/*! For license information please see main.7bc6b5ae.js.LICENSE.txt */
(()=>{"use strict";var e={11:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(s(427));class n extends r.default{eq(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}neq(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}gt(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}gte(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}lt(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}lte(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}like(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}likeAllOf(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}likeAnyOf(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}ilike(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}is(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"===typeof e&&new RegExp("[,()]").test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"in.(".concat(s,")")),this}contains(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}containedBy(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}rangeGt(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}rangeGte(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}rangeLt(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}rangeLte(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}overlaps(e,t){return"string"===typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}textSearch(e,t){let{config:s,type:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="";"plain"===a?r="pl":"phrase"===a?r="ph":"websearch"===a&&(r="w");const n=void 0===s?"":"(".concat(s,")");return this.url.searchParams.append(e,"".concat(r,"fts").concat(n,".").concat(t)),this}match(e){return Object.entries(e).forEach(e=>{let[t,s]=e;this.url.searchParams.append(t,"eq.".concat(s))}),this}not(e,t,s){return this.url.searchParams.append(e,"not.".concat(t,".").concat(s)),this}or(e){let{foreignTable:t,referencedTable:s=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=s?"".concat(s,".or"):"or";return this.url.searchParams.append(a,"(".concat(e,")")),this}filter(e,t,s){return this.url.searchParams.append(e,"".concat(t,".").concat(s)),this}}t.default=n},47:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(s(11));t.default=class{constructor(e,t){let{headers:s={},schema:a,fetch:r}=t;this.url=e,this.headers=new Headers(s),this.schema=a,this.fetch=r}select(e){let{head:t=!1,count:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=t?"HEAD":"GET";let n=!1;const i=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",i),s&&this.headers.append("Prefer","count=".concat(s)),new r.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e){let{count:t,defaultToNull:s=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var a;if(t&&this.headers.append("Prefer","count=".concat(t)),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new r.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(a=this.fetch)&&void 0!==a?a:fetch})}upsert(e){let{onConflict:t,ignoreDuplicates:s=!1,count:a,defaultToNull:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;if(this.headers.append("Prefer","resolution=".concat(s?"ignore":"merge","-duplicates")),void 0!==t&&this.url.searchParams.set("on_conflict",t),a&&this.headers.append("Prefer","count=".concat(a)),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new r.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}update(e){let{count:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s;return t&&this.headers.append("Prefer","count=".concat(t)),new r.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}delete(){let{count:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return e&&this.headers.append("Prefer","count=".concat(e)),new r.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}}},49:(e,t)=>{var s=Symbol.for("react.element"),a=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,x={};function f(e,t,s){this.props=e,this.context=t,this.refs=x,this.updater=s||p}function y(){}function b(e,t,s){this.props=e,this.context=t,this.refs=x,this.updater=s||p}f.prototype.isReactComponent={},f.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},f.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=f.prototype;var v=b.prototype=new y;v.constructor=b,g(v,f.prototype),v.isPureReactComponent=!0;var w=Array.isArray,j=Object.prototype.hasOwnProperty,_={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,a){var r,n={},i=null,l=null;if(null!=t)for(r in void 0!==t.ref&&(l=t.ref),void 0!==t.key&&(i=""+t.key),t)j.call(t,r)&&!N.hasOwnProperty(r)&&(n[r]=t[r]);var o=arguments.length-2;if(1===o)n.children=a;else if(1<o){for(var c=Array(o),d=0;d<o;d++)c[d]=arguments[d+2];n.children=c}if(e&&e.defaultProps)for(r in o=e.defaultProps)void 0===n[r]&&(n[r]=o[r]);return{$$typeof:s,type:e,key:i,ref:l,props:n,_owner:_.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===s}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function P(e,t,r,n,i){var l=typeof e;"undefined"!==l&&"boolean"!==l||(e=null);var o=!1;if(null===e)o=!0;else switch(l){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case s:case a:o=!0}}if(o)return i=i(o=e),e=""===n?"."+E(o,0):n,w(i)?(r="",null!=e&&(r=e.replace(C,"$&/")+"/"),P(i,t,r,"",function(e){return e})):null!=i&&(S(i)&&(i=function(e,t){return{$$typeof:s,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,r+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(C,"$&/")+"/")+e)),t.push(i)),1;if(o=0,n=""===n?".":n+":",w(e))for(var c=0;c<e.length;c++){var d=n+E(l=e[c],c);o+=P(l,t,r,d,i)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=m&&e[m]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(l=e.next()).done;)o+=P(l=l.value,t,r,d=n+E(l,c++),i);else if("object"===l)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function T(e,t,s){if(null==e)return e;var a=[],r=0;return P(e,a,"","",function(e){return t.call(s,e,r++)}),a}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var A={current:null},O={transition:null},F={ReactCurrentDispatcher:A,ReactCurrentBatchConfig:O,ReactCurrentOwner:_};function R(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:T,forEach:function(e,t,s){T(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return T(e,function(){t++}),t},toArray:function(e){return T(e,function(e){return e})||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=f,t.Fragment=r,t.Profiler=i,t.PureComponent=b,t.StrictMode=n,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F,t.act=R,t.cloneElement=function(e,t,a){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=g({},e.props),n=e.key,i=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,l=_.current),void 0!==t.key&&(n=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(c in t)j.call(t,c)&&!N.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==o?o[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=a;else if(1<c){o=Array(c);for(var d=0;d<c;d++)o[d]=arguments[d+2];r.children=o}return{$$typeof:s,type:e.type,key:n,ref:i,props:r,_owner:l}},t.createContext=function(e){return(e={$$typeof:o,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=R,t.useCallback=function(e,t){return A.current.useCallback(e,t)},t.useContext=function(e){return A.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return A.current.useDeferredValue(e)},t.useEffect=function(e,t){return A.current.useEffect(e,t)},t.useId=function(){return A.current.useId()},t.useImperativeHandle=function(e,t,s){return A.current.useImperativeHandle(e,t,s)},t.useInsertionEffect=function(e,t){return A.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return A.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return A.current.useMemo(e,t)},t.useReducer=function(e,t,s){return A.current.useReducer(e,t,s)},t.useRef=function(e){return A.current.useRef(e)},t.useState=function(e){return A.current.useState(e)},t.useSyncExternalStore=function(e,t,s){return A.current.useSyncExternalStore(e,t,s)},t.useTransition=function(){return A.current.useTransition()},t.version="18.3.1"},53:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;const r=a(s(71));t.PostgrestClient=r.default;const n=a(s(47));t.PostgrestQueryBuilder=n.default;const i=a(s(11));t.PostgrestFilterBuilder=i.default;const l=a(s(427));t.PostgrestTransformBuilder=l.default;const o=a(s(569));t.PostgrestBuilder=o.default;const c=a(s(732));t.PostgrestError=c.default,t.default={PostgrestClient:r.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:i.default,PostgrestTransformBuilder:l.default,PostgrestBuilder:o.default,PostgrestError:c.default}},71:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(s(47)),n=a(s(11));class i{constructor(e){let{headers:t={},schema:s,fetch:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=a}from(e){const t=new URL("".concat(this.url,"/").concat(e));return new r.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new i(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:s=!1,get:a=!1,count:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;let l;const o=new URL("".concat(this.url,"/rpc/").concat(e));let c;s||a?(l=s?"HEAD":"GET",Object.entries(t).filter(e=>{let[t,s]=e;return void 0!==s}).map(e=>{let[t,s]=e;return[t,Array.isArray(s)?"{".concat(s.join(","),"}"):"".concat(s)]}).forEach(e=>{let[t,s]=e;o.searchParams.append(t,s)})):(l="POST",c=t);const d=new Headers(this.headers);return r&&d.set("Prefer","count=".concat(r)),new n.default({method:l,url:o,headers:d,schema:this.schemaName,body:c,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}}t.default=i},119:(e,t,s)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=s(345)},340:(e,t,s)=>{e.exports=s(761)},345:(e,t,s)=>{var a=s(950),r=s(340);function n(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,l={};function o(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(l[e]=t,e=0;e<t.length;e++)i.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},p={};function g(e,t,s,a,r,n,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=a,this.attributeNamespace=r,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=n,this.removeEmptyString=i}var x={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){x[e]=new g(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];x[t]=new g(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){x[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){x[e]=new g(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){x[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){x[e]=new g(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){x[e]=new g(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){x[e]=new g(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){x[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)});var f=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,s,a){var r=x.hasOwnProperty(t)?x[t]:null;(null!==r?0!==r.type:a||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,s,a){if(null===t||"undefined"===typeof t||function(e,t,s,a){if(null!==s&&0===s.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!a&&(null!==s?!s.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,s,a))return!0;if(a)return!1;if(null!==s)switch(s.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,s,r,a)&&(s=null),a||null===r?function(e){return!!u.call(p,e)||!u.call(m,e)&&(h.test(e)?p[e]=!0:(m[e]=!0,!1))}(t)&&(null===s?e.removeAttribute(t):e.setAttribute(t,""+s)):r.mustUseProperty?e[r.propertyName]=null===s?3!==r.type&&"":s:(t=r.attributeName,a=r.attributeNamespace,null===s?e.removeAttribute(t):(s=3===(r=r.type)||4===r&&!0===s?"":""+s,a?e.setAttributeNS(a,t,s):e.setAttribute(t,s))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(f,y);x[t]=new g(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(f,y);x[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(f,y);x[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){x[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)}),x.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){x[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)});var v=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),j=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),C=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),A=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var F=Symbol.iterator;function R(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=F&&e[F]||e["@@iterator"])?e:null}var M,I=Object.assign;function L(e){if(void 0===M)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var U=!1;function z(e,t){if(!e||U)return"";U=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var a=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){a=c}e.call(t.prototype)}else{try{throw Error()}catch(c){a=c}e()}}catch(c){if(c&&a&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),n=a.stack.split("\n"),i=r.length-1,l=n.length-1;1<=i&&0<=l&&r[i]!==n[l];)l--;for(;1<=i&&0<=l;i--,l--)if(r[i]!==n[l]){if(1!==i||1!==l)do{if(i--,0>--l||r[i]!==n[l]){var o="\n"+r[i].replace(" at new "," at ");return e.displayName&&o.includes("<anonymous>")&&(o=o.replace("<anonymous>",e.displayName)),o}}while(1<=i&&0<=l);break}}}finally{U=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?L(e):""}function q(e){switch(e.tag){case 5:return L(e.type);case 16:return L("Lazy");case 13:return L("Suspense");case 19:return L("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case j:return"Portal";case k:return"Profiler";case N:return"StrictMode";case P:return"Suspense";case T:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case S:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case D:return null!==(t=e.displayName||null)?t:W(e.type)||"Memo";case A:t=e._payload,e=e._init;try{return W(e(t))}catch(s){}}return null}function B(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(t);case 8:return t===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function V(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof s&&"function"===typeof s.get&&"function"===typeof s.set){var r=s.get,n=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){a=""+e,n.call(this,e)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(e){a=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),a="";return e&&(a=H(e)?e.checked?"true":"false":e.value),(e=a)!==s&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var s=t.checked;return I({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=s?s:e._wrapperState.initialChecked})}function Y(e,t){var s=null==t.defaultValue?"":t.defaultValue,a=null!=t.checked?t.checked:t.defaultChecked;s=G(null!=t.value?t.value:s),e._wrapperState={initialChecked:a,initialValue:s,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function X(e,t){Q(e,t);var s=G(t.value),a=t.type;if(null!=s)"number"===a?(0===s&&""===e.value||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if("submit"===a||"reset"===a)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,s):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var a=t.type;if(!("submit"!==a&&"reset"!==a||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}""!==(s=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==s&&(e.name=s)}function ee(e,t,s){"number"===t&&K(e.ownerDocument)===e||(null==s?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var te=Array.isArray;function se(e,t,s,a){if(e=e.options,t){t={};for(var r=0;r<s.length;r++)t["$"+s[r]]=!0;for(s=0;s<e.length;s++)r=t.hasOwnProperty("$"+e[s].value),e[s].selected!==r&&(e[s].selected=r),r&&a&&(e[s].defaultSelected=!0)}else{for(s=""+G(s),t=null,r=0;r<e.length;r++){if(e[r].value===s)return e[r].selected=!0,void(a&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(n(91));return I({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var s=t.value;if(null==s){if(s=t.children,t=t.defaultValue,null!=s){if(null!=t)throw Error(n(92));if(te(s)){if(1<s.length)throw Error(n(93));s=s[0]}t=s}null==t&&(t=""),s=t}e._wrapperState={initialValue:G(s)}}function ne(e,t){var s=G(t.value),a=G(t.defaultValue);null!=s&&((s=""+s)!==e.value&&(e.value=s),null==t.defaultValue&&e.defaultValue!==s&&(e.defaultValue=s)),null!=a&&(e.defaultValue=""+a)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function le(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function oe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?le(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,s,a){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&3===s.nodeType)return void(s.nodeValue=t)}e.textContent=t}var me={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ge(e,t,s){return null==t||"boolean"===typeof t||""===t?"":s||"number"!==typeof t||0===t||me.hasOwnProperty(e)&&me[e]?(""+t).trim():t+"px"}function xe(e,t){for(var s in e=e.style,t)if(t.hasOwnProperty(s)){var a=0===s.indexOf("--"),r=ge(s,t[s],a);"float"===s&&(s="cssFloat"),a?e.setProperty(s,r):e[s]=r}}Object.keys(me).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),me[t]=me[e]})});var fe=I({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(fe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(n(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(n(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(n(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(n(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var je=null,_e=null,Ne=null;function ke(e){if(e=yr(e)){if("function"!==typeof je)throw Error(n(280));var t=e.stateNode;t&&(t=vr(t),je(e.stateNode,e.type,t))}}function Se(e){_e?Ne?Ne.push(e):Ne=[e]:_e=e}function Ce(){if(_e){var e=_e,t=Ne;if(Ne=_e=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Ee(e,t){return e(t)}function Pe(){}var Te=!1;function De(e,t,s){if(Te)return e(t,s);Te=!0;try{return Ee(e,t,s)}finally{Te=!1,(null!==_e||null!==Ne)&&(Pe(),Ce())}}function Ae(e,t){var s=e.stateNode;if(null===s)return null;var a=vr(s);if(null===a)return null;s=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(a=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!a;break e;default:e=!1}if(e)return null;if(s&&"function"!==typeof s)throw Error(n(231,t,typeof s));return s}var Oe=!1;if(d)try{var Fe={};Object.defineProperty(Fe,"passive",{get:function(){Oe=!0}}),window.addEventListener("test",Fe,Fe),window.removeEventListener("test",Fe,Fe)}catch(de){Oe=!1}function Re(e,t,s,a,r,n,i,l,o){var c=Array.prototype.slice.call(arguments,3);try{t.apply(s,c)}catch(d){this.onError(d)}}var Me=!1,Ie=null,Le=!1,Ue=null,ze={onError:function(e){Me=!0,Ie=e}};function qe(e,t,s,a,r,n,i,l,o){Me=!1,Ie=null,Re.apply(ze,arguments)}function We(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(s=t.return),e=t.return}while(e)}return 3===t.tag?s:null}function Be(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ge(e){if(We(e)!==e)throw Error(n(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=We(e)))throw Error(n(188));return t!==e?null:e}for(var s=e,a=t;;){var r=s.return;if(null===r)break;var i=r.alternate;if(null===i){if(null!==(a=r.return)){s=a;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===s)return Ge(r),e;if(i===a)return Ge(r),t;i=i.sibling}throw Error(n(188))}if(s.return!==a.return)s=r,a=i;else{for(var l=!1,o=r.child;o;){if(o===s){l=!0,s=r,a=i;break}if(o===a){l=!0,a=r,s=i;break}o=o.sibling}if(!l){for(o=i.child;o;){if(o===s){l=!0,s=i,a=r;break}if(o===a){l=!0,a=i,s=r;break}o=o.sibling}if(!l)throw Error(n(189))}}if(s.alternate!==a)throw Error(n(190))}if(3!==s.tag)throw Error(n(188));return s.stateNode.current===s?e:t}(e))?Ve(e):null}function Ve(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ve(e);if(null!==t)return t;e=e.sibling}return null}var Je=r.unstable_scheduleCallback,Ke=r.unstable_cancelCallback,$e=r.unstable_shouldYield,Ye=r.unstable_requestPaint,Qe=r.unstable_now,Xe=r.unstable_getCurrentPriorityLevel,Ze=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,st=r.unstable_LowPriority,at=r.unstable_IdlePriority,rt=null,nt=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(lt(e)/ot|0)|0},lt=Math.log,ot=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var s=e.pendingLanes;if(0===s)return 0;var a=0,r=e.suspendedLanes,n=e.pingedLanes,i=268435455&s;if(0!==i){var l=i&~r;0!==l?a=ut(l):0!==(n&=i)&&(a=ut(n))}else 0!==(i=s&~r)?a=ut(i):0!==n&&(a=ut(n));if(0===a)return 0;if(0!==t&&t!==a&&0===(t&r)&&((r=a&-a)>=(n=t&-t)||16===r&&0!==(4194240&n)))return t;if(0!==(4&a)&&(a|=16&s),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=a;0<t;)r=1<<(s=31-it(t)),a|=e[s],t&=~r;return a}function mt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function xt(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function ft(e,t,s){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=s}function yt(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var a=31-it(s),r=1<<a;r&t|e[a]&t&&(e[a]|=t),s&=~r}}var bt=0;function vt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,jt,_t,Nt,kt,St=!1,Ct=[],Et=null,Pt=null,Tt=null,Dt=new Map,At=new Map,Ot=[],Ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rt(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":Tt=null;break;case"pointerover":case"pointerout":Dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":At.delete(t.pointerId)}}function Mt(e,t,s,a,r,n){return null===e||e.nativeEvent!==n?(e={blockedOn:t,domEventName:s,eventSystemFlags:a,nativeEvent:n,targetContainers:[r]},null!==t&&(null!==(t=yr(t))&&jt(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function It(e){var t=fr(e.target);if(null!==t){var s=We(t);if(null!==s)if(13===(t=s.tag)){if(null!==(t=Be(s)))return e.blockedOn=t,void kt(e.priority,function(){_t(s)})}else if(3===t&&s.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===s.tag?s.stateNode.containerInfo:null)}e.blockedOn=null}function Lt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var s=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==s)return null!==(t=yr(s))&&jt(t),e.blockedOn=s,!1;var a=new(s=e.nativeEvent).constructor(s.type,s);ve=a,s.target.dispatchEvent(a),ve=null,t.shift()}return!0}function Ut(e,t,s){Lt(e)&&s.delete(t)}function zt(){St=!1,null!==Et&&Lt(Et)&&(Et=null),null!==Pt&&Lt(Pt)&&(Pt=null),null!==Tt&&Lt(Tt)&&(Tt=null),Dt.forEach(Ut),At.forEach(Ut)}function qt(e,t){e.blockedOn===t&&(e.blockedOn=null,St||(St=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,zt)))}function Wt(e){function t(t){return qt(t,e)}if(0<Ct.length){qt(Ct[0],e);for(var s=1;s<Ct.length;s++){var a=Ct[s];a.blockedOn===e&&(a.blockedOn=null)}}for(null!==Et&&qt(Et,e),null!==Pt&&qt(Pt,e),null!==Tt&&qt(Tt,e),Dt.forEach(t),At.forEach(t),s=0;s<Ot.length;s++)(a=Ot[s]).blockedOn===e&&(a.blockedOn=null);for(;0<Ot.length&&null===(s=Ot[0]).blockedOn;)It(s),null===s.blockedOn&&Ot.shift()}var Bt=v.ReactCurrentBatchConfig,Gt=!0;function Ht(e,t,s,a){var r=bt,n=Bt.transition;Bt.transition=null;try{bt=1,Jt(e,t,s,a)}finally{bt=r,Bt.transition=n}}function Vt(e,t,s,a){var r=bt,n=Bt.transition;Bt.transition=null;try{bt=4,Jt(e,t,s,a)}finally{bt=r,Bt.transition=n}}function Jt(e,t,s,a){if(Gt){var r=$t(e,t,s,a);if(null===r)Ba(e,t,a,Kt,s),Rt(e,a);else if(function(e,t,s,a,r){switch(t){case"focusin":return Et=Mt(Et,e,t,s,a,r),!0;case"dragenter":return Pt=Mt(Pt,e,t,s,a,r),!0;case"mouseover":return Tt=Mt(Tt,e,t,s,a,r),!0;case"pointerover":var n=r.pointerId;return Dt.set(n,Mt(Dt.get(n)||null,e,t,s,a,r)),!0;case"gotpointercapture":return n=r.pointerId,At.set(n,Mt(At.get(n)||null,e,t,s,a,r)),!0}return!1}(r,e,t,s,a))a.stopPropagation();else if(Rt(e,a),4&t&&-1<Ft.indexOf(e)){for(;null!==r;){var n=yr(r);if(null!==n&&wt(n),null===(n=$t(e,t,s,a))&&Ba(e,t,a,Kt,s),n===r)break;r=n}null!==r&&a.stopPropagation()}else Ba(e,t,a,null,s)}}var Kt=null;function $t(e,t,s,a){if(Kt=null,null!==(e=fr(e=we(a))))if(null===(t=We(e)))e=null;else if(13===(s=t.tag)){if(null!==(e=Be(t)))return e;e=null}else if(3===s){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case st:return 16;case at:return 536870912;default:return 16}default:return 16}}var Qt=null,Xt=null,Zt=null;function es(){if(Zt)return Zt;var e,t,s=Xt,a=s.length,r="value"in Qt?Qt.value:Qt.textContent,n=r.length;for(e=0;e<a&&s[e]===r[e];e++);var i=a-e;for(t=1;t<=i&&s[a-t]===r[n-t];t++);return Zt=r.slice(e,1<t?1-t:void 0)}function ts(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ss(){return!0}function as(){return!1}function rs(e){function t(t,s,a,r,n){for(var i in this._reactName=t,this._targetInst=a,this.type=s,this.nativeEvent=r,this.target=n,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(r):r[i]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ss:as,this.isPropagationStopped=as,this}return I(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ss)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ss)},persist:function(){},isPersistent:ss}),t}var ns,is,ls,os={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cs=rs(os),ds=I({},os,{view:0,detail:0}),us=rs(ds),hs=I({},ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ns,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ls&&(ls&&"mousemove"===e.type?(ns=e.screenX-ls.screenX,is=e.screenY-ls.screenY):is=ns=0,ls=e),ns)},movementY:function(e){return"movementY"in e?e.movementY:is}}),ms=rs(hs),ps=rs(I({},hs,{dataTransfer:0})),gs=rs(I({},ds,{relatedTarget:0})),xs=rs(I({},os,{animationName:0,elapsedTime:0,pseudoElement:0})),fs=I({},os,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ys=rs(fs),bs=rs(I({},os,{data:0})),vs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ws={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},js={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _s(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=js[e])&&!!t[e]}function Ns(){return _s}var ks=I({},ds,{key:function(e){if(e.key){var t=vs[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ts(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ws[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ns,charCode:function(e){return"keypress"===e.type?ts(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ts(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ss=rs(ks),Cs=rs(I({},hs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Es=rs(I({},ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ns})),Ps=rs(I({},os,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ts=I({},hs,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ds=rs(Ts),As=[9,13,27,32],Os=d&&"CompositionEvent"in window,Fs=null;d&&"documentMode"in document&&(Fs=document.documentMode);var Rs=d&&"TextEvent"in window&&!Fs,Ms=d&&(!Os||Fs&&8<Fs&&11>=Fs),Is=String.fromCharCode(32),Ls=!1;function Us(e,t){switch(e){case"keyup":return-1!==As.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zs(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var qs=!1;var Ws={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bs(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Ws[e.type]:"textarea"===t}function Gs(e,t,s,a){Se(a),0<(t=Ha(t,"onChange")).length&&(s=new cs("onChange","change",null,s,a),e.push({event:s,listeners:t}))}var Hs=null,Vs=null;function Js(e){Ia(e,0)}function Ks(e){if(J(br(e)))return e}function $s(e,t){if("change"===e)return t}var Ys=!1;if(d){var Qs;if(d){var Xs="oninput"in document;if(!Xs){var Zs=document.createElement("div");Zs.setAttribute("oninput","return;"),Xs="function"===typeof Zs.oninput}Qs=Xs}else Qs=!1;Ys=Qs&&(!document.documentMode||9<document.documentMode)}function ea(){Hs&&(Hs.detachEvent("onpropertychange",ta),Vs=Hs=null)}function ta(e){if("value"===e.propertyName&&Ks(Vs)){var t=[];Gs(t,Vs,e,we(e)),De(Js,t)}}function sa(e,t,s){"focusin"===e?(ea(),Vs=s,(Hs=t).attachEvent("onpropertychange",ta)):"focusout"===e&&ea()}function aa(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ks(Vs)}function ra(e,t){if("click"===e)return Ks(t)}function na(e,t){if("input"===e||"change"===e)return Ks(t)}var ia="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function la(e,t){if(ia(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var s=Object.keys(e),a=Object.keys(t);if(s.length!==a.length)return!1;for(a=0;a<s.length;a++){var r=s[a];if(!u.call(t,r)||!ia(e[r],t[r]))return!1}return!0}function oa(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ca(e,t){var s,a=oa(e);for(e=0;a;){if(3===a.nodeType){if(s=e+a.textContent.length,e<=t&&s>=t)return{node:a,offset:t-e};e=s}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=oa(a)}}function da(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?da(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ua(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var s="string"===typeof t.contentWindow.location.href}catch(a){s=!1}if(!s)break;t=K((e=t.contentWindow).document)}return t}function ha(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function ma(e){var t=ua(),s=e.focusedElem,a=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&da(s.ownerDocument.documentElement,s)){if(null!==a&&ha(s))if(t=a.start,void 0===(e=a.end)&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if((e=(t=s.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=s.textContent.length,n=Math.min(a.start,r);a=void 0===a.end?n:Math.min(a.end,r),!e.extend&&n>a&&(r=a,a=n,n=r),r=ca(s,n);var i=ca(s,a);r&&i&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),n>a?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=s;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<t.length;s++)(e=t[s]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var pa=d&&"documentMode"in document&&11>=document.documentMode,ga=null,xa=null,fa=null,ya=!1;function ba(e,t,s){var a=s.window===s?s.document:9===s.nodeType?s:s.ownerDocument;ya||null==ga||ga!==K(a)||("selectionStart"in(a=ga)&&ha(a)?a={start:a.selectionStart,end:a.selectionEnd}:a={anchorNode:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset},fa&&la(fa,a)||(fa=a,0<(a=Ha(xa,"onSelect")).length&&(t=new cs("onSelect","select",null,t,s),e.push({event:t,listeners:a}),t.target=ga)))}function va(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var wa={animationend:va("Animation","AnimationEnd"),animationiteration:va("Animation","AnimationIteration"),animationstart:va("Animation","AnimationStart"),transitionend:va("Transition","TransitionEnd")},ja={},_a={};function Na(e){if(ja[e])return ja[e];if(!wa[e])return e;var t,s=wa[e];for(t in s)if(s.hasOwnProperty(t)&&t in _a)return ja[e]=s[t];return e}d&&(_a=document.createElement("div").style,"AnimationEvent"in window||(delete wa.animationend.animation,delete wa.animationiteration.animation,delete wa.animationstart.animation),"TransitionEvent"in window||delete wa.transitionend.transition);var ka=Na("animationend"),Sa=Na("animationiteration"),Ca=Na("animationstart"),Ea=Na("transitionend"),Pa=new Map,Ta="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Da(e,t){Pa.set(e,t),o(t,[e])}for(var Aa=0;Aa<Ta.length;Aa++){var Oa=Ta[Aa];Da(Oa.toLowerCase(),"on"+(Oa[0].toUpperCase()+Oa.slice(1)))}Da(ka,"onAnimationEnd"),Da(Sa,"onAnimationIteration"),Da(Ca,"onAnimationStart"),Da("dblclick","onDoubleClick"),Da("focusin","onFocus"),Da("focusout","onBlur"),Da(Ea,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ra=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fa));function Ma(e,t,s){var a=e.type||"unknown-event";e.currentTarget=s,function(e,t,s,a,r,i,l,o,c){if(qe.apply(this,arguments),Me){if(!Me)throw Error(n(198));var d=Ie;Me=!1,Ie=null,Le||(Le=!0,Ue=d)}}(a,t,void 0,e),e.currentTarget=null}function Ia(e,t){t=0!==(4&t);for(var s=0;s<e.length;s++){var a=e[s],r=a.event;a=a.listeners;e:{var n=void 0;if(t)for(var i=a.length-1;0<=i;i--){var l=a[i],o=l.instance,c=l.currentTarget;if(l=l.listener,o!==n&&r.isPropagationStopped())break e;Ma(r,l,c),n=o}else for(i=0;i<a.length;i++){if(o=(l=a[i]).instance,c=l.currentTarget,l=l.listener,o!==n&&r.isPropagationStopped())break e;Ma(r,l,c),n=o}}}if(Le)throw e=Ue,Le=!1,Ue=null,e}function La(e,t){var s=t[pr];void 0===s&&(s=t[pr]=new Set);var a=e+"__bubble";s.has(a)||(Wa(t,e,2,!1),s.add(a))}function Ua(e,t,s){var a=0;t&&(a|=4),Wa(s,e,a,t)}var za="_reactListening"+Math.random().toString(36).slice(2);function qa(e){if(!e[za]){e[za]=!0,i.forEach(function(t){"selectionchange"!==t&&(Ra.has(t)||Ua(t,!1,e),Ua(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[za]||(t[za]=!0,Ua("selectionchange",!1,t))}}function Wa(e,t,s,a){switch(Yt(t)){case 1:var r=Ht;break;case 4:r=Vt;break;default:r=Jt}s=r.bind(null,t,s,e),r=void 0,!Oe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),a?void 0!==r?e.addEventListener(t,s,{capture:!0,passive:r}):e.addEventListener(t,s,!0):void 0!==r?e.addEventListener(t,s,{passive:r}):e.addEventListener(t,s,!1)}function Ba(e,t,s,a,r){var n=a;if(0===(1&t)&&0===(2&t)&&null!==a)e:for(;;){if(null===a)return;var i=a.tag;if(3===i||4===i){var l=a.stateNode.containerInfo;if(l===r||8===l.nodeType&&l.parentNode===r)break;if(4===i)for(i=a.return;null!==i;){var o=i.tag;if((3===o||4===o)&&((o=i.stateNode.containerInfo)===r||8===o.nodeType&&o.parentNode===r))return;i=i.return}for(;null!==l;){if(null===(i=fr(l)))return;if(5===(o=i.tag)||6===o){a=n=i;continue e}l=l.parentNode}}a=a.return}De(function(){var a=n,r=we(s),i=[];e:{var l=Pa.get(e);if(void 0!==l){var o=cs,c=e;switch(e){case"keypress":if(0===ts(s))break e;case"keydown":case"keyup":o=Ss;break;case"focusin":c="focus",o=gs;break;case"focusout":c="blur",o=gs;break;case"beforeblur":case"afterblur":o=gs;break;case"click":if(2===s.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":o=ms;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":o=ps;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":o=Es;break;case ka:case Sa:case Ca:o=xs;break;case Ea:o=Ps;break;case"scroll":o=us;break;case"wheel":o=Ds;break;case"copy":case"cut":case"paste":o=ys;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":o=Cs}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==l?l+"Capture":null:l;d=[];for(var m,p=a;null!==p;){var g=(m=p).stateNode;if(5===m.tag&&null!==g&&(m=g,null!==h&&(null!=(g=Ae(p,h))&&d.push(Ga(p,g,m)))),u)break;p=p.return}0<d.length&&(l=new o(l,c,null,s,r),i.push({event:l,listeners:d}))}}if(0===(7&t)){if(o="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||s===ve||!(c=s.relatedTarget||s.fromElement)||!fr(c)&&!c[mr])&&(o||l)&&(l=r.window===r?r:(l=r.ownerDocument)?l.defaultView||l.parentWindow:window,o?(o=a,null!==(c=(c=s.relatedTarget||s.toElement)?fr(c):null)&&(c!==(u=We(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(o=null,c=a),o!==c)){if(d=ms,g="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(d=Cs,g="onPointerLeave",h="onPointerEnter",p="pointer"),u=null==o?l:br(o),m=null==c?l:br(c),(l=new d(g,p+"leave",o,s,r)).target=u,l.relatedTarget=m,g=null,fr(r)===a&&((d=new d(h,p+"enter",c,s,r)).target=m,d.relatedTarget=u,g=d),u=g,o&&c)e:{for(h=c,p=0,m=d=o;m;m=Va(m))p++;for(m=0,g=h;g;g=Va(g))m++;for(;0<p-m;)d=Va(d),p--;for(;0<m-p;)h=Va(h),m--;for(;p--;){if(d===h||null!==h&&d===h.alternate)break e;d=Va(d),h=Va(h)}d=null}else d=null;null!==o&&Ja(i,l,o,d,!1),null!==c&&null!==u&&Ja(i,u,c,d,!0)}if("select"===(o=(l=a?br(a):window).nodeName&&l.nodeName.toLowerCase())||"input"===o&&"file"===l.type)var x=$s;else if(Bs(l))if(Ys)x=na;else{x=aa;var f=sa}else(o=l.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===l.type||"radio"===l.type)&&(x=ra);switch(x&&(x=x(e,a))?Gs(i,x,s,r):(f&&f(e,l,a),"focusout"===e&&(f=l._wrapperState)&&f.controlled&&"number"===l.type&&ee(l,"number",l.value)),f=a?br(a):window,e){case"focusin":(Bs(f)||"true"===f.contentEditable)&&(ga=f,xa=a,fa=null);break;case"focusout":fa=xa=ga=null;break;case"mousedown":ya=!0;break;case"contextmenu":case"mouseup":case"dragend":ya=!1,ba(i,s,r);break;case"selectionchange":if(pa)break;case"keydown":case"keyup":ba(i,s,r)}var y;if(Os)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else qs?Us(e,s)&&(b="onCompositionEnd"):"keydown"===e&&229===s.keyCode&&(b="onCompositionStart");b&&(Ms&&"ko"!==s.locale&&(qs||"onCompositionStart"!==b?"onCompositionEnd"===b&&qs&&(y=es()):(Xt="value"in(Qt=r)?Qt.value:Qt.textContent,qs=!0)),0<(f=Ha(a,b)).length&&(b=new bs(b,e,null,s,r),i.push({event:b,listeners:f}),y?b.data=y:null!==(y=zs(s))&&(b.data=y))),(y=Rs?function(e,t){switch(e){case"compositionend":return zs(t);case"keypress":return 32!==t.which?null:(Ls=!0,Is);case"textInput":return(e=t.data)===Is&&Ls?null:e;default:return null}}(e,s):function(e,t){if(qs)return"compositionend"===e||!Os&&Us(e,t)?(e=es(),Zt=Xt=Qt=null,qs=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ms&&"ko"!==t.locale?null:t.data}}(e,s))&&(0<(a=Ha(a,"onBeforeInput")).length&&(r=new bs("onBeforeInput","beforeinput",null,s,r),i.push({event:r,listeners:a}),r.data=y))}Ia(i,t)})}function Ga(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Ha(e,t){for(var s=t+"Capture",a=[];null!==e;){var r=e,n=r.stateNode;5===r.tag&&null!==n&&(r=n,null!=(n=Ae(e,s))&&a.unshift(Ga(e,n,r)),null!=(n=Ae(e,t))&&a.push(Ga(e,n,r))),e=e.return}return a}function Va(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ja(e,t,s,a,r){for(var n=t._reactName,i=[];null!==s&&s!==a;){var l=s,o=l.alternate,c=l.stateNode;if(null!==o&&o===a)break;5===l.tag&&null!==c&&(l=c,r?null!=(o=Ae(s,n))&&i.unshift(Ga(s,o,l)):r||null!=(o=Ae(s,n))&&i.push(Ga(s,o,l))),s=s.return}0!==i.length&&e.push({event:t,listeners:i})}var Ka=/\r\n?/g,$a=/\u0000|\uFFFD/g;function Ya(e){return("string"===typeof e?e:""+e).replace(Ka,"\n").replace($a,"")}function Qa(e,t,s){if(t=Ya(t),Ya(e)!==t&&s)throw Error(n(425))}function Xa(){}var Za=null,er=null;function tr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var sr="function"===typeof setTimeout?setTimeout:void 0,ar="function"===typeof clearTimeout?clearTimeout:void 0,rr="function"===typeof Promise?Promise:void 0,nr="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof rr?function(e){return rr.resolve(null).then(e).catch(ir)}:sr;function ir(e){setTimeout(function(){throw e})}function lr(e,t){var s=t,a=0;do{var r=s.nextSibling;if(e.removeChild(s),r&&8===r.nodeType)if("/$"===(s=r.data)){if(0===a)return e.removeChild(r),void Wt(t);a--}else"$"!==s&&"$?"!==s&&"$!"!==s||a++;s=r}while(s);Wt(t)}function or(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function cr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var s=e.data;if("$"===s||"$!"===s||"$?"===s){if(0===t)return e;t--}else"/$"===s&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),ur="__reactFiber$"+dr,hr="__reactProps$"+dr,mr="__reactContainer$"+dr,pr="__reactEvents$"+dr,gr="__reactListeners$"+dr,xr="__reactHandles$"+dr;function fr(e){var t=e[ur];if(t)return t;for(var s=e.parentNode;s;){if(t=s[mr]||s[ur]){if(s=t.alternate,null!==t.child||null!==s&&null!==s.child)for(e=cr(e);null!==e;){if(s=e[ur])return s;e=cr(e)}return t}s=(e=s).parentNode}return null}function yr(e){return!(e=e[ur]||e[mr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function br(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(n(33))}function vr(e){return e[hr]||null}var wr=[],jr=-1;function _r(e){return{current:e}}function Nr(e){0>jr||(e.current=wr[jr],wr[jr]=null,jr--)}function kr(e,t){jr++,wr[jr]=e.current,e.current=t}var Sr={},Cr=_r(Sr),Er=_r(!1),Pr=Sr;function Tr(e,t){var s=e.type.contextTypes;if(!s)return Sr;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===t)return a.__reactInternalMemoizedMaskedChildContext;var r,n={};for(r in s)n[r]=t[r];return a&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Dr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ar(){Nr(Er),Nr(Cr)}function Or(e,t,s){if(Cr.current!==Sr)throw Error(n(168));kr(Cr,t),kr(Er,s)}function Fr(e,t,s){var a=e.stateNode;if(t=t.childContextTypes,"function"!==typeof a.getChildContext)return s;for(var r in a=a.getChildContext())if(!(r in t))throw Error(n(108,B(e)||"Unknown",r));return I({},s,a)}function Rr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Sr,Pr=Cr.current,kr(Cr,e),kr(Er,Er.current),!0}function Mr(e,t,s){var a=e.stateNode;if(!a)throw Error(n(169));s?(e=Fr(e,t,Pr),a.__reactInternalMemoizedMergedChildContext=e,Nr(Er),Nr(Cr),kr(Cr,e)):Nr(Er),kr(Er,s)}var Ir=null,Lr=!1,Ur=!1;function zr(e){null===Ir?Ir=[e]:Ir.push(e)}function qr(){if(!Ur&&null!==Ir){Ur=!0;var e=0,t=bt;try{var s=Ir;for(bt=1;e<s.length;e++){var a=s[e];do{a=a(!0)}while(null!==a)}Ir=null,Lr=!1}catch(r){throw null!==Ir&&(Ir=Ir.slice(e+1)),Je(Ze,qr),r}finally{bt=t,Ur=!1}}return null}var Wr=[],Br=0,Gr=null,Hr=0,Vr=[],Jr=0,Kr=null,$r=1,Yr="";function Qr(e,t){Wr[Br++]=Hr,Wr[Br++]=Gr,Gr=e,Hr=t}function Xr(e,t,s){Vr[Jr++]=$r,Vr[Jr++]=Yr,Vr[Jr++]=Kr,Kr=e;var a=$r;e=Yr;var r=32-it(a)-1;a&=~(1<<r),s+=1;var n=32-it(t)+r;if(30<n){var i=r-r%5;n=(a&(1<<i)-1).toString(32),a>>=i,r-=i,$r=1<<32-it(t)+r|s<<r|a,Yr=n+e}else $r=1<<n|s<<r|a,Yr=e}function Zr(e){null!==e.return&&(Qr(e,1),Xr(e,1,0))}function en(e){for(;e===Gr;)Gr=Wr[--Br],Wr[Br]=null,Hr=Wr[--Br],Wr[Br]=null;for(;e===Kr;)Kr=Vr[--Jr],Vr[Jr]=null,Yr=Vr[--Jr],Vr[Jr]=null,$r=Vr[--Jr],Vr[Jr]=null}var tn=null,sn=null,an=!1,rn=null;function nn(e,t){var s=Dc(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,null===(t=e.deletions)?(e.deletions=[s],e.flags|=16):t.push(s)}function ln(e,t){switch(e.tag){case 5:var s=e.type;return null!==(t=1!==t.nodeType||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,tn=e,sn=or(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,tn=e,sn=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(s=null!==Kr?{id:$r,overflow:Yr}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},(s=Dc(18,null,null,0)).stateNode=t,s.return=e,e.child=s,tn=e,sn=null,!0);default:return!1}}function on(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cn(e){if(an){var t=sn;if(t){var s=t;if(!ln(e,t)){if(on(e))throw Error(n(418));t=or(s.nextSibling);var a=tn;t&&ln(e,t)?nn(a,s):(e.flags=-4097&e.flags|2,an=!1,tn=e)}}else{if(on(e))throw Error(n(418));e.flags=-4097&e.flags|2,an=!1,tn=e}}}function dn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;tn=e}function un(e){if(e!==tn)return!1;if(!an)return dn(e),an=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!tr(e.type,e.memoizedProps)),t&&(t=sn)){if(on(e))throw hn(),Error(n(418));for(;t;)nn(e,t),t=or(t.nextSibling)}if(dn(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(n(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var s=e.data;if("/$"===s){if(0===t){sn=or(e.nextSibling);break e}t--}else"$"!==s&&"$!"!==s&&"$?"!==s||t++}e=e.nextSibling}sn=null}}else sn=tn?or(e.stateNode.nextSibling):null;return!0}function hn(){for(var e=sn;e;)e=or(e.nextSibling)}function mn(){sn=tn=null,an=!1}function pn(e){null===rn?rn=[e]:rn.push(e)}var gn=v.ReactCurrentBatchConfig;function xn(e,t,s){if(null!==(e=s.ref)&&"function"!==typeof e&&"object"!==typeof e){if(s._owner){if(s=s._owner){if(1!==s.tag)throw Error(n(309));var a=s.stateNode}if(!a)throw Error(n(147,e));var r=a,i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=r.refs;null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(n(284));if(!s._owner)throw Error(n(290,e))}return e}function fn(e,t){throw e=Object.prototype.toString.call(t),Error(n(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yn(e){return(0,e._init)(e._payload)}function bn(e){function t(t,s){if(e){var a=t.deletions;null===a?(t.deletions=[s],t.flags|=16):a.push(s)}}function s(s,a){if(!e)return null;for(;null!==a;)t(s,a),a=a.sibling;return null}function a(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Oc(e,t)).index=0,e.sibling=null,e}function i(t,s,a){return t.index=a,e?null!==(a=t.alternate)?(a=a.index)<s?(t.flags|=2,s):a:(t.flags|=2,s):(t.flags|=1048576,s)}function l(t){return e&&null===t.alternate&&(t.flags|=2),t}function o(e,t,s,a){return null===t||6!==t.tag?((t=Ic(s,e.mode,a)).return=e,t):((t=r(t,s)).return=e,t)}function c(e,t,s,a){var n=s.type;return n===_?u(e,t,s.props.children,a,s.key):null!==t&&(t.elementType===n||"object"===typeof n&&null!==n&&n.$$typeof===A&&yn(n)===t.type)?((a=r(t,s.props)).ref=xn(e,t,s),a.return=e,a):((a=Fc(s.type,s.key,s.props,null,e.mode,a)).ref=xn(e,t,s),a.return=e,a)}function d(e,t,s,a){return null===t||4!==t.tag||t.stateNode.containerInfo!==s.containerInfo||t.stateNode.implementation!==s.implementation?((t=Lc(s,e.mode,a)).return=e,t):((t=r(t,s.children||[])).return=e,t)}function u(e,t,s,a,n){return null===t||7!==t.tag?((t=Rc(s,e.mode,a,n)).return=e,t):((t=r(t,s)).return=e,t)}function h(e,t,s){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ic(""+t,e.mode,s)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(s=Fc(t.type,t.key,t.props,null,e.mode,s)).ref=xn(e,null,t),s.return=e,s;case j:return(t=Lc(t,e.mode,s)).return=e,t;case A:return h(e,(0,t._init)(t._payload),s)}if(te(t)||R(t))return(t=Rc(t,e.mode,s,null)).return=e,t;fn(e,t)}return null}function m(e,t,s,a){var r=null!==t?t.key:null;if("string"===typeof s&&""!==s||"number"===typeof s)return null!==r?null:o(e,t,""+s,a);if("object"===typeof s&&null!==s){switch(s.$$typeof){case w:return s.key===r?c(e,t,s,a):null;case j:return s.key===r?d(e,t,s,a):null;case A:return m(e,t,(r=s._init)(s._payload),a)}if(te(s)||R(s))return null!==r?null:u(e,t,s,a,null);fn(e,s)}return null}function p(e,t,s,a,r){if("string"===typeof a&&""!==a||"number"===typeof a)return o(t,e=e.get(s)||null,""+a,r);if("object"===typeof a&&null!==a){switch(a.$$typeof){case w:return c(t,e=e.get(null===a.key?s:a.key)||null,a,r);case j:return d(t,e=e.get(null===a.key?s:a.key)||null,a,r);case A:return p(e,t,s,(0,a._init)(a._payload),r)}if(te(a)||R(a))return u(t,e=e.get(s)||null,a,r,null);fn(t,a)}return null}function g(r,n,l,o){for(var c=null,d=null,u=n,g=n=0,x=null;null!==u&&g<l.length;g++){u.index>g?(x=u,u=null):x=u.sibling;var f=m(r,u,l[g],o);if(null===f){null===u&&(u=x);break}e&&u&&null===f.alternate&&t(r,u),n=i(f,n,g),null===d?c=f:d.sibling=f,d=f,u=x}if(g===l.length)return s(r,u),an&&Qr(r,g),c;if(null===u){for(;g<l.length;g++)null!==(u=h(r,l[g],o))&&(n=i(u,n,g),null===d?c=u:d.sibling=u,d=u);return an&&Qr(r,g),c}for(u=a(r,u);g<l.length;g++)null!==(x=p(u,r,g,l[g],o))&&(e&&null!==x.alternate&&u.delete(null===x.key?g:x.key),n=i(x,n,g),null===d?c=x:d.sibling=x,d=x);return e&&u.forEach(function(e){return t(r,e)}),an&&Qr(r,g),c}function x(r,l,o,c){var d=R(o);if("function"!==typeof d)throw Error(n(150));if(null==(o=d.call(o)))throw Error(n(151));for(var u=d=null,g=l,x=l=0,f=null,y=o.next();null!==g&&!y.done;x++,y=o.next()){g.index>x?(f=g,g=null):f=g.sibling;var b=m(r,g,y.value,c);if(null===b){null===g&&(g=f);break}e&&g&&null===b.alternate&&t(r,g),l=i(b,l,x),null===u?d=b:u.sibling=b,u=b,g=f}if(y.done)return s(r,g),an&&Qr(r,x),d;if(null===g){for(;!y.done;x++,y=o.next())null!==(y=h(r,y.value,c))&&(l=i(y,l,x),null===u?d=y:u.sibling=y,u=y);return an&&Qr(r,x),d}for(g=a(r,g);!y.done;x++,y=o.next())null!==(y=p(g,r,x,y.value,c))&&(e&&null!==y.alternate&&g.delete(null===y.key?x:y.key),l=i(y,l,x),null===u?d=y:u.sibling=y,u=y);return e&&g.forEach(function(e){return t(r,e)}),an&&Qr(r,x),d}return function e(a,n,i,o){if("object"===typeof i&&null!==i&&i.type===_&&null===i.key&&(i=i.props.children),"object"===typeof i&&null!==i){switch(i.$$typeof){case w:e:{for(var c=i.key,d=n;null!==d;){if(d.key===c){if((c=i.type)===_){if(7===d.tag){s(a,d.sibling),(n=r(d,i.props.children)).return=a,a=n;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===A&&yn(c)===d.type){s(a,d.sibling),(n=r(d,i.props)).ref=xn(a,d,i),n.return=a,a=n;break e}s(a,d);break}t(a,d),d=d.sibling}i.type===_?((n=Rc(i.props.children,a.mode,o,i.key)).return=a,a=n):((o=Fc(i.type,i.key,i.props,null,a.mode,o)).ref=xn(a,n,i),o.return=a,a=o)}return l(a);case j:e:{for(d=i.key;null!==n;){if(n.key===d){if(4===n.tag&&n.stateNode.containerInfo===i.containerInfo&&n.stateNode.implementation===i.implementation){s(a,n.sibling),(n=r(n,i.children||[])).return=a,a=n;break e}s(a,n);break}t(a,n),n=n.sibling}(n=Lc(i,a.mode,o)).return=a,a=n}return l(a);case A:return e(a,n,(d=i._init)(i._payload),o)}if(te(i))return g(a,n,i,o);if(R(i))return x(a,n,i,o);fn(a,i)}return"string"===typeof i&&""!==i||"number"===typeof i?(i=""+i,null!==n&&6===n.tag?(s(a,n.sibling),(n=r(n,i)).return=a,a=n):(s(a,n),(n=Ic(i,a.mode,o)).return=a,a=n),l(a)):s(a,n)}}var vn=bn(!0),wn=bn(!1),jn=_r(null),_n=null,Nn=null,kn=null;function Sn(){kn=Nn=_n=null}function Cn(e){var t=jn.current;Nr(jn),e._currentValue=t}function En(e,t,s){for(;null!==e;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==a&&(a.childLanes|=t)):null!==a&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===s)break;e=e.return}}function Pn(e,t){_n=e,kn=Nn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(yl=!0),e.firstContext=null)}function Tn(e){var t=e._currentValue;if(kn!==e)if(e={context:e,memoizedValue:t,next:null},null===Nn){if(null===_n)throw Error(n(308));Nn=e,_n.dependencies={lanes:0,firstContext:e}}else Nn=Nn.next=e;return t}var Dn=null;function An(e){null===Dn?Dn=[e]:Dn.push(e)}function On(e,t,s,a){var r=t.interleaved;return null===r?(s.next=s,An(t)):(s.next=r.next,r.next=s),t.interleaved=s,Fn(e,a)}function Fn(e,t){e.lanes|=t;var s=e.alternate;for(null!==s&&(s.lanes|=t),s=e,e=e.return;null!==e;)e.childLanes|=t,null!==(s=e.alternate)&&(s.childLanes|=t),s=e,e=e.return;return 3===s.tag?s.stateNode:null}var Rn=!1;function Mn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function In(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ln(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Un(e,t,s){var a=e.updateQueue;if(null===a)return null;if(a=a.shared,0!==(2&Eo)){var r=a.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),a.pending=t,Fn(e,s)}return null===(r=a.interleaved)?(t.next=t,An(a)):(t.next=r.next,r.next=t),a.interleaved=t,Fn(e,s)}function zn(e,t,s){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&s))){var a=t.lanes;s|=a&=e.pendingLanes,t.lanes=s,yt(e,s)}}function qn(e,t){var s=e.updateQueue,a=e.alternate;if(null!==a&&s===(a=a.updateQueue)){var r=null,n=null;if(null!==(s=s.firstBaseUpdate)){do{var i={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};null===n?r=n=i:n=n.next=i,s=s.next}while(null!==s);null===n?r=n=t:n=n.next=t}else r=n=t;return s={baseState:a.baseState,firstBaseUpdate:r,lastBaseUpdate:n,shared:a.shared,effects:a.effects},void(e.updateQueue=s)}null===(e=s.lastBaseUpdate)?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Wn(e,t,s,a){var r=e.updateQueue;Rn=!1;var n=r.firstBaseUpdate,i=r.lastBaseUpdate,l=r.shared.pending;if(null!==l){r.shared.pending=null;var o=l,c=o.next;o.next=null,null===i?n=c:i.next=c,i=o;var d=e.alternate;null!==d&&((l=(d=d.updateQueue).lastBaseUpdate)!==i&&(null===l?d.firstBaseUpdate=c:l.next=c,d.lastBaseUpdate=o))}if(null!==n){var u=r.baseState;for(i=0,d=c=o=null,l=n;;){var h=l.lane,m=l.eventTime;if((a&h)===h){null!==d&&(d=d.next={eventTime:m,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var p=e,g=l;switch(h=t,m=s,g.tag){case 1:if("function"===typeof(p=g.payload)){u=p.call(m,u,h);break e}u=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=g.payload)?p.call(m,u,h):p)||void 0===h)break e;u=I({},u,h);break e;case 2:Rn=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[l]:h.push(l))}else m={eventTime:m,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===d?(c=d=m,o=u):d=d.next=m,i|=h;if(null===(l=l.next)){if(null===(l=r.shared.pending))break;l=(h=l).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===d&&(o=u),r.baseState=o,r.firstBaseUpdate=c,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do{i|=r.lane,r=r.next}while(r!==t)}else null===n&&(r.shared.lanes=0);Mo|=i,e.lanes=i,e.memoizedState=u}}function Bn(e,t,s){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var a=e[t],r=a.callback;if(null!==r){if(a.callback=null,a=s,"function"!==typeof r)throw Error(n(191,r));r.call(a)}}}var Gn={},Hn=_r(Gn),Vn=_r(Gn),Jn=_r(Gn);function Kn(e){if(e===Gn)throw Error(n(174));return e}function $n(e,t){switch(kr(Jn,t),kr(Vn,e),kr(Hn,Gn),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:oe(null,"");break;default:t=oe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Nr(Hn),kr(Hn,t)}function Yn(){Nr(Hn),Nr(Vn),Nr(Jn)}function Qn(e){Kn(Jn.current);var t=Kn(Hn.current),s=oe(t,e.type);t!==s&&(kr(Vn,e),kr(Hn,s))}function Xn(e){Vn.current===e&&(Nr(Hn),Nr(Vn))}var Zn=_r(0);function ei(e){for(var t=e;null!==t;){if(13===t.tag){var s=t.memoizedState;if(null!==s&&(null===(s=s.dehydrated)||"$?"===s.data||"$!"===s.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ti=[];function si(){for(var e=0;e<ti.length;e++)ti[e]._workInProgressVersionPrimary=null;ti.length=0}var ai=v.ReactCurrentDispatcher,ri=v.ReactCurrentBatchConfig,ni=0,ii=null,li=null,oi=null,ci=!1,di=!1,ui=0,hi=0;function mi(){throw Error(n(321))}function pi(e,t){if(null===t)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!ia(e[s],t[s]))return!1;return!0}function gi(e,t,s,a,r,i){if(ni=i,ii=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ai.current=null===e||null===e.memoizedState?Xi:Zi,e=s(a,r),di){i=0;do{if(di=!1,ui=0,25<=i)throw Error(n(301));i+=1,oi=li=null,t.updateQueue=null,ai.current=el,e=s(a,r)}while(di)}if(ai.current=Qi,t=null!==li&&null!==li.next,ni=0,oi=li=ii=null,ci=!1,t)throw Error(n(300));return e}function xi(){var e=0!==ui;return ui=0,e}function fi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===oi?ii.memoizedState=oi=e:oi=oi.next=e,oi}function yi(){if(null===li){var e=ii.alternate;e=null!==e?e.memoizedState:null}else e=li.next;var t=null===oi?ii.memoizedState:oi.next;if(null!==t)oi=t,li=e;else{if(null===e)throw Error(n(310));e={memoizedState:(li=e).memoizedState,baseState:li.baseState,baseQueue:li.baseQueue,queue:li.queue,next:null},null===oi?ii.memoizedState=oi=e:oi=oi.next=e}return oi}function bi(e,t){return"function"===typeof t?t(e):t}function vi(e){var t=yi(),s=t.queue;if(null===s)throw Error(n(311));s.lastRenderedReducer=e;var a=li,r=a.baseQueue,i=s.pending;if(null!==i){if(null!==r){var l=r.next;r.next=i.next,i.next=l}a.baseQueue=r=i,s.pending=null}if(null!==r){i=r.next,a=a.baseState;var o=l=null,c=null,d=i;do{var u=d.lane;if((ni&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),a=d.hasEagerState?d.eagerState:e(a,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(o=c=h,l=a):c=c.next=h,ii.lanes|=u,Mo|=u}d=d.next}while(null!==d&&d!==i);null===c?l=a:c.next=o,ia(a,t.memoizedState)||(yl=!0),t.memoizedState=a,t.baseState=l,t.baseQueue=c,s.lastRenderedState=a}if(null!==(e=s.interleaved)){r=e;do{i=r.lane,ii.lanes|=i,Mo|=i,r=r.next}while(r!==e)}else null===r&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function wi(e){var t=yi(),s=t.queue;if(null===s)throw Error(n(311));s.lastRenderedReducer=e;var a=s.dispatch,r=s.pending,i=t.memoizedState;if(null!==r){s.pending=null;var l=r=r.next;do{i=e(i,l.action),l=l.next}while(l!==r);ia(i,t.memoizedState)||(yl=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),s.lastRenderedState=i}return[i,a]}function ji(){}function _i(e,t){var s=ii,a=yi(),r=t(),i=!ia(a.memoizedState,r);if(i&&(a.memoizedState=r,yl=!0),a=a.queue,Ri(Si.bind(null,s,a,e),[e]),a.getSnapshot!==t||i||null!==oi&&1&oi.memoizedState.tag){if(s.flags|=2048,Ti(9,ki.bind(null,s,a,r,t),void 0,null),null===Po)throw Error(n(349));0!==(30&ni)||Ni(s,t,r)}return r}function Ni(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.stores=[e]):null===(s=t.stores)?t.stores=[e]:s.push(e)}function ki(e,t,s,a){t.value=s,t.getSnapshot=a,Ci(t)&&Ei(e)}function Si(e,t,s){return s(function(){Ci(t)&&Ei(e)})}function Ci(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!ia(e,s)}catch(a){return!0}}function Ei(e){var t=Fn(e,1);null!==t&&sc(t,e,1,-1)}function Pi(e){var t=fi();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bi,lastRenderedState:e},t.queue=e,e=e.dispatch=Ji.bind(null,ii,e),[t.memoizedState,e]}function Ti(e,t,s,a){return e={tag:e,create:t,destroy:s,deps:a,next:null},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.lastEffect=e.next=e):null===(s=t.lastEffect)?t.lastEffect=e.next=e:(a=s.next,s.next=e,e.next=a,t.lastEffect=e),e}function Di(){return yi().memoizedState}function Ai(e,t,s,a){var r=fi();ii.flags|=e,r.memoizedState=Ti(1|t,s,void 0,void 0===a?null:a)}function Oi(e,t,s,a){var r=yi();a=void 0===a?null:a;var n=void 0;if(null!==li){var i=li.memoizedState;if(n=i.destroy,null!==a&&pi(a,i.deps))return void(r.memoizedState=Ti(t,s,n,a))}ii.flags|=e,r.memoizedState=Ti(1|t,s,n,a)}function Fi(e,t){return Ai(8390656,8,e,t)}function Ri(e,t){return Oi(2048,8,e,t)}function Mi(e,t){return Oi(4,2,e,t)}function Ii(e,t){return Oi(4,4,e,t)}function Li(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ui(e,t,s){return s=null!==s&&void 0!==s?s.concat([e]):null,Oi(4,4,Li.bind(null,t,e),s)}function zi(){}function qi(e,t){var s=yi();t=void 0===t?null:t;var a=s.memoizedState;return null!==a&&null!==t&&pi(t,a[1])?a[0]:(s.memoizedState=[e,t],e)}function Wi(e,t){var s=yi();t=void 0===t?null:t;var a=s.memoizedState;return null!==a&&null!==t&&pi(t,a[1])?a[0]:(e=e(),s.memoizedState=[e,t],e)}function Bi(e,t,s){return 0===(21&ni)?(e.baseState&&(e.baseState=!1,yl=!0),e.memoizedState=s):(ia(s,t)||(s=gt(),ii.lanes|=s,Mo|=s,e.baseState=!0),t)}function Gi(e,t){var s=bt;bt=0!==s&&4>s?s:4,e(!0);var a=ri.transition;ri.transition={};try{e(!1),t()}finally{bt=s,ri.transition=a}}function Hi(){return yi().memoizedState}function Vi(e,t,s){var a=tc(e);if(s={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null},Ki(e))$i(t,s);else if(null!==(s=On(e,t,s,a))){sc(s,e,a,ec()),Yi(s,t,a)}}function Ji(e,t,s){var a=tc(e),r={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null};if(Ki(e))$i(t,r);else{var n=e.alternate;if(0===e.lanes&&(null===n||0===n.lanes)&&null!==(n=t.lastRenderedReducer))try{var i=t.lastRenderedState,l=n(i,s);if(r.hasEagerState=!0,r.eagerState=l,ia(l,i)){var o=t.interleaved;return null===o?(r.next=r,An(t)):(r.next=o.next,o.next=r),void(t.interleaved=r)}}catch(c){}null!==(s=On(e,t,r,a))&&(sc(s,e,a,r=ec()),Yi(s,t,a))}}function Ki(e){var t=e.alternate;return e===ii||null!==t&&t===ii}function $i(e,t){di=ci=!0;var s=e.pending;null===s?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Yi(e,t,s){if(0!==(4194240&s)){var a=t.lanes;s|=a&=e.pendingLanes,t.lanes=s,yt(e,s)}}var Qi={readContext:Tn,useCallback:mi,useContext:mi,useEffect:mi,useImperativeHandle:mi,useInsertionEffect:mi,useLayoutEffect:mi,useMemo:mi,useReducer:mi,useRef:mi,useState:mi,useDebugValue:mi,useDeferredValue:mi,useTransition:mi,useMutableSource:mi,useSyncExternalStore:mi,useId:mi,unstable_isNewReconciler:!1},Xi={readContext:Tn,useCallback:function(e,t){return fi().memoizedState=[e,void 0===t?null:t],e},useContext:Tn,useEffect:Fi,useImperativeHandle:function(e,t,s){return s=null!==s&&void 0!==s?s.concat([e]):null,Ai(4194308,4,Li.bind(null,t,e),s)},useLayoutEffect:function(e,t){return Ai(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ai(4,2,e,t)},useMemo:function(e,t){var s=fi();return t=void 0===t?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var a=fi();return t=void 0!==s?s(t):t,a.memoizedState=a.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},a.queue=e,e=e.dispatch=Vi.bind(null,ii,e),[a.memoizedState,e]},useRef:function(e){return e={current:e},fi().memoizedState=e},useState:Pi,useDebugValue:zi,useDeferredValue:function(e){return fi().memoizedState=e},useTransition:function(){var e=Pi(!1),t=e[0];return e=Gi.bind(null,e[1]),fi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var a=ii,r=fi();if(an){if(void 0===s)throw Error(n(407));s=s()}else{if(s=t(),null===Po)throw Error(n(349));0!==(30&ni)||Ni(a,t,s)}r.memoizedState=s;var i={value:s,getSnapshot:t};return r.queue=i,Fi(Si.bind(null,a,i,e),[e]),a.flags|=2048,Ti(9,ki.bind(null,a,i,s,t),void 0,null),s},useId:function(){var e=fi(),t=Po.identifierPrefix;if(an){var s=Yr;t=":"+t+"R"+(s=($r&~(1<<32-it($r)-1)).toString(32)+s),0<(s=ui++)&&(t+="H"+s.toString(32)),t+=":"}else t=":"+t+"r"+(s=hi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Zi={readContext:Tn,useCallback:qi,useContext:Tn,useEffect:Ri,useImperativeHandle:Ui,useInsertionEffect:Mi,useLayoutEffect:Ii,useMemo:Wi,useReducer:vi,useRef:Di,useState:function(){return vi(bi)},useDebugValue:zi,useDeferredValue:function(e){return Bi(yi(),li.memoizedState,e)},useTransition:function(){return[vi(bi)[0],yi().memoizedState]},useMutableSource:ji,useSyncExternalStore:_i,useId:Hi,unstable_isNewReconciler:!1},el={readContext:Tn,useCallback:qi,useContext:Tn,useEffect:Ri,useImperativeHandle:Ui,useInsertionEffect:Mi,useLayoutEffect:Ii,useMemo:Wi,useReducer:wi,useRef:Di,useState:function(){return wi(bi)},useDebugValue:zi,useDeferredValue:function(e){var t=yi();return null===li?t.memoizedState=e:Bi(t,li.memoizedState,e)},useTransition:function(){return[wi(bi)[0],yi().memoizedState]},useMutableSource:ji,useSyncExternalStore:_i,useId:Hi,unstable_isNewReconciler:!1};function tl(e,t){if(e&&e.defaultProps){for(var s in t=I({},t),e=e.defaultProps)void 0===t[s]&&(t[s]=e[s]);return t}return t}function sl(e,t,s,a){s=null===(s=s(a,t=e.memoizedState))||void 0===s?t:I({},t,s),e.memoizedState=s,0===e.lanes&&(e.updateQueue.baseState=s)}var al={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,t,s){e=e._reactInternals;var a=ec(),r=tc(e),n=Ln(a,r);n.payload=t,void 0!==s&&null!==s&&(n.callback=s),null!==(t=Un(e,n,r))&&(sc(t,e,r,a),zn(t,e,r))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var a=ec(),r=tc(e),n=Ln(a,r);n.tag=1,n.payload=t,void 0!==s&&null!==s&&(n.callback=s),null!==(t=Un(e,n,r))&&(sc(t,e,r,a),zn(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=ec(),a=tc(e),r=Ln(s,a);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Un(e,r,a))&&(sc(t,e,a,s),zn(t,e,a))}};function rl(e,t,s,a,r,n,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(a,n,i):!t.prototype||!t.prototype.isPureReactComponent||(!la(s,a)||!la(r,n))}function nl(e,t,s){var a=!1,r=Sr,n=t.contextType;return"object"===typeof n&&null!==n?n=Tn(n):(r=Dr(t)?Pr:Cr.current,n=(a=null!==(a=t.contextTypes)&&void 0!==a)?Tr(e,r):Sr),t=new t(s,n),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=al,e.stateNode=t,t._reactInternals=e,a&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=n),t}function il(e,t,s,a){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(s,a),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(s,a),t.state!==e&&al.enqueueReplaceState(t,t.state,null)}function ll(e,t,s,a){var r=e.stateNode;r.props=s,r.state=e.memoizedState,r.refs={},Mn(e);var n=t.contextType;"object"===typeof n&&null!==n?r.context=Tn(n):(n=Dr(t)?Pr:Cr.current,r.context=Tr(e,n)),r.state=e.memoizedState,"function"===typeof(n=t.getDerivedStateFromProps)&&(sl(e,t,n,s),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&al.enqueueReplaceState(r,r.state,null),Wn(e,s,r,a),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function ol(e,t){try{var s="",a=t;do{s+=q(a),a=a.return}while(a);var r=s}catch(n){r="\nError generating stack: "+n.message+"\n"+n.stack}return{value:e,source:t,stack:r,digest:null}}function cl(e,t,s){return{value:e,source:null,stack:null!=s?s:null,digest:null!=t?t:null}}function dl(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var ul="function"===typeof WeakMap?WeakMap:Map;function hl(e,t,s){(s=Ln(-1,s)).tag=3,s.payload={element:null};var a=t.value;return s.callback=function(){Go||(Go=!0,Ho=a),dl(0,t)},s}function ml(e,t,s){(s=Ln(-1,s)).tag=3;var a=e.type.getDerivedStateFromError;if("function"===typeof a){var r=t.value;s.payload=function(){return a(r)},s.callback=function(){dl(0,t)}}var n=e.stateNode;return null!==n&&"function"===typeof n.componentDidCatch&&(s.callback=function(){dl(0,t),"function"!==typeof a&&(null===Vo?Vo=new Set([this]):Vo.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),s}function pl(e,t,s){var a=e.pingCache;if(null===a){a=e.pingCache=new ul;var r=new Set;a.set(t,r)}else void 0===(r=a.get(t))&&(r=new Set,a.set(t,r));r.has(s)||(r.add(s),e=kc.bind(null,e,t,s),t.then(e,e))}function gl(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function xl(e,t,s,a,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,1===s.tag&&(null===s.alternate?s.tag=17:((t=Ln(-1,1)).tag=2,Un(s,t,1))),s.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var fl=v.ReactCurrentOwner,yl=!1;function bl(e,t,s,a){t.child=null===e?wn(t,null,s,a):vn(t,e.child,s,a)}function vl(e,t,s,a,r){s=s.render;var n=t.ref;return Pn(t,r),a=gi(e,t,s,a,n,r),s=xi(),null===e||yl?(an&&s&&Zr(t),t.flags|=1,bl(e,t,a,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Bl(e,t,r))}function wl(e,t,s,a,r){if(null===e){var n=s.type;return"function"!==typeof n||Ac(n)||void 0!==n.defaultProps||null!==s.compare||void 0!==s.defaultProps?((e=Fc(s.type,null,a,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=n,jl(e,t,n,a,r))}if(n=e.child,0===(e.lanes&r)){var i=n.memoizedProps;if((s=null!==(s=s.compare)?s:la)(i,a)&&e.ref===t.ref)return Bl(e,t,r)}return t.flags|=1,(e=Oc(n,a)).ref=t.ref,e.return=t,t.child=e}function jl(e,t,s,a,r){if(null!==e){var n=e.memoizedProps;if(la(n,a)&&e.ref===t.ref){if(yl=!1,t.pendingProps=a=n,0===(e.lanes&r))return t.lanes=e.lanes,Bl(e,t,r);0!==(131072&e.flags)&&(yl=!0)}}return kl(e,t,s,a,r)}function _l(e,t,s){var a=t.pendingProps,r=a.children,n=null!==e?e.memoizedState:null;if("hidden"===a.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},kr(Oo,Ao),Ao|=s;else{if(0===(1073741824&s))return e=null!==n?n.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,kr(Oo,Ao),Ao|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=null!==n?n.baseLanes:s,kr(Oo,Ao),Ao|=a}else null!==n?(a=n.baseLanes|s,t.memoizedState=null):a=s,kr(Oo,Ao),Ao|=a;return bl(e,t,r,s),t.child}function Nl(e,t){var s=t.ref;(null===e&&null!==s||null!==e&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function kl(e,t,s,a,r){var n=Dr(s)?Pr:Cr.current;return n=Tr(t,n),Pn(t,r),s=gi(e,t,s,a,n,r),a=xi(),null===e||yl?(an&&a&&Zr(t),t.flags|=1,bl(e,t,s,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Bl(e,t,r))}function Sl(e,t,s,a,r){if(Dr(s)){var n=!0;Rr(t)}else n=!1;if(Pn(t,r),null===t.stateNode)Wl(e,t),nl(t,s,a),ll(t,s,a,r),a=!0;else if(null===e){var i=t.stateNode,l=t.memoizedProps;i.props=l;var o=i.context,c=s.contextType;"object"===typeof c&&null!==c?c=Tn(c):c=Tr(t,c=Dr(s)?Pr:Cr.current);var d=s.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof i.getSnapshotBeforeUpdate;u||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(l!==a||o!==c)&&il(t,i,a,c),Rn=!1;var h=t.memoizedState;i.state=h,Wn(t,a,i,r),o=t.memoizedState,l!==a||h!==o||Er.current||Rn?("function"===typeof d&&(sl(t,s,d,a),o=t.memoizedState),(l=Rn||rl(t,s,l,a,h,o,c))?(u||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=o),i.props=a,i.state=o,i.context=c,a=l):("function"===typeof i.componentDidMount&&(t.flags|=4194308),a=!1)}else{i=t.stateNode,In(e,t),l=t.memoizedProps,c=t.type===t.elementType?l:tl(t.type,l),i.props=c,u=t.pendingProps,h=i.context,"object"===typeof(o=s.contextType)&&null!==o?o=Tn(o):o=Tr(t,o=Dr(s)?Pr:Cr.current);var m=s.getDerivedStateFromProps;(d="function"===typeof m||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(l!==u||h!==o)&&il(t,i,a,o),Rn=!1,h=t.memoizedState,i.state=h,Wn(t,a,i,r);var p=t.memoizedState;l!==u||h!==p||Er.current||Rn?("function"===typeof m&&(sl(t,s,m,a),p=t.memoizedState),(c=Rn||rl(t,s,c,a,h,p,o)||!1)?(d||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(a,p,o),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(a,p,o)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=p),i.props=a,i.state=p,i.context=o,a=c):("function"!==typeof i.componentDidUpdate||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),a=!1)}return Cl(e,t,s,a,n,r)}function Cl(e,t,s,a,r,n){Nl(e,t);var i=0!==(128&t.flags);if(!a&&!i)return r&&Mr(t,s,!1),Bl(e,t,n);a=t.stateNode,fl.current=t;var l=i&&"function"!==typeof s.getDerivedStateFromError?null:a.render();return t.flags|=1,null!==e&&i?(t.child=vn(t,e.child,null,n),t.child=vn(t,null,l,n)):bl(e,t,l,n),t.memoizedState=a.state,r&&Mr(t,s,!0),t.child}function El(e){var t=e.stateNode;t.pendingContext?Or(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Or(0,t.context,!1),$n(e,t.containerInfo)}function Pl(e,t,s,a,r){return mn(),pn(r),t.flags|=256,bl(e,t,s,a),t.child}var Tl,Dl,Al,Ol,Fl={dehydrated:null,treeContext:null,retryLane:0};function Rl(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ml(e,t,s){var a,r=t.pendingProps,i=Zn.current,l=!1,o=0!==(128&t.flags);if((a=o)||(a=(null===e||null!==e.memoizedState)&&0!==(2&i)),a?(l=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),kr(Zn,1&i),null===e)return cn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(o=r.children,e=r.fallback,l?(r=t.mode,l=t.child,o={mode:"hidden",children:o},0===(1&r)&&null!==l?(l.childLanes=0,l.pendingProps=o):l=Mc(o,r,0,null),e=Rc(e,r,s,null),l.return=t,e.return=t,l.sibling=e,t.child=l,t.child.memoizedState=Rl(s),t.memoizedState=Fl,e):Il(t,o));if(null!==(i=e.memoizedState)&&null!==(a=i.dehydrated))return function(e,t,s,a,r,i,l){if(s)return 256&t.flags?(t.flags&=-257,Ll(e,t,l,a=cl(Error(n(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=a.fallback,r=t.mode,a=Mc({mode:"visible",children:a.children},r,0,null),(i=Rc(i,r,l,null)).flags|=2,a.return=t,i.return=t,a.sibling=i,t.child=a,0!==(1&t.mode)&&vn(t,e.child,null,l),t.child.memoizedState=Rl(l),t.memoizedState=Fl,i);if(0===(1&t.mode))return Ll(e,t,l,null);if("$!"===r.data){if(a=r.nextSibling&&r.nextSibling.dataset)var o=a.dgst;return a=o,Ll(e,t,l,a=cl(i=Error(n(419)),a,void 0))}if(o=0!==(l&e.childLanes),yl||o){if(null!==(a=Po)){switch(l&-l){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(a.suspendedLanes|l))?0:r)&&r!==i.retryLane&&(i.retryLane=r,Fn(e,r),sc(a,e,r,-1))}return gc(),Ll(e,t,l,a=cl(Error(n(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Cc.bind(null,e),r._reactRetry=t,null):(e=i.treeContext,sn=or(r.nextSibling),tn=t,an=!0,rn=null,null!==e&&(Vr[Jr++]=$r,Vr[Jr++]=Yr,Vr[Jr++]=Kr,$r=e.id,Yr=e.overflow,Kr=t),t=Il(t,a.children),t.flags|=4096,t)}(e,t,o,r,a,i,s);if(l){l=r.fallback,o=t.mode,a=(i=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&o)&&t.child!==i?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Oc(i,c)).subtreeFlags=14680064&i.subtreeFlags,null!==a?l=Oc(a,l):(l=Rc(l,o,s,null)).flags|=2,l.return=t,r.return=t,r.sibling=l,t.child=r,r=l,l=t.child,o=null===(o=e.child.memoizedState)?Rl(s):{baseLanes:o.baseLanes|s,cachePool:null,transitions:o.transitions},l.memoizedState=o,l.childLanes=e.childLanes&~s,t.memoizedState=Fl,r}return e=(l=e.child).sibling,r=Oc(l,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=s),r.return=t,r.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=r,t.memoizedState=null,r}function Il(e,t){return(t=Mc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ll(e,t,s,a){return null!==a&&pn(a),vn(t,e.child,null,s),(e=Il(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ul(e,t,s){e.lanes|=t;var a=e.alternate;null!==a&&(a.lanes|=t),En(e.return,t,s)}function zl(e,t,s,a,r){var n=e.memoizedState;null===n?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:s,tailMode:r}:(n.isBackwards=t,n.rendering=null,n.renderingStartTime=0,n.last=a,n.tail=s,n.tailMode=r)}function ql(e,t,s){var a=t.pendingProps,r=a.revealOrder,n=a.tail;if(bl(e,t,a.children,s),0!==(2&(a=Zn.current)))a=1&a|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ul(e,s,t);else if(19===e.tag)Ul(e,s,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(kr(Zn,a),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(s=t.child,r=null;null!==s;)null!==(e=s.alternate)&&null===ei(e)&&(r=s),s=s.sibling;null===(s=r)?(r=t.child,t.child=null):(r=s.sibling,s.sibling=null),zl(t,!1,r,s,n);break;case"backwards":for(s=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ei(e)){t.child=r;break}e=r.sibling,r.sibling=s,s=r,r=e}zl(t,!0,s,null,n);break;case"together":zl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Wl(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Bl(e,t,s){if(null!==e&&(t.dependencies=e.dependencies),Mo|=t.lanes,0===(s&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(n(153));if(null!==t.child){for(s=Oc(e=t.child,e.pendingProps),t.child=s,s.return=t;null!==e.sibling;)e=e.sibling,(s=s.sibling=Oc(e,e.pendingProps)).return=t;s.sibling=null}return t.child}function Gl(e,t){if(!an)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;null!==t;)null!==t.alternate&&(s=t),t=t.sibling;null===s?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var a=null;null!==s;)null!==s.alternate&&(a=s),s=s.sibling;null===a?t||null===e.tail?e.tail=null:e.tail.sibling=null:a.sibling=null}}function Hl(e){var t=null!==e.alternate&&e.alternate.child===e.child,s=0,a=0;if(t)for(var r=e.child;null!==r;)s|=r.lanes|r.childLanes,a|=14680064&r.subtreeFlags,a|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)s|=r.lanes|r.childLanes,a|=r.subtreeFlags,a|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=a,e.childLanes=s,t}function Vl(e,t,s){var a=t.pendingProps;switch(en(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hl(t),null;case 1:case 17:return Dr(t.type)&&Ar(),Hl(t),null;case 3:return a=t.stateNode,Yn(),Nr(Er),Nr(Cr),si(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),null!==e&&null!==e.child||(un(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==rn&&(ic(rn),rn=null))),Dl(e,t),Hl(t),null;case 5:Xn(t);var r=Kn(Jn.current);if(s=t.type,null!==e&&null!=t.stateNode)Al(e,t,s,a,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!a){if(null===t.stateNode)throw Error(n(166));return Hl(t),null}if(e=Kn(Hn.current),un(t)){a=t.stateNode,s=t.type;var i=t.memoizedProps;switch(a[ur]=t,a[hr]=i,e=0!==(1&t.mode),s){case"dialog":La("cancel",a),La("close",a);break;case"iframe":case"object":case"embed":La("load",a);break;case"video":case"audio":for(r=0;r<Fa.length;r++)La(Fa[r],a);break;case"source":La("error",a);break;case"img":case"image":case"link":La("error",a),La("load",a);break;case"details":La("toggle",a);break;case"input":Y(a,i),La("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!i.multiple},La("invalid",a);break;case"textarea":re(a,i),La("invalid",a)}for(var o in ye(s,i),r=null,i)if(i.hasOwnProperty(o)){var c=i[o];"children"===o?"string"===typeof c?a.textContent!==c&&(!0!==i.suppressHydrationWarning&&Qa(a.textContent,c,e),r=["children",c]):"number"===typeof c&&a.textContent!==""+c&&(!0!==i.suppressHydrationWarning&&Qa(a.textContent,c,e),r=["children",""+c]):l.hasOwnProperty(o)&&null!=c&&"onScroll"===o&&La("scroll",a)}switch(s){case"input":V(a),Z(a,i,!0);break;case"textarea":V(a),ie(a);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(a.onclick=Xa)}a=r,t.updateQueue=a,null!==a&&(t.flags|=4)}else{o=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=le(s)),"http://www.w3.org/1999/xhtml"===e?"script"===s?((e=o.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof a.is?e=o.createElement(s,{is:a.is}):(e=o.createElement(s),"select"===s&&(o=e,a.multiple?o.multiple=!0:a.size&&(o.size=a.size))):e=o.createElementNS(e,s),e[ur]=t,e[hr]=a,Tl(e,t,!1,!1),t.stateNode=e;e:{switch(o=be(s,a),s){case"dialog":La("cancel",e),La("close",e),r=a;break;case"iframe":case"object":case"embed":La("load",e),r=a;break;case"video":case"audio":for(r=0;r<Fa.length;r++)La(Fa[r],e);r=a;break;case"source":La("error",e),r=a;break;case"img":case"image":case"link":La("error",e),La("load",e),r=a;break;case"details":La("toggle",e),r=a;break;case"input":Y(e,a),r=$(e,a),La("invalid",e);break;case"option":default:r=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},r=I({},a,{value:void 0}),La("invalid",e);break;case"textarea":re(e,a),r=ae(e,a),La("invalid",e)}for(i in ye(s,r),c=r)if(c.hasOwnProperty(i)){var d=c[i];"style"===i?xe(e,d):"dangerouslySetInnerHTML"===i?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===i?"string"===typeof d?("textarea"!==s||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(l.hasOwnProperty(i)?null!=d&&"onScroll"===i&&La("scroll",e):null!=d&&b(e,i,d,o))}switch(s){case"input":V(e),Z(e,a,!1);break;case"textarea":V(e),ie(e);break;case"option":null!=a.value&&e.setAttribute("value",""+G(a.value));break;case"select":e.multiple=!!a.multiple,null!=(i=a.value)?se(e,!!a.multiple,i,!1):null!=a.defaultValue&&se(e,!!a.multiple,a.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Xa)}switch(s){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hl(t),null;case 6:if(e&&null!=t.stateNode)Ol(e,t,e.memoizedProps,a);else{if("string"!==typeof a&&null===t.stateNode)throw Error(n(166));if(s=Kn(Jn.current),Kn(Hn.current),un(t)){if(a=t.stateNode,s=t.memoizedProps,a[ur]=t,(i=a.nodeValue!==s)&&null!==(e=tn))switch(e.tag){case 3:Qa(a.nodeValue,s,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qa(a.nodeValue,s,0!==(1&e.mode))}i&&(t.flags|=4)}else(a=(9===s.nodeType?s:s.ownerDocument).createTextNode(a))[ur]=t,t.stateNode=a}return Hl(t),null;case 13:if(Nr(Zn),a=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(an&&null!==sn&&0!==(1&t.mode)&&0===(128&t.flags))hn(),mn(),t.flags|=98560,i=!1;else if(i=un(t),null!==a&&null!==a.dehydrated){if(null===e){if(!i)throw Error(n(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(n(317));i[ur]=t}else mn(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hl(t),i=!1}else null!==rn&&(ic(rn),rn=null),i=!0;if(!i)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=s,t):((a=null!==a)!==(null!==e&&null!==e.memoizedState)&&a&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zn.current)?0===Fo&&(Fo=3):gc())),null!==t.updateQueue&&(t.flags|=4),Hl(t),null);case 4:return Yn(),Dl(e,t),null===e&&qa(t.stateNode.containerInfo),Hl(t),null;case 10:return Cn(t.type._context),Hl(t),null;case 19:if(Nr(Zn),null===(i=t.memoizedState))return Hl(t),null;if(a=0!==(128&t.flags),null===(o=i.rendering))if(a)Gl(i,!1);else{if(0!==Fo||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=ei(e))){for(t.flags|=128,Gl(i,!1),null!==(a=o.updateQueue)&&(t.updateQueue=a,t.flags|=4),t.subtreeFlags=0,a=s,s=t.child;null!==s;)e=a,(i=s).flags&=14680066,null===(o=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return kr(Zn,1&Zn.current|2),t.child}e=e.sibling}null!==i.tail&&Qe()>Wo&&(t.flags|=128,a=!0,Gl(i,!1),t.lanes=4194304)}else{if(!a)if(null!==(e=ei(o))){if(t.flags|=128,a=!0,null!==(s=e.updateQueue)&&(t.updateQueue=s,t.flags|=4),Gl(i,!0),null===i.tail&&"hidden"===i.tailMode&&!o.alternate&&!an)return Hl(t),null}else 2*Qe()-i.renderingStartTime>Wo&&1073741824!==s&&(t.flags|=128,a=!0,Gl(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(null!==(s=i.last)?s.sibling=o:t.child=o,i.last=o)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Qe(),t.sibling=null,s=Zn.current,kr(Zn,a?1&s|2:1&s),t):(Hl(t),null);case 22:case 23:return uc(),a=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==a&&(t.flags|=8192),a&&0!==(1&t.mode)?0!==(1073741824&Ao)&&(Hl(t),6&t.subtreeFlags&&(t.flags|=8192)):Hl(t),null;case 24:case 25:return null}throw Error(n(156,t.tag))}function Jl(e,t){switch(en(t),t.tag){case 1:return Dr(t.type)&&Ar(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Yn(),Nr(Er),Nr(Cr),si(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Xn(t),null;case 13:if(Nr(Zn),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(n(340));mn()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Nr(Zn),null;case 4:return Yn(),null;case 10:return Cn(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}Tl=function(e,t){for(var s=t.child;null!==s;){if(5===s.tag||6===s.tag)e.appendChild(s.stateNode);else if(4!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}},Dl=function(){},Al=function(e,t,s,a){var r=e.memoizedProps;if(r!==a){e=t.stateNode,Kn(Hn.current);var n,i=null;switch(s){case"input":r=$(e,r),a=$(e,a),i=[];break;case"select":r=I({},r,{value:void 0}),a=I({},a,{value:void 0}),i=[];break;case"textarea":r=ae(e,r),a=ae(e,a),i=[];break;default:"function"!==typeof r.onClick&&"function"===typeof a.onClick&&(e.onclick=Xa)}for(d in ye(s,a),s=null,r)if(!a.hasOwnProperty(d)&&r.hasOwnProperty(d)&&null!=r[d])if("style"===d){var o=r[d];for(n in o)o.hasOwnProperty(n)&&(s||(s={}),s[n]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(l.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in a){var c=a[d];if(o=null!=r?r[d]:void 0,a.hasOwnProperty(d)&&c!==o&&(null!=c||null!=o))if("style"===d)if(o){for(n in o)!o.hasOwnProperty(n)||c&&c.hasOwnProperty(n)||(s||(s={}),s[n]="");for(n in c)c.hasOwnProperty(n)&&o[n]!==c[n]&&(s||(s={}),s[n]=c[n])}else s||(i||(i=[]),i.push(d,s)),s=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,o=o?o.__html:void 0,null!=c&&o!==c&&(i=i||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(i=i||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(l.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&La("scroll",e),i||o===c||(i=[])):(i=i||[]).push(d,c))}s&&(i=i||[]).push("style",s);var d=i;(t.updateQueue=d)&&(t.flags|=4)}},Ol=function(e,t,s,a){s!==a&&(t.flags|=4)};var Kl=!1,$l=!1,Yl="function"===typeof WeakSet?WeakSet:Set,Ql=null;function Xl(e,t){var s=e.ref;if(null!==s)if("function"===typeof s)try{s(null)}catch(a){Nc(e,t,a)}else s.current=null}function Zl(e,t,s){try{s()}catch(a){Nc(e,t,a)}}var eo=!1;function to(e,t,s){var a=t.updateQueue;if(null!==(a=null!==a?a.lastEffect:null)){var r=a=a.next;do{if((r.tag&e)===e){var n=r.destroy;r.destroy=void 0,void 0!==n&&Zl(t,s,n)}r=r.next}while(r!==a)}}function so(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var s=t=t.next;do{if((s.tag&e)===e){var a=s.create;s.destroy=a()}s=s.next}while(s!==t)}}function ao(e){var t=e.ref;if(null!==t){var s=e.stateNode;e.tag,e=s,"function"===typeof t?t(e):t.current=e}}function ro(e){var t=e.alternate;null!==t&&(e.alternate=null,ro(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ur],delete t[hr],delete t[pr],delete t[gr],delete t[xr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function no(e){return 5===e.tag||3===e.tag||4===e.tag}function io(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||no(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lo(e,t,s){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?8===s.nodeType?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(8===s.nodeType?(t=s.parentNode).insertBefore(e,s):(t=s).appendChild(e),null!==(s=s._reactRootContainer)&&void 0!==s||null!==t.onclick||(t.onclick=Xa));else if(4!==a&&null!==(e=e.child))for(lo(e,t,s),e=e.sibling;null!==e;)lo(e,t,s),e=e.sibling}function oo(e,t,s){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(4!==a&&null!==(e=e.child))for(oo(e,t,s),e=e.sibling;null!==e;)oo(e,t,s),e=e.sibling}var co=null,uo=!1;function ho(e,t,s){for(s=s.child;null!==s;)mo(e,t,s),s=s.sibling}function mo(e,t,s){if(nt&&"function"===typeof nt.onCommitFiberUnmount)try{nt.onCommitFiberUnmount(rt,s)}catch(l){}switch(s.tag){case 5:$l||Xl(s,t);case 6:var a=co,r=uo;co=null,ho(e,t,s),uo=r,null!==(co=a)&&(uo?(e=co,s=s.stateNode,8===e.nodeType?e.parentNode.removeChild(s):e.removeChild(s)):co.removeChild(s.stateNode));break;case 18:null!==co&&(uo?(e=co,s=s.stateNode,8===e.nodeType?lr(e.parentNode,s):1===e.nodeType&&lr(e,s),Wt(e)):lr(co,s.stateNode));break;case 4:a=co,r=uo,co=s.stateNode.containerInfo,uo=!0,ho(e,t,s),co=a,uo=r;break;case 0:case 11:case 14:case 15:if(!$l&&(null!==(a=s.updateQueue)&&null!==(a=a.lastEffect))){r=a=a.next;do{var n=r,i=n.destroy;n=n.tag,void 0!==i&&(0!==(2&n)||0!==(4&n))&&Zl(s,t,i),r=r.next}while(r!==a)}ho(e,t,s);break;case 1:if(!$l&&(Xl(s,t),"function"===typeof(a=s.stateNode).componentWillUnmount))try{a.props=s.memoizedProps,a.state=s.memoizedState,a.componentWillUnmount()}catch(l){Nc(s,t,l)}ho(e,t,s);break;case 21:ho(e,t,s);break;case 22:1&s.mode?($l=(a=$l)||null!==s.memoizedState,ho(e,t,s),$l=a):ho(e,t,s);break;default:ho(e,t,s)}}function po(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var s=e.stateNode;null===s&&(s=e.stateNode=new Yl),t.forEach(function(t){var a=Ec.bind(null,e,t);s.has(t)||(s.add(t),t.then(a,a))})}}function go(e,t){var s=t.deletions;if(null!==s)for(var a=0;a<s.length;a++){var r=s[a];try{var i=e,l=t,o=l;e:for(;null!==o;){switch(o.tag){case 5:co=o.stateNode,uo=!1;break e;case 3:case 4:co=o.stateNode.containerInfo,uo=!0;break e}o=o.return}if(null===co)throw Error(n(160));mo(i,l,r),co=null,uo=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(d){Nc(r,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)xo(t,e),t=t.sibling}function xo(e,t){var s=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(go(t,e),fo(e),4&a){try{to(3,e,e.return),so(3,e)}catch(x){Nc(e,e.return,x)}try{to(5,e,e.return)}catch(x){Nc(e,e.return,x)}}break;case 1:go(t,e),fo(e),512&a&&null!==s&&Xl(s,s.return);break;case 5:if(go(t,e),fo(e),512&a&&null!==s&&Xl(s,s.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(x){Nc(e,e.return,x)}}if(4&a&&null!=(r=e.stateNode)){var i=e.memoizedProps,l=null!==s?s.memoizedProps:i,o=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===o&&"radio"===i.type&&null!=i.name&&Q(r,i),be(o,l);var d=be(o,i);for(l=0;l<c.length;l+=2){var u=c[l],h=c[l+1];"style"===u?xe(r,h):"dangerouslySetInnerHTML"===u?ue(r,h):"children"===u?he(r,h):b(r,u,h,d)}switch(o){case"input":X(r,i);break;case"textarea":ne(r,i);break;case"select":var m=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var p=i.value;null!=p?se(r,!!i.multiple,p,!1):m!==!!i.multiple&&(null!=i.defaultValue?se(r,!!i.multiple,i.defaultValue,!0):se(r,!!i.multiple,i.multiple?[]:"",!1))}r[hr]=i}catch(x){Nc(e,e.return,x)}}break;case 6:if(go(t,e),fo(e),4&a){if(null===e.stateNode)throw Error(n(162));r=e.stateNode,i=e.memoizedProps;try{r.nodeValue=i}catch(x){Nc(e,e.return,x)}}break;case 3:if(go(t,e),fo(e),4&a&&null!==s&&s.memoizedState.isDehydrated)try{Wt(t.containerInfo)}catch(x){Nc(e,e.return,x)}break;case 4:default:go(t,e),fo(e);break;case 13:go(t,e),fo(e),8192&(r=e.child).flags&&(i=null!==r.memoizedState,r.stateNode.isHidden=i,!i||null!==r.alternate&&null!==r.alternate.memoizedState||(qo=Qe())),4&a&&po(e);break;case 22:if(u=null!==s&&null!==s.memoizedState,1&e.mode?($l=(d=$l)||u,go(t,e),$l=d):go(t,e),fo(e),8192&a){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Ql=e,u=e.child;null!==u;){for(h=Ql=u;null!==Ql;){switch(p=(m=Ql).child,m.tag){case 0:case 11:case 14:case 15:to(4,m,m.return);break;case 1:Xl(m,m.return);var g=m.stateNode;if("function"===typeof g.componentWillUnmount){a=m,s=m.return;try{t=a,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(x){Nc(a,s,x)}}break;case 5:Xl(m,m.return);break;case 22:if(null!==m.memoizedState){wo(h);continue}}null!==p?(p.return=m,Ql=p):wo(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{r=h.stateNode,d?"function"===typeof(i=r.style).setProperty?i.setProperty("display","none","important"):i.display="none":(o=h.stateNode,l=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,o.style.display=ge("display",l))}catch(x){Nc(e,e.return,x)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(x){Nc(e,e.return,x)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:go(t,e),fo(e),4&a&&po(e);case 21:}}function fo(e){var t=e.flags;if(2&t){try{e:{for(var s=e.return;null!==s;){if(no(s)){var a=s;break e}s=s.return}throw Error(n(160))}switch(a.tag){case 5:var r=a.stateNode;32&a.flags&&(he(r,""),a.flags&=-33),oo(e,io(e),r);break;case 3:case 4:var i=a.stateNode.containerInfo;lo(e,io(e),i);break;default:throw Error(n(161))}}catch(l){Nc(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yo(e,t,s){Ql=e,bo(e,t,s)}function bo(e,t,s){for(var a=0!==(1&e.mode);null!==Ql;){var r=Ql,n=r.child;if(22===r.tag&&a){var i=null!==r.memoizedState||Kl;if(!i){var l=r.alternate,o=null!==l&&null!==l.memoizedState||$l;l=Kl;var c=$l;if(Kl=i,($l=o)&&!c)for(Ql=r;null!==Ql;)o=(i=Ql).child,22===i.tag&&null!==i.memoizedState?jo(r):null!==o?(o.return=i,Ql=o):jo(r);for(;null!==n;)Ql=n,bo(n,t,s),n=n.sibling;Ql=r,Kl=l,$l=c}vo(e)}else 0!==(8772&r.subtreeFlags)&&null!==n?(n.return=r,Ql=n):vo(e)}}function vo(e){for(;null!==Ql;){var t=Ql;if(0!==(8772&t.flags)){var s=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$l||so(5,t);break;case 1:var a=t.stateNode;if(4&t.flags&&!$l)if(null===s)a.componentDidMount();else{var r=t.elementType===t.type?s.memoizedProps:tl(t.type,s.memoizedProps);a.componentDidUpdate(r,s.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&Bn(t,i,a);break;case 3:var l=t.updateQueue;if(null!==l){if(s=null,null!==t.child)switch(t.child.tag){case 5:case 1:s=t.child.stateNode}Bn(t,l,s)}break;case 5:var o=t.stateNode;if(null===s&&4&t.flags){s=o;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&s.focus();break;case"img":c.src&&(s.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Wt(h)}}}break;default:throw Error(n(163))}$l||512&t.flags&&ao(t)}catch(m){Nc(t,t.return,m)}}if(t===e){Ql=null;break}if(null!==(s=t.sibling)){s.return=t.return,Ql=s;break}Ql=t.return}}function wo(e){for(;null!==Ql;){var t=Ql;if(t===e){Ql=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Ql=s;break}Ql=t.return}}function jo(e){for(;null!==Ql;){var t=Ql;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{so(4,t)}catch(o){Nc(t,s,o)}break;case 1:var a=t.stateNode;if("function"===typeof a.componentDidMount){var r=t.return;try{a.componentDidMount()}catch(o){Nc(t,r,o)}}var n=t.return;try{ao(t)}catch(o){Nc(t,n,o)}break;case 5:var i=t.return;try{ao(t)}catch(o){Nc(t,i,o)}}}catch(o){Nc(t,t.return,o)}if(t===e){Ql=null;break}var l=t.sibling;if(null!==l){l.return=t.return,Ql=l;break}Ql=t.return}}var _o,No=Math.ceil,ko=v.ReactCurrentDispatcher,So=v.ReactCurrentOwner,Co=v.ReactCurrentBatchConfig,Eo=0,Po=null,To=null,Do=0,Ao=0,Oo=_r(0),Fo=0,Ro=null,Mo=0,Io=0,Lo=0,Uo=null,zo=null,qo=0,Wo=1/0,Bo=null,Go=!1,Ho=null,Vo=null,Jo=!1,Ko=null,$o=0,Yo=0,Qo=null,Xo=-1,Zo=0;function ec(){return 0!==(6&Eo)?Qe():-1!==Xo?Xo:Xo=Qe()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Eo)&&0!==Do?Do&-Do:null!==gn.transition?(0===Zo&&(Zo=gt()),Zo):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function sc(e,t,s,a){if(50<Yo)throw Yo=0,Qo=null,Error(n(185));ft(e,s,a),0!==(2&Eo)&&e===Po||(e===Po&&(0===(2&Eo)&&(Io|=s),4===Fo&&lc(e,Do)),ac(e,a),1===s&&0===Eo&&0===(1&t.mode)&&(Wo=Qe()+500,Lr&&qr()))}function ac(e,t){var s=e.callbackNode;!function(e,t){for(var s=e.suspendedLanes,a=e.pingedLanes,r=e.expirationTimes,n=e.pendingLanes;0<n;){var i=31-it(n),l=1<<i,o=r[i];-1===o?0!==(l&s)&&0===(l&a)||(r[i]=mt(l,t)):o<=t&&(e.expiredLanes|=l),n&=~l}}(e,t);var a=ht(e,e===Po?Do:0);if(0===a)null!==s&&Ke(s),e.callbackNode=null,e.callbackPriority=0;else if(t=a&-a,e.callbackPriority!==t){if(null!=s&&Ke(s),1===t)0===e.tag?function(e){Lr=!0,zr(e)}(oc.bind(null,e)):zr(oc.bind(null,e)),nr(function(){0===(6&Eo)&&qr()}),s=null;else{switch(vt(a)){case 1:s=Ze;break;case 4:s=et;break;case 16:default:s=tt;break;case 536870912:s=at}s=Pc(s,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function rc(e,t){if(Xo=-1,Zo=0,0!==(6&Eo))throw Error(n(327));var s=e.callbackNode;if(jc()&&e.callbackNode!==s)return null;var a=ht(e,e===Po?Do:0);if(0===a)return null;if(0!==(30&a)||0!==(a&e.expiredLanes)||t)t=xc(e,a);else{t=a;var r=Eo;Eo|=2;var i=pc();for(Po===e&&Do===t||(Bo=null,Wo=Qe()+500,hc(e,t));;)try{yc();break}catch(o){mc(e,o)}Sn(),ko.current=i,Eo=r,null!==To?t=0:(Po=null,Do=0,t=Fo)}if(0!==t){if(2===t&&(0!==(r=pt(e))&&(a=r,t=nc(e,r))),1===t)throw s=Ro,hc(e,0),lc(e,a),ac(e,Qe()),s;if(6===t)lc(e,a);else{if(r=e.current.alternate,0===(30&a)&&!function(e){for(var t=e;;){if(16384&t.flags){var s=t.updateQueue;if(null!==s&&null!==(s=s.stores))for(var a=0;a<s.length;a++){var r=s[a],n=r.getSnapshot;r=r.value;try{if(!ia(n(),r))return!1}catch(l){return!1}}}if(s=t.child,16384&t.subtreeFlags&&null!==s)s.return=t,t=s;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=xc(e,a))&&(0!==(i=pt(e))&&(a=i,t=nc(e,i))),1===t))throw s=Ro,hc(e,0),lc(e,a),ac(e,Qe()),s;switch(e.finishedWork=r,e.finishedLanes=a,t){case 0:case 1:throw Error(n(345));case 2:case 5:wc(e,zo,Bo);break;case 3:if(lc(e,a),(130023424&a)===a&&10<(t=qo+500-Qe())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&a)!==a){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=sr(wc.bind(null,e,zo,Bo),t);break}wc(e,zo,Bo);break;case 4:if(lc(e,a),(4194240&a)===a)break;for(t=e.eventTimes,r=-1;0<a;){var l=31-it(a);i=1<<l,(l=t[l])>r&&(r=l),a&=~i}if(a=r,10<(a=(120>(a=Qe()-a)?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*No(a/1960))-a)){e.timeoutHandle=sr(wc.bind(null,e,zo,Bo),a);break}wc(e,zo,Bo);break;default:throw Error(n(329))}}}return ac(e,Qe()),e.callbackNode===s?rc.bind(null,e):null}function nc(e,t){var s=Uo;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=xc(e,t))&&(t=zo,zo=s,null!==t&&ic(t)),e}function ic(e){null===zo?zo=e:zo.push.apply(zo,e)}function lc(e,t){for(t&=~Lo,t&=~Io,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-it(t),a=1<<s;e[s]=-1,t&=~a}}function oc(e){if(0!==(6&Eo))throw Error(n(327));jc();var t=ht(e,0);if(0===(1&t))return ac(e,Qe()),null;var s=xc(e,t);if(0!==e.tag&&2===s){var a=pt(e);0!==a&&(t=a,s=nc(e,a))}if(1===s)throw s=Ro,hc(e,0),lc(e,t),ac(e,Qe()),s;if(6===s)throw Error(n(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,zo,Bo),ac(e,Qe()),null}function cc(e,t){var s=Eo;Eo|=1;try{return e(t)}finally{0===(Eo=s)&&(Wo=Qe()+500,Lr&&qr())}}function dc(e){null!==Ko&&0===Ko.tag&&0===(6&Eo)&&jc();var t=Eo;Eo|=1;var s=Co.transition,a=bt;try{if(Co.transition=null,bt=1,e)return e()}finally{bt=a,Co.transition=s,0===(6&(Eo=t))&&qr()}}function uc(){Ao=Oo.current,Nr(Oo)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(-1!==s&&(e.timeoutHandle=-1,ar(s)),null!==To)for(s=To.return;null!==s;){var a=s;switch(en(a),a.tag){case 1:null!==(a=a.type.childContextTypes)&&void 0!==a&&Ar();break;case 3:Yn(),Nr(Er),Nr(Cr),si();break;case 5:Xn(a);break;case 4:Yn();break;case 13:case 19:Nr(Zn);break;case 10:Cn(a.type._context);break;case 22:case 23:uc()}s=s.return}if(Po=e,To=e=Oc(e.current,null),Do=Ao=t,Fo=0,Ro=null,Lo=Io=Mo=0,zo=Uo=null,null!==Dn){for(t=0;t<Dn.length;t++)if(null!==(a=(s=Dn[t]).interleaved)){s.interleaved=null;var r=a.next,n=s.pending;if(null!==n){var i=n.next;n.next=r,a.next=i}s.pending=a}Dn=null}return e}function mc(e,t){for(;;){var s=To;try{if(Sn(),ai.current=Qi,ci){for(var a=ii.memoizedState;null!==a;){var r=a.queue;null!==r&&(r.pending=null),a=a.next}ci=!1}if(ni=0,oi=li=ii=null,di=!1,ui=0,So.current=null,null===s||null===s.return){Fo=1,Ro=t,To=null;break}e:{var i=e,l=s.return,o=s,c=t;if(t=Do,o.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=o,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=gl(l);if(null!==p){p.flags&=-257,xl(p,l,o,0,t),1&p.mode&&pl(i,d,t),c=d;var g=(t=p).updateQueue;if(null===g){var x=new Set;x.add(c),t.updateQueue=x}else g.add(c);break e}if(0===(1&t)){pl(i,d,t),gc();break e}c=Error(n(426))}else if(an&&1&o.mode){var f=gl(l);if(null!==f){0===(65536&f.flags)&&(f.flags|=256),xl(f,l,o,0,t),pn(ol(c,o));break e}}i=c=ol(c,o),4!==Fo&&(Fo=2),null===Uo?Uo=[i]:Uo.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,qn(i,hl(0,c,t));break e;case 1:o=c;var y=i.type,b=i.stateNode;if(0===(128&i.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Vo||!Vo.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t,qn(i,ml(i,o,t));break e}}i=i.return}while(null!==i)}vc(s)}catch(v){t=v,To===s&&null!==s&&(To=s=s.return);continue}break}}function pc(){var e=ko.current;return ko.current=Qi,null===e?Qi:e}function gc(){0!==Fo&&3!==Fo&&2!==Fo||(Fo=4),null===Po||0===(268435455&Mo)&&0===(268435455&Io)||lc(Po,Do)}function xc(e,t){var s=Eo;Eo|=2;var a=pc();for(Po===e&&Do===t||(Bo=null,hc(e,t));;)try{fc();break}catch(r){mc(e,r)}if(Sn(),Eo=s,ko.current=a,null!==To)throw Error(n(261));return Po=null,Do=0,Fo}function fc(){for(;null!==To;)bc(To)}function yc(){for(;null!==To&&!$e();)bc(To)}function bc(e){var t=_o(e.alternate,e,Ao);e.memoizedProps=e.pendingProps,null===t?vc(e):To=t,So.current=null}function vc(e){var t=e;do{var s=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(s=Vl(s,t,Ao)))return void(To=s)}else{if(null!==(s=Jl(s,t)))return s.flags&=32767,void(To=s);if(null===e)return Fo=6,void(To=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(To=t);To=t=e}while(null!==t);0===Fo&&(Fo=5)}function wc(e,t,s){var a=bt,r=Co.transition;try{Co.transition=null,bt=1,function(e,t,s,a){do{jc()}while(null!==Ko);if(0!==(6&Eo))throw Error(n(327));s=e.finishedWork;var r=e.finishedLanes;if(null===s)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(n(177));e.callbackNode=null,e.callbackPriority=0;var i=s.lanes|s.childLanes;if(function(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<s;){var r=31-it(s),n=1<<r;t[r]=0,a[r]=-1,e[r]=-1,s&=~n}}(e,i),e===Po&&(To=Po=null,Do=0),0===(2064&s.subtreeFlags)&&0===(2064&s.flags)||Jo||(Jo=!0,Pc(tt,function(){return jc(),null})),i=0!==(15990&s.flags),0!==(15990&s.subtreeFlags)||i){i=Co.transition,Co.transition=null;var l=bt;bt=1;var o=Eo;Eo|=4,So.current=null,function(e,t){if(Za=Gt,ha(e=ua())){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{var a=(s=(s=e.ownerDocument)&&s.defaultView||window).getSelection&&s.getSelection();if(a&&0!==a.rangeCount){s=a.anchorNode;var r=a.anchorOffset,i=a.focusNode;a=a.focusOffset;try{s.nodeType,i.nodeType}catch(w){s=null;break e}var l=0,o=-1,c=-1,d=0,u=0,h=e,m=null;t:for(;;){for(var p;h!==s||0!==r&&3!==h.nodeType||(o=l+r),h!==i||0!==a&&3!==h.nodeType||(c=l+a),3===h.nodeType&&(l+=h.nodeValue.length),null!==(p=h.firstChild);)m=h,h=p;for(;;){if(h===e)break t;if(m===s&&++d===r&&(o=l),m===i&&++u===a&&(c=l),null!==(p=h.nextSibling))break;m=(h=m).parentNode}h=p}s=-1===o||-1===c?null:{start:o,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(er={focusedElem:e,selectionRange:s},Gt=!1,Ql=t;null!==Ql;)if(e=(t=Ql).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Ql=e;else for(;null!==Ql;){t=Ql;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var x=g.memoizedProps,f=g.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?x:tl(t.type,x),f);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var v=t.stateNode.containerInfo;1===v.nodeType?v.textContent="":9===v.nodeType&&v.documentElement&&v.removeChild(v.documentElement);break;default:throw Error(n(163))}}catch(w){Nc(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Ql=e;break}Ql=t.return}g=eo,eo=!1}(e,s),xo(s,e),ma(er),Gt=!!Za,er=Za=null,e.current=s,yo(s,e,r),Ye(),Eo=o,bt=l,Co.transition=i}else e.current=s;if(Jo&&(Jo=!1,Ko=e,$o=r),i=e.pendingLanes,0===i&&(Vo=null),function(e){if(nt&&"function"===typeof nt.onCommitFiberRoot)try{nt.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(s.stateNode),ac(e,Qe()),null!==t)for(a=e.onRecoverableError,s=0;s<t.length;s++)r=t[s],a(r.value,{componentStack:r.stack,digest:r.digest});if(Go)throw Go=!1,e=Ho,Ho=null,e;0!==(1&$o)&&0!==e.tag&&jc(),i=e.pendingLanes,0!==(1&i)?e===Qo?Yo++:(Yo=0,Qo=e):Yo=0,qr()}(e,t,s,a)}finally{Co.transition=r,bt=a}return null}function jc(){if(null!==Ko){var e=vt($o),t=Co.transition,s=bt;try{if(Co.transition=null,bt=16>e?16:e,null===Ko)var a=!1;else{if(e=Ko,Ko=null,$o=0,0!==(6&Eo))throw Error(n(331));var r=Eo;for(Eo|=4,Ql=e.current;null!==Ql;){var i=Ql,l=i.child;if(0!==(16&Ql.flags)){var o=i.deletions;if(null!==o){for(var c=0;c<o.length;c++){var d=o[c];for(Ql=d;null!==Ql;){var u=Ql;switch(u.tag){case 0:case 11:case 15:to(8,u,i)}var h=u.child;if(null!==h)h.return=u,Ql=h;else for(;null!==Ql;){var m=(u=Ql).sibling,p=u.return;if(ro(u),u===d){Ql=null;break}if(null!==m){m.return=p,Ql=m;break}Ql=p}}}var g=i.alternate;if(null!==g){var x=g.child;if(null!==x){g.child=null;do{var f=x.sibling;x.sibling=null,x=f}while(null!==x)}}Ql=i}}if(0!==(2064&i.subtreeFlags)&&null!==l)l.return=i,Ql=l;else e:for(;null!==Ql;){if(0!==(2048&(i=Ql).flags))switch(i.tag){case 0:case 11:case 15:to(9,i,i.return)}var y=i.sibling;if(null!==y){y.return=i.return,Ql=y;break e}Ql=i.return}}var b=e.current;for(Ql=b;null!==Ql;){var v=(l=Ql).child;if(0!==(2064&l.subtreeFlags)&&null!==v)v.return=l,Ql=v;else e:for(l=b;null!==Ql;){if(0!==(2048&(o=Ql).flags))try{switch(o.tag){case 0:case 11:case 15:so(9,o)}}catch(j){Nc(o,o.return,j)}if(o===l){Ql=null;break e}var w=o.sibling;if(null!==w){w.return=o.return,Ql=w;break e}Ql=o.return}}if(Eo=r,qr(),nt&&"function"===typeof nt.onPostCommitFiberRoot)try{nt.onPostCommitFiberRoot(rt,e)}catch(j){}a=!0}return a}finally{bt=s,Co.transition=t}}return!1}function _c(e,t,s){e=Un(e,t=hl(0,t=ol(s,t),1),1),t=ec(),null!==e&&(ft(e,1,t),ac(e,t))}function Nc(e,t,s){if(3===e.tag)_c(e,e,s);else for(;null!==t;){if(3===t.tag){_c(t,e,s);break}if(1===t.tag){var a=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof a.componentDidCatch&&(null===Vo||!Vo.has(a))){t=Un(t,e=ml(t,e=ol(s,e),1),1),e=ec(),null!==t&&(ft(t,1,e),ac(t,e));break}}t=t.return}}function kc(e,t,s){var a=e.pingCache;null!==a&&a.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&s,Po===e&&(Do&s)===s&&(4===Fo||3===Fo&&(130023424&Do)===Do&&500>Qe()-qo?hc(e,0):Lo|=s),ac(e,t)}function Sc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var s=ec();null!==(e=Fn(e,t))&&(ft(e,t,s),ac(e,s))}function Cc(e){var t=e.memoizedState,s=0;null!==t&&(s=t.retryLane),Sc(e,s)}function Ec(e,t){var s=0;switch(e.tag){case 13:var a=e.stateNode,r=e.memoizedState;null!==r&&(s=r.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(n(314))}null!==a&&a.delete(t),Sc(e,s)}function Pc(e,t){return Je(e,t)}function Tc(e,t,s,a){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dc(e,t,s,a){return new Tc(e,t,s,a)}function Ac(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oc(e,t){var s=e.alternate;return null===s?((s=Dc(e.tag,t,e.key,e.mode)).elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=14680064&e.flags,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Fc(e,t,s,a,r,i){var l=2;if(a=e,"function"===typeof e)Ac(e)&&(l=1);else if("string"===typeof e)l=5;else e:switch(e){case _:return Rc(s.children,r,i,t);case N:l=8,r|=8;break;case k:return(e=Dc(12,s,t,2|r)).elementType=k,e.lanes=i,e;case P:return(e=Dc(13,s,t,r)).elementType=P,e.lanes=i,e;case T:return(e=Dc(19,s,t,r)).elementType=T,e.lanes=i,e;case O:return Mc(s,r,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case S:l=10;break e;case C:l=9;break e;case E:l=11;break e;case D:l=14;break e;case A:l=16,a=null;break e}throw Error(n(130,null==e?e:typeof e,""))}return(t=Dc(l,s,t,r)).elementType=e,t.type=a,t.lanes=i,t}function Rc(e,t,s,a){return(e=Dc(7,e,a,t)).lanes=s,e}function Mc(e,t,s,a){return(e=Dc(22,e,a,t)).elementType=O,e.lanes=s,e.stateNode={isHidden:!1},e}function Ic(e,t,s){return(e=Dc(6,e,null,t)).lanes=s,e}function Lc(e,t,s){return(t=Dc(4,null!==e.children?e.children:[],e.key,t)).lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uc(e,t,s,a,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=xt(0),this.expirationTimes=xt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xt(0),this.identifierPrefix=a,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function zc(e,t,s,a,r,n,i,l,o){return e=new Uc(e,t,s,l,o),1===t?(t=1,!0===n&&(t|=8)):t=0,n=Dc(3,null,null,t),e.current=n,n.stateNode=e,n.memoizedState={element:a,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mn(n),e}function qc(e){if(!e)return Sr;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(n(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Dr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(n(171))}if(1===e.tag){var s=e.type;if(Dr(s))return Fr(e,s,t)}return t}function Wc(e,t,s,a,r,n,i,l,o){return(e=zc(s,a,!0,e,0,n,0,l,o)).context=qc(null),s=e.current,(n=Ln(a=ec(),r=tc(s))).callback=void 0!==t&&null!==t?t:null,Un(s,n,r),e.current.lanes=r,ft(e,r,a),ac(e,a),e}function Bc(e,t,s,a){var r=t.current,n=ec(),i=tc(r);return s=qc(s),null===t.context?t.context=s:t.pendingContext=s,(t=Ln(n,i)).payload={element:e},null!==(a=void 0===a?null:a)&&(t.callback=a),null!==(e=Un(r,t,i))&&(sc(e,r,i,n),zn(e,r,i)),i}function Gc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var s=e.retryLane;e.retryLane=0!==s&&s<t?s:t}}function Vc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}_o=function(e,t,s){if(null!==e)if(e.memoizedProps!==t.pendingProps||Er.current)yl=!0;else{if(0===(e.lanes&s)&&0===(128&t.flags))return yl=!1,function(e,t,s){switch(t.tag){case 3:El(t),mn();break;case 5:Qn(t);break;case 1:Dr(t.type)&&Rr(t);break;case 4:$n(t,t.stateNode.containerInfo);break;case 10:var a=t.type._context,r=t.memoizedProps.value;kr(jn,a._currentValue),a._currentValue=r;break;case 13:if(null!==(a=t.memoizedState))return null!==a.dehydrated?(kr(Zn,1&Zn.current),t.flags|=128,null):0!==(s&t.child.childLanes)?Ml(e,t,s):(kr(Zn,1&Zn.current),null!==(e=Bl(e,t,s))?e.sibling:null);kr(Zn,1&Zn.current);break;case 19:if(a=0!==(s&t.childLanes),0!==(128&e.flags)){if(a)return ql(e,t,s);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),kr(Zn,Zn.current),a)break;return null;case 22:case 23:return t.lanes=0,_l(e,t,s)}return Bl(e,t,s)}(e,t,s);yl=0!==(131072&e.flags)}else yl=!1,an&&0!==(1048576&t.flags)&&Xr(t,Hr,t.index);switch(t.lanes=0,t.tag){case 2:var a=t.type;Wl(e,t),e=t.pendingProps;var r=Tr(t,Cr.current);Pn(t,s),r=gi(null,t,a,e,r,s);var i=xi();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Dr(a)?(i=!0,Rr(t)):i=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Mn(t),r.updater=al,t.stateNode=r,r._reactInternals=t,ll(t,a,e,s),t=Cl(null,t,a,!0,i,s)):(t.tag=0,an&&i&&Zr(t),bl(null,t,r,s),t=t.child),t;case 16:a=t.elementType;e:{switch(Wl(e,t),e=t.pendingProps,a=(r=a._init)(a._payload),t.type=a,r=t.tag=function(e){if("function"===typeof e)return Ac(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===D)return 14}return 2}(a),e=tl(a,e),r){case 0:t=kl(null,t,a,e,s);break e;case 1:t=Sl(null,t,a,e,s);break e;case 11:t=vl(null,t,a,e,s);break e;case 14:t=wl(null,t,a,tl(a.type,e),s);break e}throw Error(n(306,a,""))}return t;case 0:return a=t.type,r=t.pendingProps,kl(e,t,a,r=t.elementType===a?r:tl(a,r),s);case 1:return a=t.type,r=t.pendingProps,Sl(e,t,a,r=t.elementType===a?r:tl(a,r),s);case 3:e:{if(El(t),null===e)throw Error(n(387));a=t.pendingProps,r=(i=t.memoizedState).element,In(e,t),Wn(t,a,null,s);var l=t.memoizedState;if(a=l.element,i.isDehydrated){if(i={element:a,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Pl(e,t,a,s,r=ol(Error(n(423)),t));break e}if(a!==r){t=Pl(e,t,a,s,r=ol(Error(n(424)),t));break e}for(sn=or(t.stateNode.containerInfo.firstChild),tn=t,an=!0,rn=null,s=wn(t,null,a,s),t.child=s;s;)s.flags=-3&s.flags|4096,s=s.sibling}else{if(mn(),a===r){t=Bl(e,t,s);break e}bl(e,t,a,s)}t=t.child}return t;case 5:return Qn(t),null===e&&cn(t),a=t.type,r=t.pendingProps,i=null!==e?e.memoizedProps:null,l=r.children,tr(a,r)?l=null:null!==i&&tr(a,i)&&(t.flags|=32),Nl(e,t),bl(e,t,l,s),t.child;case 6:return null===e&&cn(t),null;case 13:return Ml(e,t,s);case 4:return $n(t,t.stateNode.containerInfo),a=t.pendingProps,null===e?t.child=vn(t,null,a,s):bl(e,t,a,s),t.child;case 11:return a=t.type,r=t.pendingProps,vl(e,t,a,r=t.elementType===a?r:tl(a,r),s);case 7:return bl(e,t,t.pendingProps,s),t.child;case 8:case 12:return bl(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(a=t.type._context,r=t.pendingProps,i=t.memoizedProps,l=r.value,kr(jn,a._currentValue),a._currentValue=l,null!==i)if(ia(i.value,l)){if(i.children===r.children&&!Er.current){t=Bl(e,t,s);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var o=i.dependencies;if(null!==o){l=i.child;for(var c=o.firstContext;null!==c;){if(c.context===a){if(1===i.tag){(c=Ln(-1,s&-s)).tag=2;var d=i.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=s,null!==(c=i.alternate)&&(c.lanes|=s),En(i.return,s,t),o.lanes|=s;break}c=c.next}}else if(10===i.tag)l=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(l=i.return))throw Error(n(341));l.lanes|=s,null!==(o=l.alternate)&&(o.lanes|=s),En(l,s,t),l=i.sibling}else l=i.child;if(null!==l)l.return=i;else for(l=i;null!==l;){if(l===t){l=null;break}if(null!==(i=l.sibling)){i.return=l.return,l=i;break}l=l.return}i=l}bl(e,t,r.children,s),t=t.child}return t;case 9:return r=t.type,a=t.pendingProps.children,Pn(t,s),a=a(r=Tn(r)),t.flags|=1,bl(e,t,a,s),t.child;case 14:return r=tl(a=t.type,t.pendingProps),wl(e,t,a,r=tl(a.type,r),s);case 15:return jl(e,t,t.type,t.pendingProps,s);case 17:return a=t.type,r=t.pendingProps,r=t.elementType===a?r:tl(a,r),Wl(e,t),t.tag=1,Dr(a)?(e=!0,Rr(t)):e=!1,Pn(t,s),nl(t,a,r),ll(t,a,r,s),Cl(null,t,a,!0,e,s);case 19:return ql(e,t,s);case 22:return _l(e,t,s)}throw Error(n(156,t.tag))};var Jc="function"===typeof reportError?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}function $c(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xc(){}function Zc(e,t,s,a,r){var n=s._reactRootContainer;if(n){var i=n;if("function"===typeof r){var l=r;r=function(){var e=Gc(i);l.call(e)}}Bc(t,i,e,r)}else i=function(e,t,s,a,r){if(r){if("function"===typeof a){var n=a;a=function(){var e=Gc(i);n.call(e)}}var i=Wc(t,a,e,0,null,!1,0,"",Xc);return e._reactRootContainer=i,e[mr]=i.current,qa(8===e.nodeType?e.parentNode:e),dc(),i}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof a){var l=a;a=function(){var e=Gc(o);l.call(e)}}var o=zc(e,0,!1,null,0,!1,0,"",Xc);return e._reactRootContainer=o,e[mr]=o.current,qa(8===e.nodeType?e.parentNode:e),dc(function(){Bc(t,o,s,a)}),o}(s,t,e,r,a);return Gc(i)}$c.prototype.render=Kc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(n(409));Bc(e,t,null,null)},$c.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc(function(){Bc(null,e,null,null)}),t[mr]=null}},$c.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nt();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Ot.length&&0!==t&&t<Ot[s].priority;s++);Ot.splice(s,0,e),0===s&&It(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=ut(t.pendingLanes);0!==s&&(yt(t,1|s),ac(t,Qe()),0===(6&Eo)&&(Wo=Qe()+500,qr()))}break;case 13:dc(function(){var t=Fn(e,1);if(null!==t){var s=ec();sc(t,e,1,s)}}),Vc(e,1)}},jt=function(e){if(13===e.tag){var t=Fn(e,134217728);if(null!==t)sc(t,e,134217728,ec());Vc(e,134217728)}},_t=function(e){if(13===e.tag){var t=tc(e),s=Fn(e,t);if(null!==s)sc(s,e,t,ec());Vc(e,t)}},Nt=function(){return bt},kt=function(e,t){var s=bt;try{return bt=e,t()}finally{bt=s}},je=function(e,t,s){switch(t){case"input":if(X(e,s),t=s.name,"radio"===s.type&&null!=t){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var a=s[t];if(a!==e&&a.form===e.form){var r=vr(a);if(!r)throw Error(n(90));J(a),X(a,r)}}}break;case"textarea":ne(e,s);break;case"select":null!=(t=s.value)&&se(e,!!s.multiple,t,!1)}},Ee=cc,Pe=dc;var ed={usingClientEntryPoint:!1,Events:[yr,br,vr,Se,Ce,cc]},td={findFiberByHostInstance:fr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},sd={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:v.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ad=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ad.isDisabled&&ad.supportsFiber)try{rt=ad.inject(sd),nt=ad}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ed,t.createPortal=function(e,t){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(n(200));return function(e,t,s){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:j,key:null==a?null:""+a,children:e,containerInfo:t,implementation:s}}(e,t,null,s)},t.createRoot=function(e,t){if(!Yc(e))throw Error(n(299));var s=!1,a="",r=Jc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(s=!0),void 0!==t.identifierPrefix&&(a=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=zc(e,1,!1,null,0,s,0,a,r),e[mr]=t.current,qa(8===e.nodeType?e.parentNode:e),new Kc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(n(188));throw e=Object.keys(e).join(","),Error(n(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,s){if(!Qc(t))throw Error(n(200));return Zc(null,e,t,!0,s)},t.hydrateRoot=function(e,t,s){if(!Yc(e))throw Error(n(405));var a=null!=s&&s.hydratedSources||null,r=!1,i="",l=Jc;if(null!==s&&void 0!==s&&(!0===s.unstable_strictMode&&(r=!0),void 0!==s.identifierPrefix&&(i=s.identifierPrefix),void 0!==s.onRecoverableError&&(l=s.onRecoverableError)),t=Wc(t,null,e,1,null!=s?s:null,r,0,i,l),e[mr]=t.current,qa(e),a)for(e=0;e<a.length;e++)r=(r=(s=a[e])._getVersion)(s._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[s,r]:t.mutableSourceEagerHydrationData.push(s,r);return new $c(t)},t.render=function(e,t,s){if(!Qc(t))throw Error(n(200));return Zc(null,e,t,!1,s)},t.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(n(40));return!!e._reactRootContainer&&(dc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[mr]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,s,a){if(!Qc(s))throw Error(n(200));if(null==e||void 0===e._reactInternals)throw Error(n(38));return Zc(e,t,s,!1,a)},t.version="18.3.1-next-f1338f8080-20240426"},352:(e,t,s)=>{var a=s(119);t.createRoot=a.createRoot,t.hydrateRoot=a.hydrateRoot},414:(e,t,s)=>{e.exports=s(654)},427:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(s(569));class n extends r.default{select(e){let t=!1;const s=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e){let{ascending:t=!0,nullsFirst:s,foreignTable:a,referencedTable:r=a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=r?"".concat(r,".order"):"order",i=this.url.searchParams.get(n);return this.url.searchParams.set(n,"".concat(i?"".concat(i,","):"").concat(e,".").concat(t?"asc":"desc").concat(void 0===s?"":s?".nullsfirst":".nullslast")),this}limit(e){let{foreignTable:t,referencedTable:s=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a="undefined"===typeof s?"limit":"".concat(s,".limit");return this.url.searchParams.set(a,"".concat(e)),this}range(e,t){let{foreignTable:s,referencedTable:a=s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r="undefined"===typeof a?"offset":"".concat(a,".offset"),n="undefined"===typeof a?"limit":"".concat(a,".limit");return this.url.searchParams.set(r,"".concat(e)),this.url.searchParams.set(n,"".concat(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain(){let{analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:a=!1,wal:r=!1,format:n="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var i;const l=[e?"analyze":null,t?"verbose":null,s?"settings":null,a?"buffers":null,r?"wal":null].filter(Boolean).join("|"),o=null!==(i=this.headers.get("Accept"))&&void 0!==i?i:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(n,'; for="').concat(o,'"; options=').concat(l,";")),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(e)),this}}t.default=n},569:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(s(621)),n=a(s(732));t.default=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(s=e.isMaybeSingle)&&void 0!==s&&s,e.fetch?this.fetch=e.fetch:"undefined"===typeof fetch?this.fetch=r.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,a,r;let i=null,l=null,o=null,c=e.status,d=e.statusText;if(e.ok){if("HEAD"!==this.method){const s=await e.text();""===s||(l="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?s:JSON.parse(s))}const r=null===(s=this.headers.get("Prefer"))||void 0===s?void 0:s.match(/count=(exact|planned|estimated)/),n=null===(a=e.headers.get("content-range"))||void 0===a?void 0:a.split("/");r&&n&&n.length>1&&(o=parseInt(n[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(l)&&(l.length>1?(i={code:"PGRST116",details:"Results contain ".concat(l.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,o=null,c=406,d="Not Acceptable"):l=1===l.length?l[0]:null)}else{const t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(l=[],i=null,c=200,d="OK")}catch(u){404===e.status&&""===t?(c=204,d="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(r=null===i||void 0===i?void 0:i.details)||void 0===r?void 0:r.includes("0 rows"))&&(i=null,c=200,d="OK"),i&&this.shouldThrowOnError)throw new n.default(i)}return{error:i,data:l,count:o,status:c,statusText:d}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,a;return{error:{message:"".concat(null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),details:"".concat(null!==(s=null===e||void 0===e?void 0:e.stack)&&void 0!==s?s:""),hint:"",code:"".concat(null!==(a=null===e||void 0===e?void 0:e.code)&&void 0!==a?a:"")},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}}},621:(e,t,s)=>{s.r(t),s.d(t,{Headers:()=>i,Request:()=>l,Response:()=>o,default:()=>n,fetch:()=>r});var a=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof s.g)return s.g;throw new Error("unable to locate global object")}();const r=a.fetch,n=a.fetch.bind(a),i=a.Headers,l=a.Request,o=a.Response},654:(e,t,s)=>{var a=s(950),r=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var a,n={},c=null,d=null;for(a in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)i.call(t,a)&&!o.hasOwnProperty(a)&&(n[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===n[a]&&(n[a]=t[a]);return{$$typeof:r,type:e,key:c,ref:d,props:n,_owner:l.current}}t.Fragment=n,t.jsx=c,t.jsxs=c},732:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class s extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=s},761:(e,t)=>{function s(e,t){var s=e.length;e.push(t);e:for(;0<s;){var a=s-1>>>1,r=e[a];if(!(0<n(r,t)))break e;e[a]=t,e[s]=r,s=a}}function a(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],s=e.pop();if(s!==t){e[0]=s;e:for(var a=0,r=e.length,i=r>>>1;a<i;){var l=2*(a+1)-1,o=e[l],c=l+1,d=e[c];if(0>n(o,s))c<r&&0>n(d,o)?(e[a]=d,e[c]=s,a=c):(e[a]=o,e[l]=s,a=l);else{if(!(c<r&&0>n(d,s)))break e;e[a]=d,e[c]=s,a=c}}}return t}function n(e,t){var s=e.sortIndex-t.sortIndex;return 0!==s?s:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var l=Date,o=l.now();t.unstable_now=function(){return l.now()-o}}var c=[],d=[],u=1,h=null,m=3,p=!1,g=!1,x=!1,f="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function v(e){for(var t=a(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,s(c,t)}t=a(d)}}function w(e){if(x=!1,v(e),!g)if(null!==a(c))g=!0,O(j);else{var t=a(d);null!==t&&F(w,t.startTime-e)}}function j(e,s){g=!1,x&&(x=!1,y(S),S=-1),p=!0;var n=m;try{for(v(s),h=a(c);null!==h&&(!(h.expirationTime>s)||e&&!P());){var i=h.callback;if("function"===typeof i){h.callback=null,m=h.priorityLevel;var l=i(h.expirationTime<=s);s=t.unstable_now(),"function"===typeof l?h.callback=l:h===a(c)&&r(c),v(s)}else r(c);h=a(c)}if(null!==h)var o=!0;else{var u=a(d);null!==u&&F(w,u.startTime-s),o=!1}return o}finally{h=null,m=n,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,N=!1,k=null,S=-1,C=5,E=-1;function P(){return!(t.unstable_now()-E<C)}function T(){if(null!==k){var e=t.unstable_now();E=e;var s=!0;try{s=k(!0,e)}finally{s?_():(N=!1,k=null)}}else N=!1}if("function"===typeof b)_=function(){b(T)};else if("undefined"!==typeof MessageChannel){var D=new MessageChannel,A=D.port2;D.port1.onmessage=T,_=function(){A.postMessage(null)}}else _=function(){f(T,0)};function O(e){k=e,N||(N=!0,_())}function F(e,s){S=f(function(){e(t.unstable_now())},s)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||p||(g=!0,O(j))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return a(c)},t.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var s=m;m=t;try{return e()}finally{m=s}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var s=m;m=e;try{return t()}finally{m=s}},t.unstable_scheduleCallback=function(e,r,n){var i=t.unstable_now();switch("object"===typeof n&&null!==n?n="number"===typeof(n=n.delay)&&0<n?i+n:i:n=i,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:n,expirationTime:l=n+l,sortIndex:-1},n>i?(e.sortIndex=n,s(d,e),null===a(c)&&e===a(d)&&(x?(y(S),S=-1):x=!0,F(w,n-i))):(e.sortIndex=l,s(c,e),g||p||(g=!0,O(j))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=m;return function(){var s=m;m=t;try{return e.apply(this,arguments)}finally{m=s}}}},950:(e,t,s)=>{e.exports=s(49)}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,s),n.exports}s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a=s(950),r=s(352);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!=n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}function l(e,t,s){return(t=i(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function o(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?o(Object(s),!0).forEach(function(t){l(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):o(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}class d extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",s=arguments.length>2?arguments[2]:void 0;super(e),this.name=t,this.context=s}}class u extends d{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class h extends d{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class m extends d{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var p;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(p||(p={}));var g=function(e,t,s,a){return new(s||(s=Promise))(function(r,n){function i(e){try{o(a.next(e))}catch(t){n(t)}}function l(e){try{o(a.throw(e))}catch(t){n(t)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};class x{constructor(e){let{headers:t={},customFetch:a,region:r=p.Any}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=t,this.region=r,this.fetch=(e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return Promise.resolve().then(s.bind(s,621)).then(e=>{let{default:s}=e;return s(...t)})}:fetch),function(){return t(...arguments)}})(a)}setAuth(e){this.headers.Authorization="Bearer ".concat(e)}invoke(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s;return g(this,void 0,void 0,function*(){try{const{headers:a,method:r,body:n}=t;let i={},{region:l}=t;l||(l=this.region);const o=new URL("".concat(this.url,"/").concat(e));let c;l&&"any"!==l&&(i["x-region"]=l,o.searchParams.set("forceFunctionRegion",l)),n&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&("undefined"!==typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(i["Content-Type"]="application/octet-stream",c=n):"string"===typeof n?(i["Content-Type"]="text/plain",c=n):"undefined"!==typeof FormData&&n instanceof FormData?c=n:(i["Content-Type"]="application/json",c=JSON.stringify(n)));const d=yield this.fetch(o.toString(),{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},i),this.headers),a),body:c}).catch(e=>{throw new u(e)}),p=d.headers.get("x-relay-error");if(p&&"true"===p)throw new h(d);if(!d.ok)throw new m(d);let g,x=(null!==(s=d.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return g="application/json"===x?yield d.json():"application/octet-stream"===x?yield d.blob():"text/event-stream"===x?d:"multipart/form-data"===x?yield d.formData():yield d.text(),{data:g,error:null,response:d}}catch(a){return{data:null,error:a,response:a instanceof m||a instanceof h?a.context:void 0}}})}}var f=s(53);const{PostgrestClient:y,PostgrestQueryBuilder:b,PostgrestFilterBuilder:v,PostgrestTransformBuilder:w,PostgrestBuilder:j,PostgrestError:_}=f;const N=class{static detectEnvironment(){var e;if("undefined"!==typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!==typeof s.g&&"undefined"!==typeof s.g.WebSocket)return{type:"native",constructor:s.g.WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocketPair&&"undefined"===typeof globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!==typeof globalThis&&globalThis.EdgeRuntime||"undefined"!==typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!==typeof process&&process.versions&&process.versions.node){const e=parseInt(process.versions.node.split(".")[0]);return e>=22?"undefined"!==typeof globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(e," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:"Node.js ".concat(e," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+="\n\nSuggested solution: ".concat(e.workaround)),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},k="realtime-js/".concat("2.15.4"),S=1e4;var C,E,P,T,D,A;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(C||(C={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(E||(E={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(P||(P={})),function(e){e.websocket="websocket"}(T||(T={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(D||(D={}));class O{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"===typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const a=t.getUint8(1),r=t.getUint8(2);let n=this.HEADER_LENGTH+2;const i=s.decode(e.slice(n,n+a));n+=a;const l=s.decode(e.slice(n,n+r));n+=r;return{ref:null,topic:i,event:l,payload:JSON.parse(s.decode(e.slice(n,e.byteLength)))}}}class F{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(A||(A={}));const R=function(e,t){var s;const a=null!==(s=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce((s,r)=>(s[r]=M(r,e,t,a),s),{})},M=(e,t,s,a)=>{const r=t.find(t=>t.name===e),n=null===r||void 0===r?void 0:r.type,i=s[e];return n&&!a.includes(n)?I(n,i):L(i)},I=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return W(t,s)}switch(e){case A.bool:return U(t);case A.float4:case A.float8:case A.int2:case A.int4:case A.int8:case A.numeric:case A.oid:return z(t);case A.json:case A.jsonb:return q(t);case A.timestamp:return B(t);case A.abstime:case A.date:case A.daterange:case A.int4range:case A.int8range:case A.money:case A.reltime:case A.text:case A.time:case A.timestamptz:case A.timetz:case A.tsrange:case A.tstzrange:default:return L(t)}},L=e=>e,U=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},z=e=>{if("string"===typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},q=e=>{if("string"===typeof e)try{return JSON.parse(e)}catch(t){return console.log("JSON parse error: ".concat(t)),e}return e},W=(e,t)=>{if("string"!==typeof e)return e;const s=e.length-1,a=e[s];if("{"===e[0]&&"}"===a){let a;const n=e.slice(1,s);try{a=JSON.parse("["+n+"]")}catch(r){a=n?n.split(","):[]}return a.map(e=>I(t,e))}return e},B=e=>"string"===typeof e?e.replace(" ","T"):e,G=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class H{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S;this.channel=e,this.event=t,this.payload=s,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(e){let{status:t,response:s}=e;this.recHooks.filter(e=>e.status===t).forEach(e=>e.callback(s))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var V,J,K,$;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(V||(V={}));class Y{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null===t||void 0===t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Y.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=Y.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Y.syncDiff(this.state,e,t,s),a())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,a){const r=this.cloneDeep(e),n=this.transformState(t),i={},l={};return this.map(r,(e,t)=>{n[e]||(l[e]=t)}),this.map(n,(e,t)=>{const s=r[e];if(s){const a=t.map(e=>e.presence_ref),r=s.map(e=>e.presence_ref),n=t.filter(e=>r.indexOf(e.presence_ref)<0),o=s.filter(e=>a.indexOf(e.presence_ref)<0);n.length>0&&(i[e]=n),o.length>0&&(l[e]=o)}else i[e]=t}),this.syncDiff(r,{joins:i,leaves:l},s,a)}static syncDiff(e,t,s,a){const{joins:r,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),a||(a=()=>{}),this.map(r,(t,a)=>{var r;const n=null!==(r=e[t])&&void 0!==r?r:[];if(e[t]=this.cloneDeep(a),n.length>0){const s=e[t].map(e=>e.presence_ref),a=n.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...a)}s(t,n,a)}),this.map(n,(t,s)=>{let r=e[t];if(!r)return;const n=s.map(e=>e.presence_ref);r=r.filter(e=>n.indexOf(e.presence_ref)<0),e[t]=r,a(t,r,s),0===r.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const a=e[s];return t[s]="metas"in a?a.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):a,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(J||(J={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(K||(K={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}($||($={}));class Q{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},s=arguments.length>2?arguments[2]:void 0;this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=E.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new H(this,P.join,this.params,this.timeout),this.rejoinTimer=new F(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=E.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this._joinRef())),this.state=E.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=E.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=E.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=E.errored,this.rejoinTimer.scheduleTimeout())}),this._on(P.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Y(this),this.broadcastEndpointURL=G(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;var s,a,r;if(this.socket.isConnected()||this.socket.connect(),this.state==E.closed){const{config:{broadcast:n,presence:i,private:l}}=this.params,o=null!==(a=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==a?a:[],c=!!this.bindings[K.PRESENCE]&&this.bindings[K.PRESENCE].length>0||!0===(null===(r=this.params.config.presence)||void 0===r?void 0:r.enabled),d={},u={broadcast:n,presence:Object.assign(Object.assign({},i),{enabled:c}),postgres_changes:o,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(t=>null===e||void 0===e?void 0:e($.CHANNEL_ERROR,t)),this._onClose(()=>null===e||void 0===e?void 0:e($.CLOSED)),this.updateJoinPayload(Object.assign({config:u},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async t=>{let{postgres_changes:s}=t;var a;if(this.socket.setAuth(),void 0!==s){const t=this.bindings.postgres_changes,r=null!==(a=null===t||void 0===t?void 0:t.length)&&void 0!==a?a:0,n=[];for(let a=0;a<r;a++){const r=t[a],{filter:{event:i,schema:l,table:o,filter:c}}=r,d=s&&s[a];if(!d||d.event!==i||d.schema!==l||d.table!==o||d.filter!==c)return this.unsubscribe(),this.state=E.errored,void(null===e||void 0===e||e($.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},r),{id:d.id}))}return this.bindings.postgres_changes=n,void(e&&e($.SUBSCRIBED))}null===e||void 0===e||e($.SUBSCRIBED)}).receive("error",t=>{this.state=E.errored,null===e||void 0===e||e($.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null===e||void 0===e||e($.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===E.joined&&e===K.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s,a;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var a,r,n;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(n=null===(r=null===(a=this.params)||void 0===a?void 0:a.config)||void 0===r?void 0:r.broadcast)||void 0===n?void 0:n.ack)||s("ok"),i.receive("ok",()=>s("ok")),i.receive("error",()=>s("error")),i.receive("timeout",()=>s("timed out"))});{const{event:n,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,l,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(a=e.body)||void 0===a?void 0:a.cancel()),e.ok?"ok":"error"}catch(r){return"AbortError"===r.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=E.leaving;const t=()=>{this.socket.log("channel","leave ".concat(this.topic)),this._trigger(P.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(a=>{s=new H(this,P.leave,{},e),s.receive("ok",()=>{t(),a("ok")}).receive("timeout",()=>{t(),a("timed out")}).receive("error",()=>{a("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null===s||void 0===s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=E.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const a=new AbortController,r=setTimeout(()=>a.abort(),s),n=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:a.signal}));return clearTimeout(r),n}_push(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let a=new H(this,e,t,s);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(e.event),e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var a,r;const n=e.toLocaleLowerCase(),{close:i,error:l,leave:o,join:c}=P;if(s&&[i,l,o,c].indexOf(n)>=0&&s!==this._joinRef())return;let d=this._onMessage(n,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(a=this.bindings.postgres_changes)||void 0===a||a.filter(e=>{var t,s,a;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(a=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===a?void 0:a.toLocaleLowerCase())===n}).map(e=>e.callback(d,s)):null===(r=this.bindings[n])||void 0===r||r.filter(e=>{var s,a,r,i,l,o;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in e){const n=e.id,i=null===(s=e.filter)||void 0===s?void 0:s.event;return n&&(null===(a=t.ids)||void 0===a?void 0:a.includes(n))&&("*"===i||(null===i||void 0===i?void 0:i.toLocaleLowerCase())===(null===(r=t.data)||void 0===r?void 0:r.type.toLocaleLowerCase()))}{const s=null===(l=null===(i=null===e||void 0===e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===l?void 0:l.toLocaleLowerCase();return"*"===s||s===(null===(o=null===t||void 0===t?void 0:t.event)||void 0===o?void 0:o.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===n}).map(e=>{if("object"===typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:a,type:r,errors:n}=e,i={schema:t,table:s,commit_timestamp:a,eventType:r,new:{},old:{},errors:n};d=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(d,s)})}_isClosed(){return this.state===E.closed}_isJoined(){return this.state===E.joined}_isJoining(){return this.state===E.joining}_isLeaving(){return this.state===E.leaving}_replyEventName(e){return"chan_reply_".concat(e)}_on(e,t,s){const a=e.toLocaleLowerCase(),r={type:a,filter:t,callback:s};return this.bindings[a]?this.bindings[a].push(r):this.bindings[a]=[r],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var a;return!((null===(a=e.type)||void 0===a?void 0:a.toLocaleLowerCase())===s&&Q.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(P.close,{},e)}_onError(e){this._on(P.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=E.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=R(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=R(e.columns,e.old_record)),t}}const X=()=>{},Z=25e3,ee=10,te=100,se=[1e3,2e3,5e3,1e4];class ae{constructor(e,t){var a;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=S,this.transport=null,this.heartbeatIntervalMs=Z,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=X,this.ref=0,this.reconnectTimer=null,this.logger=X,this.conn=null,this.sendBuffer=[],this.serializer=new O,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return Promise.resolve().then(s.bind(s,621)).then(e=>{let{default:s}=e;return s(...t)}).catch(e=>{throw new Error("Failed to load @supabase/node-fetch: ".concat(e.message,". ")+"This is required for HTTP requests in Node.js environments without native fetch.")})}:fetch),function(){return t(...arguments)}},!(null===(a=null===t||void 0===t?void 0:t.params)||void 0===a?void 0:a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint="".concat(e,"/").concat(T.websocket),this.httpEndpoint=G(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null===t||void 0===t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=N.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error("".concat(t,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw new Error("WebSocket not available: ".concat(t))}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,null!==t&&void 0!==t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case C.connecting:return D.Connecting;case C.open:return D.Open;case C.closing:return D.Closing;default:return D.Closed}}isConnected(){return this.connectionState()===D.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};const s="realtime:".concat(e),a=this.getChannels().find(e=>e.topic===s);if(a)return a;{const s=new Q("realtime:".concat(e),t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:a,ref:r}=e,n=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push","".concat(t," ").concat(s," (").concat(r,")"),a),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},te)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(l){this.log("error","error in heartbeat callback",l)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:s,payload:a,ref:r}=e,n=r?"(".concat(r,")"):"",i=a.status||"";this.log("receive","".concat(i," ").concat(t," ").concat(s," ").concat(n).trim(),a),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,a,r)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport","connected to ".concat(this.endpointURL())),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport","".concat(e)),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(P.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?",a=new URLSearchParams(t);return"".concat(e).concat(s).concat(a)}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=t||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const s={access_token:e,version:k};e&&t.updateJoinPayload(s),t.joinedOnce&&t._isJoined()&&t._push(P.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";this.setAuth().catch(t=>{this.log("error","error setting auth in ".concat(e),t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(a){this.log("error","error in ".concat(e," callback"),a)}})}catch(s){this.log("error","error triggering ".concat(e," callbacks"),s)}}_setupReconnectionTimer(){this.reconnectTimer=new F(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ee)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,a,r,n,i,l,o,c;if(this.transport=null!==(t=null===e||void 0===e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null===e||void 0===e?void 0:e.timeout)&&void 0!==s?s:S,this.heartbeatIntervalMs=null!==(a=null===e||void 0===e?void 0:e.heartbeatIntervalMs)&&void 0!==a?a:Z,this.worker=null!==(r=null===e||void 0===e?void 0:e.worker)&&void 0!==r&&r,this.accessToken=null!==(n=null===e||void 0===e?void 0:e.accessToken)&&void 0!==n?n:null,this.heartbeatCallback=null!==(i=null===e||void 0===e?void 0:e.heartbeatCallback)&&void 0!==i?i:X,(null===e||void 0===e?void 0:e.params)&&(this.params=e.params),(null===e||void 0===e?void 0:e.logger)&&(this.logger=e.logger),((null===e||void 0===e?void 0:e.logLevel)||(null===e||void 0===e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null===e||void 0===e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>se[e-1]||1e4,this.encode=null!==(o=null===e||void 0===e?void 0:e.encode)&&void 0!==o?o:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null===e||void 0===e?void 0:e.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!==typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null===e||void 0===e?void 0:e.workerUrl}}}class re extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ne(e){return"object"===typeof e&&null!==e&&"__isStorageError"in e}class ie extends re{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class le extends re{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var oe=function(e,t,s,a){return new(s||(s=Promise))(function(r,n){function i(e){try{o(a.next(e))}catch(t){n(t)}}function l(e){try{o(a.throw(e))}catch(t){n(t)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};const ce=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return Promise.resolve().then(s.bind(s,621)).then(e=>{let{default:s}=e;return s(...t)})}:fetch),function(){return t(...arguments)}},de=e=>{if(Array.isArray(e))return e.map(e=>de(e));if("function"===typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(e=>{let[s,a]=e;const r=s.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=de(a)}),t};var ue=function(e,t,s,a){return new(s||(s=Promise))(function(r,n){function i(e){try{o(a.next(e))}catch(t){n(t)}}function l(e){try{o(a.throw(e))}catch(t){n(t)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};const he=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),me=(e,t,a)=>ue(void 0,void 0,void 0,function*(){const r=yield oe(void 0,void 0,void 0,function*(){return"undefined"===typeof Response?(yield Promise.resolve().then(s.bind(s,621))).Response:Response});e instanceof r&&!(null===a||void 0===a?void 0:a.noResolveJson)?e.json().then(s=>{const a=e.status||500,r=(null===s||void 0===s?void 0:s.statusCode)||a+"";t(new ie(he(s),a,r))}).catch(e=>{t(new le(he(e),e))}):t(new le(he(e),e))}),pe=(e,t,s,a)=>{const r={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&a?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(a)?(r.headers=Object.assign({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),r.body=JSON.stringify(a)):r.body=a,(null===t||void 0===t?void 0:t.duplex)&&(r.duplex=t.duplex),Object.assign(Object.assign({},r),s)):r};function ge(e,t,s,a,r,n){return ue(this,void 0,void 0,function*(){return new Promise((i,l)=>{e(s,pe(t,a,r,n)).then(e=>{if(!e.ok)throw e;return(null===a||void 0===a?void 0:a.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>me(e,l,a))})})}function xe(e,t,s,a){return ue(this,void 0,void 0,function*(){return ge(e,"GET",t,s,a)})}function fe(e,t,s,a,r){return ue(this,void 0,void 0,function*(){return ge(e,"POST",t,a,r,s)})}function ye(e,t,s,a,r){return ue(this,void 0,void 0,function*(){return ge(e,"PUT",t,a,r,s)})}function be(e,t,s,a,r){return ue(this,void 0,void 0,function*(){return ge(e,"DELETE",t,a,r,s)})}var ve=function(e,t,s,a){return new(s||(s=Promise))(function(r,n){function i(e){try{o(a.next(e))}catch(t){n(t)}}function l(e){try{o(a.throw(e))}catch(t){n(t)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};const we={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},je={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class _e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;this.url=e,this.headers=t,this.bucketId=s,this.fetch=ce(a)}uploadOrUpdate(e,t,s,a){return ve(this,void 0,void 0,function*(){try{let r;const n=Object.assign(Object.assign({},je),a);let i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const l=n.metadata;"undefined"!==typeof Blob&&s instanceof Blob?(r=new FormData,r.append("cacheControl",n.cacheControl),l&&r.append("metadata",this.encodeMetadata(l)),r.append("",s)):"undefined"!==typeof FormData&&s instanceof FormData?(r=s,r.append("cacheControl",n.cacheControl),l&&r.append("metadata",this.encodeMetadata(l))):(r=s,i["cache-control"]="max-age=".concat(n.cacheControl),i["content-type"]=n.contentType,l&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),(null===a||void 0===a?void 0:a.headers)&&(i=Object.assign(Object.assign({},i),a.headers));const o=this._removeEmptyFolders(t),c=this._getFinalPath(o),d=yield("PUT"==e?ye:fe)(this.fetch,"".concat(this.url,"/object/").concat(c),r,Object.assign({headers:i},(null===n||void 0===n?void 0:n.duplex)?{duplex:n.duplex}:{}));return{data:{path:o,id:d.Id,fullPath:d.Key},error:null}}catch(r){if(ne(r))return{data:null,error:r};throw r}})}upload(e,t,s){return ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,a){return ve(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),n=this._getFinalPath(r),i=new URL(this.url+"/object/upload/sign/".concat(n));i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:je.upsert},a),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!==typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!==typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,n["cache-control"]="max-age=".concat(t.cacheControl),n["content-type"]=t.contentType);return{data:{path:r,fullPath:(yield ye(this.fetch,i.toString(),e,{headers:n})).Key},error:null}}catch(l){if(ne(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return ve(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const a=Object.assign({},this.headers);(null===t||void 0===t?void 0:t.upsert)&&(a["x-upsert"]="true");const r=yield fe(this.fetch,"".concat(this.url,"/object/upload/sign/").concat(s),{},{headers:a}),n=new URL(this.url+r.url),i=n.searchParams.get("token");if(!i)throw new re("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:i},error:null}}catch(s){if(ne(s))return{data:null,error:s};throw s}})}update(e,t,s){return ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return ve(this,void 0,void 0,function*(){try{return{data:yield fe(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===s||void 0===s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(ne(a))return{data:null,error:a};throw a}})}copy(e,t,s){return ve(this,void 0,void 0,function*(){try{return{data:{path:(yield fe(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===s||void 0===s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(ne(a))return{data:null,error:a};throw a}})}createSignedUrl(e,t,s){return ve(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),r=yield fe(this.fetch,"".concat(this.url,"/object/sign/").concat(a),Object.assign({expiresIn:t},(null===s||void 0===s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const n=(null===s||void 0===s?void 0:s.download)?"&download=".concat(!0===s.download?"":s.download):"";return r={signedUrl:encodeURI("".concat(this.url).concat(r.signedURL).concat(n))},{data:r,error:null}}catch(a){if(ne(a))return{data:null,error:a};throw a}})}createSignedUrls(e,t,s){return ve(this,void 0,void 0,function*(){try{const a=yield fe(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:t,paths:e},{headers:this.headers}),r=(null===s||void 0===s?void 0:s.download)?"&download=".concat(!0===s.download?"":s.download):"";return{data:a.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI("".concat(this.url).concat(e.signedURL).concat(r)):null})),error:null}}catch(a){if(ne(a))return{data:null,error:a};throw a}})}download(e,t){return ve(this,void 0,void 0,function*(){const s="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image/authenticated":"object",a=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{}),r=a?"?".concat(a):"";try{const t=this._getFinalPath(e),a=yield xe(this.fetch,"".concat(this.url,"/").concat(s,"/").concat(t).concat(r),{headers:this.headers,noResolveJson:!0});return{data:yield a.blob(),error:null}}catch(n){if(ne(n))return{data:null,error:n};throw n}})}info(e){return ve(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield xe(this.fetch,"".concat(this.url,"/object/info/").concat(t),{headers:this.headers});return{data:de(e),error:null}}catch(s){if(ne(s))return{data:null,error:s};throw s}})}exists(e){return ve(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,a){return ue(this,void 0,void 0,function*(){return ge(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),a)})}(this.fetch,"".concat(this.url,"/object/").concat(t),{headers:this.headers}),{data:!0,error:null}}catch(s){if(ne(s)&&s instanceof le){const e=s.originalError;if([400,404].includes(null===e||void 0===e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),a=[],r=(null===t||void 0===t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==r&&a.push(r);const n="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{});""!==i&&a.push(i);let l=a.join("&");return""!==l&&(l="?".concat(l)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(n,"/public/").concat(s).concat(l))}}}remove(e){return ve(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ne(t))return{data:null,error:t};throw t}})}list(e,t,s){return ve(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},we),t),{prefix:e||""});return{data:yield fe(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),a,{headers:this.headers},s),error:null}}catch(a){if(ne(a))return{data:null,error:a};throw a}})}listV2(e,t){return ve(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield fe(this.fetch,"".concat(this.url,"/object/list-v2/").concat(this.bucketId),s,{headers:this.headers},t),error:null}}catch(s){if(ne(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!==typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return"".concat(this.bucketId,"/").concat(e.replace(/^\/+/,""))}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}}const Ne={"X-Client-Info":"storage-js/".concat("2.11.0")};var ke=function(e,t,s,a){return new(s||(s=Promise))(function(r,n){function i(e){try{o(a.next(e))}catch(t){n(t)}}function l(e){try{o(a.throw(e))}catch(t){n(t)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};class Se{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;const r=new URL(e);if(null===a||void 0===a?void 0:a.useNewHostname){/supabase\.(co|in|red)$/.test(r.hostname)&&!r.hostname.includes("storage.supabase.")&&(r.hostname=r.hostname.replace("supabase.","storage.supabase."))}this.url=r.href,this.headers=Object.assign(Object.assign({},Ne),t),this.fetch=ce(s)}listBuckets(){return ke(this,void 0,void 0,function*(){try{return{data:yield xe(this.fetch,"".concat(this.url,"/bucket"),{headers:this.headers}),error:null}}catch(e){if(ne(e))return{data:null,error:e};throw e}})}getBucket(e){return ke(this,void 0,void 0,function*(){try{return{data:yield xe(this.fetch,"".concat(this.url,"/bucket/").concat(e),{headers:this.headers}),error:null}}catch(t){if(ne(t))return{data:null,error:t};throw t}})}createBucket(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};return ke(this,void 0,void 0,function*(){try{return{data:yield fe(this.fetch,"".concat(this.url,"/bucket"),{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(ne(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ke(this,void 0,void 0,function*(){try{return{data:yield ye(this.fetch,"".concat(this.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(ne(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ke(this,void 0,void 0,function*(){try{return{data:yield fe(this.fetch,"".concat(this.url,"/bucket/").concat(e,"/empty"),{},{headers:this.headers}),error:null}}catch(t){if(ne(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ke(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers}),error:null}}catch(t){if(ne(t))return{data:null,error:t};throw t}})}}class Ce extends Se{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}from(e){return new _e(this.url,this.headers,e,this.fetch)}}let Ee="";Ee="undefined"!==typeof Deno?"deno":"undefined"!==typeof document?"web":"undefined"!==typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Pe={headers:{"X-Client-Info":"supabase-js-".concat(Ee,"/").concat("2.56.1")}},Te={schema:"public"},De={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ae={};var Oe=s(621),Fe=function(e,t,s,a){return new(s||(s=Promise))(function(r,n){function i(e){try{o(a.next(e))}catch(t){n(t)}}function l(e){try{o(a.throw(e))}catch(t){n(t)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};const Re=e=>{let t;return t=e||("undefined"===typeof fetch?Oe.default:fetch),function(){return t(...arguments)}},Me=(e,t,s)=>{const a=Re(s),r="undefined"===typeof Headers?Oe.Headers:Headers;return(s,n)=>Fe(void 0,void 0,void 0,function*(){var i;const l=null!==(i=yield t())&&void 0!==i?i:e;let o=new r(null===n||void 0===n?void 0:n.headers);return o.has("apikey")||o.set("apikey",e),o.has("Authorization")||o.set("Authorization","Bearer ".concat(l)),a(s,Object.assign(Object.assign({},n),{headers:o}))})};var Ie=function(e,t,s,a){return new(s||(s=Promise))(function(r,n){function i(e){try{o(a.next(e))}catch(t){n(t)}}function l(e){try{o(a.throw(e))}catch(t){n(t)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};const Le="2.71.1",Ue=3e4,ze=9e4,qe={"X-Client-Info":"gotrue-js/".concat(Le)},We="X-Supabase-Api-Version",Be={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Ge=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class He extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Ve(e){return"object"===typeof e&&null!==e&&"__isAuthError"in e}class Je extends He{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class Ke extends He{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class $e extends He{constructor(e,t,s,a){super(e,s,a),this.name=t,this.status=s}}class Ye extends $e{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Qe extends $e{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Xe extends $e{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ze extends $e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class et extends $e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tt extends $e{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function st(e){return Ve(e)&&"AuthRetryableFetchError"===e.name}class at extends $e{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class rt extends $e{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),it=" \t\n\r=".split(""),lt=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<it.length;t+=1)e[it[t].charCodeAt(0)]=-2;for(let t=0;t<nt.length;t+=1)e[nt[t].charCodeAt(0)]=t;return e})();function ot(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(nt[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(nt[e]),t.queuedBits-=6}}function ct(e,t,s){const a=lt[e];if(!(a>-1)){if(-2===a)return;throw new Error('Invalid Base64-URL character "'.concat(String.fromCharCode(e),'"'))}for(t.queue=t.queue<<6|a,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function dt(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},a={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},n=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(0===(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,a,s)};for(let i=0;i<e.length;i+=1)ct(e.charCodeAt(i),r,n);return t.join("")}function ut(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error("Unrecognized Unicode codepoint: ".concat(e.toString(16)))}t(e)}function ht(e,t){for(let s=0;s<e.length;s+=1){let a=e.charCodeAt(s);if(a>55295&&a<=56319){const t=1024*(a-55296)&65535;a=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}ut(a,t)}}function mt(e){const t=[],s={queue:0,queuedBits:0},a=e=>{t.push(e)};for(let r=0;r<e.length;r+=1)ct(e.charCodeAt(r),s,a);return new Uint8Array(t)}function pt(e){const t=[],s={queue:0,queuedBits:0},a=e=>{t.push(e)};return e.forEach(e=>ot(e,s,a)),ot(null,s,a),t.join("")}const gt=()=>"undefined"!==typeof window&&"undefined"!==typeof document,xt={tested:!1,writable:!1},ft=()=>{if(!gt())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(t){return!1}if(xt.tested)return xt.writable;const e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),xt.tested=!0,xt.writable=!0}catch(t){xt.tested=!0,xt.writable=!1}return xt.writable};const yt=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return Promise.resolve().then(s.bind(s,621)).then(e=>{let{default:s}=e;return s(...t)})}:fetch),function(){return t(...arguments)}},bt=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},vt=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(a){return s}},wt=async(e,t)=>{await e.removeItem(t)};class jt{constructor(){this.promise=new jt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function _t(e){const t=e.split(".");if(3!==t.length)throw new rt("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!Ge.test(t[s]))throw new rt("JWT not in base64url format");return{header:JSON.parse(dt(t[0])),payload:JSON.parse(dt(t[1])),signature:mt(t[2]),raw:{header:t[0],payload:t[1]}}}function Nt(e){return("0"+e.toString(16)).substr(-2)}async function kt(e){if(!("undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"undefined"!==typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),a=new Uint8Array(s);return Array.from(a).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function St(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=function(){const e=new Uint32Array(56);if("undefined"===typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let a=0;a<56;a++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Nt).join("")}();let r=a;s&&(r+="/PASSWORD_RECOVERY"),await bt(e,"".concat(t,"-code-verifier"),r);const n=await kt(a);return[n,a===n?"plain":"s256"]}jt.promiseConstructor=Promise;const Ct=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Et=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Pt(e){if(!Et.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Tt(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"===typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(t,'" property of the session object is not supported. Please use getUser() instead.'))},set:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function Dt(e){return JSON.parse(JSON.stringify(e))}var At=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(s[a[r]]=e[a[r]])}return s};const Ot=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ft=[502,503,504];async function Rt(e){var t,s;if(!("object"===typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"===typeof s.json))throw new tt(Ot(e),0);if(Ft.includes(e.status))throw new tt(Ot(e),e.status);let a,r;try{a=await e.json()}catch(i){throw new Ke(Ot(i),i)}const n=function(e){const t=e.headers.get(We);if(!t)return null;if(!t.match(Ct))return null;try{return new Date("".concat(t,"T00:00:00.0Z"))}catch(i){return null}}(e);if(n&&n.getTime()>=Be.timestamp&&"object"===typeof a&&a&&"string"===typeof a.code?r=a.code:"object"===typeof a&&a&&"string"===typeof a.error_code&&(r=a.error_code),r){if("weak_password"===r)throw new at(Ot(a),e.status,(null===(t=a.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===r)throw new Ye}else if("object"===typeof a&&a&&"object"===typeof a.weak_password&&a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0))throw new at(Ot(a),e.status,a.weak_password.reasons);throw new Je(Ot(a),e.status||500,r)}async function Mt(e,t,s,a){var r;const n=Object.assign({},null===a||void 0===a?void 0:a.headers);n[We]||(n[We]=Be.name),(null===a||void 0===a?void 0:a.jwt)&&(n.Authorization="Bearer ".concat(a.jwt));const i=null!==(r=null===a||void 0===a?void 0:a.query)&&void 0!==r?r:{};(null===a||void 0===a?void 0:a.redirectTo)&&(i.redirect_to=a.redirectTo);const l=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",o=await async function(e,t,s,a,r,n){const i=((e,t,s,a)=>{const r={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===t||void 0===t?void 0:t.headers),r.body=JSON.stringify(a),Object.assign(Object.assign({},r),s))})(t,a,r,n);let l;try{l=await e(s,Object.assign({},i))}catch(o){throw console.error(o),new tt(Ot(o),0)}l.ok||await Rt(l);if(null===a||void 0===a?void 0:a.noResolveJson)return l;try{return await l.json()}catch(o){await Rt(o)}}(e,t,s+l,{headers:n,noResolveJson:null===a||void 0===a?void 0:a.noResolveJson},{},null===a||void 0===a?void 0:a.body);return(null===a||void 0===a?void 0:a.xform)?null===a||void 0===a?void 0:a.xform(o):{data:Object.assign({},o),error:null}}function It(e){var t;let s=null;var a;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(a=e.expires_in,Math.round(Date.now()/1e3)+a)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Lt(e){const t=It(e);return!t.error&&e.weak_password&&"object"===typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"===typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Ut(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function zt(e){return{data:e,error:null}}function qt(e){const{action_link:t,email_otp:s,hashed_token:a,redirect_to:r,verification_type:n}=e,i=At(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:a,redirect_to:r,verification_type:n},user:Object.assign({},i)},error:null}}function Wt(e){return e}const Bt=["global","local","others"];var Gt=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(s[a[r]]=e[a[r]])}return s};class Ht{constructor(e){let{url:t="",headers:s={},fetch:a}=e;this.url=t,this.headers=s,this.fetch=yt(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bt[0];if(Bt.indexOf(t)<0)throw new Error("@supabase/auth-js: Parameter scope must be one of ".concat(Bt.join(", ")));try{return await Mt(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(t),{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ve(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await Mt(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ut})}catch(s){if(Ve(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Gt(e,["options"]),a=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(a.new_email=null===s||void 0===s?void 0:s.newEmail,delete a.newEmail),await Mt(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:a,headers:this.headers,xform:qt,redirectTo:null===t||void 0===t?void 0:t.redirectTo})}catch(t){if(Ve(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Mt(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:Ut})}catch(t){if(Ve(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,a,r,n,i,l;try{const o={nextPage:null,lastPage:0,total:0},c=await Mt(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(r=null===(a=null===e||void 0===e?void 0:e.perPage)||void 0===a?void 0:a.toString())&&void 0!==r?r:""},xform:Wt});if(c.error)throw c.error;const d=await c.json(),u=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,h=null!==(l=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==l?l:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);o["".concat(s,"Page")]=t}),o.total=parseInt(u)),{data:Object.assign(Object.assign({},d),o),error:null}}catch(o){if(Ve(o))return{data:{users:[]},error:o};throw o}}async getUserById(e){Pt(e);try{return await Mt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:Ut})}catch(t){if(Ve(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Pt(e);try{return await Mt(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:Ut})}catch(s){if(Ve(s))return{data:{user:null},error:s};throw s}}async deleteUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Pt(e);try{return await Mt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:Ut})}catch(s){if(Ve(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Pt(e.userId);try{const{data:t,error:s}=await Mt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Pt(e.userId),Pt(e.id);try{return{data:await Mt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers}),error:null}}catch(t){if(Ve(t))return{data:null,error:t};throw t}}}function Vt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Jt=!!(globalThis&&ft()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Kt extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class $t extends Kt{}async function Yt(e,t,s){Jt&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const a=new globalThis.AbortController;return t>0&&setTimeout(()=>{a.abort(),Jt&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async a=>{if(!a){if(0===t)throw Jt&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new $t('Acquiring an exclusive Navigator LockManager lock "'.concat(e,'" immediately failed'));if(Jt)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}Jt&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,a.name);try{return await s()}finally{Jt&&console.log("@supabase/gotrue-js: navigatorLock: released",e,a.name)}}))}!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!==typeof self&&(self.globalThis=self)}}();const Qt={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:qe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Xt(e,t,s){return await s()}const Zt={};class es{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=es.nextInstanceID,es.nextInstanceID+=1,this.instanceID>0&&gt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},Qt),e);if(this.logDebugMessages=!!a.debug,"function"===typeof a.debug&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new Ht({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=yt(a.fetch),this.lock=a.lock||Xt,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:gt()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Yt:this.lock=Xt,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:ft()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Vt(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=Vt(this.memoryStorage)),gt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=Zt[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Zt[this.storageKey]=Object.assign(Object.assign({},Zt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Zt[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Zt[this.storageKey]=Object.assign(Object.assign({},Zt[this.storageKey]),{cachedAt:e})}_debug(){if(this.logDebugMessages){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.logger("GoTrueClient@".concat(this.instanceID," (").concat(Le,") ").concat((new Date).toISOString()),...t)}return this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(a){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),gt()&&this.detectSessionInUrl&&"none"!==s){const{data:a,error:r}=await this._getSessionFromURL(t,s);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),function(e){return Ve(e)&&"AuthImplicitGrantRedirectError"===e.name}(r)){const t=null===(e=r.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:r}}return await this._removeSession(),{error:r}}const{session:n,redirectType:i}=a;return this._debug("#_initialize()","detected session in URL",n,"redirect type",i),await this._saveSession(n),setTimeout(async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",n):await this._notifyAllSubscribers("SIGNED_IN",n)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Ve(t)?{error:t}:{error:new Ke("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,a;try{const r=await Mt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!==(s=null===(t=null===e||void 0===e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(a=null===e||void 0===e?void 0:e.options)||void 0===a?void 0:a.captchaToken}},xform:It}),{data:n,error:i}=r;if(i||!n)return{data:{user:null,session:null},error:i};const l=n.session,o=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:o,session:l},error:null}}catch(r){if(Ve(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,s,a;try{let r;if("email"in e){const{email:s,password:a,options:n}=e;let i=null,l=null;"pkce"===this.flowType&&([i,l]=await St(this.storage,this.storageKey)),r=await Mt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null===n||void 0===n?void 0:n.emailRedirectTo,body:{email:s,password:a,data:null!==(t=null===n||void 0===n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null===n||void 0===n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:l},xform:It})}else{if(!("phone"in e))throw new Xe("You must provide either an email or phone number and a password");{const{phone:t,password:n,options:i}=e;r=await Mt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:t,password:n,data:null!==(s=null===i||void 0===i?void 0:i.data)&&void 0!==s?s:{},channel:null!==(a=null===i||void 0===i?void 0:i.channel)&&void 0!==a?a:"sms",gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},xform:It})}}const{data:n,error:i}=r;if(i||!n)return{data:{user:null,session:null},error:i};const l=n.session,o=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:o,session:l},error:null}}catch(r){if(Ve(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:a,options:r}=e;t=await Mt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:null===r||void 0===r?void 0:r.captchaToken}},xform:Lt})}else{if(!("phone"in e))throw new Xe("You must provide either an email or phone number and a password");{const{phone:s,password:a,options:r}=e;t=await Mt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:null===r||void 0===r?void 0:r.captchaToken}},xform:Lt})}}const{data:s,error:a}=t;return a?{data:{user:null,session:null},error:a}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:a}):{data:{user:null,session:null},error:new Qe}}catch(t){if(Ve(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,a,r;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:null===(r=e.options)||void 0===r?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error('@supabase/auth-js: Unsupported chain "'.concat(t,'"'))}async signInWithSolana(e){var t,s,a,r,n,i,l,o,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:g,options:x}=e;let f;if(gt())if("object"===typeof h)f=h;else{const e=window;if(!("solana"in e)||"object"!==typeof e.solana||!("signIn"in e.solana&&"function"===typeof e.solana.signIn||"signMessage"in e.solana&&"function"===typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");f=e.solana}else{if("object"!==typeof h||!(null===x||void 0===x?void 0:x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");f=h}const y=new URL(null!==(t=null===x||void 0===x?void 0:x.url)&&void 0!==t?t:window.location.href);if("signIn"in f&&f.signIn){const e=await f.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null===x||void 0===x?void 0:x.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"===typeof e[0])t=e[0];else{if(!(e&&"object"===typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"===typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"===typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in f)||"function"!==typeof f.signMessage||!("publicKey"in f)||"object"!==typeof f||!f.publicKey||!("toBase58"in f.publicKey)||"function"!==typeof f.publicKey.toBase58)throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=["".concat(y.host," wants you to sign in with your Solana account:"),f.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1","URI: ".concat(y.href),"Issued At: ".concat(null!==(a=null===(s=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==a?a:(new Date).toISOString()),...(null===(r=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===r?void 0:r.notBefore)?["Not Before: ".concat(x.signInWithSolana.notBefore)]:[],...(null===(n=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===n?void 0:n.expirationTime)?["Expiration Time: ".concat(x.signInWithSolana.expirationTime)]:[],...(null===(i=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===i?void 0:i.chainId)?["Chain ID: ".concat(x.signInWithSolana.chainId)]:[],...(null===(l=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===l?void 0:l.nonce)?["Nonce: ".concat(x.signInWithSolana.nonce)]:[],...(null===(o=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===o?void 0:o.requestId)?["Request ID: ".concat(x.signInWithSolana.requestId)]:[],...(null===(d=null===(c=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...x.signInWithSolana.resources.map(e=>"- ".concat(e))]:[]].join("\n");const e=await f.signMessage((new TextEncoder).encode(m),"utf8");if(!e||!(e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:s}=await Mt(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:pt(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:It});if(s)throw s;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Qe}}catch(g){if(Ve(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await vt(this.storage,"".concat(this.storageKey,"-code-verifier")),[s,a]=(null!==t&&void 0!==t?t:"").split("/");try{const{data:t,error:r}=await Mt(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:It});if(await wt(this.storage,"".concat(this.storageKey,"-code-verifier")),r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!==a&&void 0!==a?a:null}),error:r}):{data:{user:null,session:null,redirectType:null},error:new Qe}}catch(r){if(Ve(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:s,token:a,access_token:r,nonce:n}=e,i=await Mt(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:s,id_token:a,access_token:r,nonce:n,gotrue_meta_security:{captcha_token:null===t||void 0===t?void 0:t.captchaToken}},xform:It}),{data:l,error:o}=i;return o?{data:{user:null,session:null},error:o}:l&&l.session&&l.user?(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:o}):{data:{user:null,session:null},error:new Qe}}catch(t){if(Ve(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,a,r,n;try{if("email"in e){const{email:a,options:r}=e;let n=null,i=null;"pkce"===this.flowType&&([n,i]=await St(this.storage,this.storageKey));const{error:l}=await Mt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:a,data:null!==(t=null===r||void 0===r?void 0:r.data)&&void 0!==t?t:{},create_user:null===(s=null===r||void 0===r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null===r||void 0===r?void 0:r.captchaToken},code_challenge:n,code_challenge_method:i},redirectTo:null===r||void 0===r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:l}}if("phone"in e){const{phone:t,options:s}=e,{data:i,error:l}=await Mt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:t,data:null!==(a=null===s||void 0===s?void 0:s.data)&&void 0!==a?a:{},create_user:null===(r=null===s||void 0===s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken},channel:null!==(n=null===s||void 0===s?void 0:s.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null===i||void 0===i?void 0:i.message_id},error:l}}throw new Xe("You must provide either an email or phone number.")}catch(i){if(Ve(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(e){var t,s;try{let a,r;"options"in e&&(a=null===(t=e.options)||void 0===t?void 0:t.redirectTo,r=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:n,error:i}=await Mt(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:a,xform:It});if(i)throw i;if(!n)throw new Error("An error occurred on token verification.");const l=n.session,o=n.user;return(null===l||void 0===l?void 0:l.access_token)&&(await this._saveSession(l),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:o,session:l},error:null}}catch(a){if(Ve(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(e){var t,s,a;try{let r=null,n=null;return"pkce"===this.flowType&&([r,n]=await St(this.storage,this.storageKey)),await Mt(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(a=null===e||void 0===e?void 0:e.options)||void 0===a?void 0:a.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:n}),headers:this.headers,xform:zt})}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Ye;const{error:a}=await Mt(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:a}})}catch(e){if(Ve(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t="".concat(this.url,"/resend");if("email"in e){const{email:s,type:a,options:r}=e,{error:n}=await Mt(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:a,gotrue_meta_security:{captcha_token:null===r||void 0===r?void 0:r.captchaToken}},redirectTo:null===r||void 0===r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){const{phone:s,type:a,options:r}=e,{data:n,error:i}=await Mt(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:a,gotrue_meta_security:{captcha_token:null===r||void 0===r?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:null===n||void 0===n?void 0:n.message_id},error:i}}throw new Xe("You must provide either an email or phone number and a type")}catch(t){if(Ve(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock("lock:".concat(this.storageKey),e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await vt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<ze;if(this._debug("#__loadSession()","session has".concat(s?"":" not"," expired"),"expires_at",e.expires_at),!s){if(this.userStorage){const t=await vt(this.userStorage,this.storageKey+"-user");(null===t||void 0===t?void 0:t.user)?e.user=t.user:e.user=Tt()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,a)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,a))})}return{data:{session:e},error:null}}const{session:a,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Mt(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:Ut}):await this._useSession(async e=>{var t,s,a;const{data:r,error:n}=e;if(n)throw n;return(null===(t=r.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Mt(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:null!==(a=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==a?a:void 0,xform:Ut}):{data:{user:null},error:new Ye}})}catch(t){if(Ve(t))return function(e){return Ve(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await wt(this.storage,"".concat(this.storageKey,"-code-verifier"))),{data:{user:null},error:t};throw t}}async updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession(async s=>{const{data:a,error:r}=s;if(r)throw r;if(!a.session)throw new Ye;const n=a.session;let i=null,l=null;"pkce"===this.flowType&&null!=e.email&&([i,l]=await St(this.storage,this.storageKey));const{data:o,error:c}=await Mt(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null===t||void 0===t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:l}),jwt:n.access_token,xform:Ut});if(c)throw c;return n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}})}catch(s){if(Ve(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ye;const t=Date.now()/1e3;let s=t,a=!0,r=null;const{payload:n}=_t(e.access_token);if(n.exp&&(s=n.exp,a=s<=t),a){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};r=t}else{const{data:a,error:n}=await this._getUser(e.access_token);if(n)throw n;r={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(Ve(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:r}=t;if(r)throw r;e=null!==(s=a.session)&&void 0!==s?s:void 0}if(!(null===e||void 0===e?void 0:e.refresh_token))throw new Ye;const{session:a,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Ve(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!gt())throw new Ze("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ze(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new et("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Ze("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new et("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const a=new URL(window.location.href);return a.searchParams.delete("code"),window.history.replaceState(window.history.state,"",a.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:a,access_token:r,refresh_token:n,expires_in:i,expires_at:l,token_type:o}=e;if(!r||!i||!n||!o)throw new Ze("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(i);let u=c+d;l&&(u=parseInt(l));const h=u-c;1e3*h<=Ue&&console.warn("@supabase/gotrue-js: Session as retrieved from URL expires in ".concat(h,"s, should have been closer to ").concat(d,"s"));const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:p,error:g}=await this._getUser(r);if(g)throw g;const x={provider_token:s,provider_refresh_token:a,access_token:r,expires_in:d,expires_at:u,refresh_token:n,token_type:o,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:x,redirectType:e.type},error:null}}catch(s){if(Ve(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await vt(this.storage,"".concat(this.storageKey,"-code-verifier"));return!(!e.code||!t)}async signOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut(){let{scope:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession(async t=>{var s;const{data:a,error:r}=t;if(r)return{error:r};const n=null===(s=a.session)||void 0===s?void 0:s.access_token;if(n){const{error:t}=await this.admin.signOut(n,e);if(t&&(!function(e){return Ve(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await wt(this.storage,"".concat(this.storageKey,"-code-verifier"))),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,a;try{const{data:{session:a},error:r}=t;if(r)throw r;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(r){await(null===(a=this.stateChangeEmitters.get(e))||void 0===a?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null,a=null;"pkce"===this.flowType&&([s,a]=await St(this.storage,this.storageKey,!0));try{return await Mt(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:s,code_challenge_method:a,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(Ve(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:a}=await this._useSession(async t=>{var s,a,r,n,i;const{data:l,error:o}=t;if(o)throw o;const c=await this._getUrlForProvider("".concat(this.url,"/user/identities/authorize"),e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(a=e.options)||void 0===a?void 0:a.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:!0});return await Mt(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(n=l.session)||void 0===n?void 0:n.access_token)&&void 0!==i?i:void 0})});if(a)throw a;return gt()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null===s||void 0===s?void 0:s.url),{data:{provider:e.provider,url:null===s||void 0===s?void 0:s.url},error:null}}catch(s){if(Ve(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,a;const{data:r,error:n}=t;if(n)throw n;return await Mt(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(e.identity_id),{headers:this.headers,jwt:null!==(a=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==a?a:void 0})})}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t="#_refreshAccessToken(".concat(e.substring(0,5),"...)");this._debug(t,"begin");try{const r=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Mt(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:It})),a=(e,t)=>{const s=200*Math.pow(2,e);return t&&st(t)&&Date.now()+s-r<Ue},new Promise((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{const t=await s(n);if(!a(n,null,t))return void e(t)}catch(r){if(!a(n,r))return void t(r)}})()}))}catch(r){if(this._debug(t,"error",r),Ve(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}var s,a}_isValidSession(e){return"object"===typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider("".concat(this.url,"/authorize"),e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),gt()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const r=await vt(this.storage,this.storageKey);if(r&&this.userStorage){let t=await vt(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:r.user},await bt(this.userStorage,this.storageKey+"-user",t)),r.user=null!==(e=null===t||void 0===t?void 0:t.user)&&void 0!==e?e:Tt()}else if(r&&!r.user&&!r.user){const e=await vt(this.storage,this.storageKey+"-user");e&&(null===e||void 0===e?void 0:e.user)?(r.user=e.user,await wt(this.storage,this.storageKey+"-user"),await bt(this.storage,this.storageKey,r)):r.user=Tt()}if(this._debug(s,"session from storage",r),!this._isValidSession(r))return this._debug(s,"session is not valid"),void(null!==r&&await this._removeSession());const n=1e3*(null!==(t=r.expires_at)&&void 0!==t?t:1/0)-Date.now()<ze;if(this._debug(s,"session has".concat(n?"":" not"," expired with margin of ").concat(ze,"s")),n){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),st(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(r.user&&!0===r.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(r.access_token);!t&&(null===e||void 0===e?void 0:e.user)?(r.user=e.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(s,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){return this._debug(s,"error",r),void console.error(r)}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Ye;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a="#_callRefreshToken(".concat(e.substring(0,5),"...)");this._debug(a,"begin");try{this.refreshingDeferred=new jt;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Ye;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const a={session:t.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(a,"error",r),Ve(r)){const e={session:null,error:r};return st(r)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a="#_notifyAllSubscribers(".concat(e,")");this._debug(a,"begin",t,"broadcast = ".concat(s));try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const a=[],r=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,t)}catch(r){a.push(r)}});if(await Promise.all(r),a.length>0){for(let e=0;e<a.length;e+=1)console.error(a[e]);throw a[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&await bt(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const a=Dt(e);await bt(this.storage,this.storageKey,a)}else{const e=Dt(t);await bt(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await wt(this.storage,this.storageKey),await wt(this.storage,this.storageKey+"-code-verifier"),await wt(this.storage,this.storageKey+"-user"),this.userStorage&&await wt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&gt()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ue);this.autoRefreshTicker=e,e&&"object"===typeof e&&"function"===typeof e.unref?e.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const a=Math.floor((1e3*s.expires_at-t)/Ue);this._debug("#_autoRefreshTokenTick()","access token expires in ".concat(a," ticks, a tick lasts ").concat(Ue,"ms, refresh threshold is ").concat(3," ticks")),a<=3&&await this._callRefreshToken(s.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Kt))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!gt()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t="#_onVisibilityChanged(".concat(e,")");this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const a=["provider=".concat(encodeURIComponent(t))];if((null===s||void 0===s?void 0:s.redirectTo)&&a.push("redirect_to=".concat(encodeURIComponent(s.redirectTo))),(null===s||void 0===s?void 0:s.scopes)&&a.push("scopes=".concat(encodeURIComponent(s.scopes))),"pkce"===this.flowType){const[e,t]=await St(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(e)),code_challenge_method:"".concat(encodeURIComponent(t))});a.push(s.toString())}if(null===s||void 0===s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);a.push(e.toString())}return(null===s||void 0===s?void 0:s.skipBrowserRedirect)&&a.push("skip_http_redirect=".concat(s.skipBrowserRedirect)),"".concat(e,"?").concat(a.join("&"))}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:a,error:r}=t;return r?{data:null,error:r}:await Mt(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:null===(s=null===a||void 0===a?void 0:a.session)||void 0===s?void 0:s.access_token})})}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,a;const{data:r,error:n}=t;if(n)return{data:null,error:n};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:o}=await Mt(this.fetch,"POST","".concat(this.url,"/factors"),{body:i,headers:this.headers,jwt:null===(s=null===r||void 0===r?void 0:r.session)||void 0===s?void 0:s.access_token});return o?{data:null,error:o}:("totp"===e.factorType&&(null===(a=null===l||void 0===l?void 0:l.totp)||void 0===a?void 0:a.qr_code)&&(l.totp.qr_code="data:image/svg+xml;utf-8,".concat(l.totp.qr_code)),{data:l,error:null})})}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:a,error:r}=t;if(r)return{data:null,error:r};const{data:n,error:i}=await Mt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null===a||void 0===a?void 0:a.session)||void 0===s?void 0:s.access_token});return i?{data:null,error:i}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),{data:n,error:i})})}catch(t){if(Ve(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:a,error:r}=t;return r?{data:null,error:r}:await Mt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null===a||void 0===a?void 0:a.session)||void 0===s?void 0:s.access_token})})}catch(t){if(Ve(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null===e||void 0===e?void 0:e.factors)||[],a=s.filter(e=>"totp"===e.factor_type&&"verified"===e.status),r=s.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:s,totp:a,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:a},error:r}=e;if(r)return{data:null,error:r};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=_t(a.access_token);let i=null;n.aal&&(i=n.aal);let l=i;(null!==(s=null===(t=a.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(l="aal2");return{data:{currentLevel:i,nextLevel:l,currentAuthenticationMethods:n.amr||[]},error:null}}))}async fetchJwk(e){let t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]}).keys.find(t=>t.kid===e);if(t)return t;const s=Date.now();if(t=this.jwks.keys.find(t=>t.kid===e),t&&this.jwks_cached_at+6e5>s)return t;const{data:a,error:r}=await Mt(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(r)throw r;return a.keys&&0!==a.keys.length?(this.jwks=a,this.jwks_cached_at=s,t=a.keys.find(t=>t.kid===e),t||null):null}async getClaims(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:a,payload:r,signature:n,raw:{header:i,payload:l}}=_t(s);(null===t||void 0===t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(r.exp);const o=a.alg&&!a.alg.startsWith("HS")&&a.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(a.kid,(null===t||void 0===t?void 0:t.keys)?{keys:t.keys}:null===t||void 0===t?void 0:t.jwks):null;if(!o){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:r,header:a,signature:n},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(a.alg),d=await crypto.subtle.importKey("jwk",o,c,!0,["verify"]);if(!await crypto.subtle.verify(c,d,n,function(e){const t=[];return ht(e,e=>t.push(e)),new Uint8Array(t)}("".concat(i,".").concat(l))))throw new rt("Invalid JWT signature");return{data:{claims:r,header:a,signature:n},error:null}}catch(s){if(Ve(s))return{data:null,error:s};throw s}}}es.nextInstanceID=0;const ts=es;class ss extends ts{constructor(e){super(e)}}var as=function(e,t,s,a){return new(s||(s=Promise))(function(r,n){function i(e){try{o(a.next(e))}catch(t){n(t)}}function l(e){try{o(a.throw(e))}catch(t){n(t)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(e,t||[])).next())})};class rs{constructor(e,t,s){var a,r,n;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const i=(l=e).endsWith("/")?l:l+"/";var l;const o=new URL(i);this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const c="sb-".concat(o.hostname.split(".")[0],"-auth-token"),d=function(e,t){var s,a;const{db:r,auth:n,realtime:i,global:l}=e,{db:o,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},o),r),auth:Object.assign(Object.assign({},c),n),realtime:Object.assign(Object.assign({},d),i),storage:{},global:Object.assign(Object.assign(Object.assign({},u),l),{headers:Object.assign(Object.assign({},null!==(s=null===u||void 0===u?void 0:u.headers)&&void 0!==s?s:{}),null!==(a=null===l||void 0===l?void 0:l.headers)&&void 0!==a?a:{})}),accessToken:()=>Ie(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!==s&&void 0!==s?s:{},{db:Te,realtime:Ae,auth:Object.assign(Object.assign({},De),{storageKey:c}),global:Pe});this.storageKey=null!==(a=d.auth.storageKey)&&void 0!==a?a:"",this.headers=null!==(r=d.global.headers)&&void 0!==r?r:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!==(n=d.auth)&&void 0!==n?n:{},this.headers,d.global.fetch),this.fetch=Me(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new y(new URL("rest/v1",o).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new Ce(this.storageUrl.href,this.headers,this.fetch,null===s||void 0===s?void 0:s.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new x(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.rest.rpc(e,t,s)}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return as(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient(e,t,s){let{autoRefreshToken:a,persistSession:r,detectSessionInUrl:n,storage:i,storageKey:l,flowType:o,lock:c,debug:d}=e;const u={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new ss({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),t),storageKey:l,autoRefreshToken:a,persistSession:r,detectSessionInUrl:n,storage:i,flowType:o,lock:c,debug:d,fetch:s,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ae(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null===e||void 0===e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null===t||void 0===t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}(function(){if("undefined"!==typeof window)return!1;if("undefined"===typeof process)return!1;const e=process.version;if(void 0===e||null===e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("\u26a0\ufe0f  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const ns="https://hwpjrkmplydqaxiikupv.supabase.co",is=((e,t,s)=>new rs(e,t,s))(ns,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3cGpya21wbHlkcWF4aWlrdXB2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MTUwNjgsImV4cCI6MjA3MTA5MTA2OH0.6xnC3k_CRChyavAfdJT0I4NLN_Wv1ZgIlRO0Jnqckkk"),ls=e=>{if(e.length<=1)return[e];const t=[],s=new Set,a=(e,r)=>{if(0===r.length){const a=e.join(",");return void(s.has(a)||(s.add(a),t.push([...e])))}for(let t=0;t<r.length;t++){const s=[...e,r[t]],n=[...r.slice(0,t),...r.slice(t+1)];a(s,n)}};return a([],e),t},os=(e,t)=>{const s=[];let a=0;for(const r of t)s.push(e.slice(a,a+r)),a+=r;return s},cs=(e,t)=>1/(1+Math.pow(10,(t-e)/400)),ds=function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32;const r=cs(e,t);return Math.round(a*(s-r))},us=async(e,t)=>{try{const{data:s,error:a}=await is.from("match_fixtures").select("\n        *,\n        match:matches(season_id)\n      ").eq("id",e).single();if(a)throw a;const{data:r,error:n}=await is.from("seasons").select("elo_enabled, elo_k_factor, elo_initial_rating").eq("id",s.match.season_id).single();if(n)throw n;if(!r.elo_enabled)return{success:!0,message:"ELO not enabled for this season"};const i=[s.pair1_player1_id,s.pair1_player2_id,s.pair2_player1_id,s.pair2_player2_id].filter(Boolean),{data:l,error:o}=await is.from("season_players").select("*").eq("season_id",s.match.season_id).in("player_id",i);if(o)throw o;const c=l.filter(e=>[s.pair1_player1_id,s.pair1_player2_id].includes(e.player_id)),d=l.filter(e=>[s.pair2_player1_id,s.pair2_player2_id].includes(e.player_id)),u=c.map(e=>e.elo_rating||r.elo_initial_rating),h=function(e,t,s,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:32;const n=e.reduce((e,t)=>e+t,0)/e.length,i=t.reduce((e,t)=>e+t,0)/t.length,l=s+a,o=s/l,c=a/l;return{team1Change:ds(n,i,o,r),team2Change:ds(i,n,c,r),team1AvgRating:n,team2AvgRating:i,team1ActualScore:o,team2ActualScore:c}}(u,d.map(e=>e.elo_rating||r.elo_initial_rating),t.pair1_score,t.pair2_score,r.elo_k_factor),m=[],p=[];c.forEach((t,s)=>{const a=t.elo_rating||r.elo_initial_rating,n=a+h.team1Change;m.push({id:t.id,elo_rating:Math.max(500,Math.min(3e3,n))}),p.push({season_player_id:t.id,match_fixture_id:e,old_rating:a,new_rating:Math.max(500,Math.min(3e3,n)),rating_change:h.team1Change,k_factor:r.elo_k_factor,opponent_avg_rating:Math.round(h.team2AvgRating),expected_score:cs(h.team1AvgRating,h.team2AvgRating),actual_score:h.team1ActualScore})}),d.forEach((t,s)=>{const a=t.elo_rating||r.elo_initial_rating,n=a+h.team2Change;m.push({id:t.id,elo_rating:Math.max(500,Math.min(3e3,n))}),p.push({season_player_id:t.id,match_fixture_id:e,old_rating:a,new_rating:Math.max(500,Math.min(3e3,n)),rating_change:h.team2Change,k_factor:r.elo_k_factor,opponent_avg_rating:Math.round(h.team1AvgRating),expected_score:cs(h.team2AvgRating,h.team1AvgRating),actual_score:h.team2ActualScore})});for(const e of m){const{error:t}=await is.from("season_players").update({elo_rating:e.elo_rating}).eq("id",e.id);if(t)throw t}for(const e of m){const t=[...c,...d].find(t=>t.id===e.id);t&&await is.from("profiles").update({elo_rating:e.elo_rating}).eq("id",t.player_id)}const{error:g}=await is.from("elo_history").insert(p);if(g)throw g;return{success:!0,eloChanges:h,updates:m,historyRecords:p}}catch(s){return console.error("Error updating ELO ratings:",s),{success:!1,error:s.message}}},hs=e=>e>=1400?"text-red-600":e>=1300?"text-yellow-600":e>=1200?"text-blue-600":e>=1100?"text-green-600":"text-gray-600",ms=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const{data:t,error:s}=await is.from("score_challenges").select("*").order("created_at",{ascending:!1});if(s)throw new Error("Error fetching challenges: ".concat(s.message));if(!t||0===t.length)return[];const a=[...new Set(t.map(e=>e.fixture_id).filter(Boolean))],r=[...new Set(t.map(e=>e.original_result_id).filter(Boolean))],n=[...new Set([...t.map(e=>e.challenger_id).filter(Boolean),...t.map(e=>e.resolved_by).filter(Boolean)])],{data:i}=await is.from("match_fixtures").select("\n        *,\n        match:match_id(week_number, match_date, season_id),\n        player1:player1_id(name),\n        player2:player2_id(name),\n        player3:player3_id(name),\n        player4:player4_id(name)\n      ").in("id",a),{data:l}=await is.from("match_results").select("*").in("id",r),{data:o}=await is.from("profiles").select("id, name").in("id",n),d=t.map(e=>c(c({},e),{},{fixture:(null===i||void 0===i?void 0:i.find(t=>t.id===e.fixture_id))||null,original_result:(null===l||void 0===l?void 0:l.find(t=>t.id===e.original_result_id))||null,challenger:(null===o||void 0===o?void 0:o.find(t=>t.id===e.challenger_id))||null,resolver:(null===o||void 0===o?void 0:o.find(t=>t.id===e.resolved_by))||null}));return e?d.filter(t=>{var s,a;return(null===(s=t.fixture)||void 0===s||null===(a=s.match)||void 0===a?void 0:a.season_id)===e}):d}catch(t){throw console.error("Error in fetchScoreChallenges:",t),t}},ps=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const{data:t,error:s}=await is.from("score_conflicts").select("*").order("created_at",{ascending:!1});if(s)throw new Error("Error fetching conflicts: ".concat(s.message));if(!t||0===t.length)return[];const a=[...new Set(t.map(e=>e.fixture_id).filter(Boolean))],r=[...new Set(t.map(e=>e.first_submission_id).filter(Boolean))],n=[...new Set([...t.map(e=>e.conflicting_user_id).filter(Boolean),...t.map(e=>e.resolved_by).filter(Boolean)])],{data:i}=await is.from("match_fixtures").select("\n        *,\n        match:match_id(week_number, match_date, season_id),\n        player1:player1_id(name),\n        player2:player2_id(name),\n        player3:player3_id(name),\n        player4:player4_id(name)\n      ").in("id",a),{data:l}=await is.from("match_results").select("*").in("id",r),{data:o}=await is.from("profiles").select("id, name").in("id",n),d=t.map(e=>c(c({},e),{},{fixture:(null===i||void 0===i?void 0:i.find(t=>t.id===e.fixture_id))||null,first_submission:(null===l||void 0===l?void 0:l.find(t=>t.id===e.first_submission_id))||null,conflicting_user:(null===o||void 0===o?void 0:o.find(t=>t.id===e.conflicting_user_id))||null,resolver:(null===o||void 0===o?void 0:o.find(t=>t.id===e.resolved_by))||null}));return e?d.filter(t=>{var s,a;return(null===(s=t.fixture)||void 0===s||null===(a=s.match)||void 0===a?void 0:a.season_id)===e}):d}catch(t){throw console.error("Error in fetchScoreConflicts:",t),t}};var gs={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const xs=["color","size","strokeWidth","absoluteStrokeWidth","children"];var fs=(e,t)=>{const s=(0,a.forwardRef)((s,r)=>{let{color:n="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:o,children:d}=s,u=function(e,t){if(null==e)return{};var s,a,r=function(e,t){if(null==e)return{};var s={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;s[a]=e[a]}return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)s=n[a],-1===t.indexOf(s)&&{}.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}(s,xs);return(0,a.createElement)("svg",c(c({ref:r},gs),{},{width:i,height:i,stroke:n,strokeWidth:o?24*Number(l)/Number(i):l,className:"lucide lucide-".concat((h=e,h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()))},u),[...t.map(e=>{let[t,s]=e;return(0,a.createElement)(t,s)}),...(Array.isArray(d)?d:[d])||[]]);var h});return s.displayName="".concat(e),s};const ys=fs("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var bs=s(414);const vs=e=>{let{onBackToLogin:t}=e;const[s,r]=(0,a.useState)(""),[n,i]=(0,a.useState)(!1),[l,o]=(0,a.useState)(""),[c,d]=(0,a.useState)("");return(0,bs.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-[#5D1F1F] to-[#8B3A3A] flex items-center justify-center p-4",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[(0,bs.jsxs)("div",{className:"text-center mb-6",children:[(0,bs.jsx)("img",{src:"/club-logo.png",alt:"Cawood Tennis Club Logo",className:"w-24 h-24 mx-auto mb-3 rounded-full shadow-md object-contain bg-white p-1",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),(0,bs.jsx)("div",{className:"w-24 h-24 bg-[#5D1F1F] rounded-full mx-auto mb-3 flex items-center justify-center shadow-md",style:{display:"none"},children:(0,bs.jsx)("span",{className:"text-white font-bold text-3xl",children:"C"})}),(0,bs.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Reset Password"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"Enter your email to receive a reset link"})]}),l&&(0,bs.jsx)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md",children:(0,bs.jsx)("p",{className:"text-green-800 text-sm",children:l})}),c&&(0,bs.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,bs.jsx)("p",{className:"text-red-800 text-sm",children:c})}),(0,bs.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),i(!0),o(""),d("");try{const{data:{session:e}}=await is.auth.getSession(),t=await fetch("".concat("https://hwpjrkmplydqaxiikupv.supabase.co","/functions/v1/send-password-reset"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3cGpya21wbHlkcWF4aWlrdXB2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MTUwNjgsImV4cCI6MjA3MTA5MTA2OH0.6xnC3k_CRChyavAfdJT0I4NLN_Wv1ZgIlRO0Jnqckkk")},body:JSON.stringify({email:s})}),a=await t.json();t.ok?(o("If an account exists with that email, a password reset link has been sent. Please check your inbox and spam folder."),r("")):(console.error("Password reset error:",a),d(a.error||"Password reset failed. Please try again."))}catch(t){console.error("Unexpected error during password reset:",t),d("An unexpected error occurred. Please try again.")}finally{i(!1)}},className:"space-y-4",children:[(0,bs.jsx)("input",{type:"email",placeholder:"Email address",value:s,onChange:e=>r(e.target.value),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0,disabled:n}),(0,bs.jsx)("button",{type:"submit",disabled:n||!s.trim(),className:"w-full bg-[#5D1F1F] text-white py-3 rounded-md hover:bg-[#4A1818] transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Sending Reset Email...":"Send Reset Email"})]}),(0,bs.jsx)("div",{className:"mt-6 text-center",children:(0,bs.jsxs)("button",{onClick:t,className:"flex items-center justify-center space-x-2 text-[#5D1F1F] hover:text-[#4A1818] transition-colors mx-auto",children:[(0,bs.jsx)(ys,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Back to Sign In"})]})})]})})},ws=fs("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),js=fs("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),_s=e=>{let{onPasswordUpdated:t}=e;const[s,r]=(0,a.useState)(""),[n,i]=(0,a.useState)(""),[l,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(""),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[g,x]=(0,a.useState)(!1),[f,y]=(0,a.useState)(null),[b,v]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{const e=new URLSearchParams(window.location.search).get("token");if(!e)return d("No reset token found. Please request a new password reset."),void v(!1);try{const{data:t,error:s}=await is.rpc("validate_password_reset_token",{p_token:e});if(s)return console.error("\u274c Error validating token:",s),d("Invalid or expired reset link. Please request a new password reset."),void v(!1);t&&t.length>0&&t[0].valid?(x(!0),y(t[0])):d("Invalid or expired reset link. Please request a new password reset.")}catch(t){console.error("Unexpected error:",t),d("An error occurred. Please try again.")}finally{v(!1)}})()},[]);return(0,bs.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-[#5D1F1F] to-[#8B3A3A] flex items-center justify-center p-4",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[(0,bs.jsxs)("div",{className:"text-center mb-6",children:[(0,bs.jsx)("img",{src:"/club-logo.png",alt:"Cawood Tennis Club Logo",className:"w-24 h-24 mx-auto mb-3 rounded-full shadow-md object-contain bg-white p-1",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),(0,bs.jsx)("div",{className:"w-24 h-24 bg-[#5D1F1F] rounded-full mx-auto mb-3 flex items-center justify-center shadow-md",style:{display:"none"},children:(0,bs.jsx)("span",{className:"text-white font-bold text-3xl",children:"C"})}),(0,bs.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Set New Password"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"Enter your new password below"})]}),c&&(0,bs.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,bs.jsx)("p",{className:"text-red-800 text-sm",children:c})}),b?(0,bs.jsx)("div",{className:"text-center py-8",children:(0,bs.jsx)("p",{className:"text-gray-600",children:"Validating reset link..."})}):g?(0,bs.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),g&&f)if(s===n)if(s.length<6)d("Password must be at least 6 characters long");else{o(!0),d("");try{const{data:e,error:t}=await is.rpc("update_password_with_token",{p_user_id:f.user_id,p_new_password:s});t?(console.error("\u274c Password update error:",t),d("Failed to update password: ".concat(t.message)),o(!1)):e&&e.success?(alert("Password updated successfully! You can now sign in with your new password."),setTimeout(()=>{window.location.href="/"},100)):(d("Failed to update password. Please try again."),o(!1))}catch(t){console.error("Unexpected error:",t),d("An unexpected error occurred. Please try again."),o(!1)}}else d("Passwords do not match");else d("Invalid token. Please request a new password reset.")},className:"space-y-4",children:[(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)("input",{type:u?"text":"password",placeholder:"New Password",value:s,onChange:e=>r(e.target.value),className:"w-full p-3 pr-10 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0,disabled:l,minLength:6}),(0,bs.jsx)("button",{type:"button",onClick:()=>h(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",tabIndex:-1,children:u?(0,bs.jsx)(ws,{className:"w-5 h-5"}):(0,bs.jsx)(js,{className:"w-5 h-5"})})]}),(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)("input",{type:m?"text":"password",placeholder:"Confirm New Password",value:n,onChange:e=>i(e.target.value),className:"w-full p-3 pr-10 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0,disabled:l,minLength:6}),(0,bs.jsx)("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",tabIndex:-1,children:m?(0,bs.jsx)(ws,{className:"w-5 h-5"}):(0,bs.jsx)(js,{className:"w-5 h-5"})})]}),(0,bs.jsx)("button",{type:"submit",disabled:l||!s.trim()||!n.trim(),className:"w-full bg-[#5D1F1F] text-white py-3 rounded-md hover:bg-[#4A1818] transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Updating Password...":"Update Password"})]}):(0,bs.jsxs)("div",{className:"text-center py-8",children:[(0,bs.jsx)("p",{className:"text-gray-600 mb-4",children:"Please check your email for a valid reset link."}),(0,bs.jsx)("button",{onClick:()=>window.location.href="/",className:"text-[#5D1F1F] hover:text-[#4A1818] font-medium",children:"Return to Sign In"})]})]})})},Ns=fs("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),ks=fs("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Ss=fs("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Cs=fs("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Es=fs("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ps=e=>{let{id:t,message:s,type:r,onClose:n}=e;const[i,l]=(0,a.useState)(!1),[o,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=setTimeout(()=>l(!0),10);return()=>clearTimeout(e)},[]);const d=()=>{c(!0),setTimeout(n,300)},u=()=>{switch(r){case"success":return"text-green-800";case"error":return"text-red-800";case"warning":return"text-yellow-800";default:return"text-blue-800"}};return(0,bs.jsxs)("div",{className:(()=>{const e="\n      transform transition-all duration-300 ease-in-out\n      ".concat(i&&!o?"translate-x-0 opacity-100":"translate-x-full opacity-0","\n      bg-white rounded-lg shadow-lg border-l-4 p-4 flex items-center space-x-3\n      hover:shadow-xl cursor-pointer\n    "),t={success:"border-green-500 bg-green-50",error:"border-red-500 bg-red-50",warning:"border-yellow-500 bg-yellow-50",info:"border-blue-500 bg-blue-50"};return"".concat(e," ").concat(t[r]||t.info)})(),onClick:d,children:[(()=>{const e="w-5 h-5 flex-shrink-0";switch(r){case"success":return(0,bs.jsx)(Ns,{className:"".concat(e," text-green-600")});case"error":return(0,bs.jsx)(ks,{className:"".concat(e," text-red-600")});case"warning":return(0,bs.jsx)(Ss,{className:"".concat(e," text-yellow-600")});default:return(0,bs.jsx)(Cs,{className:"".concat(e," text-blue-600")})}})(),(0,bs.jsx)("div",{className:"flex-1 text-sm font-medium ".concat(u()),children:s}),(0,bs.jsx)("button",{onClick:e=>{e.stopPropagation(),d()},className:"p-3 rounded-full hover:bg-gray-100 transition-colors ".concat(u().replace("800","600")," min-h-[44px] min-w-[44px] flex items-center justify-center"),style:{touchAction:"manipulation"},children:(0,bs.jsx)(Es,{className:"w-5 h-5"})})]})},Ts=e=>{let{toasts:t,removeToast:s}=e;return 0===t.length?null:(0,bs.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm w-full",children:t.map(e=>(0,bs.jsx)(Ps,c(c({},e),{},{onClose:()=>s(e.id)}),e.id))})},Ds=(0,a.createContext)(),As=()=>{const e=(0,a.useContext)(Ds);if(!e)throw new Error("useAppToast must be used within a ToastProvider");return e},Os=e=>{let{children:t}=e;const s=(()=>{const[e,t]=(0,a.useState)([]),s=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;const n=Date.now()+Math.random(),i={id:n,message:e,type:s,duration:a};return t(e=>[...e,i]),a>0&&setTimeout(()=>{r(n)},a),n},r=e=>{t(t=>t.filter(t=>t.id!==e))};return{toasts:e,showToast:s,removeToast:r,success:(e,t)=>s(e,"success",t),error:(e,t)=>s(e,"error",t),warning:(e,t)=>s(e,"warning",t),info:(e,t)=>s(e,"info",t)}})();return(0,bs.jsxs)(Ds.Provider,{value:s,children:[t,(0,bs.jsx)(Ts,{toasts:s.toasts,removeToast:s.removeToast})]})},Fs=e=>{let{onAuthChange:t,isPasswordReset:s=!1,onPasswordResetComplete:r}=e;const n=As(),[i,l]=(0,a.useState)("login"),[o,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)({email:"",password:"",name:""});(0,a.useEffect)(()=>{s&&l("update")},[s]);return"reset"===i?(0,bs.jsx)(vs,{onBackToLogin:()=>l("login")}):"update"===i?(0,bs.jsx)(_s,{onPasswordUpdated:()=>{r?r():l("login")}}):(0,bs.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-[#5D1F1F] to-[#8B3A3A] flex items-center justify-center p-4",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[(0,bs.jsxs)("div",{className:"text-center mb-6",children:[(0,bs.jsx)("img",{src:"/club-logo.png",alt:"Cawood Tennis Club Logo",className:"w-24 h-24 mx-auto mb-3 rounded-full shadow-md object-contain bg-white p-1",onError:e=>{console.error("Logo failed to load"),e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),(0,bs.jsx)("div",{className:"w-24 h-24 bg-[#5D1F1F] rounded-full mx-auto mb-3 flex items-center justify-center shadow-md",style:{display:"none"},children:(0,bs.jsx)("span",{className:"text-white font-bold text-3xl",children:"C"})}),(0,bs.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Cawood Tennis Club"})]}),(0,bs.jsxs)("div",{className:"flex rounded-lg bg-gray-100 p-1 mb-6",children:[(0,bs.jsx)("button",{type:"button",className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("login"===i?"bg-white text-gray-900 shadow":"text-gray-600"),onClick:()=>l("login"),disabled:o,children:"Sign In"}),(0,bs.jsx)("button",{type:"button",className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("register"===i?"bg-white text-gray-900 shadow":"text-gray-600"),onClick:()=>l("register"),disabled:o,children:"Sign Up"})]}),(0,bs.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),d(!0);try{if("login"===i){const{data:e,error:s}=await is.auth.signInWithPassword({email:u.email,password:u.password});if(s)console.error("\u274c Login error:",s),n.error("Login failed: ".concat(s.message));else{const{data:s}=await is.from("profiles").select("*").eq("id",e.user.id).single();t(s)}}else if("register"===i){const{data:e,error:t}=await is.auth.signUp({email:u.email,password:u.password,options:{data:{name:u.name}}});if(t)console.error("\u274c Registration error:",t),n.error("Registration failed: ".concat(t.message));else if(e.user){const{error:t}=await is.from("profiles").upsert({id:e.user.id,name:u.name,email:u.email,role:"player",status:"approved"},{onConflict:"id"});t&&console.error("Profile creation error:",t);try{const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3cGpya21wbHlkcWF4aWlrdXB2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MTUwNjgsImV4cCI6MjA3MTA5MTA2OH0.6xnC3k_CRChyavAfdJT0I4NLN_Wv1ZgIlRO0Jnqckkk";await fetch("".concat(ns,"/functions/v1/notify-new-user-signup"),{method:"POST",headers:{"Content-Type":"application/json",apikey:t,Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:e.user.id,email:u.email,name:u.name})})}catch(s){console.warn("Failed to send admin notification:",s)}n.success("Registration successful! Check your email to confirm, then sign in."),l("login"),h({email:"",password:"",name:""})}}}catch(a){console.error("\ud83d\udca5 Unexpected error:",a),n.error("An unexpected error occurred. Please try again.")}finally{d(!1)}},className:"space-y-4",children:["register"===i&&(0,bs.jsx)("input",{type:"text",placeholder:"Full Name",value:u.name,onChange:e=>h(c(c({},u),{},{name:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0,disabled:o}),(0,bs.jsx)("input",{type:"email",placeholder:"Email",value:u.email,onChange:e=>h(c(c({},u),{},{email:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0,disabled:o}),(0,bs.jsx)("input",{type:"password",placeholder:"Password",value:u.password,onChange:e=>h(c(c({},u),{},{password:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0,disabled:o}),(0,bs.jsx)("button",{type:"submit",disabled:o,className:"w-full bg-[#5D1F1F] text-white py-3 rounded-md hover:bg-[#4A1818] transition-colors font-medium disabled:opacity-50",children:o?"Loading...":"login"===i?"Sign In":"Sign Up"})]}),"login"===i&&(0,bs.jsx)("div",{className:"mt-4 text-center",children:(0,bs.jsx)("button",{type:"button",onClick:()=>l("reset"),className:"text-[#5D1F1F] hover:text-[#4A1818] text-sm transition-colors",disabled:o,children:"Forgot your password?"})}),(0,bs.jsx)("div",{className:"mt-4 text-sm text-gray-600 text-center",children:"Create an account to get started!"})]})})},Rs=fs("GraduationCap",[["path",{d:"M22 10v6M2 10l10-5 10 5-10 5z",key:"1ef52a"}],["path",{d:"M6 12v5c3 3 9 3 12 0v-5",key:"1f75yj"}]]),Ms=fs("PoundSterling",[["path",{d:"M18 7c0-5.333-8-5.333-8 0",key:"1prm2n"}],["path",{d:"M10 7v14",key:"18tmcs"}],["path",{d:"M6 21h12",key:"4dkmi1"}],["path",{d:"M6 13h10",key:"ybwr4a"}]]),Is=fs("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Ls=fs("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),Us=fs("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),zs=fs("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),qs=fs("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Ws=fs("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Bs="light",Gs="medium",Hs="heavy",Vs="success",Js="warning",Ks="error",$s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bs;try{if(!navigator.vibrate&&!window.navigator.vibrate)return!1;if(window.DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission){if(navigator.vibrate){switch(e){case Bs:navigator.vibrate(10);break;case Gs:navigator.vibrate(20);break;case Hs:navigator.vibrate(40);break;case Vs:navigator.vibrate([10,50,10]);break;case Js:navigator.vibrate([20,100,20]);break;case Ks:navigator.vibrate([50,50,50]);break;default:navigator.vibrate(15)}return!0}}else if(navigator.vibrate){switch(e){case Bs:navigator.vibrate(25);break;case Gs:navigator.vibrate(50);break;case Hs:navigator.vibrate(75);break;case Vs:navigator.vibrate([25,25,25]);break;case Js:navigator.vibrate([50,50,50]);break;case Ks:navigator.vibrate([100,50,100]);break;default:navigator.vibrate(30)}return!0}}catch(t){console.warn("Haptic feedback not supported or failed:",t)}return!1},Ys={tap:()=>$s(Bs),click:()=>$s(Gs),impact:()=>$s(Hs),success:()=>$s(Vs),warning:()=>$s(Js),error:()=>$s(Ks),pattern:e=>{try{if(navigator.vibrate&&Array.isArray(e))return navigator.vibrate(e),!0}catch(t){console.warn("Custom haptic pattern failed:",t)}return!1}},Qs=e=>{let{activeTab:t,setActiveTab:s,currentUser:a,ladderPlayers:r,selectedSeason:n}=e;const i="league"===(null===n||void 0===n?void 0:n.season_type);if("coach"===(null===a||void 0===a?void 0:a.role)){const e=[{id:"coaching",icon:Rs,label:"Sessions"},{id:"coach-payments",icon:Ms,label:"Payments"}];return(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("nav",{className:"hidden sm:block bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,bs.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,bs.jsx)("div",{className:"flex",children:e.map(e=>{let{id:a,icon:r,label:n}=e;return(0,bs.jsxs)("button",{onClick:()=>{Ys.tap(),s(a)},className:"flex-shrink-0 px-6 py-4 text-sm font-medium border-b-2 min-h-[60px] flex items-center ".concat(t===a?"border-[#5D1F1F] text-[#5D1F1F]":"border-transparent text-gray-500 hover:text-gray-700"),children:[(0,bs.jsx)(r,{className:"w-5 h-5 mr-2"}),n]},a)})})})}),(0,bs.jsx)("nav",{className:"sm:hidden fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:(0,bs.jsx)("div",{className:"flex",children:e.map(e=>{let{id:a,icon:r,label:n}=e;return(0,bs.jsxs)("button",{onClick:()=>{Ys.tap(),s(a)},className:"flex-1 flex flex-col items-center justify-center py-2 min-h-[64px] transition-colors relative ".concat(t===a?"text-[#5D1F1F] bg-red-50":"text-gray-500 hover:text-gray-700 active:bg-gray-100"),style:{touchAction:"manipulation"},children:[(0,bs.jsx)(r,{className:"w-6 h-6 mb-1 ".concat(t===a?"text-[#5D1F1F]":"")}),(0,bs.jsx)("span",{className:"text-xs font-medium ".concat(t===a?"text-[#5D1F1F]":""),children:n}),t===a&&(0,bs.jsx)("div",{className:"absolute top-0 left-0 right-0 h-0.5 bg-[#5D1F1F]"})]},a)})})})]})}const l=[{id:"ladder",icon:Is,label:"League",show:!0},{id:"matches",icon:Ls,label:"Matches",show:!0},{id:"profile",icon:Us,label:"Profile",show:null===r||void 0===r?void 0:r.find(e=>e.id===(null===a||void 0===a?void 0:a.id))},{id:"trophies",icon:zs,label:"Trophies",show:!0},{id:"availability",icon:qs,label:"Available",show:!i&&(null===r||void 0===r?void 0:r.find(e=>e.id===(null===a||void 0===a?void 0:a.id)))},{id:"coaching",icon:Rs,label:"Coaching",show:!0},{id:"admin",icon:Ws,label:"Admin",show:"admin"===(null===a||void 0===a?void 0:a.role)}].filter(e=>e.show);return(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("nav",{className:"hidden sm:block bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,bs.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,bs.jsx)("div",{className:"flex overflow-x-auto scrollbar-hide",children:l.map(e=>{let{id:a,icon:r,label:n}=e;return(0,bs.jsxs)("button",{onClick:()=>{Ys.tap(),s(a)},className:"flex-shrink-0 px-6 py-4 text-sm font-medium border-b-2 min-h-[60px] flex items-center ".concat(t===a?"border-[#5D1F1F] text-[#5D1F1F]":"border-transparent text-gray-500 hover:text-gray-700"),children:[(0,bs.jsx)(r,{className:"w-5 h-5 mr-2"}),n]},a)})})})}),(0,bs.jsx)("nav",{className:"sm:hidden fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:(0,bs.jsx)("div",{className:"flex",children:l.map(e=>{let{id:a,icon:r,label:n}=e;return(0,bs.jsxs)("button",{onClick:()=>{Ys.tap(),s(a)},className:"flex-1 flex flex-col items-center justify-center py-2 min-h-[64px] transition-colors ".concat(t===a?"text-[#5D1F1F] bg-red-50":"text-gray-500 hover:text-gray-700 active:bg-gray-100"),style:{touchAction:"manipulation"},children:[(0,bs.jsx)(r,{className:"w-6 h-6 mb-1 ".concat(t===a?"text-[#5D1F1F]":"")}),(0,bs.jsx)("span",{className:"text-xs font-medium ".concat(t===a?"text-[#5D1F1F]":""),children:n}),t===a&&(0,bs.jsx)("div",{className:"absolute top-0 left-0 right-0 h-0.5 bg-[#5D1F1F]"})]},a)})})})]})},Xs=fs("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Zs=fs("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),ea=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"league"===(null===t||void 0===t?void 0:t.season_type)?function(e){return e.filter(e=>e.in_ladder&&"approved"===e.status).filter(e=>(e.games_played||0)>0).sort((e,t)=>{const s=(e.games_played||0)>0?(e.games_won||0)/(e.games_played||0):0,a=(t.games_played||0)>0?(t.games_won||0)/(t.games_played||0):0;return s!==a?a-s:(e.games_won||0)!==(t.games_won||0)?(t.games_won||0)-(e.games_won||0):(t.games_played||0)-(e.games_played||0)}).map((e,t)=>c(c({},e),{},{rank:t+1,win_percentage:(e.games_played||0)>0?((e.games_won||0)/(e.games_played||0)*100).toFixed(1):"0.0"}))}(e):"singles_championship"===(null===t||void 0===t?void 0:t.season_type)?function(e){return e.filter(e=>e.in_ladder&&"approved"===e.status).filter(e=>(e.matches_played||0)>0).sort((e,t)=>{const s=e.matches_won||0,a=t.matches_won||0;if(s!==a)return a-s;const r=(e.games_played||0)>0?(e.games_won||0)/(e.games_played||0):0,n=(t.games_played||0)>0?(t.games_won||0)/(t.games_played||0):0;return r!==n?n-r:(e.games_won||0)!==(t.games_won||0)?(t.games_won||0)-(e.games_won||0):(t.matches_played||0)-(e.matches_played||0)}).map((e,t)=>c(c({},e),{},{rank:t+1,win_percentage:(e.games_played||0)>0?((e.games_won||0)/(e.games_played||0)*100).toFixed(1):"0.0",match_win_percentage:(e.matches_played||0)>0?((e.matches_won||0)/(e.matches_played||0)*100).toFixed(1):"0.0"}))}(e):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=e.filter(e=>e.in_ladder&&"approved"===e.status);return"completed"===(null===t||void 0===t?void 0:t.status)?s.sort((e,t)=>{const s=(e.games_played||0)>0?(e.games_won||0)/(e.games_played||0):0,a=(t.games_played||0)>0?(t.games_won||0)/(t.games_played||0):0;return s!==a?a-s:(e.games_played||0)!==(t.games_played||0)?(t.games_played||0)-(e.games_played||0):(t.games_won||0)-(e.games_won||0)}).map((e,t)=>c(c({},e),{},{rank:t+1})):s.sort((e,t)=>(e.rank||999)-(t.rank||999))}(e,t)},ta=e=>{if(!e)return{title:"",subtitle:"",badge:""};const t=e.season_type,s=e.league_info||{};switch(t){case"league":return{title:e.name,subtitle:"".concat(s.division||"League"," - ").concat(s.external_league_name||"External League"),badge:"League",badgeColor:"bg-blue-100 text-blue-800"};case"singles_championship":return{title:e.name,subtitle:"Singles Championship - Individual Competition",badge:"Singles",badgeColor:"bg-orange-100 text-orange-800"};default:return{title:e.name,subtitle:"Internal Ladder",badge:"Ladder",badgeColor:"bg-green-100 text-green-800"}}},sa=fs("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),aa=fs("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),ra=fs("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),na=fs("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),ia=fs("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),la=e=>{let{seasonData:t,onClose:s,appUrl:r="https://cawood-tennis.vercel.app"}=e;const[n,i]=(0,a.useState)(!1),[l]=(0,a.useState)("list"),[o,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(!0),h=()=>{var e;let s=[];const a=o?t.players.filter(e=>e.games_played>0):t.players;if(0===a.length)return"No players found with the current filters.";s.push("\ud83c\udfbe CAWOOD TENNIS LADDER \ud83c\udfbe"),s.push("\u2550".repeat(14)),s.push("");const n="league"===t.season.season_type?"League":"Ladder";s.push("\ud83c\udfc6 ".concat(t.season.name," ").concat(n)),"completed"===t.season.status?s.push("\ud83c\udfc1 Final Results"):s.push("\ud83d\udcca Current Standings"),s.push("");const i=(e=>{const t={},s=[...new Set(e.filter(e=>e))],a={};return s.forEach(e=>{const t=e.trim().split(/\s+/),s=t[0],r=t.length>1?t[t.length-1]:"";a[s]||(a[s]=[]),a[s].push({fullName:e,firstName:s,lastName:r})}),Object.values(a).forEach(e=>{1===e.length?t[e[0].fullName]=e[0].firstName:e.forEach(s=>{if(s.lastName){let a=s.firstName,r=1,n=!1;for(;!n&&r<=s.lastName.length;){const t="".concat(s.firstName," ").concat(s.lastName.substring(0,r));0===e.filter(e=>e!==s&&e.lastName&&e.lastName.substring(0,r)===s.lastName.substring(0,r)).length?(a=t,n=!0):r++}n||(a="".concat(s.firstName," ").concat(s.lastName)),t[s.fullName]=a}else t[s.fullName]=s.firstName})}),t})(a.map(e=>e.name));s.push("\ud83d\udccb League Table:"),s.push(""),a.forEach((e,a)=>{var r;const n=i[e.name]||e.name,l=e.games_played>0?Math.round(e.games_won/e.games_played*100):0;let o="".concat(e.rank||a+1,".");1===e.rank?o="\ud83e\udd47":2===e.rank?o="\ud83e\udd48":3===e.rank&&(o="\ud83e\udd49");const c=null===(r=t.season)||void 0===r?void 0:r.elo_enabled;let d="".concat(o," ").concat(n," - ").concat(l,"%");if(c){const t=e.elo_rating||"1200",s=(e=>e&&0!==e?e>0?" \u2197\ufe0f+".concat(e):" \u2198\ufe0f".concat(e):"")(e.last_elo_change);d+=" (ELO: ".concat(t).concat(s,")")}s.push(d)}),s.push(""),null!==(e=t.season)&&void 0!==e&&e.elo_enabled&&t.mostImprovedPlayer&&(s.push("\ud83c\udf1f Most Improved Player:"),s.push("   ".concat(t.mostImprovedPlayer.name," (+").concat(t.mostImprovedPlayer.improvement," ELO)")),s.push(""));const l=a.length,c=a.filter(e=>e.games_played>0).length;return o?s.push("\ud83d\udcc8 ".concat(c," active players")):s.push("\ud83d\udc65 ".concat(l," players (").concat(c," active)")),d&&(s.push(""),s.push("\ud83d\udcf1 View full details:"),s.push("".concat(r))),s.push(""),s.push("\u2500".repeat(10)),s.push("Questions? Contact Jon or Charlie \ud83d\udc4b"),s.join("\n")},m=h();return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[(0,bs.jsxs)("div",{className:"p-6 border-b border-gray-200 flex-shrink-0",children:[(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"\ud83d\udcf1 WhatsApp League Table Export"}),(0,bs.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 text-xl font-bold",children:"\xd7"})]}),(0,bs.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Share your league table results on WhatsApp"})]}),(0,bs.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,bs.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Export Options"}),(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsxs)("label",{className:"flex items-center",children:[(0,bs.jsx)("input",{type:"checkbox",checked:o,onChange:e=>c(e.target.checked),className:"rounded border-gray-300 text-[#5D1F1F] focus:ring-[#5D1F1F]"}),(0,bs.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"\ud83c\udfbe Only show players who have played games"})]}),(0,bs.jsxs)("label",{className:"flex items-center",children:[(0,bs.jsx)("input",{type:"checkbox",checked:d,onChange:e=>u(e.target.checked),className:"rounded border-gray-300 text-[#5D1F1F] focus:ring-[#5D1F1F]"}),(0,bs.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"\ud83d\udd17 Include link to full ladder app"})]})]})]}),(0,bs.jsxs)("div",{className:"p-6",children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Message Preview"}),(0,bs.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 border",children:(0,bs.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 font-mono leading-relaxed",children:m})})]})]}),(0,bs.jsxs)("div",{className:"p-6 border-t border-gray-200 flex-shrink-0",children:[(0,bs.jsxs)("div",{className:"flex space-x-3",children:[(0,bs.jsx)("button",{onClick:async()=>{const e=h();try{await navigator.clipboard.writeText(e),i(!0),setTimeout(()=>i(!1),2e3)}catch(t){const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),i(!0),setTimeout(()=>i(!1),2e3)}},className:"flex-1 bg-[#5D1F1F] text-white py-3 px-4 rounded-md hover:bg-[#4A1818] transition-colors flex items-center justify-center space-x-2",children:n?(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(na,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Copied!"})]}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(ia,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Copy to Clipboard"})]})}),(0,bs.jsxs)("button",{onClick:()=>{const e=encodeURIComponent(h()),t="https://web.whatsapp.com/send?text=".concat(e);window.open(t,"_blank")},className:"flex-1 bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 transition-colors flex items-center justify-center space-x-2",children:[(0,bs.jsx)(ra,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Open WhatsApp Web"})]})]}),(0,bs.jsx)("p",{className:"text-xs text-gray-500 mt-3 text-center",children:"Copy the message and paste it into your club WhatsApp group"})]})]})})},oa=e=>{let{currentUser:t,users:s,updateRankings:r,selectedSeason:n,onPlayerSelect:i,supabase:l,matchFixtures:o}=e;const[d,u]=(0,a.useState)("all"),[h,m]=(0,a.useState)("rank"),[p,g]=(0,a.useState)("rank"),[x,f]=(0,a.useState)("asc"),[y,b]=(0,a.useState)(!1),[v,w]=(0,a.useState)(null),[j,_]=(0,a.useState)(null),[N,k]=(0,a.useState)(0);(0,a.useEffect)(()=>{(async()=>{if(null===n||void 0===n||!n.elo_enabled||!l||!s||0===s.length)return _(null),void k(0);try{const{data:e}=await l.from("season_players").select("id, player_id, elo_rating").eq("season_id",n.id);if(e&&e.length>0){const t={};e.forEach(e=>{t[e.player_id]=e.id});const{data:a}=await l.from("elo_history").select("season_player_id, old_rating, new_rating").in("season_player_id",e.map(e=>e.id)).order("created_at",{ascending:!0});if(a){const e={};a.forEach(t=>{e[t.season_player_id]||(e[t.season_player_id]=t.old_rating),e[t.season_player_id]=Math.min(e[t.season_player_id],t.old_rating,t.new_rating)});const r=ea(s,n);let i=0,l=null;r.forEach(s=>{const a=t[s.id],r=e[a],n=s.elo_rating;if(r&&n&&s.games_played>0){const e=n-r;e>i&&(i=e,l=s.id)}}),l&&i>0?(_(l),k(Math.round(i))):(_(null),k(0))}}}catch(e){console.error("Error calculating Most Improved Player:",e),_(null),k(0)}})()},[n,s,l]);const S=ea(s,n),C="completed"===(null===n||void 0===n?void 0:n.status),E="league"===(null===n||void 0===n?void 0:n.season_type),P="singles_championship"===(null===n||void 0===n?void 0:n.season_type),T=ta(n),D=e=>{var t;return{rankIcon:1===(t=e.rank)?"\ud83c\udfc6":2===t?"\ud83e\udd48":3===t?"\ud83e\udd49":"#".concat(t),movement:((e,t)=>{if(!e||e===t)return(0,bs.jsx)("span",{className:"text-gray-400 text-xs",children:"-"});if(e>t){const s=e-t;return(0,bs.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,bs.jsx)(Xs,{className:"w-4 h-4 text-green-500"}),(0,bs.jsxs)("span",{className:"text-green-600 text-xs font-medium",children:["+",s]})]})}{const s=t-e;return(0,bs.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,bs.jsx)(Zs,{className:"w-4 h-4 text-red-500"}),(0,bs.jsxs)("span",{className:"text-red-600 text-xs font-medium",children:["-",s]})]})}})(e.previous_rank,e.rank)}},A=e=>e.games_played>0?Math.round(e.games_won/e.games_played*100*10)/10:0,O=()=>{let e;var t;return e=E&&"all"!==d?R():S,!E&&null!==n&&void 0!==n&&n.elo_enabled&&"elo"===h&&"rank"===p&&(e=F(e)),"rank"===p&&"asc"===x||(t=e,e=[...t].sort((e,t)=>{let s,a;switch(p){case"rank":default:s=e.rank||999,a=t.rank||999;break;case"name":s=e.name||"",a=t.name||"";break;case"matches":s=(e.matches_won||0)/Math.max(e.matches_played||1,1),a=(t.matches_won||0)/Math.max(t.matches_played||1,1);break;case"games":s=(e.games_won||0)/Math.max(e.games_played||1,1),a=(t.games_won||0)/Math.max(t.games_played||1,1);break;case"winPercent":s=A(e),a=A(t);break;case"elo":s=e.elo_rating||(null===n||void 0===n?void 0:n.elo_initial_rating)||1200,a=t.elo_rating||(null===n||void 0===n?void 0:n.elo_initial_rating)||1200}if("string"===typeof s&&"string"===typeof a){const e=s.localeCompare(a);return"asc"===x?e:-e}const r=s-a;return"asc"===x?r:-r})),e},F=e=>null!==n&&void 0!==n&&n.elo_enabled&&"elo"===h?[...e].sort((e,t)=>{const s=e.elo_rating||n.elo_initial_rating||1200;return(t.elo_rating||n.elo_initial_rating||1200)-s}).map((e,t)=>c(c({},e),{},{rank:t+1})):e,R=()=>{if(!o||0===o.length)return[];const e=new Map;o.forEach(t=>{var s;t.team===d&&(null===(s=t.league_match_rubbers)||void 0===s||s.forEach(t=>{[t.cawood_player1_id,t.cawood_player2_id].forEach(s=>{if(!s)return;if(!e.has(s)){const t=S.find(e=>e.id===s);if(!t)return;e.set(s,c(c({},t),{},{games_played:0,games_won:0,matches_played:0,matches_won:0,team:d}))}const a=e.get(s);null!==t.cawood_games_won&&null!==t.opponent_games_won&&(a.games_played+=t.cawood_games_won+t.opponent_games_won,a.games_won+=t.cawood_games_won,a.matches_played+=1,t.cawood_games_won>t.opponent_games_won&&(a.matches_won+=1))})}))});return Array.from(e.values()).filter(e=>e.games_played>0).sort((e,t)=>{const s=e.games_played>0?e.games_won/e.games_played:0,a=t.games_played>0?t.games_won/t.games_played:0;return s!==a?a-s:e.games_won!==t.games_won?t.games_won-e.games_won:t.games_played-e.games_played}).map((e,t)=>c(c({},e),{},{rank:t+1,win_percentage:e.games_played>0?(e.games_won/e.games_played*100).toFixed(1):"0.0"}))},M=e=>{let{column:t,children:s,className:a=""}=e;const r=p===t,n=r&&"asc"===x;return(0,bs.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors ".concat(a),onClick:()=>(e=>{p===e?f("asc"===x?"desc":"asc"):(g(e),f("desc"))})(t),children:(0,bs.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,bs.jsx)("span",{children:s}),(0,bs.jsxs)("div",{className:"flex flex-col",children:[(0,bs.jsx)(sa,{className:"w-3 h-3 ".concat(r&&n?"text-blue-600":"text-gray-300")}),(0,bs.jsx)(aa,{className:"w-3 h-3 -mt-1 ".concat(r&&!n?"text-blue-600":"text-gray-300")})]})]})})};return(0,bs.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 sm:gap-0",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,bs.jsxs)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:[T.title," ",P?"Championship":E?"League":"Ladder"]}),(0,bs.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(T.badgeColor),children:T.badge})]}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:T.subtitle}),C&&(0,bs.jsx)("p",{className:"text-sm text-blue-600 mt-1",children:"\ud83c\udfc6 This season has been completed"})]}),(0,bs.jsxs)("div",{className:"flex items-center gap-4",children:[E&&(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Team:"}),(0,bs.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm",children:[(0,bs.jsx)("option",{value:"all",children:"All Cawood"}),(0,bs.jsx)("option",{value:"1sts",children:"Cawood 1sts"}),(0,bs.jsx)("option",{value:"2nds",children:"Cawood 2nds"})]})]}),!E&&(null===n||void 0===n?void 0:n.elo_enabled)&&(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Sort by:"}),(0,bs.jsxs)("select",{value:h,onChange:e=>m(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm",children:[(0,bs.jsx)("option",{value:"rank",children:"Win %"}),(0,bs.jsx)("option",{value:"elo",children:"ELO Rating"})]})]}),"admin"===(null===t||void 0===t?void 0:t.role)&&(0,bs.jsxs)("button",{onClick:async()=>{const e=await(async()=>{const e=O();let t=e,s=null;if(null!==n&&void 0!==n&&n.elo_enabled&&l)try{const{data:a}=await l.from("elo_history").select("created_at").eq("season_players.season_id",n.id).order("created_at",{ascending:!1}).limit(1);if(a&&a.length>0){const s=new Date(a[0].created_at).toISOString().split("T")[0],{data:r}=await l.rpc("get_weekly_elo_changes",{p_season_id:n.id,p_date:s});if(r){const s={};r.forEach(e=>{s[e.player_id]=e.total_week_change}),t=e.map(e=>c(c({},e),{},{last_elo_change:s[e.id]||null}))}else{const{data:a}=await l.from("elo_history").select("\n                rating_change,\n                created_at,\n                season_player_id,\n                season_players!inner(player_id)\n              ").eq("season_players.season_id",n.id).gte("created_at",s).lt("created_at",new Date(new Date(s).getTime()+864e5).toISOString());if(a){const s={};a.forEach(e=>{const t=e.season_players.player_id;s[t]||(s[t]=0),s[t]+=e.rating_change}),t=e.map(e=>c(c({},e),{},{last_elo_change:s[e.id]||null}))}}}const{data:r}=await l.from("season_players").select("id, player_id").eq("season_id",n.id);if(r&&r.length>0){const e={};r.forEach(t=>{e[t.player_id]=t.id});const{data:a}=await l.from("elo_history").select("season_player_id, old_rating, new_rating").in("season_player_id",r.map(e=>e.id)).order("created_at",{ascending:!0});if(a){const r={};a.forEach(e=>{r[e.season_player_id]||(r[e.season_player_id]=e.old_rating),r[e.season_player_id]=Math.min(r[e.season_player_id],e.old_rating,e.new_rating)});let n=0,i=null;if(t.forEach(t=>{const s=e[t.id],a=r[s],l=t.elo_rating;if(a&&l&&t.games_played>0){const e=l-a;e>n&&(n=e,i=t.id)}}),i&&n>0){const e=t.find(e=>e.id===i);s={name:null===e||void 0===e?void 0:e.name,improvement:Math.round(n)}}}}}catch(a){console.error("Error fetching ELO data:",a)}return{season:n,players:t,mostImprovedPlayer:s}})();w(e),b(!0)},className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors text-sm sm:text-base flex items-center space-x-2",children:[(0,bs.jsx)(ra,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Share"})]}),"admin"===(null===t||void 0===t?void 0:t.role)&&!C&&(0,bs.jsx)("button",{onClick:r,className:"bg-[#5D1F1F] text-white px-4 py-2 rounded-md hover:bg-[#4A1818] transition-colors text-sm sm:text-base",children:"Update Rankings"}),"admin"===(null===t||void 0===t?void 0:t.role)&&C&&(0,bs.jsx)("div",{className:"bg-gray-100 text-gray-500 px-4 py-2 rounded-md text-sm sm:text-base",children:"Season Completed"})]})]}),(()=>{const e=O();return 0===e.length?(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow p-6 text-center text-gray-500",children:"all"===d?"No players in ".concat(E?"league":"ladder"," yet"):"No players found for ".concat("1sts"===d?"Cawood 1sts":"Cawood 2nds")}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("div",{className:"block sm:hidden space-y-3",children:e.map((e,s)=>{const a=e.id===(null===t||void 0===t?void 0:t.id),r=A(e),{rankIcon:l,movement:o}=D(e);return(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border-2 p-4 ".concat(a?"border-[#5D1F1F] bg-gradient-to-r from-[#5D1F1F]/5 to-[#5D1F1F]/2":"border-gray-100"),children:[(0,bs.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,bs.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bs.jsxs)("div",{className:"text-2xl font-bold ".concat(a?"text-[#5D1F1F]":"text-gray-600"," flex items-center gap-1"),children:[l,(0,bs.jsx)("span",{className:"text-sm",children:o})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("button",{onClick:()=>i&&i(e.id),className:"font-semibold text-left hover:underline transition-colors py-2 px-1 min-h-[44px] flex items-center gap-2 ".concat(a?"text-[#5D1F1F] hover:text-red-800":"text-gray-900 hover:text-[#5D1F1F]"),style:{touchAction:"manipulation"},children:[(0,bs.jsx)("span",{children:e.name}),j===e.id&&N>0&&(0,bs.jsxs)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full font-medium whitespace-nowrap",children:["\ud83c\udf1f +",N]})]}),a&&(0,bs.jsx)("div",{className:"text-xs text-[#5D1F1F] font-medium",children:"You"})]})]})}),(0,bs.jsxs)("div",{className:"grid gap-4 text-center ".concat(!E&&null!==n&&void 0!==n&&n.elo_enabled?"grid-cols-4":"grid-cols-3"),children:[(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-2",children:[(0,bs.jsx)("div",{className:"text-xs text-gray-500 uppercase font-medium",children:E?"Rubbers":"Matches"}),(0,bs.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:[e.matches_won||0,"/",e.matches_played||0]})]}),(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-2",children:[(0,bs.jsx)("div",{className:"text-xs text-gray-500 uppercase font-medium",children:"Games"}),(0,bs.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:[e.games_won||0,"/",e.games_played||0]})]}),(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-2",children:[(0,bs.jsx)("div",{className:"text-xs text-gray-500 uppercase font-medium",children:"Win %"}),(0,bs.jsxs)("div",{className:"text-sm font-semibold ".concat(r>=60?"text-green-600":r>=40?"text-yellow-600":"text-gray-900"),children:[r,"%"]})]}),!E&&(null===n||void 0===n?void 0:n.elo_enabled)&&(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-2",children:[(0,bs.jsx)("div",{className:"text-xs text-gray-500 uppercase font-medium",children:"ELO"}),(0,bs.jsx)("div",{className:"text-sm font-semibold ".concat(hs(e.elo_rating||n.elo_initial_rating||1200)),children:e.elo_rating||n.elo_initial_rating||1200})]})]})]},e.id)})}),(0,bs.jsx)("div",{className:"hidden sm:block bg-white rounded-lg shadow overflow-hidden",children:(0,bs.jsx)("div",{className:"overflow-x-auto",children:(0,bs.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,bs.jsx)("thead",{className:"bg-gray-50",children:(0,bs.jsxs)("tr",{children:[(0,bs.jsx)(M,{column:"rank",children:"Rank"}),(0,bs.jsx)(M,{column:"name",children:"Name"}),(0,bs.jsx)(M,{column:"matches",children:E?"Rubbers":"Matches"}),(0,bs.jsx)(M,{column:"games",children:"Games"}),(0,bs.jsx)(M,{column:"winPercent",children:"Win %"}),!E&&(null===n||void 0===n?void 0:n.elo_enabled)&&(0,bs.jsx)(M,{column:"elo",children:"ELO Rating"})]})}),(0,bs.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map((e,s)=>{const a=e.id===(null===t||void 0===t?void 0:t.id),r=A(e),{rankIcon:l,movement:o}=D(e);return(0,bs.jsxs)("tr",{className:a?"bg-gradient-to-r from-[#5D1F1F]/10 to-[#5D1F1F]/5 border-l-4 border-[#5D1F1F] font-medium":s%2===0?"bg-white":"bg-gray-50",children:[(0,bs.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{children:l}),(0,bs.jsx)("span",{className:"text-xs",children:o})]})}),(0,bs.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,bs.jsxs)("button",{onClick:()=>i&&i(e.id),className:"text-sm font-medium hover:underline transition-colors text-left py-2 px-1 min-h-[44px] flex items-center gap-2 ".concat(a?"text-[#5D1F1F] hover:text-red-800":"text-gray-900 hover:text-[#5D1F1F]"),style:{touchAction:"manipulation"},children:[(0,bs.jsxs)("span",{children:[e.name," ",a&&(0,bs.jsx)("span",{className:"text-xs",children:"(You)"})]}),j===e.id&&N>0&&(0,bs.jsxs)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full font-medium whitespace-nowrap",children:["\ud83c\udf1f +",N]})]})}),(0,bs.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.matches_won||0,"/",e.matches_played||0]}),(0,bs.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.games_won||0,"/",e.games_played||0]}),(0,bs.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,bs.jsxs)("span",{className:"font-medium ".concat(r>=60?"text-green-600":r>=40?"text-yellow-600":"text-gray-900"),children:[r,"%"]})}),!E&&(null===n||void 0===n?void 0:n.elo_enabled)&&(0,bs.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,bs.jsx)("span",{className:"font-medium ".concat(hs(e.elo_rating||n.elo_initial_rating||1200)),children:e.elo_rating||n.elo_initial_rating||1200})})]},e.id)})})]})})})]})})(),y&&v&&(0,bs.jsx)(la,{seasonData:v,onClose:()=>{b(!1),w(null)}})]})},ca=e=>{let{match:t,fixture:s,supabase:r}=e;const[n,i]=(0,a.useState)(!1),[l,o]=(0,a.useState)([]),[c,d]=(0,a.useState)(!1),u=(0,a.useCallback)(async()=>{if(r&&null!==s&&void 0!==s&&s.id){d(!0);try{const{data:e,error:t}=await r.from("league_match_rubbers").select("\n          *,\n          cawood_player1:cawood_player1_id(name),\n          cawood_player2:cawood_player2_id(name),\n          opponent_player1:opponent_player1_id(name),\n          opponent_player2:opponent_player2_id(name)\n        ").eq("match_fixture_id",s.id).order("rubber_number");if(t)throw t;o(e||[])}catch(e){console.error("Error fetching rubber details:",e)}finally{d(!1)}}},[r,null===s||void 0===s?void 0:s.id]);(0,a.useEffect)(()=>{l.length||u()},[u,l.length]),(0,a.useEffect)(()=>{n&&!l.length&&u()},[n,u,l.length]);const h=(e,t)=>e>=7&&e>t?"WIN":t>=7&&t>e?"LOSS":6===e&&6===t?"DRAW":e<7&&t<7?"INCOMPLETE":e>t?"WIN":"LOSS",m=e=>{switch(e){case"WIN":return"text-green-600 bg-green-50";case"LOSS":return"text-red-600 bg-red-50";case"DRAW":return"text-yellow-600 bg-yellow-50";default:return"text-gray-600 bg-gray-50"}},p=l.length,g=(()=>{if(!l.length)return{cawoodPoints:0,opponentPoints:0,cawoodGamesTotal:0,opponentGamesTotal:0,teamBonusCawood:0,teamBonusOpponent:0,rubberStats:{wins:0,losses:0,draws:0,incomplete:0}};const e=l.reduce((e,t)=>{const s=h(t.cawood_games_won,t.opponent_games_won);return"WIN"===s?e.rubberStats.wins++:"LOSS"===s?e.rubberStats.losses++:"DRAW"===s?e.rubberStats.draws++:e.rubberStats.incomplete++,"WIN"===s?e.cawoodPoints+=1:"LOSS"===s?e.opponentPoints+=1:"DRAW"===s&&(e.cawoodPoints+=.5,e.opponentPoints+=.5),e.cawoodGamesTotal+=t.cawood_games_won||0,e.opponentGamesTotal+=t.opponent_games_won||0,e},{cawoodPoints:0,opponentPoints:0,cawoodGamesTotal:0,opponentGamesTotal:0,rubberStats:{wins:0,losses:0,draws:0,incomplete:0}});return e.cawoodGamesTotal>54?(e.teamBonusCawood=3,e.teamBonusOpponent=0):e.opponentGamesTotal>54?(e.teamBonusCawood=0,e.teamBonusOpponent=3):54===e.cawoodGamesTotal&&54===e.opponentGamesTotal?(e.teamBonusCawood=1.5,e.teamBonusOpponent=1.5):(e.teamBonusCawood=0,e.teamBonusOpponent=0),e.cawoodPoints+=e.teamBonusCawood,e.opponentPoints+=e.teamBonusOpponent,e})(),x=g.cawoodPoints>g.opponentPoints?"WIN":g.cawoodPoints<g.opponentPoints?"LOSS":"DRAW";return(0,bs.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm border-l-4 ".concat(0===p?"border-l-blue-400":"WIN"===x?"border-l-green-500":"LOSS"===x?"border-l-red-500":"border-l-yellow-500"),children:[(0,bs.jsx)("div",{className:"p-4 sm:p-5 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>i(!n),children:(0,bs.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,bs.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)(Is,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),(0,bs.jsxs)("h3",{className:"font-semibold text-gray-900",children:[null===s||void 0===s?void 0:s.opponent_club," vs Cawood ",null===s||void 0===s?void 0:s.team]})]}),p>0&&(0,bs.jsxs)("span",{className:"px-2.5 py-1 rounded-full text-sm font-medium ".concat(m(x)),children:[g.cawoodPoints,"-",g.opponentPoints]})]}),(0,bs.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,bs.jsx)(Ls,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:(f=t.match_date,new Date(f).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}))})]}),p>0&&(0,bs.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,bs.jsx)(qs,{className:"w-4 h-4"}),(0,bs.jsxs)("span",{className:"hidden sm:inline",children:[p," rubbers"]}),(0,bs.jsxs)("span",{className:"sm:hidden",children:[p," games"]})]})]})]}),(0,bs.jsx)("div",{className:"text-gray-400 p-1.5 rounded-full bg-gray-100 transition-all duration-200 hover:bg-gray-200 cursor-pointer flex-shrink-0",children:(0,bs.jsx)(aa,{className:"w-5 h-5 transition-transform duration-200 ".concat(n?"rotate-180":"rotate-0")})})]})}),n&&(0,bs.jsx)("div",{className:"border-t border-gray-200 p-4 bg-gray-50",children:c?(0,bs.jsx)("div",{className:"text-center py-4 text-gray-500",children:"Loading rubber details..."}):0===l.length?(0,bs.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No rubber details available"}):(0,bs.jsxs)("div",{className:"space-y-3",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[(0,bs.jsxs)("h4",{className:"font-medium text-gray-900 mb-2 sm:mb-0",children:["Rubber Results (",p," played)"]}),(0,bs.jsxs)("div",{className:"bg-white border border-gray-300 rounded-lg p-3 shadow-sm",children:[(0,bs.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Final Match Score"}),(0,bs.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,bs.jsxs)("div",{className:"text-center",children:[(0,bs.jsx)("div",{className:"font-bold text-lg text-blue-600",children:"Cawood"}),(0,bs.jsx)("div",{className:"text-2xl font-bold",children:g.cawoodPoints})]}),(0,bs.jsx)("div",{className:"text-gray-400",children:"-"}),(0,bs.jsxs)("div",{className:"text-center",children:[(0,bs.jsx)("div",{className:"font-bold text-lg text-red-600",children:null===s||void 0===s?void 0:s.opponent_club}),(0,bs.jsx)("div",{className:"text-2xl font-bold",children:g.opponentPoints})]})]}),(0,bs.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[(0,bs.jsx)("div",{className:"text-xs text-gray-500 mb-2",children:"Game Totals"}),(0,bs.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,bs.jsxs)("span",{children:["Cawood: ",g.cawoodGamesTotal]}),(0,bs.jsxs)("span",{children:[null===s||void 0===s?void 0:s.opponent_club,": ",g.opponentGamesTotal]})]}),(g.teamBonusCawood>0||g.teamBonusOpponent>0)&&(0,bs.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-100",children:[(0,bs.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Team Bonus"}),(0,bs.jsxs)("div",{className:"flex justify-between text-sm font-medium",children:[g.teamBonusCawood>0&&(0,bs.jsxs)("span",{className:"text-green-600",children:["+",g.teamBonusCawood," to Cawood"]}),g.teamBonusOpponent>0&&(0,bs.jsxs)("span",{className:"text-green-600",children:["+",g.teamBonusOpponent," to ",null===s||void 0===s?void 0:s.opponent_club]})]})]})]})]})]}),(0,bs.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,bs.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,bs.jsx)("thead",{className:"bg-white",children:(0,bs.jsxs)("tr",{children:[(0,bs.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rubber"}),(0,bs.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cawood Pair"}),(0,bs.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Opponent Pair"}),(0,bs.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Score"}),(0,bs.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Result"})]})}),(0,bs.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(e=>{var t,s,a,r;const n=h(e.cawood_games_won,e.opponent_games_won);return(0,bs.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,bs.jsxs)("td",{className:"px-4 py-2 text-sm font-medium text-gray-900",children:["#",e.rubber_number]}),(0,bs.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-700",children:[null===(t=e.cawood_player1)||void 0===t?void 0:t.name," & ",null===(s=e.cawood_player2)||void 0===s?void 0:s.name]}),(0,bs.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-700",children:[null===(a=e.opponent_player1)||void 0===a?void 0:a.name," & ",null===(r=e.opponent_player2)||void 0===r?void 0:r.name]}),(0,bs.jsxs)("td",{className:"px-4 py-2 text-sm font-mono text-gray-900",children:[e.cawood_games_won,"-",e.opponent_games_won]}),(0,bs.jsx)("td",{className:"px-4 py-2",children:(0,bs.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(m(n)),children:"WIN"===n?"WON":"LOSS"===n?"LOST":"DRAW"===n?"DRAWN":"INCOMPLETE"})})]},e.id)})})]})}),(0,bs.jsx)("div",{className:"md:hidden space-y-3",children:l.map(e=>{var t,s,a,r;const n=h(e.cawood_games_won,e.opponent_games_won);return(0,bs.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,bs.jsxs)("span",{className:"font-medium text-gray-900",children:["Rubber #",e.rubber_number]}),(0,bs.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(m(n)),children:"WIN"===n?"WON":"LOSS"===n?"LOST":"DRAW"===n?"DRAWN":"INCOMPLETE"})]}),(0,bs.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("span",{className:"text-gray-500",children:"Cawood:"})," ",(0,bs.jsxs)("span",{className:"text-gray-900",children:[null===(t=e.cawood_player1)||void 0===t?void 0:t.name," & ",null===(s=e.cawood_player2)||void 0===s?void 0:s.name]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("span",{className:"text-gray-500",children:"Opponent:"})," ",(0,bs.jsxs)("span",{className:"text-gray-900",children:[null===(a=e.opponent_player1)||void 0===a?void 0:a.name," & ",null===(r=e.opponent_player2)||void 0===r?void 0:r.name]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("span",{className:"text-gray-500",children:"Score:"})," ",(0,bs.jsxs)("span",{className:"font-mono text-gray-900",children:[e.cawood_games_won,"-",e.opponent_games_won]})]})]})]},e.id)})})]})})]});var f},da=fs("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),ua=fs("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ha=fs("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),ma=e=>{let{fixture:t,score:s,selectedSeason:r,currentUser:n,users:i=[]}=e;const{eloImpacts:l,loading:o}=((e,t)=>{const[s,r]=(0,a.useState)({}),[n,i]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{e&&t?(async()=>{i(!0);try{const{data:t,error:s}=await is.from("elo_history").select("\n            old_rating,\n            new_rating,\n            rating_change,\n            season_players!inner (\n              player_id,\n              profiles (\n                id,\n                name\n              )\n            )\n          ").eq("match_fixture_id",e);if(s)return console.error("Error fetching ELO impacts:",s),void r({});const a={};t&&t.forEach(e=>{var t,s,r;const n=null===(t=e.season_players)||void 0===t?void 0:t.player_id,i=null===(s=e.season_players)||void 0===s||null===(r=s.profiles)||void 0===r?void 0:r.name;n&&(a[n]={change:e.rating_change,oldRating:e.old_rating,newRating:e.new_rating,playerName:i})}),r(a)}catch(t){console.error("Error fetching match ELO impacts:",t),r({})}finally{i(!1)}})():r({})},[e,t]),{eloImpacts:s,loading:n}})(t.id,null===r||void 0===r?void 0:r.id);if(!s)return null;const c=e=>{const t=i.find(t=>t.id===e);return(null===t||void 0===t?void 0:t.name)||"Unknown"},d="singles"===t.match_format,u=s.pair1_score===s.pair2_score;let h,m;d?(h=[{id:t.player1_id,name:c(t.player1_id)}],m=[{id:t.player2_id,name:c(t.player2_id)}]):(h=[{id:t.pair1_player1_id,name:c(t.pair1_player1_id)},{id:t.pair1_player2_id,name:c(t.pair1_player2_id)}].filter(e=>e.id),m=[{id:t.pair2_player1_id,name:c(t.pair2_player1_id)},{id:t.pair2_player2_id,name:c(t.pair2_player2_id)}].filter(e=>e.id));const p=s.pair1_score>s.pair2_score,g=s.pair2_score>s.pair1_score,x=e=>{var t;let{players:s,isWinningTeam:a}=e;if(null===r||void 0===r||!r.elo_enabled||0===s.length)return null;const i=l[null===(t=s[0])||void 0===t?void 0:t.id];if(!i)return null;const o=i.change>0,c=i.change<0,d=s.some(e=>e.id===(null===n||void 0===n?void 0:n.id));return(0,bs.jsxs)("div",{className:"inline-flex items-center px-3 py-1 rounded-lg text-sm font-bold transition-all duration-200 ".concat(d?o?"bg-green-600 text-white shadow-lg ring-2 ring-green-300":c?"bg-red-600 text-white shadow-lg ring-2 ring-red-300":"bg-gray-600 text-white shadow-lg ring-2 ring-gray-300":o?"bg-green-200 text-green-900":c?"bg-red-200 text-red-900":"bg-gray-200 text-gray-900"),children:[o&&(0,bs.jsx)(da,{className:"w-4 h-4 mr-1"}),c&&(0,bs.jsx)(ua,{className:"w-4 h-4 mr-1"}),!o&&!c&&(0,bs.jsx)(ha,{className:"w-4 h-4 mr-1"}),"ELO ",o?"+":"",i.change]})},f=e=>{var t;let{players:s,score:a,won:n,lost:i}=e;return(0,bs.jsxs)("div",{className:"flex-1 p-3 sm:p-4 rounded-xl border-2 transition-all duration-300 min-w-0 ".concat(n?"bg-gradient-to-br from-green-50 to-green-100 border-green-300 shadow-lg":i?"bg-gradient-to-br from-red-50 to-red-100 border-red-300 shadow-md":"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-300 shadow-md"),children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-3 space-y-2 sm:space-y-0",children:[(0,bs.jsx)("div",{className:"flex items-center space-x-2 min-w-0",children:d?(0,bs.jsx)("div",{className:"text-sm font-semibold text-gray-900 truncate",children:null===(t=s[0])||void 0===t?void 0:t.name}):(0,bs.jsxs)("div",{className:"flex items-center space-x-1 min-w-0",children:[(0,bs.jsx)(qs,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}),(0,bs.jsx)("div",{className:"text-sm font-semibold text-gray-900 truncate",children:s.map(e=>e.name).join(" & ")})]})}),(0,bs.jsx)("div",{className:"text-xl sm:text-2xl font-bold px-2 sm:px-3 py-1 rounded-lg self-start sm:self-auto ".concat(n?"bg-green-600 text-white":i?"bg-red-600 text-white":"bg-gray-600 text-white"),children:a})]}),(null===r||void 0===r?void 0:r.elo_enabled)&&!o&&(0,bs.jsx)("div",{className:"flex justify-center",children:(0,bs.jsx)(x,{players:s,isWinningTeam:n})})]})};return(0,bs.jsxs)("div",{className:"p-3 sm:p-4 w-full overflow-hidden",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 space-y-2 sm:space-y-0",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 flex-wrap",children:[(0,bs.jsxs)("div",{className:"px-3 py-1 rounded-full text-xs font-bold ".concat(u?"bg-gray-500 text-white":"bg-blue-500 text-white"),children:[d?"SINGLES":"DOUBLES"," ",u&&"\u2022 DRAW"]}),(null===r||void 0===r?void 0:r.elo_enabled)&&(0,bs.jsx)("div",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs font-medium",children:"ELO MATCH"})]}),(0,bs.jsx)("div",{className:"px-3 py-1 rounded-full text-xs font-bold self-start sm:self-auto ".concat(u?"bg-gray-600 text-white":"bg-green-600 text-white"),children:u?"DRAW":"COMPLETED"})]}),(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch space-y-3 sm:space-y-0 sm:space-x-3 lg:space-x-4",children:[(0,bs.jsx)(f,{players:h,score:s.pair1_score,won:p,lost:g}),(0,bs.jsxs)("div",{className:"flex sm:flex-col items-center justify-center sm:justify-center",children:[(0,bs.jsx)("div",{className:"text-xs font-medium text-gray-500 sm:mb-1",children:"VS"}),(0,bs.jsx)("div",{className:"w-8 h-px sm:w-px sm:h-8 bg-gradient-to-r sm:bg-gradient-to-b from-gray-300 via-gray-400 to-gray-300 mx-2 sm:mx-0"})]}),(0,bs.jsx)(f,{players:m,score:s.pair2_score,won:g,lost:p})]}),(null===r||void 0===r?void 0:r.elo_enabled)&&o&&(0,bs.jsx)("div",{className:"mt-3 text-center",children:(0,bs.jsxs)("div",{className:"inline-flex items-center space-x-2 text-xs text-gray-500",children:[(0,bs.jsx)("div",{className:"animate-spin w-3 h-3 border border-gray-300 border-t-blue-500 rounded-full"}),(0,bs.jsx)("span",{children:"Loading ELO impacts..."})]})})]})},pa=fs("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),ga=e=>{let{showModal:t,setShowModal:s,availablePlayersCount:a,seasonEloEnabled:r,onMethodSelect:n,winPercentPreview:i,eloPreview:l,isLoadingPreviews:o}=e;if(!t)return null;const c=e=>{n(e)},d=e=>{let{preview:t,title:s}=e;return(0,bs.jsx)("div",{className:"mt-3",children:(0,bs.jsx)("div",{className:"p-3 bg-gray-50 rounded-md border",children:o?(0,bs.jsxs)("div",{className:"text-center py-4",children:[(0,bs.jsx)("div",{className:"animate-spin w-5 h-5 border-2 border-gray-300 border-t-blue-500 rounded-full mx-auto mb-2"}),(0,bs.jsx)("p",{className:"text-sm text-gray-500",children:"Loading preview..."})]}):t&&t.length>0?(0,bs.jsx)("div",{className:"space-y-3",children:t.map((e,t)=>(0,bs.jsxs)("div",{className:"bg-white rounded-lg p-3 border",children:[(0,bs.jsxs)("h4",{className:"font-medium text-sm text-gray-900 mb-2",children:["Court ",t+1," (",e.length," players)"]}),(0,bs.jsx)("div",{className:"space-y-1",children:e.map((e,t)=>(0,bs.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,bs.jsxs)("span",{className:"font-medium text-gray-900",children:[t+1,". ",e.name]}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:["Win%"===s&&(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsxs)("span",{children:["Rank #",e.rank||"N/A"]}),(0,bs.jsx)("span",{children:"\u2022"}),(0,bs.jsxs)("span",{children:[e.win_percentage||0,"% Win"]})]}),"ELO"===s&&(0,bs.jsx)(bs.Fragment,{children:(0,bs.jsxs)("span",{children:["ELO: ",e.elo_rating||e.initialRating||1200]})})]})]},e.id))})]},t))}):(0,bs.jsx)("p",{className:"text-sm text-gray-500 text-center py-2",children:"No preview available"})})})};return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-y-auto",children:[(0,bs.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,bs.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Choose Scheduling Method"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Compare both grouping methods and select the best option for this match week"})]}),(0,bs.jsxs)("div",{className:"p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 mb-6",children:[(0,bs.jsx)(qs,{className:"w-4 h-4 text-blue-600"}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:[a," players available for scheduling"]})]}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,bs.jsxs)("div",{className:"border-2 border-blue-200 rounded-lg p-4 h-fit hover:shadow-md transition-shadow",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,bs.jsx)("div",{className:"bg-blue-100 p-2 rounded-full",children:(0,bs.jsx)(Is,{className:"w-5 h-5 text-blue-600"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-bold text-gray-900",children:"Win Percentage"}),(0,bs.jsx)("p",{className:"text-xs text-blue-600",children:"Ranked by current ladder position"})]})]}),(0,bs.jsx)(d,{preview:i,title:"Win%"}),(0,bs.jsx)("button",{onClick:()=>c("winPercent"),className:"w-full mt-4 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-all transform hover:scale-[1.02] font-semibold shadow-md",children:"Select Win Percentage"})]}),(0,bs.jsxs)("div",{className:"border-2 rounded-lg p-4 h-fit transition-shadow ".concat(r?"border-purple-200 hover:shadow-md":"border-gray-200 bg-gray-50 opacity-60"),children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,bs.jsx)("div",{className:"p-2 rounded-full ".concat(r?"bg-purple-100":"bg-gray-100"),children:(0,bs.jsx)(pa,{className:"w-5 h-5 ".concat(r?"text-purple-600":"text-gray-400")})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-bold ".concat(r?"text-gray-900":"text-gray-500"),children:"ELO Rating"}),(0,bs.jsx)("p",{className:"text-xs ".concat(r?"text-purple-600":"text-gray-400"),children:r?"Skill-based matching system":"Not enabled for this season"})]})]}),r&&(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(d,{preview:l,title:"ELO"}),(0,bs.jsx)("button",{onClick:()=>c("elo"),className:"w-full mt-4 bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-all transform hover:scale-[1.02] font-semibold shadow-md",children:"Select ELO Rating"})]})]})]})]}),(0,bs.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:(0,bs.jsx)("button",{onClick:()=>s(!1),className:"w-full bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 transition-colors font-medium",children:"Cancel"})})]})})},xa=e=>{let{showModal:t,setShowModal:s,layoutOptions:a,sortedPlayers:r,schedulingMethod:n,onConfirm:i,onBack:l,seasonEloEnabled:o}=e;if(!t)return null;const c=e=>{i(e),s(!1)},d="elo"===n,u=d?pa:Is,h=d?"ELO Rating":"Win Percentage",m=d?"bg-purple-100":"bg-blue-100",p=d?"text-purple-600":"text-blue-600",g=d?"border-purple-200":"border-blue-200",x=d?"hover:border-purple-400":"hover:border-blue-400",f=d?"bg-purple-600":"bg-blue-600",y=d?"hover:bg-purple-700":"hover:bg-blue-700";return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,bs.jsxs)("div",{className:"p-6 border-b border-gray-200 sticky top-0 bg-white z-10",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,bs.jsx)("div",{className:"p-2 rounded-full ".concat(m),children:(0,bs.jsx)(u,{className:"w-5 h-5 ".concat(p)})}),(0,bs.jsxs)("h3",{className:"text-xl font-bold text-gray-900",children:["Choose Court Layout - ",h]})]}),(0,bs.jsxs)("p",{className:"text-sm text-gray-600",children:[r.length," players available - Select how to distribute players across courts"]})]}),(0,bs.jsx)("div",{className:"p-6",children:1===a.length?(0,bs.jsxs)("div",{className:"text-center py-8",children:[(0,bs.jsxs)("p",{className:"text-gray-600 mb-4",children:["Only one layout option available for ",r.length," players:"]}),(0,bs.jsxs)("div",{className:"inline-block bg-gray-100 px-4 py-2 rounded-lg font-medium text-gray-900 mb-6",children:[a[0].join("-")," (Courts: ",a[0].length,")"]}),(0,bs.jsx)("button",{onClick:()=>c(a[0]),className:"".concat(f," ").concat(y," text-white py-3 px-8 rounded-lg transition-all transform hover:scale-[1.02] font-semibold shadow-md"),children:"Continue with this layout"})]}):(0,bs.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:a.map((e,t)=>{const s=os(r,e),a=((e,t)=>{const s=e.join("-"),a=(e.length,e.includes(4)),r=e.includes(5);if(!a&&r)return"Option ".concat(t+1,": All 5-player courts (").concat(s,")");if(a&&!r)return"Option ".concat(t+1,": All 4-player courts (").concat(s,")");const n=e[0],i=e[e.length-1];return n>i?"Option ".concat(t+1,": Top-heavy (").concat(s,")"):n<i?"Option ".concat(t+1,": Bottom-heavy (").concat(s,")"):"Option ".concat(t+1,": Balanced (").concat(s,")")})(e,t);return(0,bs.jsxs)("div",{className:"border-2 ".concat(g," ").concat(x," rounded-lg p-4 hover:shadow-lg transition-all"),children:[(0,bs.jsxs)("div",{className:"mb-4 pb-3 border-b border-gray-200",children:[(0,bs.jsx)("h4",{className:"font-bold text-gray-900 mb-1",children:a}),(0,bs.jsxs)("p",{className:"text-xs text-gray-500",children:[e.length," court",e.length>1?"s":"",": ",e.join(", ")," players each"]})]}),(0,bs.jsx)("div",{className:"space-y-3 mb-4 max-h-[400px] overflow-y-auto",children:s.map((e,t)=>(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[(0,bs.jsxs)("h5",{className:"font-semibold text-sm text-gray-900 mb-2",children:["Court ",t+1," (",e.length," players)"]}),(0,bs.jsx)("div",{className:"space-y-1",children:e.map((e,t)=>(0,bs.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,bs.jsxs)("span",{className:"font-medium text-gray-900",children:[t+1,". ",e.name]}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2 text-gray-500",children:["winPercent"===n&&(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsxs)("span",{children:["Rank #",e.rank||"N/A"]}),(0,bs.jsx)("span",{children:"\u2022"}),(0,bs.jsxs)("span",{children:[Math.round((e.games_won||0)/Math.max(e.games_played||1,1)*100),"% Win"]})]}),"elo"===n&&(0,bs.jsx)(bs.Fragment,{children:(0,bs.jsxs)("span",{children:["ELO: ",e.elo_rating||e.initialRating||1200]})})]})]},e.id))})]},t))}),(0,bs.jsxs)("button",{onClick:()=>c(e),className:"w-full ".concat(f," ").concat(y," text-white py-3 px-4 rounded-lg transition-all transform hover:scale-[1.02] font-semibold shadow-md"),children:["Select Layout ",String.fromCharCode(65+t)]})]},t)})})}),(0,bs.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex space-x-3",children:[(0,bs.jsxs)("button",{onClick:()=>{s(!1),l&&l()},className:"flex items-center space-x-2 bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors font-medium",children:[(0,bs.jsx)(ys,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Back to Method Selection"})]}),(0,bs.jsx)("button",{onClick:()=>s(!1),className:"flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Cancel"})]})]})})},fa=e=>{let{match:t,fixtures:s,users:r,availabilityStats:n,onClose:i,appUrl:l="https://cawood-tennis.vercel.app"}=e;const[o,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!0),[h,m]=(0,a.useState)(!0),[p,g]=(0,a.useState)(!1),[x,f]=(0,a.useState)("card"),y=()=>{let e=[];e.push("\ud83c\udfbe CAWOOD TENNIS LADDER \ud83c\udfbe"),e.push("\u2550".repeat(12)),e.push("");const a=new Date(t.match_date).toLocaleDateString("en-GB",{weekday:"long"}),r=new Date(t.match_date).toLocaleDateString("en-GB",{day:"numeric",month:"short"});if(e.push("\ud83d\udcc5 Week ".concat(t.week_number," - ").concat(a," ").concat(r)),e.push(""),s&&s.length>0){e.push("\ud83c\udfc6 MATCH FIXTURES"),e.push("\u2500".repeat(8)),e.push("");const t=[];s.forEach(e=>{var s,a,r,n,i;null!==(s=e.player1)&&void 0!==s&&s.name&&t.push(e.player1.name),null!==(a=e.player2)&&void 0!==a&&a.name&&t.push(e.player2.name),null!==(r=e.player3)&&void 0!==r&&r.name&&t.push(e.player3.name),null!==(n=e.player4)&&void 0!==n&&n.name&&t.push(e.player4.name),p&&null!==(i=e.sitting_player)&&void 0!==i&&i.name&&t.push(e.sitting_player.name)});const a=(e=>{const t={},s=[...new Set(e.filter(e=>e))],a={};return s.forEach(e=>{const t=e.trim().split(/\s+/),s=t[0],r=t.length>1?t[t.length-1]:"";a[s]||(a[s]=[]),a[s].push({fullName:e,firstName:s,lastName:r})}),Object.values(a).forEach(e=>{1===e.length?t[e[0].fullName]=e[0].firstName:e.forEach(s=>{if(s.lastName){let a=s.firstName,r=1,n=!1;for(;!n&&r<=s.lastName.length;){const t="".concat(s.firstName," ").concat(s.lastName.substring(0,r));0===e.filter(e=>e!==s&&e.lastName&&e.lastName.substring(0,r)===s.lastName.substring(0,r)).length?(a=t,n=!0):r++}n||(a="".concat(s.firstName," ").concat(s.lastName)),t[s.fullName]=a}else t[s.fullName]=s.firstName})}),t})(t),r={};s.forEach(e=>{r[e.court_number]||(r[e.court_number]=[]),r[e.court_number].push(e)}),Object.entries(r).forEach((t,s)=>{let[r,n]=t;s>0&&e.push(""),e.push("\ud83c\udfdf\ufe0f Court ".concat(r)),e.push(""),n.forEach((t,s)=>{var r,n,i,l;const o=[null!==(r=t.player1)&&void 0!==r&&r.name?a[t.player1.name]||t.player1.name:null,null!==(n=t.player2)&&void 0!==n&&n.name?a[t.player2.name]||t.player2.name:null].filter(Boolean),c=[null!==(i=t.player3)&&void 0!==i&&i.name?a[t.player3.name]||t.player3.name:null,null!==(l=t.player4)&&void 0!==l&&l.name?a[t.player4.name]||t.player4.name:null].filter(Boolean),d=o.join(" & "),u=c.join(" & ");if("card"===x){if(e.push("\ud83c\udfbe Match ".concat(s+1)),e.push("".concat(d," \ud83c\udd9a ").concat(u)),p&&t.sitting_player){const s=a[t.sitting_player.name]||t.sitting_player.name;e.push("\ud83d\udcba ".concat(s," sitting"))}e.push("")}else if("list"===x){if(e.push("".concat(s+1,". ").concat(d," vs ").concat(u)),p&&t.sitting_player){const s=a[t.sitting_player.name]||t.sitting_player.name;e.push("   (".concat(s," sitting)"))}}else if("brackets"===x){if(e.push("\u3010".concat(s+1,"\u3011").concat(d," \u26a1 ").concat(u)),p&&t.sitting_player){const s=a[t.sitting_player.name]||t.sitting_player.name;e.push("    \ud83d\udca4 ".concat(s," sitting"))}}else if("tournament"===x){if(e.push("\u25b6\ufe0f ".concat(d)),e.push("     \ud83c\udd9a"),e.push("\u25b6\ufe0f ".concat(u)),p&&t.sitting_player){const s=a[t.sitting_player.name]||t.sitting_player.name;e.push("\ud83d\udcba ".concat(s))}e.push("\u2500".repeat(6))}else if("clean"===x){if(e.push("".concat(d," v ").concat(u)),p&&t.sitting_player){const s=a[t.sitting_player.name]||t.sitting_player.name;e.push("(".concat(s," sits)"))}e.push("")}})}),e.push(""),e.push("\u23f0 Please arrive 15 minutes early for warm-up")}else e.push("\ud83e\udd14 AVAILABILITY CHECK"),e.push("\u2500".repeat(8)),e.push(""),e.push("We need to know who's available for Week ".concat(t.week_number,"!")),e.push(""),n&&(e.push("\ud83d\udcca Current responses:"),e.push("```"),e.push("Available:     ".concat(n.available||0)),e.push("Not available: ".concat(n.unavailable||0)),e.push("No response:   ".concat(n.pending||0)),e.push("```"),e.push(""));return!d||s&&0!==s.length||(e.push("\ud83d\udcac PLEASE RESPOND TO POLL:"),e.push("\u2022 \u2705 Available"),e.push("\u2022 \u274c Not available"),e.push("\u2022 \u2753 Maybe/unsure"),e.push(""),e.push("(Create a WhatsApp poll with these options)"),e.push("")),h&&(s&&s.length>0?e.push("\ud83d\udcf1 Update scores in the app:"):e.push("\ud83d\udcf1 Update availability in the app:"),e.push("".concat(l)),e.push("")),e.push("\u2500".repeat(10)),e.push("Questions? Contact Jon or Charlie \ud83d\udc4b"),e.join("\n")},b=y();return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[(0,bs.jsxs)("div",{className:"p-6 border-b border-gray-200 flex-shrink-0",children:[(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"\ud83d\udcf1 WhatsApp Post Generator"}),(0,bs.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 text-xl font-bold",children:"\xd7"})]}),(0,bs.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Generate a formatted message for your club WhatsApp group"})]}),(0,bs.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,bs.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Message Options"}),(0,bs.jsxs)("div",{className:"space-y-4",children:[s&&s.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\ud83d\udcf1 WhatsApp Format Style"}),(0,bs.jsxs)("select",{value:x,onChange:e=>f(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-[#5D1F1F] focus:border-[#5D1F1F]",children:[(0,bs.jsx)("option",{value:"card",children:"\ud83c\udfbe Card Style (Clean & Visual)"}),(0,bs.jsx)("option",{value:"list",children:"\ud83d\udcdd Simple List (Clean & Readable)"}),(0,bs.jsx)("option",{value:"brackets",children:"\u3010\u3011Emoji Brackets (Fun & Visual)"}),(0,bs.jsx)("option",{value:"tournament",children:"\ud83c\udfc6 Tournament Style (Professional)"}),(0,bs.jsx)("option",{value:"clean",children:"\u2728 Ultra Clean (Minimal)"})]}),(0,bs.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Try different styles to see what looks best in WhatsApp!"})]}),s&&s.length>0&&(0,bs.jsxs)("label",{className:"flex items-center",children:[(0,bs.jsx)("input",{type:"checkbox",checked:p,onChange:e=>g(e.target.checked),className:"rounded border-gray-300 text-[#5D1F1F] focus:ring-[#5D1F1F]"}),(0,bs.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"\ud83d\udcba Include sitting players"})]}),(!s||0===s.length)&&(0,bs.jsxs)("label",{className:"flex items-center",children:[(0,bs.jsx)("input",{type:"checkbox",checked:d,onChange:e=>u(e.target.checked),className:"rounded border-gray-300 text-[#5D1F1F] focus:ring-[#5D1F1F]"}),(0,bs.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Include availability poll instructions"})]}),(0,bs.jsxs)("label",{className:"flex items-center",children:[(0,bs.jsx)("input",{type:"checkbox",checked:h,onChange:e=>m(e.target.checked),className:"rounded border-gray-300 text-[#5D1F1F] focus:ring-[#5D1F1F]"}),(0,bs.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Include link to ladder app"})]})]})]}),(0,bs.jsxs)("div",{className:"p-6",children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Message Preview"}),(0,bs.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 border",children:(0,bs.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 font-mono leading-relaxed",children:b})})]})]}),(0,bs.jsxs)("div",{className:"p-6 border-t border-gray-200 flex-shrink-0",children:[(0,bs.jsxs)("div",{className:"flex space-x-3",children:[(0,bs.jsx)("button",{onClick:async()=>{const e=y();try{await navigator.clipboard.writeText(e),c(!0),setTimeout(()=>c(!1),2e3)}catch(t){const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),c(!0),setTimeout(()=>c(!1),2e3)}},className:"flex-1 bg-[#5D1F1F] text-white py-3 px-4 rounded-md hover:bg-[#4A1818] transition-colors flex items-center justify-center space-x-2",children:o?(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(na,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Copied!"})]}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(ia,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Copy to Clipboard"})]})}),(0,bs.jsxs)("button",{onClick:()=>{const e=encodeURIComponent(y()),t="https://web.whatsapp.com/send?text=".concat(e);window.open(t,"_blank")},className:"flex-1 bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 transition-colors flex items-center justify-center space-x-2",children:[(0,bs.jsx)(ra,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Open WhatsApp Web"})]})]}),(0,bs.jsx)("p",{className:"text-xs text-gray-500 mt-3 text-center",children:'Copy the message and paste it into your club WhatsApp group, or click "Open WhatsApp Web" to send directly'})]})]})})},ya=e=>{var t,s,a,r;let{fixture:n,existingScore:i,canEnterScore:l,openScoreModal:o,selectedSeason:c,currentUser:d,users:u,isSeasonCompleted:h,onMoveUp:m,onMoveDown:p,canMoveUp:g,canMoveDown:x,isAdmin:f}=e;const y=[null===(t=n.player1)||void 0===t?void 0:t.name,null===(s=n.player2)||void 0===s?void 0:s.name].filter(Boolean),b=[null===(a=n.player3)||void 0===a?void 0:a.name,null===(r=n.player4)||void 0===r?void 0:r.name].filter(Boolean);return(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,bs.jsxs)("div",{className:"flex",children:[f&&(g||x)&&(0,bs.jsxs)("div",{className:"flex flex-col bg-gray-100 border-r border-gray-200",children:[(0,bs.jsx)("button",{onClick:m,disabled:!g,className:"flex items-center justify-center w-9 flex-1 transition-colors border-b border-gray-200 ".concat(g?"text-gray-600 hover:bg-gray-200 hover:text-gray-800 active:bg-gray-300":"text-gray-300 cursor-not-allowed"),title:"Move up","aria-label":"Move fixture up",children:(0,bs.jsx)(sa,{className:"w-4 h-4"})}),(0,bs.jsx)("button",{onClick:p,disabled:!x,className:"flex items-center justify-center w-9 flex-1 transition-colors ".concat(x?"text-gray-600 hover:bg-gray-200 hover:text-gray-800 active:bg-gray-300":"text-gray-300 cursor-not-allowed"),title:"Move down","aria-label":"Move fixture down",children:(0,bs.jsx)(aa,{className:"w-4 h-4"})})]}),(0,bs.jsxs)("div",{className:"flex-1",children:[i?(0,bs.jsx)(ma,{fixture:n,score:i,selectedSeason:c,currentUser:d,users:u}):(0,bs.jsx)("div",{className:"p-4",children:(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsx)("div",{className:"flex-1",children:(0,bs.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[y.join(" & ")," vs ",b.join(" & "),n.sitting_player&&" (".concat(n.sitting_player.name," sitting)")]})}),(0,bs.jsx)("div",{className:"text-sm text-gray-500",children:"No score yet"})]})}),l&&!h&&(0,bs.jsx)("div",{className:"border-t border-gray-100",children:(0,bs.jsx)("button",{onClick:e=>{e.stopPropagation(),o({fixtureId:n.id,pair1:y,pair2:b})},className:"text-sm px-6 py-3 transition-colors min-h-[44px] w-full font-medium border-0 rounded-none rounded-br-xl ".concat(i?"bg-blue-600 text-white hover:bg-blue-700 focus:bg-blue-700":"bg-[#5D1F1F] text-white hover:bg-[#4A1818] focus:bg-[#4A1818]"),style:{touchAction:"manipulation"},children:i?"Challenge Score":"Enter Score"})})]})]})})},ba=e=>{let{courtFixtures:t,getMatchScore:s,canUserEnterScores:a,openScoreModal:r,selectedSeason:n,currentUser:i,users:l,onReorderMatches:o,isSeasonCompleted:d}=e;const u="admin"===(null===i||void 0===i?void 0:i.role);return(0,bs.jsx)("div",{className:"space-y-5",children:t.map((e,h)=>(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-3 pb-2 border-b border-gray-200",children:[(0,bs.jsxs)("h4",{className:"font-semibold text-gray-900",children:["Court ",e.court]}),(0,bs.jsxs)("span",{className:"text-xs text-gray-500 bg-white px-2 py-1 rounded",children:[e.fixtures.length," ",1===e.fixtures.length?"game":"games"]})]}),(0,bs.jsxs)("div",{className:"mb-3 text-sm text-gray-600",children:[(0,bs.jsx)("span",{className:"font-medium",children:"Players: "}),(0,bs.jsx)("span",{children:[...new Set([...e.fixtures.map(e=>{var t;return null===(t=e.player1)||void 0===t?void 0:t.name}),...e.fixtures.map(e=>{var t;return null===(t=e.player2)||void 0===t?void 0:t.name}),...e.fixtures.map(e=>{var t;return null===(t=e.player3)||void 0===t?void 0:t.name}),...e.fixtures.map(e=>{var t;return null===(t=e.player4)||void 0===t?void 0:t.name})].filter(Boolean))].join(", ")})]}),(0,bs.jsx)("div",{className:"space-y-3",children:e.fixtures.map((m,p)=>{const g=s(m.id),x=a(m),f=p>0,y=p<e.fixtures.length-1;return(0,bs.jsx)(ya,{fixture:m,existingScore:g,canEnterScore:x,openScoreModal:r,selectedSeason:n,currentUser:i,users:l,isSeasonCompleted:d,isAdmin:u,onMoveUp:()=>((e,s)=>{const a=[...t[e].fixtures];[a[s],a[s-1]]=[a[s-1],a[s]];const r=a.map((e,t)=>c(c({},e),{},{game_number:t+1}));o(e,r)})(h,p),onMoveDown:()=>((e,s)=>{const a=[...t[e].fixtures];[a[s],a[s+1]]=[a[s+1],a[s]];const r=a.map((e,t)=>c(c({},e),{},{game_number:t+1}));o(e,r)})(h,p),canMoveUp:f,canMoveDown:y},m.id)})})]},e.court))})},va=fs("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),wa=fs("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),ja=fs("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]),_a=e=>{let{match:t,matchStatus:s,stats:r,courtFixtures:n,isSeasonCompleted:i,seasonType:l,onGenerateClick:o,onUndoClick:c,onWhatsAppClick:d}=e;const[u,h]=(0,a.useState)(!1),m=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&h(!1)};if(u)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[u]);const p="ladder"===l,g=!i&&"future-no-fixtures"===s&&r.available>=4,x=!i&&n.length>0&&"completed"!==s;if(!p&&!g&&!x)return null;const f=(e,t)=>{e.stopPropagation(),h(!1),t()};return(0,bs.jsxs)("div",{className:"relative",ref:m,children:[(0,bs.jsx)("button",{onClick:e=>{e.stopPropagation(),Ys.tap(),h(!u)},className:"p-2 rounded-lg transition-all duration-200 ".concat(u?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),"aria-label":"Admin actions","aria-expanded":u,children:(0,bs.jsx)(va,{className:"w-5 h-5"})}),u&&(0,bs.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[p&&(0,bs.jsxs)("button",{onClick:e=>f(e,d),className:"w-full px-4 py-2.5 text-left hover:bg-gray-50 transition-colors flex items-center gap-3 text-sm",children:[(0,bs.jsx)(ra,{className:"w-4 h-4 text-green-600"}),(0,bs.jsx)("span",{children:"Share on WhatsApp"})]}),g&&(0,bs.jsxs)("button",{onClick:e=>f(e,o),className:"w-full px-4 py-2.5 text-left hover:bg-gray-50 transition-colors flex items-center gap-3 text-sm",children:[(0,bs.jsx)(wa,{className:"w-4 h-4 text-[#5D1F1F]"}),(0,bs.jsxs)("div",{className:"flex items-center justify-between flex-1",children:[(0,bs.jsx)("span",{children:"Generate Matches"}),(0,bs.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-0.5 rounded-full text-gray-600",children:r.available})]})]}),x&&(0,bs.jsxs)("button",{onClick:e=>f(e,c),className:"w-full px-4 py-2.5 text-left hover:bg-gray-50 transition-colors flex items-center gap-3 text-sm text-orange-600",children:[(0,bs.jsx)(ja,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Undo Generated Matches"})]})]})]})},Na=e=>{let{currentUser:t,currentSeason:s,selectedSeason:r,matchFixtures:n,matchResults:i,availability:l,users:o,generateMatches:d,undoGenerateMatches:u,openScoreModal:h,getAvailabilityStats:m,getMatchScore:p,supabase:g,refetch:x,reorderMatchFixtures:f}=e;const[y,b]=(0,a.useState)({}),[v,w]=(0,a.useState)("all"),[j,_]=(0,a.useState)(!1),[N,k]=(0,a.useState)(null),[S,C]=(0,a.useState)(0),[E,P]=(0,a.useState)([]),[T,D]=(0,a.useState)([]),[A,O]=(0,a.useState)(!1),[F,R]=(0,a.useState)(!1),[M,I]=(0,a.useState)(null),[L,U]=(0,a.useState)([]),[z,q]=(0,a.useState)([]),[W,B]=(0,a.useState)(!1),[G,H]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{null!==x&&void 0!==x&&x.fixtures&&await x.fixtures(),null!==x&&void 0!==x&&x.results&&await x.results(),null!==x&&void 0!==x&&x.selectedSeasonData&&await x.selectedSeasonData(),null!==x&&void 0!==x&&x.availability&&await x.availability()}catch(e){console.error("Error refreshing match data:",e)}})()},[null===r||void 0===r?void 0:r.id]);const V=e=>{const t=e.length,s=[];if(t%4===0)for(let a=0;a<t;a+=4)s.push(e.slice(a,a+4));else if(5===t)s.push(e);else if(9===t)s.push(e.slice(0,4)),s.push(e.slice(4,9));else if(10===t)s.push(e.slice(0,5)),s.push(e.slice(5,10));else{const a=Math.floor(t/4);for(let t=0;t<a;t++)s.push(e.slice(4*t,4*(t+1)));t%4>0&&s.push(e.slice(4*a))}return s},J=e=>{switch(e){case"completed":return"border-l-green-500";case"partially-complete":return"border-l-yellow-500";case"past-in-progress":return"border-l-orange-500";case"future-in-progress":return"border-l-blue-500";case"future-no-fixtures":return"border-l-blue-400";default:return"border-l-gray-300"}},K=e=>"admin"===(null===t||void 0===t?void 0:t.role)||(e.player1_id===(null===t||void 0===t?void 0:t.id)||e.player2_id===(null===t||void 0===t?void 0:t.id)||e.player3_id===(null===t||void 0===t?void 0:t.id)||e.player4_id===(null===t||void 0===t?void 0:t.id)),$=e=>n.filter(t=>t.match_id===e).some(e=>"league"===e.match_type),Y=e=>n.find(t=>t.match_id===e&&"league"===t.match_type),Q="completed"===(null===r||void 0===r?void 0:r.status),X="singles_championship"===(null===r||void 0===r?void 0:r.season_type),Z=X?(()=>{if(null===s||void 0===s||!s.matches)return[];const e=new Map;return s.matches.forEach(t=>{const a=t.match_date;e.has(a)||e.set(a,{date:a,matches:[],weekNumber:Math.min(...s.matches.filter(e=>e.match_date===a).map(e=>e.week_number))}),e.get(a).matches.push(t)}),Array.from(e.values()).sort((e,t)=>new Date(e.date)-new Date(t.date))})():[],ee=X?[]:null!==s&&void 0!==s&&s.matches?s.matches.filter(e=>{if(!$(e.id))return"all"===v||"ladder"===v;if("all"===v)return!0;const t=Y(e.id);return(null===t||void 0===t?void 0:t.team)===v}):[];return(0,bs.jsxs)("div",{className:"space-y-5",children:[(0,bs.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:[(null===r||void 0===r?void 0:r.name)||"Current"," Match Schedule"]}),Q&&(0,bs.jsx)("p",{className:"text-sm text-blue-600 mt-1",children:"\ud83c\udfc6 This season has been completed - no modifications allowed"})]}),(0,bs.jsxs)("div",{className:"flex items-center space-x-4",children:["league"===(null===r||void 0===r?void 0:r.season_type)&&(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Team:"}),(0,bs.jsxs)("select",{value:v,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm",children:[(0,bs.jsx)("option",{value:"all",children:"All Cawood"}),(0,bs.jsx)("option",{value:"1sts",children:"Cawood 1sts"}),(0,bs.jsx)("option",{value:"2nds",children:"Cawood 2nds"})]})]}),Q&&(0,bs.jsx)("div",{className:"bg-gray-100 text-gray-500 px-4 py-2 rounded-md",children:"Season Completed"})]})]}),X?Z&&0!==Z.length?(0,bs.jsx)("div",{className:"space-y-4",children:Z.map((e,s)=>{var a;const l=e.matches.reduce((e,t)=>e.concat(n.filter(e=>e.match_id===t.id)),[]),d=l.filter(e=>i.some(t=>t.fixture_id===e.id)).length,u=0===d?"pending":d<l.length?"partially-complete":"completed",m=new Date(e.date),g=new Date;g.setHours(0,0,0,0),m.setHours(0,0,0,0);const x=null===(a=y["group-".concat(s)])||void 0===a||a,f="completed"===u?"border-l-green-500":"partially-complete"===u?"border-l-yellow-500":"border-l-blue-400";return(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow border-l-4 ".concat(f),children:[(0,bs.jsx)("div",{className:"p-4 sm:p-6 cursor-pointer hover:bg-gray-50 active:bg-gray-100 transition-colors",onClick:()=>{Ys.tap(),b(e=>c(c({},e),{},{["group-".concat(s)]:!e["group-".concat(s)]}))},children:(0,bs.jsxs)("div",{className:"flex justify-between items-start",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold",children:["Week ",s+1]}),(0,bs.jsx)("p",{className:"text-gray-600",children:m.toLocaleDateString("en-GB")}),m.getTime()===g.getTime()&&(0,bs.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded",children:"\ud83d\udcc5 Today"}),"completed"===u&&(0,bs.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded",children:"\u2705 All Completed"}),"partially-complete"===u&&(0,bs.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded",children:"\ud83d\udd04 In Progress"}),"pending"===u&&(0,bs.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-orange-100 text-orange-800 rounded",children:"\u23f0 Enter Scores"})]}),!x&&(0,bs.jsx)("div",{className:"mt-2 sm:mt-3",children:(0,bs.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,bs.jsxs)("span",{children:[e.matches.length," matches"]}),"completed"===u&&(0,bs.jsx)("span",{className:"text-green-600",children:"All results recorded"}),"partially-complete"===u&&(0,bs.jsxs)("span",{className:"text-yellow-600",children:[d,"/",l.length," completed"]}),"pending"===u&&(0,bs.jsx)("span",{className:"text-orange-600",children:"Results needed"})]})})]}),(0,bs.jsx)("div",{className:"text-gray-400 p-1.5 rounded-full bg-gray-100 transition-all duration-200 hover:bg-gray-200 cursor-pointer",children:(0,bs.jsx)(aa,{className:"w-5 h-5 transition-transform duration-200 ".concat(x?"rotate-180":"rotate-0")})})]})}),x&&(0,bs.jsx)("div",{className:"border-t border-gray-200 p-4 sm:p-5",children:(0,bs.jsx)("div",{className:"space-y-3",children:e.matches.map(e=>n.filter(t=>t.match_id===e.id).map(e=>{var s,a;const n=p(e.id),i=K(e);return(0,bs.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[n?(0,bs.jsx)(ma,{fixture:e,score:n,selectedSeason:r,currentUser:t,users:o}):(0,bs.jsx)("div",{className:"p-4",children:(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsxs)("div",{className:"font-medium text-gray-900",children:[null===(s=e.player1)||void 0===s?void 0:s.name," vs ",null===(a=e.player2)||void 0===a?void 0:a.name]}),(0,bs.jsx)("div",{className:"text-sm text-gray-500",children:"No score yet"})]})}),i&&!Q&&(0,bs.jsx)("div",{className:"border-t border-gray-100",children:(0,bs.jsx)("button",{onClick:t=>{var s,a;t.stopPropagation(),Ys.click(),h({fixtureId:e.id,pair1:[null===(s=e.player1)||void 0===s?void 0:s.name],pair2:[null===(a=e.player2)||void 0===a?void 0:a.name]})},className:"text-sm px-6 py-3 transition-colors min-h-[44px] w-full font-medium border-0 rounded-none rounded-b-xl ".concat(n?"bg-blue-600 text-white hover:bg-blue-700 focus:bg-blue-700":"bg-[#5D1F1F] text-white hover:bg-[#4A1818] focus:bg-[#4A1818]"),style:{touchAction:"manipulation"},children:n?"Challenge Score":"Enter Score"})}),n&&!i&&(0,bs.jsx)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Complete"}),!n&&!i&&(0,bs.jsx)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:"Pending"})]},e.id)}))})})]},"group-".concat(s))})}):(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[(0,bs.jsx)("p",{className:"text-gray-500",children:"No singles matches scheduled yet."}),"admin"===(null===t||void 0===t?void 0:t.role)&&(0,bs.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Go to Admin tab to import singles matches."})]}):ee&&0!==ee.length?(0,bs.jsx)("div",{className:"space-y-4",children:ee.map(e=>{var a;const d=m(e.id),x=(e=>{const t=new Date;t.setHours(0,0,0,0);const s=new Date(e.match_date);if(s.setHours(0,0,0,0),!n.some(t=>t.match_id===e.id))return s<t?"past-no-fixtures":"future-no-fixtures";const a=n.filter(t=>t.match_id===e.id),r=a.filter(e=>i.some(t=>t.fixture_id===e.id)).length;return 0===r?s<t?"past-in-progress":"future-in-progress":r<a.length?"partially-complete":"completed"})(e),v="admin"===(null===t||void 0===t?void 0:t.role),w=(e=>{const t=n.filter(t=>t.match_id===e),s={};return t.forEach(e=>{s[e.court_number]||(s[e.court_number]=[]),s[e.court_number].push(e)}),Object.entries(s).map(e=>{let[t,s]=e;return{court:parseInt(t),fixtures:s.sort((e,t)=>e.game_number-t.game_number)}})})(e.id),j="completed"===x||"past-no-fixtures"===x,N=null!==(a=y[e.id])&&void 0!==a?a:!j,S=new Date;S.setHours(0,0,0,0);const E=new Date(e.match_date);if(E.setHours(0,0,0,0),$(e.id)){const t=Y(e.id);return(0,bs.jsx)(ca,{match:e,fixture:t,supabase:g},e.id)}return(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow border-l-4 ".concat(J(x)),children:[(0,bs.jsx)("div",{className:"p-4 sm:p-6 ".concat(w.length>0||"future-no-fixtures"===x?"cursor-pointer hover:bg-gray-50 active:bg-gray-100":""," transition-colors"),onClick:()=>{var t;(w.length>0||"future-no-fixtures"===x)&&(Ys.tap(),t=e.id,b(e=>c(c({},e),{},{[t]:!e[t]})))},children:(0,bs.jsxs)("div",{className:"flex justify-between items-start",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3 flex-wrap gap-y-2",children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold",children:["Week ",e.week_number]}),(0,bs.jsx)("p",{className:"text-gray-600",children:E.toLocaleDateString("en-GB")}),(()=>{const e=((e,t)=>{const s=new Date;s.setHours(0,0,0,0);const a=t.getTime()===s.getTime();switch(e){case"completed":return{text:a?"Completed Today":"Completed",emoji:"\u2705",color:"bg-green-100 text-green-800"};case"partially-complete":return{text:a?"In Progress \u2022 Today":"In Progress",emoji:"\ud83d\udd04",color:"bg-yellow-100 text-yellow-800"};case"past-in-progress":return{text:a?"Enter Scores \u2022 Today":"Enter Scores",emoji:"\u23f0",color:"bg-orange-100 text-orange-800"};case"future-in-progress":return{text:a?"Scheduled \u2022 Today":"Scheduled",emoji:"\ud83d\udccb",color:"bg-blue-100 text-blue-800"};case"future-no-fixtures":return{text:a?"Availability Check \u2022 Today":"Availability Check",emoji:"\ud83d\udcc5",color:"bg-blue-100 text-blue-800"};case"past-no-fixtures":return{text:"No Fixtures",emoji:"\u26a0\ufe0f",color:"bg-gray-100 text-gray-600"};default:return{text:"Unknown",emoji:"",color:"bg-gray-100 text-gray-600"}}})(x,E);return(0,bs.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded ".concat(e.color),children:[(0,bs.jsx)("span",{children:e.emoji}),(0,bs.jsx)("span",{children:e.text})]})})()]}),!N&&(0,bs.jsxs)("div",{className:"mt-2 sm:mt-3",children:["future-no-fixtures"===x&&(0,bs.jsxs)("div",{className:"text-sm text-gray-600",children:["Availability: ",d.available," available, ",d.pending," pending"]}),w.length>0&&(0,bs.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[(0,bs.jsxs)("span",{children:[w.length," matches"]}),"completed"===x&&(0,bs.jsx)("span",{className:"text-green-600",children:"All scores recorded"}),"partially-complete"===x&&(0,bs.jsx)("span",{className:"text-yellow-600",children:"Some scores pending"}),"past-in-progress"===x&&(0,bs.jsx)("span",{className:"text-orange-600",children:"Scores needed"})]})]})]}),(0,bs.jsxs)("div",{className:"flex items-center gap-3 ml-4",children:[v&&(0,bs.jsx)(_a,{match:e,matchStatus:x,stats:d,courtFixtures:w,isSeasonCompleted:Q,seasonType:null===r||void 0===r?void 0:r.season_type,onGenerateClick:()=>{k(e.id),C(d.available),_(!0),(async e=>{O(!0);try{var t,a;const n=(null===s||void 0===s||null===(t=s.matches)||void 0===t?void 0:t.find(t=>t.id===e))||(null===r||void 0===r||null===(a=r.matches)||void 0===a?void 0:a.find(t=>t.id===e));if(!n)return void console.error("Match not found for preview");const i=(o||[]).filter(e=>{const t=l.find(t=>t.player_id===e.id&&t.match_date===n.match_date);return!0===(null===t||void 0===t?void 0:t.is_available)});if(0===i.length)return console.warn("No available players found for preview"),P([]),void D([]);const d=i.sort((e,t)=>(e.rank||999)-(t.rank||999)).map(e=>c(c({},e),{},{win_percentage:Math.round((e.games_won||0)/Math.max(e.games_played||1,1)*100)})),u=V(d);P(u);const h=(null===r||void 0===r?void 0:r.elo_initial_rating)||1200,m=i.sort((e,t)=>{const s=e.elo_rating||h;return(t.elo_rating||h)-s}).map(e=>c(c({},e),{},{initialRating:h})),p=V(m);D(p)}catch(n){console.error("Error generating previews:",n),P([]),D([])}finally{O(!1)}})(e.id)},onUndoClick:()=>{Ys.click();window.confirm("Are you sure you want to undo the generated matches?\n\nThis will delete all match fixtures and restore the availability state.\n"+("partially-complete"===x||"past-in-progress"===x?"Warning: This will also delete any scores that have been entered!":""))&&u(e.id)},onWhatsAppClick:()=>{const t=w.length>0?w.flatMap(e=>e.fixtures):null;H({match:e,fixtures:t,users:o,availabilityStats:d}),B(!0)}}),(w.length>0||"future-no-fixtures"===x)&&(0,bs.jsx)("div",{className:"text-gray-400 p-1.5 rounded-full bg-gray-100 transition-all duration-200 hover:bg-gray-200 cursor-pointer",children:(0,bs.jsx)(aa,{className:"w-5 h-5 transition-transform duration-200 ".concat(N?"rotate-180":"rotate-0")})})]})]})}),N&&(0,bs.jsxs)("div",{className:"border-t border-gray-200 p-4 sm:p-5",children:["future-no-fixtures"===x&&(0,bs.jsx)("div",{className:"mb-4",children:(0,bs.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,bs.jsxs)("div",{children:["Availability: ",d.available," available, ",d.pending," pending response"]}),v&&d.available<4&&(0,bs.jsx)("div",{className:"text-red-600 mt-1",children:"Need at least 4 players to generate matches"}),v&&d.available>=4&&(0,bs.jsxs)("div",{className:"text-green-600 mt-1 font-medium",children:["Ready to generate matches! ",E.getTime()===S.getTime()?"(Today's match)":""]})]})}),w.length>0&&(0,bs.jsx)("div",{className:"space-y-4",children:(0,bs.jsx)(ba,{courtFixtures:w,getMatchScore:p,canUserEnterScores:K,openScoreModal:h,selectedSeason:r,currentUser:t,users:o,onReorderMatches:f,isSeasonCompleted:Q})}),"past-no-fixtures"===x&&(0,bs.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:(0,bs.jsx)("p",{className:"text-yellow-800 text-sm",children:"This match date has passed but no fixtures were generated."})})]})]},e.id)})}):(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[(0,bs.jsx)("p",{className:"text-gray-500",children:"all"===v?"No matches scheduled yet.":"No matches found for ".concat("1sts"===v?"Cawood 1sts":"Cawood 2nds",".")}),"admin"===(null===t||void 0===t?void 0:t.role)&&"all"===v&&(0,bs.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"ladder"===(null===r||void 0===r?void 0:r.season_type)?"Go to Admin tab to add ladder matches.":"League matches are added via import in the Admin tab."})]}),W&&G&&(0,bs.jsx)(fa,{match:G.match,fixtures:G.fixtures,users:G.users,availabilityStats:G.availabilityStats,onClose:()=>{B(!1),H(null)}}),(0,bs.jsx)(ga,{showModal:j,setShowModal:_,availablePlayersCount:S,seasonEloEnabled:(null===r||void 0===r?void 0:r.elo_enabled)||!1,onMethodSelect:e=>{if(!N)return;const t="elo"===e?T:E;if(0===t.length)return void console.error("No preview available for selected method");const s=t.flat(),a=(e=>{if(e%4===0)return[Array(e/4).fill(4)];if(e%5===0)return[Array(e/5).fill(5)];if(5===e)return[[5]];const t=[],s=Math.floor(e/4);for(let a=0;a<=s;a++){const s=e-4*a;if(s%5===0){const e=s/5,r=[...Array(a).fill(4),...Array(e).fill(5)],n=ls(r);t.push(...n)}}return t.length>0?t:[]})(s.length);I(e),U(a),q(s),_(!1),R(!0)},winPercentPreview:E,eloPreview:T,isLoadingPreviews:A}),(0,bs.jsx)(xa,{showModal:F,setShowModal:R,layoutOptions:L,sortedPlayers:z,schedulingMethod:M,onConfirm:e=>{N&&M&&(d(N,M,e),k(null),C(0),P([]),D([]),I(null),U([]),q([]),R(!1))},onBack:()=>{R(!1),_(!0)},seasonEloEnabled:(null===r||void 0===r?void 0:r.elo_enabled)||!1})]})},ka=fs("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Sa=fs("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Ca=fs("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Ea=e=>{let{eloData:t,onClick:s}=e;const a=t.recentChanges[0],r=Math.round(t.currentRating||0),n=a?a.change:0,i=(t.seasonEloChange,t.recentChanges.slice(0,12).reverse());return(0,bs.jsxs)("div",{className:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 p-6 transition-all duration-300 hover:shadow-lg hover:scale-105 cursor-pointer",onClick:s,children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:(0,bs.jsx)(zs,{className:"w-5 h-5 text-purple-600"})}),t.rankingPosition&&(0,bs.jsx)("div",{className:"absolute -top-1 -right-1 bg-purple-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:t.rankingPosition})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"ELO Rating"}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:r}),0!==n&&(0,bs.jsxs)("span",{className:"text-sm font-bold px-2 py-1 rounded-full ".concat(n>0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:[n>0?"+":"",n]})]}),null!==t.maxEloChange&&t.maxEloChange>0&&(0,bs.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:["Max Change: ",(0,bs.jsxs)("span",{className:"font-semibold text-green-600",children:["+",Math.round(t.maxEloChange)]})]})]})]}),(0,bs.jsxs)("div",{className:"text-xs text-gray-400 flex items-center",children:[(0,bs.jsx)("span",{children:"Tap for history"}),(0,bs.jsx)(Sa,{className:"w-3 h-3 ml-1"})]})]}),i.length>1&&(0,bs.jsx)("div",{className:"flex-1",children:(0,bs.jsxs)("div",{className:"h-24 relative",children:[(0,bs.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 100 40",children:[(0,bs.jsx)("defs",{children:(0,bs.jsx)("pattern",{id:"grid",width:"20",height:"10",patternUnits:"userSpaceOnUse",children:(0,bs.jsx)("path",{d:"M 20 0 L 0 0 0 10",fill:"none",stroke:"#e5e7eb",strokeWidth:"0.5"})})}),(0,bs.jsx)("rect",{width:"100",height:"40",fill:"url(#grid)"}),(()=>{const e=Math.max(...i.map(e=>e.newRating));let s=Math.min(...i.map(e=>e.newRating));t.startingRating&&(s=Math.min(s,t.startingRating));const a=Math.max(e-s,10),r=i.map((e,t)=>{const r=t/(i.length-1)*100,n=40-(e.newRating-s)/a*35-2.5;return"".concat(r,",").concat(n)}).join(" ");return(0,bs.jsxs)("g",{children:[(0,bs.jsx)("polyline",{fill:"none",stroke:"#7c3aed",strokeWidth:"1.5",points:r}),i.map((e,t)=>{const r=t/(i.length-1)*100,n=40-(e.newRating-s)/a*35-2.5,l=e.change>0,o=e.change<0;return(0,bs.jsxs)("g",{children:[(0,bs.jsx)("circle",{cx:r,cy:n,r:"1.5",fill:l?"#10b981":o?"#ef4444":"#6b7280",stroke:"white",strokeWidth:"0.5"}),0!==e.change&&(0,bs.jsx)("g",{children:l?(0,bs.jsx)("polygon",{points:"".concat(r-1,",").concat(n-3," ").concat(r+1,",").concat(n-3," ").concat(r,",").concat(n-5),fill:"#10b981",opacity:"0.8"}):(0,bs.jsx)("polygon",{points:"".concat(r-1,",").concat(n+3," ").concat(r+1,",").concat(n+3," ").concat(r,",").concat(n+5),fill:"#ef4444",opacity:"0.8"})})]},t)})]})})()]}),(0,bs.jsx)("div",{className:"absolute inset-0 flex",children:i.map((e,t)=>(0,bs.jsx)("div",{className:"flex-1 relative group cursor-pointer",title:"".concat(e.newRating," (").concat(e.change>0?"+":"").concat(e.change,")"),children:(0,bs.jsx)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:(0,bs.jsxs)("div",{className:"text-xs px-2 py-1 rounded shadow-lg whitespace-nowrap ".concat(e.change>0?"bg-green-100 text-green-800 border border-green-200":e.change<0?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-800 border border-gray-200"),children:[e.newRating," (",e.change>0?"+":"",e.change,")"]})})},t))})]})})]})},Pa=e=>{let{stats:t,onClick:s}=e;const a=Math.round((t.matchesWon||0)/Math.max(t.totalMatches||1,1)*100);return(0,bs.jsxs)("div",{className:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 p-6 transition-all duration-300 hover:shadow-lg hover:scale-105 cursor-pointer",onClick:s,children:[(0,bs.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:(0,bs.jsx)(Is,{className:"w-5 h-5 text-green-600"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Match Performance"}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsxs)("span",{className:"text-2xl font-bold text-green-600",children:[a,"%"]}),(0,bs.jsx)("span",{className:"text-sm text-gray-500",children:"win rate"})]})]})]})}),(0,bs.jsx)("div",{className:"mb-3",children:(0,bs.jsx)("div",{className:"w-full bg-green-200 rounded-full h-2",children:(0,bs.jsx)("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-700",style:{width:"".concat(a,"%")}})})}),(0,bs.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,bs.jsxs)("span",{className:"text-gray-600",children:[t.matchesWon||0,"W - ",t.matchesLost||0,"L - ",t.matchesDrawn||0,"D"]}),(0,bs.jsxs)("div",{className:"flex items-center text-gray-400",children:[(0,bs.jsx)("span",{children:"Tap for details"}),(0,bs.jsx)(Sa,{className:"w-3 h-3 ml-1"})]})]})]})},Ta=e=>{let{stats:t,onClick:s}=e;const a=Math.round(100*(t.gameWinRate||0));return(0,bs.jsxs)("div",{className:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 p-6 transition-all duration-300 hover:shadow-lg hover:scale-105 cursor-pointer",onClick:s,children:[(0,bs.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,bs.jsx)(pa,{className:"w-5 h-5 text-blue-600"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Game Performance"}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsxs)("span",{className:"text-2xl font-bold text-blue-600",children:[a,"%"]}),(0,bs.jsx)("span",{className:"text-sm text-gray-500",children:"win rate"})]})]})]})}),(0,bs.jsx)("div",{className:"mb-3",children:(0,bs.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,bs.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-700",style:{width:"".concat(a,"%")}})})}),(0,bs.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,bs.jsxs)("span",{className:"text-gray-600",children:[t.gamesWon||0," of ",t.totalGames||0," games won"]}),(0,bs.jsxs)("div",{className:"flex items-center text-gray-400",children:[(0,bs.jsx)("span",{children:"Tap for details"}),(0,bs.jsx)(Sa,{className:"w-3 h-3 ml-1"})]})]})]})},Da=e=>{let{winStreaks:t,onClick:s}=e;const a=t.currentType,r=t.current||0,n=t.longest||0,i="win"===(l=a)?{border:"border-green-200",bg:"bg-gradient-to-br from-green-50 to-green-100 hover:from-green-100 hover:to-green-200",iconBg:"bg-green-100",iconColor:"text-green-600",textColor:"text-green-600"}:"loss"===l?{border:"border-red-200",bg:"bg-gradient-to-br from-red-50 to-red-100 hover:from-red-100 hover:to-red-200",iconBg:"bg-red-100",iconColor:"text-red-600",textColor:"text-red-600"}:{border:"border-gray-200",bg:"bg-gradient-to-br from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200",iconBg:"bg-gray-100",iconColor:"text-gray-600",textColor:"text-gray-600"};var l;return(0,bs.jsxs)("div",{className:"rounded-lg border ".concat(i.border," ").concat(i.bg," p-6 transition-all duration-300 hover:shadow-lg hover:scale-105 cursor-pointer"),onClick:s,children:[(0,bs.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("div",{className:"w-10 h-10 ".concat(i.iconBg," rounded-full flex items-center justify-center"),children:(0,bs.jsx)(Ca,{className:"w-5 h-5 ".concat(i.iconColor)})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Current Streak"}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("span",{className:"text-2xl font-bold ".concat(i.textColor),children:r}),(0,bs.jsx)("span",{className:"text-sm text-gray-500",children:"win"===a?"wins":"loss"===a?"losses":"none"})]})]})]})}),(0,bs.jsxs)("div",{className:"mb-3",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,bs.jsx)("span",{className:"text-gray-600",children:"Best streak:"}),(0,bs.jsxs)("span",{className:"font-bold text-orange-600",children:[n," wins"]})]}),(0,bs.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1 mt-1",children:(0,bs.jsx)("div",{className:"bg-orange-500 h-1 rounded-full transition-all duration-700",style:{width:"".concat(Math.min(("win"===a?r:0)/Math.max(n,1)*100,100),"%")}})})]}),(0,bs.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,bs.jsx)("span",{className:"text-gray-600",children:"win"===a&&r===n&&r>0?"Personal best!":"".concat(Math.max(n-("win"===a?r:0),0)," from best")}),(0,bs.jsxs)("div",{className:"flex items-center text-gray-400",children:[(0,bs.jsx)("span",{children:"Tap for details"}),(0,bs.jsx)(Sa,{className:"w-3 h-3 ml-1"})]})]})]})},Aa=e=>{let{data:t}=e;return t&&0!==t.length?(0,bs.jsx)("div",{className:"space-y-4",children:(0,bs.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:t.map((e,t)=>(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:e.seasonName||"Season ".concat(t+1)}),(0,bs.jsxs)("div",{className:"mt-2",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,bs.jsx)("span",{className:"text-gray-600",children:"Win Rate"}),(0,bs.jsxs)("span",{className:"font-semibold text-[#5D1F1F]",children:[Math.round(e.winRate),"%"]})]}),(0,bs.jsx)("div",{className:"mt-1 bg-gray-200 rounded-full h-2",children:(0,bs.jsx)("div",{className:"bg-gradient-to-r from-[#5D1F1F] to-red-400 h-2 rounded-full transition-all duration-300",style:{width:"".concat(e.winRate/100*100,"%")}})}),(0,bs.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.gamesWon,"W - ",e.totalGames-e.gamesWon,"L (",e.totalGames," games)"]})]})]},e.seasonId))})}):(0,bs.jsx)("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded border-2 border-dashed border-gray-300",children:(0,bs.jsxs)("div",{className:"text-center",children:[(0,bs.jsx)(ka,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),(0,bs.jsx)("p",{className:"text-gray-500",children:"No season data available"}),(0,bs.jsx)("p",{className:"text-sm text-gray-400",children:"Play matches across multiple seasons to see progression"})]})})},Oa=e=>{let{partners:t,allUsers:s}=e;const[r,n]=(0,a.useState)(!1),i=r?t:t.slice(0,5);return(0,bs.jsx)("div",{className:"space-y-3",children:0===t.length?(0,bs.jsxs)("div",{className:"text-center py-8",children:[(0,bs.jsx)(qs,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"No partnership data available"}),(0,bs.jsx)("p",{className:"text-xs text-gray-400",children:"Play matches with different partners to see statistics"})]}):(0,bs.jsxs)("div",{className:"space-y-3",children:[i.map((e,t)=>{const s=Math.round(100*e.winRate);return(0,bs.jsx)("div",{className:"group hover:bg-gray-50 rounded-lg p-3 transition-colors",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsxs)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ".concat(0===t?"bg-yellow-100 text-yellow-800":1===t?"bg-gray-100 text-gray-600":2===t?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-600"),children:["#",t+1]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,bs.jsxs)("div",{className:"text-xs text-gray-500",children:[e.totalGames," games, ",e.matches," matches together"]})]})]}),(0,bs.jsxs)("div",{className:"text-right",children:[(0,bs.jsxs)("div",{className:"text-lg font-bold text-green-600",children:[s,"%"]}),(0,bs.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-1.5 mt-1",children:(0,bs.jsx)("div",{className:"bg-green-500 h-1.5 rounded-full transition-all duration-700 ease-out",style:{width:"".concat(s,"%")}})})]})]})},e.playerId)}),t.length>5&&(0,bs.jsx)("div",{className:"text-center pt-2 border-t border-gray-100",children:(0,bs.jsx)("button",{onClick:()=>n(!r),className:"text-sm text-[#5D1F1F] hover:text-red-800 font-medium transition-colors",children:r?"Show less \u2191":"View all ".concat(t.length," partners \u2193")})})]})})},Fa=e=>{let{nemesisOpponent:t,nemesisPair:s,allUsers:a}=e;return(0,bs.jsx)("div",{className:"space-y-4",children:t||s?(0,bs.jsxs)(bs.Fragment,{children:[t&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[(0,bs.jsx)(ua,{className:"w-4 h-4 mr-1 text-red-500"}),"Toughest Opponent"]}),(0,bs.jsx)("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsx)("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:(0,bs.jsx)("span",{className:"text-red-600 font-bold text-lg",children:"\u2694\ufe0f"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"font-semibold text-gray-900",children:t.name}),(0,bs.jsx)("div",{className:"text-xs text-gray-600",children:"Your toughest individual opponent"})]})]}),(0,bs.jsxs)("div",{className:"text-right",children:[(0,bs.jsxs)("div",{className:"text-xl font-bold text-red-600",children:[Math.round(100*t.winRate),"%"]}),(0,bs.jsxs)("div",{className:"text-xs text-gray-600",children:[t.gamesWon,"W - ",t.gamesLost,"L games (",t.matches," matches)"]}),(0,bs.jsx)("div",{className:"w-16 bg-red-200 rounded-full h-1.5 mt-1",children:(0,bs.jsx)("div",{className:"bg-red-500 h-1.5 rounded-full",style:{width:"".concat(100*t.winRate,"%")}})})]})]})})]}),s&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[(0,bs.jsx)(qs,{className:"w-4 h-4 mr-1 text-red-500"}),"Toughest Pair"]}),(0,bs.jsx)("div",{className:"bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsx)("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:(0,bs.jsx)("span",{className:"text-red-600 font-bold text-sm",children:"\ud83d\udc65"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("div",{className:"font-semibold text-gray-900",children:[s.player1Name," & ",s.player2Name]}),(0,bs.jsx)("div",{className:"text-xs text-gray-600",children:"Your toughest doubles pair"})]})]}),(0,bs.jsxs)("div",{className:"text-right",children:[(0,bs.jsxs)("div",{className:"text-xl font-bold text-red-600",children:[Math.round(100*s.winRate),"%"]}),(0,bs.jsxs)("div",{className:"text-xs text-gray-600",children:[s.gamesWon,"W - ",s.gamesLost,"L games (",s.matches," matches)"]}),(0,bs.jsx)("div",{className:"w-16 bg-red-200 rounded-full h-1.5 mt-1",children:(0,bs.jsx)("div",{className:"bg-red-500 h-1.5 rounded-full",style:{width:"".concat(100*s.winRate,"%")}})})]})]})})]})]}):(0,bs.jsxs)("div",{className:"text-center py-8",children:[(0,bs.jsx)(pa,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"No nemesis data available"}),(0,bs.jsx)("p",{className:"text-xs text-gray-400",children:"Play more matches to identify challenging opponents"})]})})},Ra=e=>{let{matches:t,allUsers:s,onMatchClick:a}=e;return(0,bs.jsx)("div",{className:"space-y-4",children:0===t.length?(0,bs.jsxs)("div",{className:"text-center py-8",children:[(0,bs.jsx)(Ca,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"No recent matches"}),(0,bs.jsx)("p",{className:"text-xs text-gray-400",children:"Your recent form will appear here after playing matches"})]}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-4 p-4 bg-gray-50 rounded-lg",children:[(0,bs.jsx)("span",{className:"text-sm font-medium text-gray-600 mr-3",children:"Recent form:"}),t.map((e,t)=>{var s;return(0,bs.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold shadow-sm transition-all duration-300 hover:scale-110 cursor-pointer ".concat(e.tie?"bg-gray-500 text-white hover:bg-gray-600":e.won?"bg-green-500 text-white hover:bg-green-600":"bg-red-500 text-white hover:bg-red-600"),title:"".concat(e.tie?"Drew":e.won?"Won":"Lost"," ").concat(e.score," vs ").concat(null===(s=e.opponentNames)||void 0===s?void 0:s.join(" & ")," - Click for details"),onClick:()=>a&&a(e),children:e.tie?"D":e.won?"W":"L"},t)})]}),(0,bs.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,bs.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"text-2xl font-bold text-green-600",children:t.filter(e=>e.won).length}),(0,bs.jsx)("div",{className:"text-sm text-green-700",children:"Recent wins"})]}),(0,bs.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,bs.jsx)(da,{className:"w-4 h-4 text-green-600"})})]})}),(0,bs.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:t.filter(e=>e.tie).length}),(0,bs.jsx)("div",{className:"text-sm text-gray-700",children:"Recent draws"})]}),(0,bs.jsx)("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:(0,bs.jsx)("div",{className:"w-4 h-4 bg-gray-600 rounded"})})]})}),(0,bs.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"text-2xl font-bold text-red-600",children:t.filter(e=>!e.won&&!e.tie).length}),(0,bs.jsx)("div",{className:"text-sm text-red-700",children:"Recent losses"})]}),(0,bs.jsx)("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:(0,bs.jsx)(ua,{className:"w-4 h-4 text-red-600"})})]})})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"Recent Form Analysis"}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700",children:["Last ",t.length," matches: ",Math.round(t.filter(e=>e.won).length/Math.max(t.filter(e=>!e.tie).length,1)*100),"% win rate (excluding draws)"]})]})]})})},Ma=e=>{let{matches:t,allUsers:s}=e;const[r,n]=(0,a.useState)(!1),[i,l]=(0,a.useState)("all"),o=t.filter(e=>"wins"===i?e.won:"losses"===i?!e.won&&!e.tie:"draws"!==i||e.tie),c=r?o:o.slice(0,15);return(0,bs.jsx)("div",{className:"space-y-4",children:0===t.length?(0,bs.jsxs)("div",{className:"text-center py-8",children:[(0,bs.jsx)(Ls,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"No match history available"}),(0,bs.jsx)("p",{className:"text-xs text-gray-400",children:"Your match history will appear here as you play"})]}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("div",{className:"flex space-x-2 mb-4",children:[{key:"all",label:"All",count:t.length},{key:"wins",label:"Wins",count:t.filter(e=>e.won).length},{key:"losses",label:"Losses",count:t.filter(e=>!e.won&&!e.tie).length},{key:"draws",label:"Draws",count:t.filter(e=>e.tie).length}].map(e=>{let{key:t,label:s,count:a}=e;return(0,bs.jsxs)("button",{onClick:()=>l(t),className:"px-3 py-1 text-sm rounded-full transition-colors ".concat(i===t?"bg-[#5D1F1F] text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[s," (",a,")"]},t)})}),(0,bs.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2 pr-2",children:c.map((e,t)=>{var s;return(0,bs.jsx)("div",{className:"border rounded-lg p-3 transition-all duration-200 hover:shadow-md ".concat(e.tie?"border-gray-200 bg-gray-50/30":e.won?"border-green-200 bg-green-50/30":"border-red-200 bg-red-50/30"),children:(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,bs.jsx)("div",{className:"px-2 py-1 text-xs font-bold rounded ".concat(e.tie?"bg-gray-500 text-white":e.won?"bg-green-500 text-white":"bg-red-500 text-white"),children:e.tie?"D":e.won?"W":"L"}),(0,bs.jsx)("span",{className:"text-xs text-gray-600",children:new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.seasonName&&(0,bs.jsx)("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:e.seasonName})]}),(0,bs.jsx)("div",{className:"text-sm",children:(0,bs.jsxs)("div",{className:"flex items-center space-x-1 text-gray-700",children:[e.partnerName&&(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("span",{children:"with"}),(0,bs.jsx)("span",{className:"font-medium",children:e.partnerName}),(0,bs.jsx)("span",{children:"\u2022"})]}),(0,bs.jsx)("span",{children:"vs"}),(0,bs.jsx)("span",{className:"font-medium",children:(null===(s=e.opponentNames)||void 0===s?void 0:s.length)>0?e.opponentNames.join(" & "):"Unknown opponents"})]})})]}),(0,bs.jsxs)("div",{className:"text-right ml-3",children:[(0,bs.jsx)("div",{className:"text-lg font-bold ".concat(e.tie?"text-gray-600":e.won?"text-green-600":"text-red-600"),children:e.score}),e.eloImpact&&(0,bs.jsxs)("div",{className:"text-xs font-bold ".concat(e.eloImpact.change>0?"text-green-600":e.eloImpact.change<0?"text-red-600":"text-gray-600"),children:[e.eloImpact.change>0?"+":"",e.eloImpact.change]})]})]})},t)})}),o.length>15&&(0,bs.jsx)("div",{className:"text-center pt-3 border-t border-gray-100",children:(0,bs.jsx)("button",{onClick:()=>n(!r),className:"text-sm text-[#5D1F1F] hover:text-red-800 font-medium transition-colors",children:r?"Show less \u2191":"View all ".concat(o.length," ").concat(i," matches \u2193")})})]})})},Ia=e=>{let{records:t,allUsers:s}=e;const[r,n]=(0,a.useState)(!1),i=r?t:t.slice(0,5);return 0===t.length?(0,bs.jsxs)("div",{className:"text-center py-8",children:[(0,bs.jsx)(pa,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"No head-to-head data available"}),(0,bs.jsx)("p",{className:"text-xs text-gray-400",children:"Face opponents multiple times to see detailed records"})]}):(0,bs.jsxs)("div",{className:"space-y-3",children:[i.map((e,t)=>{const s=e.wins+e.losses+(e.draws||0),a=e.wins+e.losses,r=(a>0&&Math.round(e.wins/a*100),e.totalGames>0?Math.round(e.gamesWon/e.totalGames*100):0);return(0,bs.jsx)("div",{className:"group hover:bg-gray-50 rounded-lg p-3 transition-colors",children:(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ".concat(r>=60?"bg-green-100 text-green-600":r>=40?"bg-yellow-100 text-yellow-600":"bg-red-100 text-red-600"),children:r>=60?"\ud83d\udcaa":r>=40?"\u2696\ufe0f":"\ud83d\udd25"}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,bs.jsxs)("div",{className:"text-xs text-gray-500",children:[s," matches played",e.draws>0&&" (".concat(e.draws," draws)")]})]})]}),(0,bs.jsxs)("div",{className:"text-right min-w-0 flex-shrink-0",children:[(0,bs.jsxs)("div",{className:"mb-2",children:[(0,bs.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:[e.wins,"W - ",e.losses,"L",e.draws>0?" - ".concat(e.draws,"D"):""]}),(0,bs.jsxs)("div",{className:"text-xs text-gray-500",children:[e.gamesWon,"G - ",e.gamesLost,"G (",e.totalGames," total)"]})]}),(0,bs.jsxs)("div",{className:"flex items-center justify-end space-x-2 mb-1",children:[(0,bs.jsx)("span",{className:"text-xs text-gray-600",children:"Game win rate:"}),(0,bs.jsxs)("span",{className:"text-sm font-bold ".concat(r>=60?"text-green-600":r>=40?"text-yellow-600":"text-red-600"),children:[r,"%"]})]}),(0,bs.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-1.5 ml-auto",children:(0,bs.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-700 ".concat(r>=60?"bg-green-500":r>=40?"bg-yellow-500":"bg-red-500"),style:{width:"".concat(r,"%")}})})]})]})},t)}),t.length>5&&(0,bs.jsx)("div",{className:"text-center pt-2 border-t border-gray-100",children:(0,bs.jsx)("button",{onClick:()=>n(!r),className:"text-sm text-[#5D1F1F] hover:text-red-800 font-medium transition-colors",children:r?"Show less \u2191":"View all ".concat(t.length," opponents \u2193")})})]})},La=e=>{let{type:t,stats:s,winStreaks:a,matchHistory:r,eloData:n,allUsers:i,onClose:l}=e;return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-y-auto",children:[(0,bs.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[(0,bs.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Statistics Details"}),(0,bs.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,bs.jsx)(Es,{className:"w-6 h-6"})})]}),(0,bs.jsx)("div",{className:"p-6",children:(()=>{switch(t){case"matches":const e=r.filter(e=>e.won).slice(0,5);return(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Match Wins"}),(0,bs.jsx)("div",{className:"grid gap-3",children:e.map((e,t)=>{var s;return(0,bs.jsx)("div",{className:"border border-green-200 bg-green-50 rounded-lg p-3",children:(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900",children:e.score}),(0,bs.jsxs)("div",{className:"text-sm text-gray-600",children:["with ",e.partnerName," vs ",null===(s=e.opponentNames)||void 0===s?void 0:s.join(" & ")]}),(0,bs.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.date).toLocaleDateString()})]}),(0,bs.jsx)("div",{className:"px-2 py-1 bg-green-500 text-white text-xs font-bold rounded",children:"WIN"})]})},t)})}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"Match Statistics"}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700 space-y-1",children:[(0,bs.jsxs)("div",{children:["Total Matches: ",s.totalMatches||0]}),(0,bs.jsxs)("div",{children:["Wins: ",s.matchesWon||0]}),(0,bs.jsxs)("div",{children:["Draws: ",s.matchesDrawn||0]}),(0,bs.jsxs)("div",{children:["Losses: ",s.matchesLost||0]}),(0,bs.jsxs)("div",{children:["Win Rate: ",Math.round((s.matchesWon||0)/Math.max(s.totalMatches||1,1)*100),"%"]})]})]})]});case"matchWinRate":return(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Match Win Rate Analysis"}),(0,bs.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-2xl font-bold text-green-600",children:s.matchesWon||0}),(0,bs.jsx)("div",{className:"text-sm text-green-700",children:"Wins"})]}),(0,bs.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-2xl font-bold text-red-600",children:s.matchesLost||0}),(0,bs.jsx)("div",{className:"text-sm text-red-700",children:"Losses"})]})]}),(0,bs.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:s.matchesDrawn||0}),(0,bs.jsx)("div",{className:"text-sm text-gray-700",children:"Draws"})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"Performance Breakdown"}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700",children:["Total matches played: ",s.totalMatches||0,(0,bs.jsx)("br",{}),"Win rate (including draws): ",Math.round((s.matchesWon||0)/Math.max(s.totalMatches||1,1)*100),"%",(0,bs.jsx)("br",{}),"Win rate (excluding draws): ",Math.round((s.matchesWon||0)/Math.max((s.matchesWon||0)+(s.matchesLost||0),1)*100),"%"]})]})]});case"combinedElo":return(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"ELO Rating History"}),(0,bs.jsxs)("div",{className:"text-center p-8 rounded-lg bg-purple-50 border border-purple-200",children:[(0,bs.jsx)("div",{className:"text-6xl font-bold text-purple-600 mb-2",children:Math.round(n.currentRating||0)}),(0,bs.jsx)("div",{className:"text-lg text-purple-700",children:"Current ELO Rating"}),n.rankingPosition&&(0,bs.jsxs)("div",{className:"text-sm text-purple-600 mt-2",children:["#",n.rankingPosition," in season"]})]}),(0,bs.jsxs)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-900",children:"Recent ELO Changes"}),0===n.recentChanges.length?(0,bs.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No recent ELO changes available"}):n.recentChanges.map((e,t)=>{var s;const a=r.find(t=>{var s;return(null===(s=t.eloImpact)||void 0===s?void 0:s.change)===e.change&&Math.abs(new Date(t.date)-new Date(e.date))<864e5});return(0,bs.jsx)("div",{className:"border rounded-lg p-3 ".concat(e.change>0?"border-green-200 bg-green-50":e.change<0?"border-red-200 bg-red-50":"border-gray-200 bg-gray-50"),children:(0,bs.jsx)("div",{className:"flex justify-between items-center",children:(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,bs.jsxs)("span",{className:"text-lg font-bold ".concat(e.change>0?"text-green-600":e.change<0?"text-red-600":"text-gray-600"),children:[e.change>0?"+":"",e.change]}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:[e.oldRating," \u2192 ",e.newRating]})]}),a&&(0,bs.jsxs)("div",{className:"text-sm text-gray-600",children:["vs ",(null===(s=a.opponentNames)||void 0===s?void 0:s.join(" & "))||"Unknown",a.partnerName&&" (with ".concat(a.partnerName,")")]}),e.score&&(0,bs.jsxs)("div",{className:"text-sm text-gray-600",children:["Score: ",e.score]}),(0,bs.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.date).toLocaleDateString()})]})})},e.id)})]})]});case"combinedMatch":return(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Match Performance Details"}),(0,bs.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,bs.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[(0,bs.jsx)("div",{className:"text-3xl font-bold text-green-600",children:s.matchesWon||0}),(0,bs.jsx)("div",{className:"text-sm text-green-700",children:"Wins"})]}),(0,bs.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[(0,bs.jsx)("div",{className:"text-3xl font-bold text-red-600",children:s.matchesLost||0}),(0,bs.jsx)("div",{className:"text-sm text-red-700",children:"Losses"})]}),(0,bs.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[(0,bs.jsx)("div",{className:"text-3xl font-bold text-gray-600",children:s.matchesDrawn||0}),(0,bs.jsx)("div",{className:"text-sm text-gray-700",children:"Draws"})]})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"Performance Analysis"}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700 space-y-1",children:[(0,bs.jsxs)("div",{children:["Total matches played: ",s.totalMatches||0]}),(0,bs.jsxs)("div",{children:["Win rate (including draws): ",Math.round((s.matchesWon||0)/Math.max(s.totalMatches||1,1)*100),"%"]}),(0,bs.jsxs)("div",{children:["Win rate (excluding draws): ",Math.round((s.matchesWon||0)/Math.max((s.matchesWon||0)+(s.matchesLost||0),1)*100),"%"]})]})]})]});case"combinedGame":return(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Game Performance Details"}),(0,bs.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[(0,bs.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:s.gamesWon||0}),(0,bs.jsx)("div",{className:"text-sm text-blue-700",children:"Games Won"})]}),(0,bs.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[(0,bs.jsx)("div",{className:"text-3xl font-bold text-gray-600",children:(s.totalGames||0)-(s.gamesWon||0)}),(0,bs.jsx)("div",{className:"text-sm text-gray-700",children:"Games Lost"})]})]}),(0,bs.jsxs)("div",{className:"text-center p-6 rounded-lg bg-gradient-to-r from-blue-50 to-teal-50 border border-blue-200",children:[(0,bs.jsxs)("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:[Math.round(100*(s.gameWinRate||0)),"%"]}),(0,bs.jsx)("div",{className:"text-lg text-blue-700",children:"Overall Game Win Rate"})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"Game Statistics"}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700 space-y-1",children:[(0,bs.jsxs)("div",{children:["Total games played: ",s.totalGames||0]}),(0,bs.jsxs)("div",{children:["Games won: ",s.gamesWon||0]}),(0,bs.jsxs)("div",{children:["Games lost: ",(s.totalGames||0)-(s.gamesWon||0)]}),(0,bs.jsxs)("div",{children:["Average games per match: ",s.totalMatches>0?Math.round((s.totalGames||0)/s.totalMatches):0]})]})]})]});case"combinedStreak":return(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Streak Analysis"}),(0,bs.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{className:"text-center p-6 rounded-lg border ".concat("win"===a.currentType?"bg-green-50 border-green-200":"loss"===a.currentType?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"),children:[(0,bs.jsx)("div",{className:"text-4xl font-bold mb-2 ".concat("win"===a.currentType?"text-green-600":"loss"===a.currentType?"text-red-600":"text-gray-600"),children:a.current||0}),(0,bs.jsxs)("div",{className:"text-lg ".concat("win"===a.currentType?"text-green-700":"loss"===a.currentType?"text-red-700":"text-gray-700"),children:["Current ","win"===a.currentType?"winning":"loss"===a.currentType?"losing":""," streak"]})]}),(0,bs.jsxs)("div",{className:"text-center p-6 rounded-lg bg-orange-50 border border-orange-200",children:[(0,bs.jsx)("div",{className:"text-4xl font-bold text-orange-600 mb-2",children:a.longest||0}),(0,bs.jsx)("div",{className:"text-lg text-orange-700",children:"Best winning streak"})]})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"Streak Progress"}),(0,bs.jsx)("div",{className:"text-xs text-blue-700",children:"win"===a.currentType&&a.current===a.longest&&a.current>0?"You're currently on your best winning streak!":"win"===a.currentType?"".concat(Math.max((a.longest||0)-(a.current||0),0)," wins away from your best streak"):"Your best winning streak was ".concat(a.longest||0," consecutive wins")})]})]});case"currentStreak":case"bestStreak":const i="currentStreak"===t,l=i?a.current:a.longest,o=i?a.currentType:"win";return(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:i?"Current Streak":"Best Winning Streak"}),(0,bs.jsxs)("div",{className:"text-center p-8 rounded-lg ".concat("win"===o?"bg-green-50 border border-green-200":"loss"===o?"bg-red-50 border border-red-200":"bg-gray-50 border border-gray-200"),children:[(0,bs.jsx)("div",{className:"text-6xl font-bold mb-2 ".concat("win"===o?"text-green-600":"loss"===o?"text-red-600":"text-gray-600"),children:l||0}),(0,bs.jsx)("div",{className:"text-lg ".concat("win"===o?"text-green-700":"loss"===o?"text-red-700":"text-gray-700"),children:i?"Current ".concat("win"===o?"winning":"loss"===o?"losing":""," streak"):"Best winning streak"})]}),i&&(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"Streak History"}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700",children:["Current streak: ",a.current||0," ","win"===a.currentType?"wins":"losses",(0,bs.jsx)("br",{}),"Best winning streak: ",a.longest||0," consecutive wins"]})]})]});case"eloRating":return(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"ELO Rating Details"}),(0,bs.jsxs)("div",{className:"text-center p-8 rounded-lg bg-purple-50 border border-purple-200",children:[(0,bs.jsx)("div",{className:"text-6xl font-bold text-purple-600 mb-2",children:Math.round(n.currentRating||0)}),(0,bs.jsx)("div",{className:"text-lg text-purple-700",children:"Current ELO Rating"}),n.rankingPosition&&(0,bs.jsxs)("div",{className:"text-sm text-purple-600 mt-2",children:["#",n.rankingPosition," in season"]})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"About ELO Rating"}),(0,bs.jsx)("div",{className:"text-xs text-blue-700",children:"ELO is a skill-based rating system that adjusts based on match results and opponent strength. Higher ratings indicate stronger players. The system accounts for the skill level of your opponents when calculating rating changes."})]})]});case"eloHistory":return(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent ELO Changes"}),0===n.recentChanges.length?(0,bs.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No recent ELO changes available"}):(0,bs.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:n.recentChanges.map((e,t)=>(0,bs.jsx)("div",{className:"border rounded-lg p-3 ".concat(e.change>0?"border-green-200 bg-green-50":e.change<0?"border-red-200 bg-red-50":"border-gray-200 bg-gray-50"),children:(0,bs.jsx)("div",{className:"flex justify-between items-center",children:(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsxs)("span",{className:"text-lg font-bold ".concat(e.change>0?"text-green-600":e.change<0?"text-red-600":"text-gray-600"),children:[e.change>0?"+":"",e.change]}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:[e.oldRating," \u2192 ",e.newRating]})]}),e.score&&(0,bs.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Match result: ",e.score]}),(0,bs.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.date).toLocaleDateString()})]})})},e.id))}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"ELO Change History"}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700",children:["Showing your last ",n.recentChanges.length," ELO rating changes. Positive changes indicate rating gains, negative changes indicate rating losses."]})]})]});default:return(0,bs.jsx)("div",{children:"Details not available"})}})()})]})})},Ua=e=>{var t;let{match:s,allUsers:a,onClose:r}=e;return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[(0,bs.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-lg",children:[(0,bs.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Match Details"}),(0,bs.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,bs.jsx)(Es,{className:"w-6 h-6"})})]}),(0,bs.jsxs)("div",{className:"p-6 space-y-4",children:[(0,bs.jsxs)("div",{className:"text-center p-6 rounded-lg ".concat(s.tie?"bg-gray-50 border border-gray-200":s.won?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:[(0,bs.jsx)("div",{className:"text-3xl font-bold mb-2 ".concat(s.tie?"text-gray-600":s.won?"text-green-600":"text-red-600"),children:s.score}),(0,bs.jsx)("div",{className:"px-3 py-1 text-sm font-bold rounded-full inline-block ".concat(s.tie?"bg-gray-500 text-white":s.won?"bg-green-500 text-white":"bg-red-500 text-white"),children:s.tie?"DRAW":s.won?"WIN":"LOSS"}),s.eloImpact&&(0,bs.jsxs)("div",{className:"mt-2 text-lg font-bold ".concat(s.eloImpact.change>0?"text-green-600":s.eloImpact.change<0?"text-red-600":"text-gray-600"),children:["ELO ",s.eloImpact.change>0?"+":"",s.eloImpact.change]})]}),(0,bs.jsxs)("div",{className:"space-y-3",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,bs.jsx)(Ls,{className:"w-4 h-4 text-gray-400"}),(0,bs.jsx)("span",{className:"text-gray-600",children:"Date:"}),(0,bs.jsx)("span",{className:"font-medium",children:new Date(s.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})]}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,bs.jsx)(qs,{className:"w-4 h-4 text-gray-400"}),(0,bs.jsx)("span",{className:"text-gray-600",children:"Partner:"}),(0,bs.jsx)("span",{className:"font-medium",children:s.partnerName||"Unknown"})]}),(0,bs.jsxs)("div",{className:"flex items-start space-x-2 text-sm",children:[(0,bs.jsx)(pa,{className:"w-4 h-4 text-gray-400 mt-0.5"}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("span",{className:"text-gray-600",children:"Opponents:"}),(0,bs.jsx)("div",{className:"font-medium",children:(null===(t=s.opponentNames)||void 0===t?void 0:t.length)>0?s.opponentNames.map((e,t)=>(0,bs.jsx)("div",{className:"leading-tight",children:e||"Unknown"},t)):(0,bs.jsx)("div",{children:"Unknown opponents"})})]})]}),s.courtNumber&&(0,bs.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,bs.jsx)("div",{className:"w-4 h-4 bg-gray-400 rounded-sm"}),(0,bs.jsx)("span",{className:"text-gray-600",children:"Court:"}),(0,bs.jsxs)("span",{className:"font-medium",children:["Court ",s.courtNumber]})]}),s.seasonName&&(0,bs.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,bs.jsx)(Is,{className:"w-4 h-4 text-gray-400"}),(0,bs.jsx)("span",{className:"text-gray-600",children:"Season:"}),(0,bs.jsx)("span",{className:"font-medium",children:s.seasonName})]}),s.isLeagueMatch&&s.opponentClub&&(0,bs.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,bs.jsx)("div",{className:"w-4 h-4 bg-blue-400 rounded-sm"}),(0,bs.jsx)("span",{className:"text-gray-600",children:"League Match vs:"}),(0,bs.jsx)("span",{className:"font-medium",children:s.opponentClub})]})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"Performance"}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700 space-y-1",children:[(0,bs.jsxs)("div",{children:["Your score: ",s.playerScore," games"]}),(0,bs.jsxs)("div",{children:["Opponents' score: ",s.opponentScore," games"]}),(0,bs.jsxs)("div",{children:["Total games: ",s.playerScore+s.opponentScore]}),s.playerScore+s.opponentScore>0&&(0,bs.jsxs)("div",{children:["Your game win rate: ",Math.round(s.playerScore/(s.playerScore+s.opponentScore)*100),"%"]}),s.eloImpact&&(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsxs)("div",{children:["ELO before: ",s.eloImpact.oldRating]}),(0,bs.jsxs)("div",{children:["ELO after: ",s.eloImpact.newRating]}),(0,bs.jsxs)("div",{children:["ELO change: ",s.eloImpact.change>0?"+":"",s.eloImpact.change]})]})]})]})]})]})})},za=e=>{let{currentUser:t,seasons:s=[],selectedSeason:r=null,allUsers:n=[],selectedPlayerId:i=null,onPlayerSelect:l=null,onPlayerClear:o=null}=e;const[d,u]=(0,a.useState)("current"),[h,m]=(0,a.useState)(null===r||void 0===r?void 0:r.id),[p,g]=(0,a.useState)(null),[x,f]=(0,a.useState)(null),y=i||(null===t||void 0===t?void 0:t.id),b=n.find(e=>e.id===y)||t,v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const[n,i]=(0,a.useState)({matchHistory:[],overallStats:{},bestPartners:[],nemesisOpponent:null,nemesisPair:null,winStreaks:{},formGuide:[],headToHeadRecords:[],seasonProgression:[],eloData:{currentRating:null,recentChanges:[],rankingPosition:null},loading:!0,error:null}),l=(0,a.useCallback)(async()=>{if(e)try{i(e=>c(c({},e),{},{loading:!0,error:null}));const{data:a,error:n}=await is.from("match_fixtures").select("\n          id,\n          match_id,\n          court_number,\n          game_number,\n          match_format,\n          player1_id,\n          player2_id,\n          player3_id,\n          player4_id,\n          pair1_player1_id,\n          pair1_player2_id,\n          pair2_player1_id,\n          pair2_player2_id,\n          match_results (\n            id,\n            pair1_score,\n            pair2_score,\n            created_at\n          ),\n          matches!match_fixtures_match_id_fkey (\n            id,\n            season_id,\n            match_date,\n            seasons (\n              id,\n              name,\n              season_type\n            )\n          )\n        ").or("pair1_player1_id.eq.".concat(e,",pair1_player2_id.eq.").concat(e,",pair2_player1_id.eq.").concat(e,",pair2_player2_id.eq.").concat(e,",player1_id.eq.").concat(e,",player2_id.eq.").concat(e)).not("match_results","is",null);if(n)throw n;const{data:l,error:o}=await is.from("league_match_rubbers").select("\n          id,\n          rubber_number,\n          cawood_player1_id,\n          cawood_player2_id,\n          opponent_player1_id,\n          opponent_player2_id,\n          cawood_games_won,\n          opponent_games_won,\n          created_at,\n          match_fixture:match_fixture_id (\n            id,\n            court_number,\n            match_id,\n            opponent_club,\n            matches:match_id (\n              id,\n              season_id,\n              match_date,\n              seasons (\n                id,\n                name\n              )\n            )\n          ),\n          opponent_player1:opponent_player1_id (\n            id,\n            name\n          ),\n          opponent_player2:opponent_player2_id (\n            id,\n            name\n          )\n        ").or("cawood_player1_id.eq.".concat(e,",cawood_player2_id.eq.").concat(e));if(o)throw o;let d={currentRating:null,startingRating:null,minRating:null,seasonEloChange:null,maxEloChange:null,recentChanges:[],rankingPosition:null,seasonPlayerId:null};if(t){const{data:s,error:a}=await is.from("season_players").select("id, elo_rating").eq("player_id",e).eq("season_id",t).single();if(!a&&s){d.currentRating=s.elo_rating;const{data:e,error:a}=await is.from("elo_history").select("\n              id,\n              old_rating,\n              new_rating,\n              rating_change,\n              match_fixture_id,\n              created_at,\n              match_fixtures:match_fixture_id (\n                id,\n                match_results (\n                  pair1_score,\n                  pair2_score\n                ),\n                matches:match_id (\n                  match_date\n                )\n              )\n            ").eq("season_player_id",s.id).order("created_at",{ascending:!1}).limit(12);!a&&e&&(d.recentChanges=e.map(e=>{var t,s,a,r;return{id:e.id,oldRating:e.old_rating,newRating:e.new_rating,change:e.rating_change,date:e.created_at,matchDate:null===(t=e.match_fixtures)||void 0===t||null===(s=t.matches)||void 0===s?void 0:s.match_date,score:null!==(a=e.match_fixtures)&&void 0!==a&&null!==(r=a.match_results)&&void 0!==r&&r[0]?"".concat(e.match_fixtures.match_results[0].pair1_score,"-").concat(e.match_fixtures.match_results[0].pair2_score):null}}));const{data:r,error:n}=await is.from("elo_history").select("old_rating, new_rating, created_at").eq("season_player_id",s.id).order("created_at",{ascending:!0});if(!n&&r&&r.length>0){d.startingRating=r[0].old_rating;let e=r[0].old_rating;r.forEach(t=>{e=Math.min(e,t.old_rating,t.new_rating)}),d.minRating=e,d.currentRating&&d.minRating&&(d.maxEloChange=d.currentRating-d.minRating),d.startingRating&&d.currentRating&&(d.seasonEloChange=d.currentRating-d.startingRating)}else{const{data:e}=await is.from("seasons").select("elo_initial_rating").eq("id",t).single();d.startingRating=(null===e||void 0===e?void 0:e.elo_initial_rating)||1200,d.minRating=d.currentRating||d.startingRating,d.maxEloChange=0,d.seasonEloChange=0}d.seasonPlayerId=s.id}const{data:r,error:n}=await is.from("season_players").select("elo_rating").eq("season_id",t).not("elo_rating","is",null).gt("elo_rating",d.currentRating||0);!n&&r&&(d.rankingPosition=r.length+1)}else if(s){const{data:t,error:s}=await is.from("season_players").select("id, elo_rating, season_id").eq("player_id",e).not("elo_rating","is",null).order("season_id",{ascending:!1}).limit(1);if(!s&&t&&t.length>0){const e=t[0];d.currentRating=e.elo_rating,d.seasonPlayerId=e.id}const{data:a,error:r}=await is.from("elo_history").select("\n            id,\n            old_rating,\n            new_rating,\n            rating_change,\n            match_fixture_id,\n            created_at,\n            season_players!inner (\n              player_id\n            ),\n            match_fixtures:match_fixture_id (\n              id,\n              match_results (\n                pair1_score,\n                pair2_score\n              ),\n              matches:match_id (\n                match_date\n              )\n            )\n          ").eq("season_players.player_id",e).order("created_at",{ascending:!1}).limit(12);!r&&a&&(d.recentChanges=a.map(e=>{var t,s,a,r;return{id:e.id,oldRating:e.old_rating,newRating:e.new_rating,change:e.rating_change,date:e.created_at,matchDate:null===(t=e.match_fixtures)||void 0===t||null===(s=t.matches)||void 0===s?void 0:s.match_date,score:null!==(a=e.match_fixtures)&&void 0!==a&&null!==(r=a.match_results)&&void 0!==r&&r[0]?"".concat(e.match_fixtures.match_results[0].pair1_score,"-").concat(e.match_fixtures.match_results[0].pair2_score):null}}))}const u=r.reduce((e,t)=>(e[t.id]=t.name,e),{}),h=a.filter(e=>{var a;return!(!s&&t&&(null===(a=e.matches)||void 0===a?void 0:a.season_id)!==t)&&e.match_results&&e.match_results.length>0}).map(t=>{var s,a,r,n,i,l;const o=t.match_results.find(e=>!0===e.verified)||t.match_results[0];if("singles"===t.match_format){var c,d,h,m,p,g;const s=t.player1_id===e,a=t.player2_id===e;if(!s&&!a)return null;const r=s?o.pair1_score:o.pair2_score,n=s?o.pair2_score:o.pair1_score,i=r>n,l=r===n,x=null,f=s?t.player2_id:t.player1_id,y=[f];return{fixtureId:t.id,matchId:t.match_id,date:(null===(c=t.matches)||void 0===c?void 0:c.match_date)||o.created_at,won:i,tie:l,score:"".concat(r," - ").concat(n),partnerId:x,partnerName:null,opponentIds:y,opponentNames:[u[f]||"Unknown"],playerScore:r,opponentScore:n,seasonId:null===(d=t.matches)||void 0===d?void 0:d.season_id,seasonName:null===(h=t.matches)||void 0===h||null===(m=h.seasons)||void 0===m?void 0:m.name,seasonType:null===(p=t.matches)||void 0===p||null===(g=p.seasons)||void 0===g?void 0:g.season_type,courtNumber:t.court_number,matchFormat:"singles"}}const x=t.pair1_player1_id===e||t.pair1_player2_id===e,f=t.pair2_player1_id===e||t.pair2_player2_id===e;if(!x&&!f)return null;const y=x?o.pair1_score:o.pair2_score,b=x?o.pair2_score:o.pair1_score,v=y>b,w=y===b;let j;j=x?t.pair1_player1_id===e?t.pair1_player2_id:t.pair1_player1_id:t.pair2_player1_id===e?t.pair2_player2_id:t.pair2_player1_id;const _=x?[t.pair2_player1_id,t.pair2_player2_id]:[t.pair1_player1_id,t.pair1_player2_id];return{fixtureId:t.id,matchId:t.match_id,date:(null===(s=t.matches)||void 0===s?void 0:s.match_date)||o.created_at,won:v,tie:w,score:"".concat(y," - ").concat(b),partnerId:j,partnerName:u[j]||"Unknown",opponentIds:_,opponentNames:_.map(e=>u[e]||"Unknown"),playerScore:y,opponentScore:b,seasonId:null===(a=t.matches)||void 0===a?void 0:a.season_id,seasonName:null===(r=t.matches)||void 0===r||null===(n=r.seasons)||void 0===n?void 0:n.name,seasonType:null===(i=t.matches)||void 0===i||null===(l=i.seasons)||void 0===l?void 0:l.season_type,courtNumber:t.court_number,matchFormat:"doubles"}}).filter(Boolean).sort((e,t)=>new Date(t.date)-new Date(e.date)),m=l.filter(e=>{var a,r;return!(!s&&t&&(null===(a=e.match_fixture)||void 0===a||null===(r=a.matches)||void 0===r?void 0:r.season_id)!==t)&&null!=e.cawood_games_won&&null!=e.opponent_games_won}).map(t=>{var s,a,r,n,i,l,o,c,d,h,m,p;const g=t.cawood_player1_id===e,x=t.cawood_player2_id===e;if(!g&&!x)return null;const f=t.cawood_games_won||0,y=t.opponent_games_won||0,b=f>y,v=f===y,w=g?t.cawood_player2_id:t.cawood_player1_id,j=[(null===(s=t.opponent_player1)||void 0===s?void 0:s.name)||"Unknown",(null===(a=t.opponent_player2)||void 0===a?void 0:a.name)||"Unknown"];return{fixtureId:t.id,matchId:null===(r=t.match_fixture)||void 0===r?void 0:r.match_id,date:(null===(n=t.match_fixture)||void 0===n||null===(i=n.matches)||void 0===i?void 0:i.match_date)||t.created_at,won:b,tie:v,score:"".concat(f," - ").concat(y),partnerId:w,partnerName:u[w]||"Unknown",opponentIds:[t.opponent_player1_id,t.opponent_player2_id],opponentNames:j,playerScore:f,opponentScore:y,seasonId:null===(l=t.match_fixture)||void 0===l||null===(o=l.matches)||void 0===o?void 0:o.season_id,seasonName:null===(c=t.match_fixture)||void 0===c||null===(d=c.matches)||void 0===d||null===(h=d.seasons)||void 0===h?void 0:h.name,courtNumber:null===(m=t.match_fixture)||void 0===m?void 0:m.court_number,isLeagueMatch:!0,opponentClub:null===(p=t.match_fixture)||void 0===p?void 0:p.opponent_club,rubberNumber:t.rubber_number}}).filter(Boolean).sort((e,t)=>new Date(t.date)-new Date(e.date)),p=[...h,...m].sort((e,t)=>new Date(t.date)-new Date(e.date));let g=p;if(t&&d.currentRating&&d.seasonPlayerId){const e=new Map,{data:t,error:s}=await is.from("elo_history").select("match_fixture_id, old_rating, new_rating, rating_change").eq("season_player_id",d.seasonPlayerId);!s&&t&&t.forEach(t=>{t.match_fixture_id&&e.set(t.match_fixture_id,{change:t.rating_change,oldRating:t.old_rating,newRating:t.new_rating})}),g=p.map(t=>{const s=e.get(t.fixtureId)||null;return c(c({},t),{},{eloImpact:s})})}const x=g.length,f=g.filter(e=>e.won).length,y=g.filter(e=>e.tie).length,b=g.filter(e=>!e.won&&!e.tie).length,v=x-y,w=v>0?f/v:0,j=g.reduce((e,t)=>e+t.playerScore+t.opponentScore,0),_=g.reduce((e,t)=>e+t.playerScore,0),N=j>0?_/j:0,k={};g.forEach(e=>{"singles"!==e.matchFormat&&e.partnerId&&(k[e.partnerId]||(k[e.partnerId]={playerId:e.partnerId,name:e.partnerName,totalGames:0,gamesWon:0,matches:0}),k[e.partnerId].totalGames+=e.playerScore+e.opponentScore,k[e.partnerId].gamesWon+=e.playerScore,k[e.partnerId].matches++)});const S=Object.values(k).map(e=>c(c({},e),{},{winRate:e.totalGames>0?e.gamesWon/e.totalGames:0})).filter(e=>e.totalGames>=10).sort((e,t)=>t.winRate-e.winRate),C={};g.forEach(e=>{e.opponentIds.forEach(t=>{if(t&&!C[t]){const s=e.isLeagueMatch?e.opponentNames[e.opponentIds.indexOf(t)]:u[t]||"Unknown";C[t]={playerId:t,name:s,totalGames:0,gamesWon:0,gamesLost:0,matches:0,wins:0,losses:0,draws:0}}t&&C[t]&&(C[t].totalGames+=e.playerScore+e.opponentScore,C[t].gamesWon+=e.playerScore,C[t].gamesLost+=e.opponentScore,C[t].matches++,e.won?C[t].wins++:e.tie?C[t].draws++:C[t].losses++)})});const E=Object.values(C).map(e=>c(c({},e),{},{winRate:e.totalGames>0?e.gamesWon/e.totalGames:0})).filter(e=>e.totalGames>=10).sort((e,t)=>e.winRate-t.winRate)[0],P={};g.forEach(e=>{if("singles"!==e.matchFormat&&e.opponentIds[1]&&e.opponentIds[0]&&e.opponentIds[1]){const t=e.opponentIds.sort().join("-");if(!P[t]){const s=e.isLeagueMatch?e.opponentNames[e.opponentIds.indexOf(e.opponentIds[0])]:u[e.opponentIds[0]]||"Unknown",a=e.isLeagueMatch?e.opponentNames[e.opponentIds.indexOf(e.opponentIds[1])]:u[e.opponentIds[1]]||"Unknown";P[t]={player1Id:e.opponentIds[0],player2Id:e.opponentIds[1],player1Name:s,player2Name:a,totalGames:0,gamesWon:0,gamesLost:0,matches:0}}P[t].totalGames+=e.playerScore+e.opponentScore,P[t].gamesWon+=e.playerScore,P[t].gamesLost+=e.opponentScore,P[t].matches++}});const T=Object.values(P).map(e=>c(c({},e),{},{winRate:e.totalGames>0?e.gamesWon/e.totalGames:0})).filter(e=>e.totalGames>=10).sort((e,t)=>e.winRate-t.winRate)[0],D=[...g].reverse();let A=0,O=null,F=0,R=0;D.forEach((e,t)=>{if(0===t)A=1,O=e.won?"win":"loss",e.won&&(R=1);else{const s=D[t-1];e.won===s.won?(A++,e.won&&R++):(R>F&&(F=R),A=1,O=e.won?"win":"loss",R=e.won?1:0)}}),R>F&&(F=R);const M=g.slice(0,10),I=Object.values(C).filter(e=>e.matches>1).sort((e,t)=>t.matches-e.matches);let L=[];if(s){const e={};g.forEach(t=>{e[t.seasonId]||(e[t.seasonId]={seasonId:t.seasonId,seasonName:t.seasonName,totalGames:0,gamesWon:0,matches:0,matchesWon:0}),e[t.seasonId].totalGames+=t.playerScore+t.opponentScore,e[t.seasonId].gamesWon+=t.playerScore,e[t.seasonId].matches++,t.won&&e[t.seasonId].matchesWon++}),L=Object.values(e).map(e=>c(c({},e),{},{winRate:e.totalGames>0?e.gamesWon/e.totalGames*100:0})).sort((e,t)=>new Date(e.seasonId)-new Date(t.seasonId))}i({matchHistory:g,overallStats:{totalGames:j,gamesWon:_,gameWinRate:N,totalMatches:x,matchesWon:f,matchesDrawn:y,matchesLost:b,matchWinRate:w},bestPartners:S,nemesisOpponent:E,nemesisPair:T,winStreaks:{current:A,currentType:O,longest:F},formGuide:M,headToHeadRecords:I,seasonProgression:L,eloData:d,loading:!1,error:null})}catch(A){console.error("Error calculating profile stats:",A),i(t=>c(c({},t),{},{loading:!1,error:A.message}))}},[e,t,s,r]);return(0,a.useEffect)(()=>{l()},[l]),(0,a.useEffect)(()=>{const e=()=>{l()};return window.addEventListener("refreshMatchData",e),()=>{window.removeEventListener("refreshMatchData",e)}},[l]),n}(y,"current"===d?null===r||void 0===r?void 0:r.id:"season"===d?h:null,"all-time"===d,n),{matchHistory:w=[],overallStats:j={},bestPartners:_=[],nemesisOpponent:N=null,nemesisPair:k=null,winStreaks:S={},formGuide:C=[],headToHeadRecords:E=[],seasonProgression:P=[],eloData:T={currentRating:null,recentChanges:[],rankingPosition:null},loading:D=!0,error:A=null}=v||{};return D?(0,bs.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,bs.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#5D1F1F]"})}):A?(0,bs.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,bs.jsxs)("p",{className:"text-red-600",children:["Error loading profile stats: ",A]})}):(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,bs.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:[(null===b||void 0===b?void 0:b.name)||"Unknown Player","'s Profile"]}),i&&i!==(null===t||void 0===t?void 0:t.id)&&(0,bs.jsx)("button",{onClick:()=>o&&o(),className:"text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-full transition-colors min-h-[44px]",style:{touchAction:"manipulation"},children:"View My Profile"})]}),(0,bs.jsx)("p",{className:"text-gray-600",children:"Performance statistics and match history"})]}),(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"Player:"}),(0,bs.jsx)("select",{value:y||"",onChange:e=>{const s=e.target.value;s===(null===t||void 0===t?void 0:t.id)?o&&o():l&&l(s)},className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent min-w-0",children:n.sort((e,s)=>e.id===(null===t||void 0===t?void 0:t.id)?-1:s.id===(null===t||void 0===t?void 0:t.id)?1:(e.name||"").localeCompare(s.name||"")).map(e=>(0,bs.jsxs)("option",{value:e.id,children:[e.name,e.id===(null===t||void 0===t?void 0:t.id)?" (You)":""]},e.id))})]}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"View:"}),(0,bs.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",children:[(0,bs.jsx)("option",{value:"current",children:"Current Season"}),(0,bs.jsx)("option",{value:"all-time",children:"All Time"}),s.length>1&&(0,bs.jsx)("option",{value:"season",children:"Select Season"})]}),"season"===d&&(0,bs.jsxs)("select",{value:h||"",onChange:e=>m(e.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",children:[(0,bs.jsx)("option",{value:"",children:"Select a season..."}),s.map(e=>(0,bs.jsxs)("option",{value:e.id,children:[e.name," (","league"===e.season_type?"League":"Ladder",")"]},e.id))]})]})]})]})}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6",children:[(T.currentRating||T.recentChanges.length>0)&&(0,bs.jsx)(Ea,{eloData:T,onClick:()=>g("combinedElo")}),(0,bs.jsx)(Pa,{stats:j,onClick:()=>g("combinedMatch")}),(0,bs.jsx)(Ta,{stats:j,onClick:()=>g("combinedGame")}),(0,bs.jsx)(Da,{winStreaks:S,onClick:()=>g("combinedStreak")})]}),p&&(0,bs.jsx)(La,{type:p,stats:j,winStreaks:S,matchHistory:w,eloData:T,allUsers:n,onClose:()=>g(null)}),P.length>1&&(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,bs.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,bs.jsx)(ka,{className:"w-5 h-5 mr-2 text-[#5D1F1F]"}),"Season Progression"]}),(0,bs.jsx)(Aa,{data:P})]}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,bs.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,bs.jsx)(qs,{className:"w-5 h-5 mr-2 text-[#5D1F1F]"}),"Best Partners"]}),(0,bs.jsx)(Oa,{partners:_,allUsers:n})]}),(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,bs.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,bs.jsx)(ua,{className:"w-5 h-5 mr-2 text-red-600"}),"Nemesis Analysis"]}),(0,bs.jsx)(Fa,{nemesisOpponent:N,nemesisPair:k,allUsers:n})]})]}),(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,bs.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,bs.jsx)(da,{className:"w-5 h-5 mr-2 text-[#5D1F1F]"}),"Recent Form (Last 10 Matches)"]}),(0,bs.jsx)(Ra,{matches:C,allUsers:n,onMatchClick:e=>f(e)})]}),(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,bs.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,bs.jsx)(Ls,{className:"w-5 h-5 mr-2 text-[#5D1F1F]"}),"Match History"]}),(0,bs.jsx)(Ma,{matches:w,allUsers:n})]}),E.length>0&&(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,bs.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,bs.jsx)(pa,{className:"w-5 h-5 mr-2 text-[#5D1F1F]"}),"Head-to-Head Records"]}),(0,bs.jsx)(Ia,{records:E.sort((e,t)=>{const s=e.totalGames>0?e.gamesWon/e.totalGames:0;return(t.totalGames>0?t.gamesWon/t.totalGames:0)-s}),allUsers:n})]}),x&&(0,bs.jsx)(Ua,{match:x,allUsers:n,onClose:()=>f(null)})]})},qa=fs("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Wa=e=>{var t,s;let{isOpen:r,onClose:n,onSave:i,trophy:l=null,seasons:o=[],allUsers:d=[],currentUser:u}=e;const[h,m]=(0,a.useState)({season_id:"",trophy_type:"gold_cup",competition_type:"custom",winner_player1_id:"",winner_player2_id:"",custom_title:"",engraving_text:"",position:1,awarded_date:(new Date).toISOString().split("T")[0],display_order:0,is_featured:!1,trophy_image_url:""}),[p,g]=(0,a.useState)({}),[x,f]=(0,a.useState)(!1),[y,b]=(0,a.useState)(null),v=[{value:"custom_image",label:"Custom Image",icon:"\ud83d\udcf7",description:"Upload your own trophy image"},{value:"gold_cup",label:"Gold Cup",icon:"\ud83c\udfc6",description:"Classic golden trophy cup"},{value:"silver_cup",label:"Silver Cup",icon:"\ud83e\udd48",description:"Silver trophy cup"},{value:"bronze_cup",label:"Bronze Cup",icon:"\ud83e\udd49",description:"Bronze trophy cup"},{value:"champion_cup",label:"Champion Cup",icon:"\ud83d\udc51",description:"Special champion trophy"},{value:"gold_shield",label:"Gold Shield",icon:"\ud83d\udee1\ufe0f",description:"Golden shield award"},{value:"silver_shield",label:"Silver Shield",icon:"\ud83d\udd30",description:"Silver shield award"},{value:"bronze_shield",label:"Bronze Shield",icon:"\ud83d\udee1\ufe0f",description:"Bronze shield award"},{value:"gold_star",label:"Gold Star",icon:"\u2b50",description:"Golden star award"},{value:"silver_star",label:"Silver Star",icon:"\u2728",description:"Silver star award"},{value:"bronze_star",label:"Bronze Star",icon:"\ud83c\udf1f",description:"Bronze star award"},{value:"diamond_cup",label:"Diamond Cup",icon:"\ud83d\udc8e",description:"Premium diamond trophy"},{value:"platinum_shield",label:"Platinum Shield",icon:"\u26a1",description:"Exclusive platinum shield"}],w=[{value:"singles_winner",label:"Singles Winner"},{value:"doubles_winner",label:"Doubles Winner"},{value:"league_winner",label:"League Winner"},{value:"tournament_winner",label:"Tournament Winner"},{value:"season_champion",label:"Season Champion"},{value:"best_player",label:"Best Player"},{value:"most_improved",label:"Most Improved"},{value:"sportsmanship",label:"Sportsmanship Award"},{value:"participation",label:"Participation Award"},{value:"custom",label:"Custom Achievement"}];(0,a.useEffect)(()=>{r&&(m(l?{season_id:l.season_id||"",trophy_type:l.trophy_type||"gold_cup",competition_type:l.competition_type||"custom",winner_player1_id:l.winner_player1_id||"",winner_player2_id:l.winner_player2_id||"",custom_title:l.custom_title||"",engraving_text:l.engraving_text||"",position:l.position||1,awarded_date:l.awarded_date||(new Date).toISOString().split("T")[0],display_order:l.display_order||0,is_featured:l.is_featured||!1,trophy_image_url:l.trophy_image_url||""}:{season_id:"",trophy_type:"custom_image",competition_type:"custom",winner_player1_id:"",winner_player2_id:"",custom_title:"",engraving_text:"",position:1,awarded_date:(new Date).toISOString().split("T")[0],display_order:0,is_featured:!1,trophy_image_url:""}),g({}),b(null))},[r,l]);const j=(e,t)=>{m(s=>c(c({},s),{},{[e]:t})),p[e]&&g(t=>c(c({},t),{},{[e]:""}))},_=()=>{const e=w.find(e=>e.value===h.competition_type);return(null===e||void 0===e?void 0:e.label)||"Achievement"},N=v.find(e=>e.value===h.trophy_type);return r?(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,bs.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-lg",children:[(0,bs.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[(0,bs.jsx)(Is,{className:"w-6 h-6 text-yellow-500"}),l?"Edit Trophy":"Add New Trophy"]}),(0,bs.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,bs.jsx)(Es,{className:"w-6 h-6"})})]}),(0,bs.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!(()=>{var e;const t={};return h.season_id||(t.season_id="Season is required"),h.winner_player1_id||(t.winner_player1_id="At least one winner is required"),null!==(e=h.custom_title)&&void 0!==e&&e.trim()||"custom"!==h.competition_type||(t.custom_title="Custom title is required for custom achievements"),"doubles_winner"!==h.competition_type||h.winner_player2_id||(t.winner_player2_id="Second player is required for doubles awards"),"custom_image"!==h.trophy_type||y||h.trophy_image_url||(t.trophy_image="Trophy image is required for custom image type"),g(t),0===Object.keys(t).length})())return;const t=c({},h);"custom_image"===h.trophy_type&&y&&(t.trophy_image_url=y);(await i(t)).success&&n()},className:"p-6 space-y-6",children:[x&&(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-6 text-center border-2 border-dashed border-gray-300",children:[(0,bs.jsx)("div",{className:"mb-4",children:"custom_image"===h.trophy_type&&y?(0,bs.jsx)("img",{src:y,alt:"Custom trophy preview",className:"mx-auto max-h-24 w-24 object-contain rounded-lg border border-gray-200"}):(0,bs.jsx)("div",{className:"text-6xl",children:null===N||void 0===N?void 0:N.icon})}),(0,bs.jsxs)("div",{className:"bg-gradient-to-r from-amber-100 to-yellow-100 border border-amber-200 rounded-lg p-4 mb-4",children:[(0,bs.jsx)("h3",{className:"font-bold text-gray-900 text-xl",children:h.custom_title||_()}),h.engraving_text&&(0,bs.jsxs)("p",{className:"text-gray-700 italic mt-2",children:['"',h.engraving_text,'"']})]}),(0,bs.jsxs)("div",{className:"text-gray-600",children:["Winner: ",(null===(t=d.find(e=>e.id===h.winner_player1_id))||void 0===t?void 0:t.name)||"Select winner",h.winner_player2_id&&(0,bs.jsxs)(bs.Fragment,{children:[" & ",null===(s=d.find(e=>e.id===h.winner_player2_id))||void 0===s?void 0:s.name]})]})]}),(0,bs.jsx)("div",{className:"text-center",children:(0,bs.jsx)("button",{type:"button",onClick:()=>f(!x),className:"text-sm bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:x?"Hide Preview":"Show Preview"})}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Season *"}),(0,bs.jsxs)("select",{value:h.season_id,onChange:e=>j("season_id",e.target.value),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent ".concat(p.season_id?"border-red-300":"border-gray-300"),children:[(0,bs.jsx)("option",{value:"",children:"Select Season"}),o.map(e=>(0,bs.jsxs)("option",{value:e.id,children:[e.name," (","league"===e.season_type?"League":"Ladder",")"]},e.id))]}),p.season_id&&(0,bs.jsx)("p",{className:"text-red-600 text-sm mt-1",children:p.season_id})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Trophy Type"}),(0,bs.jsx)("select",{value:h.trophy_type,onChange:e=>j("trophy_type",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",children:v.map(e=>(0,bs.jsxs)("option",{value:e.value,children:[e.icon," ",e.label]},e.value))}),(0,bs.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:null===N||void 0===N?void 0:N.description})]}),"custom_image"===h.trophy_type&&(0,bs.jsxs)("div",{className:"col-span-2",children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Trophy Image *"}),(0,bs.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:y?(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)("img",{src:y,alt:"Trophy preview",className:"mx-auto max-h-32 rounded-lg shadow-sm"}),(0,bs.jsx)("button",{type:"button",onClick:()=>{b(null),j("trophy_image_url","")},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-600 transition-colors",children:"\xd7"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Click \xd7 to remove image"})]}):(0,bs.jsxs)("div",{children:[(0,bs.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,bs.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,bs.jsxs)("div",{className:"mt-4",children:[(0,bs.jsxs)("label",{htmlFor:"trophy-image",className:"cursor-pointer",children:[(0,bs.jsx)("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"Upload trophy image"}),(0,bs.jsx)("span",{className:"block text-xs text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]}),(0,bs.jsx)("input",{id:"trophy-image",type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{b(e.target.result)},e.readAsDataURL(t)}},className:"sr-only"})]})]})}),p.trophy_image&&(0,bs.jsx)("p",{className:"text-red-600 text-sm mt-1",children:p.trophy_image})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Award Type"}),(0,bs.jsx)("select",{value:h.competition_type,onChange:e=>j("competition_type",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",children:w.map(e=>(0,bs.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Position"}),(0,bs.jsxs)("select",{value:h.position,onChange:e=>j("position",parseInt(e.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",children:[(0,bs.jsx)("option",{value:1,children:"1st Place"}),(0,bs.jsx)("option",{value:2,children:"2nd Place"}),(0,bs.jsx)("option",{value:3,children:"3rd Place"}),(0,bs.jsx)("option",{value:4,children:"4th Place"}),(0,bs.jsx)("option",{value:5,children:"5th Place"})]})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Winners *"}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("select",{value:h.winner_player1_id,onChange:e=>j("winner_player1_id",e.target.value),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent ".concat(p.winner_player1_id?"border-red-300":"border-gray-300"),children:[(0,bs.jsx)("option",{value:"",children:"Select Winner"}),d.map(e=>(0,bs.jsx)("option",{value:e.id,children:e.name},e.id))]}),p.winner_player1_id&&(0,bs.jsx)("p",{className:"text-red-600 text-sm mt-1",children:p.winner_player1_id})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("select",{value:h.winner_player2_id,onChange:e=>j("winner_player2_id",e.target.value),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent ".concat(p.winner_player2_id?"border-red-300":"border-gray-300"),children:[(0,bs.jsx)("option",{value:"",children:"Select Partner (Optional)"}),d.filter(e=>e.id!==h.winner_player1_id).map(e=>(0,bs.jsx)("option",{value:e.id,children:e.name},e.id))]}),p.winner_player2_id&&(0,bs.jsx)("p",{className:"text-red-600 text-sm mt-1",children:p.winner_player2_id})]})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Custom Title ","custom"===h.competition_type&&"*"]}),(0,bs.jsx)("input",{type:"text",value:h.custom_title,onChange:e=>j("custom_title",e.target.value),placeholder:_(),className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent ".concat(p.custom_title?"border-red-300":"border-gray-300")}),p.custom_title&&(0,bs.jsx)("p",{className:"text-red-600 text-sm mt-1",children:p.custom_title}),(0,bs.jsxs)("p",{className:"text-gray-500 text-xs mt-1",children:['Leave blank to use default: "',_(),'"']})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Engraving Text"}),(0,bs.jsx)("textarea",{value:h.engraving_text,onChange:e=>j("engraving_text",e.target.value),placeholder:"Optional custom message to engrave on the trophy...",rows:3,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent"}),(0,bs.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"This text will appear as an engraved message on the trophy"})]}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Awarded Date"}),(0,bs.jsx)("input",{type:"date",value:h.awarded_date,onChange:e=>j("awarded_date",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Order"}),(0,bs.jsx)("input",{type:"number",value:h.display_order,onChange:e=>j("display_order",parseInt(e.target.value)||0),min:"0",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent"}),(0,bs.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Lower numbers appear first"})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"flex items-center gap-3",children:[(0,bs.jsx)("input",{type:"checkbox",checked:h.is_featured,onChange:e=>j("is_featured",e.target.checked),className:"w-4 h-4 text-[#5D1F1F] border-gray-300 rounded focus:ring-[#5D1F1F]"}),(0,bs.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Featured Trophy"}),(0,bs.jsx)(qa,{className:"w-4 h-4 text-yellow-500"})]}),(0,bs.jsx)("p",{className:"text-gray-500 text-xs mt-1 ml-7",children:"Featured trophies appear in the special showcase section"})]}),(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-6 border-t border-gray-200",children:[(0,bs.jsx)("button",{type:"button",onClick:n,className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,bs.jsx)("button",{type:"submit",className:"flex-1 bg-gradient-to-r from-[#5D1F1F] to-red-600 text-white py-2 px-4 rounded-lg hover:from-red-700 hover:to-red-800 transition-all duration-200",children:l?"Update Trophy":"Create Trophy"})]})]})]})}):null},Ba=fs("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Ga=fs("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Ha=fs("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Va=e=>{var t;let{isOpen:s,onClose:r,trophy:n,currentUser:i,onEdit:l,onDelete:o}=e;const[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(!1);if(!s||!n)return null;return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[(0,bs.jsxs)("div",{className:"bg-gradient-to-r from-amber-400 to-yellow-500 p-6 relative",children:[(0,bs.jsx)("button",{onClick:r,className:"absolute top-4 right-4 text-white hover:text-gray-200 transition-colors p-2 rounded-full hover:bg-white/20",children:(0,bs.jsx)(Es,{className:"w-6 h-6"})}),(0,bs.jsxs)("div",{className:"flex items-center gap-4",children:[(0,bs.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:(0,bs.jsx)(Is,{className:"w-8 h-8 text-white"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h2",{className:"text-2xl font-bold text-white",children:(()=>{if(n.custom_title)return n.custom_title;return{singles_winner:"Singles Champion",doubles_winner:"Doubles Champion",league_winner:"League Winner",tournament_winner:"Tournament Winner",best_player:"Player of the Season",most_improved:"Most Improved Player",sportsmanship:"Sportsmanship Award",participation:"Participation Award",season_champion:"Season Champion",custom:"Special Achievement"}[n.competition_type]||"Champion"})()}),(0,bs.jsx)("p",{className:"text-amber-100",children:"Trophy Details"})]})]}),n.is_featured&&(0,bs.jsx)("div",{className:"absolute top-4 left-4",children:(0,bs.jsxs)("div",{className:"bg-purple-600 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1",children:[(0,bs.jsx)(Ba,{className:"w-3 h-3"}),"Featured"]})})]}),(0,bs.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[(0,bs.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,bs.jsxs)("div",{className:"flex flex-col items-center",children:[(0,bs.jsxs)("div",{className:"relative mb-4",children:[!u&&!c&&n.trophy_image_url&&(0,bs.jsx)("div",{className:"w-48 h-48 bg-gray-200 animate-pulse rounded-lg flex items-center justify-center",children:(0,bs.jsx)(Is,{className:"w-12 h-12 text-gray-400"})}),n.trophy_image_url&&!c?(0,bs.jsx)("img",{src:n.trophy_image_url,alt:"Trophy",className:"w-48 h-48 object-contain rounded-lg shadow-xl transition-opacity duration-300 ".concat(u?"opacity-100":"opacity-0 absolute inset-0"),onLoad:()=>h(!0),onError:()=>d(!0),style:{filter:"drop-shadow(0 8px 16px rgba(0,0,0,0.3))"}}):(0,bs.jsx)("div",{className:"w-48 h-48 bg-gradient-to-br from-yellow-100 to-amber-200 rounded-lg flex items-center justify-center border-4 border-amber-300 shadow-xl",children:(0,bs.jsx)(Is,{className:"w-16 h-16 text-amber-600"})})]}),(0,bs.jsx)("div",{className:"mb-4",children:(()=>{if(!n.position||n.position>3)return null;const e={1:{bg:"bg-yellow-500",text:"\ud83e\udd47 1st Place"},2:{bg:"bg-gray-400",text:"\ud83e\udd48 2nd Place"},3:{bg:"bg-amber-600",text:"\ud83e\udd49 3rd Place"}}[n.position];return(0,bs.jsx)("div",{className:"".concat(e.bg," text-white px-3 py-1 rounded-full text-sm font-semibold shadow-lg"),children:e.text})})()}),n.engraving_text&&(0,bs.jsxs)("div",{className:"bg-gradient-to-r from-amber-50 to-yellow-50 border-2 border-amber-200 rounded-lg p-4 text-center shadow-md",children:[(0,bs.jsx)("h4",{className:"font-semibold text-amber-800 mb-2",children:"Engraving"}),(0,bs.jsxs)("p",{className:"text-amber-700 italic font-medium leading-relaxed",children:['"',n.engraving_text,'"']})]})]}),(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,bs.jsx)(qs,{className:"w-5 h-5 text-blue-600"}),(0,bs.jsx)("h3",{className:"font-semibold text-blue-900",children:"Winners"})]}),(0,bs.jsxs)("div",{className:"space-y-2",children:[(0,bs.jsx)("div",{className:"font-medium text-blue-800",children:n.winner1_name}),n.winner2_name&&(0,bs.jsx)("div",{className:"font-medium text-blue-800",children:n.winner2_name})]})]}),(0,bs.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,bs.jsx)(Ls,{className:"w-5 h-5 text-green-600"}),(0,bs.jsx)("h3",{className:"font-semibold text-green-900",children:"Event Details"})]}),(0,bs.jsxs)("div",{className:"space-y-2",children:[(0,bs.jsxs)("div",{className:"text-green-800",children:[(0,bs.jsx)("span",{className:"font-medium",children:"Season:"})," ",n.season_name]}),(0,bs.jsxs)("div",{className:"text-green-800",children:[(0,bs.jsx)("span",{className:"font-medium",children:"Date:"})," ",new Date(n.awarded_date).toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]})]}),(0,bs.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,bs.jsx)(zs,{className:"w-5 h-5 text-purple-600"}),(0,bs.jsx)("h3",{className:"font-semibold text-purple-900",children:"Achievement"})]}),(0,bs.jsx)("div",{className:"text-purple-800",children:(null===(t=n.competition_type)||void 0===t?void 0:t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()))||"Special Achievement"})]})]})]}),"admin"===(null===i||void 0===i?void 0:i.role)&&(0,bs.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,bs.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,bs.jsxs)("button",{onClick:()=>l(n),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,bs.jsx)(Ga,{className:"w-4 h-4"}),"Edit Trophy"]}),(0,bs.jsxs)("button",{onClick:async()=>{if(window.confirm("Are you sure you want to delete this trophy? This action cannot be undone.")){(await o(n.id)).success&&r()}},className:"flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:[(0,bs.jsx)(Ha,{className:"w-4 h-4"}),"Delete Trophy"]})]})})]})]})})},Ja=fs("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Ka=fs("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),$a=e=>{let{trophies:t,onTrophyClick:s,currentUser:a,onEdit:r,onDelete:n}=e;return(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,bs.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-6",children:t.map(e=>(0,bs.jsx)(Ya,{trophy:e,onClick:()=>s(e),currentUser:a,onEdit:()=>r(e),onDelete:()=>n(e.id)},e.id))})})},Ya=e=>{let{trophy:t,onClick:s,currentUser:a,onEdit:r,onDelete:n}=e;return(0,bs.jsxs)("div",{className:"relative group bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 hover:border-amber-300",children:[(0,bs.jsxs)("div",{className:"aspect-square relative cursor-pointer overflow-hidden bg-gradient-to-br from-gray-50 to-gray-100",onClick:s,children:[(0,bs.jsx)(Qa,{imageUrl:t.trophy_image_url,alt:"".concat(t.custom_title||"Trophy"," - ").concat(t.winner1_name)}),t.position&&t.position<=3&&(0,bs.jsx)("div",{className:"absolute top-3 right-3 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white shadow-lg ".concat(1===t.position?"bg-yellow-500":2===t.position?"bg-gray-400":"bg-amber-600"),children:t.position}),(0,bs.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300 flex items-center justify-center",children:(0,bs.jsx)("div",{className:"transform scale-0 group-hover:scale-100 transition-transform duration-300 bg-white rounded-lg px-3 py-2 shadow-lg",children:(0,bs.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"View Details"})})})]}),(0,bs.jsxs)("div",{className:"p-4",children:[(0,bs.jsx)("h3",{className:"font-semibold text-gray-900 mb-1 text-sm leading-tight",children:t.custom_title||Xa(t.competition_type)}),(0,bs.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:[t.winner1_name,t.winner2_name&&" & ".concat(t.winner2_name)]}),(0,bs.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,bs.jsx)("span",{children:t.season_name}),(0,bs.jsx)("span",{children:new Date(t.awarded_date).getFullYear()})]})]}),"admin"===(null===a||void 0===a?void 0:a.role)&&(0,bs.jsxs)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex gap-1",children:[(0,bs.jsx)("button",{onClick:e=>{e.stopPropagation(),r()},className:"bg-blue-600 text-white p-1.5 rounded-lg hover:bg-blue-700 transition-colors shadow-lg",title:"Edit Trophy",children:(0,bs.jsx)(Ga,{className:"w-3 h-3"})}),(0,bs.jsx)("button",{onClick:e=>{e.stopPropagation(),n()},className:"bg-red-600 text-white p-1.5 rounded-lg hover:bg-red-700 transition-colors shadow-lg",title:"Delete Trophy",children:(0,bs.jsx)(Ha,{className:"w-3 h-3"})})]})]})},Qa=e=>{let{imageUrl:t,alt:s="Trophy"}=e;const[r,n]=(0,a.useState)(!1),[i,l]=(0,a.useState)(!1);return!t||r?(0,bs.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-amber-50 to-amber-100 flex items-center justify-center border border-amber-200",children:(0,bs.jsx)(Is,{className:"w-16 h-16 text-amber-400"})}):(0,bs.jsxs)("div",{className:"relative w-full h-full",children:[!i&&(0,bs.jsx)("div",{className:"absolute inset-0 bg-gray-100 animate-pulse flex items-center justify-center",children:(0,bs.jsx)(Is,{className:"w-12 h-12 text-gray-400"})}),(0,bs.jsx)("img",{src:t,alt:s,className:"w-full h-full object-contain transition-opacity duration-500 ".concat(i?"opacity-100":"opacity-0"),onLoad:()=>l(!0),onError:()=>n(!0),loading:"lazy",style:{objectFit:"contain",objectPosition:"center"}})]})},Xa=e=>({singles_winner:"Singles Champion",doubles_winner:"Doubles Champion",league_winner:"League Winner",tournament_winner:"Tournament Winner",best_player:"Player of the Season",most_improved:"Most Improved Player",sportsmanship:"Sportsmanship Award",participation:"Participation Award",season_champion:"Season Champion",custom:"Special Achievement"}[e]||"Champion"),Za=e=>{let{currentUser:t,seasons:s=[],selectedSeason:r=null,allUsers:n=[]}=e;const[i,l]=(0,a.useState)(""),[o,d]=(0,a.useState)("all"),[u,h]=(0,a.useState)("all"),[m,p]=(0,a.useState)(!1),[g,x]=(0,a.useState)(!1),[f,y]=(0,a.useState)(null),[b,v]=(0,a.useState)(null),{trophies:w,loading:j,error:_,addTrophy:N,updateTrophy:k,deleteTrophy:S}=(e=>{const[t,s]=(0,a.useState)([]),[r,n]=(0,a.useState)(!0),[i,l]=(0,a.useState)(null),o=(0,a.useCallback)(async()=>{try{n(!0),l(null);const{data:e,error:t}=await is.from("trophy_cabinet").select("\n          *,\n          seasons (\n            id,\n            name,\n            season_type\n          ),\n          winner1:winner_player1_id (\n            id,\n            name\n          ),\n          winner2:winner_player2_id (\n            id,\n            name\n          ),\n          created_by_user:created_by (\n            id,\n            name\n          )\n        ").order("display_order",{ascending:!0}).order("awarded_date",{ascending:!1});if(t)throw t;const a=e.map(e=>{var t,s,a,r;return c(c({},e),{},{season_name:(null===(t=e.seasons)||void 0===t?void 0:t.name)||"Unknown Season",winner1_name:(null===(s=e.winner1)||void 0===s?void 0:s.name)||"Unknown Winner",winner2_name:(null===(a=e.winner2)||void 0===a?void 0:a.name)||null,created_by_name:(null===(r=e.created_by_user)||void 0===r?void 0:r.name)||"Unknown"})});s(a)}catch(e){console.error("Error fetching trophies:",e),l(e.message)}finally{n(!1)}},[]),d=(0,a.useCallback)(async t=>{try{var a,r,n;l(null);const i=c(c({},t),{},{season_id:t.season_id||null,winner_player1_id:t.winner_player1_id||null,winner_player2_id:t.winner_player2_id||null,created_by:e}),{data:o,error:d}=await is.from("trophy_cabinet").insert([i]).select("\n          *,\n          seasons (\n            id,\n            name,\n            season_type\n          ),\n          winner1:winner_player1_id (\n            id,\n            name\n          ),\n          winner2:winner_player2_id (\n            id,\n            name\n          )\n        ").single();if(d)throw d;const u=c(c({},o),{},{season_name:(null===(a=o.seasons)||void 0===a?void 0:a.name)||"Unknown Season",winner1_name:(null===(r=o.winner1)||void 0===r?void 0:r.name)||"Unknown Winner",winner2_name:(null===(n=o.winner2)||void 0===n?void 0:n.name)||null});return s(e=>[u,...e]),{success:!0,trophy:u}}catch(i){return console.error("Error adding trophy:",i),l(i.message),{success:!1,error:i.message}}},[e]),u=(0,a.useCallback)(async(e,t)=>{try{var a,r,n;l(null);const i=c(c({},t),{},{season_id:t.season_id||null,winner_player1_id:t.winner_player1_id||null,winner_player2_id:t.winner_player2_id||null}),{data:o,error:d}=await is.from("trophy_cabinet").update(i).eq("id",e).select("\n          *,\n          seasons (\n            id,\n            name,\n            season_type\n          ),\n          winner1:winner_player1_id (\n            id,\n            name\n          ),\n          winner2:winner_player2_id (\n            id,\n            name\n          )\n        ").single();if(d)throw d;const u=c(c({},o),{},{season_name:(null===(a=o.seasons)||void 0===a?void 0:a.name)||"Unknown Season",winner1_name:(null===(r=o.winner1)||void 0===r?void 0:r.name)||"Unknown Winner",winner2_name:(null===(n=o.winner2)||void 0===n?void 0:n.name)||null});return s(t=>t.map(t=>t.id===e?u:t)),{success:!0,trophy:u}}catch(i){return console.error("Error updating trophy:",i),l(i.message),{success:!1,error:i.message}}},[]),h=(0,a.useCallback)(async e=>{try{l(null);const{error:t}=await is.from("trophy_cabinet").delete().eq("id",e);if(t)throw t;return s(t=>t.filter(t=>t.id!==e)),{success:!0}}catch(t){return console.error("Error deleting trophy:",t),l(t.message),{success:!1,error:t.message}}},[]),m=(0,a.useCallback)(async(e,t)=>{const s=c({season_id:e,awarded_date:(new Date).toISOString().split("T")[0],display_order:0,is_featured:!1},t);return await d(s)},[d]),p=(0,a.useCallback)(e=>t.filter(t=>t.winner_player1_id===e||t.winner_player2_id===e),[t]),g=(0,a.useCallback)(e=>t.filter(t=>t.season_id===e),[t]),x=(0,a.useCallback)(()=>t.filter(e=>e.is_featured),[t]),f=(0,a.useCallback)(()=>{const e={total:t.length,byType:{},byCompetition:{},bySeason:{},recent:t.slice(0,5)};return t.forEach(t=>{e.byType[t.trophy_type]=(e.byType[t.trophy_type]||0)+1,e.byCompetition[t.competition_type]=(e.byCompetition[t.competition_type]||0)+1,e.bySeason[t.season_id]=(e.bySeason[t.season_id]||0)+1}),e},[t]);return(0,a.useEffect)(()=>{o()},[o]),(0,a.useEffect)(()=>{const e=is.channel("trophy_cabinet_changes").on("postgres_changes",{event:"*",schema:"public",table:"trophy_cabinet"},()=>{o()}).subscribe();return()=>{is.removeChannel(e)}},[o]),{trophies:t,loading:r,error:i,addTrophy:d,updateTrophy:u,deleteTrophy:h,awardTrophy:m,getTrophiesByPlayer:p,getTrophiesBySeason:g,getFeaturedTrophies:x,getTrophyStats:f,refetch:o}})(null===t||void 0===t?void 0:t.id),C=(0,a.useMemo)(()=>w.filter(e=>{var t,s,a,r;const n=!i||(null===(t=e.custom_title)||void 0===t?void 0:t.toLowerCase().includes(i.toLowerCase()))||(null===(s=e.engraving_text)||void 0===s?void 0:s.toLowerCase().includes(i.toLowerCase()))||(null===(a=e.winner1_name)||void 0===a?void 0:a.toLowerCase().includes(i.toLowerCase()))||(null===(r=e.winner2_name)||void 0===r?void 0:r.toLowerCase().includes(i.toLowerCase())),l="all"===o||e.season_id===o,c="all"===u||e.trophy_type.includes(u);return n&&l&&c}),[w,i,o,u]);return j?(0,bs.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,bs.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#5D1F1F]"})}):_?(0,bs.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,bs.jsxs)("p",{className:"text-red-600",children:["Error loading trophy cabinet: ",_]})}):(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsx)("div",{className:"bg-gradient-to-r from-amber-50 to-yellow-50 rounded-lg shadow-sm p-6 border border-amber-200",children:(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,bs.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-yellow-400 to-amber-500 rounded-full flex items-center justify-center",children:(0,bs.jsx)(Is,{className:"w-6 h-6 text-white"})}),(0,bs.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Trophy Cabinet"}),(0,bs.jsx)(Ba,{className:"w-6 h-6 text-amber-500"})]}),(0,bs.jsx)("p",{className:"text-gray-600",children:"Celebrating our champions and achievements"})]}),"admin"===(null===t||void 0===t?void 0:t.role)&&(0,bs.jsxs)("button",{onClick:()=>p(!0),className:"flex items-center gap-2 bg-gradient-to-r from-[#5D1F1F] to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-700 hover:to-red-800 transition-all duration-200 shadow-lg hover:shadow-xl",children:[(0,bs.jsx)(wa,{className:"w-4 h-4"}),"Add Trophy"]})]})}),(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,bs.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,bs.jsx)("div",{className:"flex-1",children:(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)(Ja,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,bs.jsx)("input",{type:"text",placeholder:"Search trophies, winners, or achievements...",value:i,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent"})]})}),(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)(Ka,{className:"w-4 h-4 text-gray-400"}),(0,bs.jsxs)("select",{value:o,onChange:e=>d(e.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",children:[(0,bs.jsx)("option",{value:"all",children:"All Seasons"}),s.map(e=>(0,bs.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,bs.jsx)("div",{children:(0,bs.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",children:[(0,bs.jsx)("option",{value:"all",children:"All Trophies"}),(0,bs.jsx)("option",{value:"gold",children:"Gold"}),(0,bs.jsx)("option",{value:"silver",children:"Silver"}),(0,bs.jsx)("option",{value:"bronze",children:"Bronze"}),(0,bs.jsx)("option",{value:"cup",children:"Cups"}),(0,bs.jsx)("option",{value:"shield",children:"Shields"}),(0,bs.jsx)("option",{value:"star",children:"Stars"})]})})]})}),0===C.length?(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-12",children:(0,bs.jsxs)("div",{className:"text-center",children:[(0,bs.jsx)("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,bs.jsx)(Is,{className:"w-12 h-12 text-gray-400"})}),(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Trophies Found"}),(0,bs.jsx)("p",{className:"text-gray-600 mb-4",children:i||"all"!==o||"all"!==u?"No trophies match your search criteria.":"The trophy cabinet is empty. Start adding some achievements!"}),"admin"===(null===t||void 0===t?void 0:t.role)&&!i&&"all"===o&&"all"===u&&(0,bs.jsx)("button",{onClick:()=>p(!0),className:"text-[#5D1F1F] hover:text-red-700 font-medium",children:"Add the first trophy \u2192"})]})}):(0,bs.jsx)($a,{trophies:C,onTrophyClick:e=>{v(e),x(!0)},currentUser:t,onEdit:e=>{y(e),p(!0)},onDelete:S}),(0,bs.jsx)(Wa,{isOpen:m,onClose:()=>{p(!1),y(null)},onSave:async e=>f?await k(f.id,e):await N(e),trophy:f,seasons:s,allUsers:n,currentUser:t}),(0,bs.jsx)(Va,{isOpen:g,onClose:()=>{x(!1),v(null)},trophy:b,currentUser:t,onEdit:e=>{y(e),p(!0),x(!1)},onDelete:S})]})},er=e=>{var t,s;let{currentUser:r,currentSeason:n,selectedSeason:i,ladderPlayers:l,getPlayerAvailability:o,setPlayerAvailability:c,matchFixtures:d,matchResults:u,getMatchScore:h}=e;const[m,p]=a.useState(!1),[g,x]=a.useState(!1),f="admin"===(null===r||void 0===r?void 0:r.role),y=null===l||void 0===l?void 0:l.find(e=>e.id===r.id);if(!y&&!f)return(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Match Availability"}),(0,bs.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:(0,bs.jsxs)("p",{className:"text-yellow-800",children:["You need to be added to the ",(null===i||void 0===i?void 0:i.name)||"current season"," ladder before you can set your availability for matches."]})})]});if("completed"===(null===i||void 0===i?void 0:i.status))return(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Match Availability"}),(0,bs.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:(0,bs.jsxs)("p",{className:"text-blue-800",children:["This season (",i.name,") has been completed. Availability cannot be modified."]})})]});const b=new Date;b.setHours(0,0,0,0);const v=(null===n||void 0===n||null===(t=n.matches)||void 0===t?void 0:t.filter(e=>new Date(e.match_date)>=b))||[],w=(null===n||void 0===n||null===(s=n.matches)||void 0===s?void 0:s.filter(e=>new Date(e.match_date)<b))||[],j=e=>{const t=d.filter(t=>t.match_id===e);if(0===t.length)return!1;return t.filter(e=>u.some(t=>t.fixture_id===e.id)).length===t.length&&t.length>0},_=e=>{if(!l||0===l.length)return{responded:0,total:0,available:0,notAvailable:0,responseRate:0};const t=l.length;let s=0,a=0,r=0;l.forEach(t=>{const n=o(t.id,e);void 0!==n&&(s++,!0===n&&a++,!1===n&&r++)});const n=t>0?Math.round(s/t*100):0;return{responded:s,total:t,available:a,notAvailable:r,responseRate:n}},N=(e,t)=>{const s=new Date;s.setHours(0,0,0,0);const a=new Date(t);if(a.setHours(0,0,0,0),a<s)return"border-l-gray-300";if(j(e))return"border-l-green-500";const r=_(e);return r.responseRate>=75?"border-l-green-500":r.responseRate>=50?"border-l-blue-500":r.responseRate>0?"border-l-orange-500":"border-l-gray-400"};return(0,bs.jsxs)("div",{className:"space-y-5",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,bs.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Match Availability"}),f&&(0,bs.jsx)("div",{className:"flex items-center gap-4",children:(0,bs.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,bs.jsx)("input",{type:"checkbox",checked:m,onChange:e=>p(e.target.checked),className:"rounded border-gray-300 text-[#5D1F1F] focus:ring-[#5D1F1F]"}),(0,bs.jsx)("span",{className:"font-medium",children:"Manage All Players"})]})})]}),f&&m&&"league"!==(null===n||void 0===n?void 0:n.season_type)&&(0,bs.jsxs)("div",{className:"space-y-5",children:[v.length>0?(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold mb-3 text-gray-900",children:["Upcoming Matches (",v.length,")"]}),(0,bs.jsx)("div",{className:"space-y-3",children:v.map(e=>{const t=j(e.id),s=_(e.id);return(0,bs.jsx)("div",{className:"bg-white border-l-4 ".concat(N(e.id,e.match_date)," rounded-lg shadow-sm overflow-hidden"),children:(0,bs.jsxs)("div",{className:"p-4 sm:p-5",children:[(0,bs.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,bs.jsxs)("h4",{className:"font-semibold text-gray-900",children:["Week ",e.week_number]}),(0,bs.jsx)("span",{className:"text-gray-600",children:e.match_date?new Date(e.match_date).toLocaleDateString("en-GB"):"No date set"}),t&&(0,bs.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded",children:"\u2705 Completed"})]}),!t&&(0,bs.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:[s.responded,"/",s.total," responded (",s.responseRate,"%)"]}),(0,bs.jsx)("div",{className:"flex-1 max-w-xs h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,bs.jsx)("div",{className:"h-full transition-all ".concat(s.responseRate>=75?"bg-green-500":s.responseRate>=50?"bg-blue-500":"bg-orange-500"),style:{width:"".concat(s.responseRate,"%")}})})]})]})}),t?(0,bs.jsx)("div",{className:"text-sm text-gray-600 italic",children:"All results have been entered for this match."}):(0,bs.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:null===l||void 0===l?void 0:l.map(t=>{const s=o(t.id,e.id);return(0,bs.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,bs.jsx)("span",{className:"text-sm font-medium truncate mr-2",children:t.name}),(0,bs.jsxs)("div",{className:"flex gap-1",children:[(0,bs.jsx)("button",{onClick:()=>c(e.id,!0,t.id),className:"px-2 py-1 text-xs rounded transition-colors ".concat(!0===s?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-green-100"),title:"Available",children:"\u2713"}),(0,bs.jsx)("button",{onClick:()=>c(e.id,!1,t.id),className:"px-2 py-1 text-xs rounded transition-colors ".concat(!1===s?"bg-red-600 text-white":"bg-gray-200 text-gray-700 hover:bg-red-100"),title:"Not Available",children:"\u2717"}),void 0!==s&&(0,bs.jsx)("button",{onClick:()=>c(e.id,void 0,t.id),className:"px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors",title:"Clear",children:"Clear"})]})]},t.id)})})]})},e.id)})})]}):(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:(0,bs.jsx)("p",{className:"text-gray-500",children:"No upcoming matches scheduled."})}),w.length>0&&(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,bs.jsxs)("button",{onClick:()=>x(!g),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Past Matches (",w.length,")"]}),(0,bs.jsx)("span",{className:"text-sm text-gray-500",children:"Completed or no longer accepting responses"})]}),(0,bs.jsx)(aa,{className:"w-5 h-5 text-gray-400 transition-transform duration-200 ".concat(g?"rotate-180":"rotate-0")})]}),g&&(0,bs.jsx)("div",{className:"border-t border-gray-200 p-4 space-y-3",children:w.map(e=>{const t=j(e.id),s=_(e.id);return(0,bs.jsx)("div",{className:"bg-gray-50 border-l-4 border-l-gray-300 rounded p-3",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,bs.jsxs)("h4",{className:"font-medium text-gray-900",children:["Week ",e.week_number]}),(0,bs.jsx)("span",{className:"text-sm text-gray-600",children:e.match_date?new Date(e.match_date).toLocaleDateString("en-GB"):"No date set"}),t&&(0,bs.jsx)("span",{className:"px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded",children:"Completed"})]}),(0,bs.jsxs)("span",{className:"text-sm text-gray-500",children:[s.responded,"/",s.total," responded"]})]})},e.id)})})]})]}),!m&&y&&v.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold mb-3 text-gray-900",children:"Your Upcoming Matches"}),(0,bs.jsx)("p",{className:"text-gray-600 mb-4 text-sm",children:"Please set your availability for upcoming matches"}),(0,bs.jsx)("div",{className:"space-y-3",children:v.map(e=>{const t=o(r.id,e.id),s=j(e.id),a=new Date(e.match_date),n=new Date;n.setHours(0,0,0,0),a.setHours(0,0,0,0);const i=a.getTime()===n.getTime(),l=a.getTime()===n.getTime()+864e5;return(0,bs.jsx)("div",{className:"bg-white border-l-4 ".concat(N(e.id,e.match_date)," rounded-lg shadow-sm"),children:(0,bs.jsxs)("div",{className:"p-4 sm:p-5",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,bs.jsxs)("h4",{className:"font-semibold text-gray-900",children:["Week ",e.week_number]}),(0,bs.jsx)("span",{className:"text-gray-600",children:i?"Today":l?"Tomorrow":new Date(e.match_date).toLocaleDateString("en-GB")}),s&&(0,bs.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded",children:"\u2705 Completed"})]}),!s&&void 0!==t&&(0,bs.jsx)("div",{className:"mt-2 text-sm text-gray-600",children:t?"\u2713 You're available":"\u2717 You're not available"}),!s&&void 0===t&&(0,bs.jsx)("div",{className:"mt-2 text-sm text-orange-600",children:"\u23f0 Please respond"})]}),!s&&(0,bs.jsxs)("div",{className:"flex gap-2",children:[(0,bs.jsx)("button",{onClick:()=>c(e.id,!0,r.id),className:"px-4 py-2 rounded-lg transition-colors text-sm font-medium min-h-[40px] ".concat(!0===t?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-green-100"),children:"Available"}),(0,bs.jsx)("button",{onClick:()=>c(e.id,!1,r.id),className:"px-4 py-2 rounded-lg transition-colors text-sm font-medium min-h-[40px] ".concat(!1===t?"bg-red-600 text-white":"bg-gray-200 text-gray-700 hover:bg-red-100"),children:"Not Available"}),void 0!==t&&(0,bs.jsx)("button",{onClick:()=>c(e.id,void 0,r.id),className:"px-3 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors text-sm min-h-[40px]",children:"Clear"})]})]}),s&&(0,bs.jsx)("div",{className:"mt-3 text-sm text-gray-600",children:"All results have been entered for this match."})]})},e.id)})})]}),!m&&y&&w.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold mb-3 text-gray-900",children:"Past Matches"}),(0,bs.jsx)("div",{className:"space-y-3",children:w.map(e=>{const t=(e=>{const t=d.filter(t=>t.match_id===e&&(t.player1_id===r.id||t.player2_id===r.id||t.player3_id===r.id||t.player4_id===r.id)),s=[];return t.forEach(e=>{const t=h(e.id);if(t){const h=e.pair1_player1_id===r.id||e.pair1_player2_id===r.id;let m,p,g;var a,n,i,l,o,c,d,u;m=t.pair1_score===t.pair2_score?"draw":h?t.pair1_score>t.pair2_score?"won":"lost":t.pair2_score>t.pair1_score?"won":"lost",h?(p=e.pair1_player1_id===r.id?null===(a=e.player2)||void 0===a?void 0:a.name:null===(n=e.player1)||void 0===n?void 0:n.name,g="".concat(null===(i=e.player3)||void 0===i?void 0:i.name," & ").concat(null===(l=e.player4)||void 0===l?void 0:l.name)):(p=e.pair2_player1_id===r.id?null===(o=e.player4)||void 0===o?void 0:o.name:null===(c=e.player3)||void 0===c?void 0:c.name,g="".concat(null===(d=e.player1)||void 0===d?void 0:d.name," & ").concat(null===(u=e.player2)||void 0===u?void 0:u.name)),s.push({opponent:g,partner:p,score:"".concat(t.pair1_score," - ").concat(t.pair2_score),result:m})}}),s})(e.id);return(0,bs.jsx)("div",{className:"bg-white border-l-4 border-l-gray-300 rounded-lg shadow-sm",children:(0,bs.jsxs)("div",{className:"p-4 sm:p-5",children:[(0,bs.jsx)("div",{className:"mb-3",children:(0,bs.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bs.jsxs)("h4",{className:"font-semibold text-gray-900",children:["Week ",e.week_number]}),(0,bs.jsx)("span",{className:"text-gray-600 text-sm",children:new Date(e.match_date).toLocaleDateString("en-GB")})]})}),t.length>0?(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h5",{className:"font-medium mb-2 text-sm text-gray-700",children:"Your Results:"}),(0,bs.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>{const s="won"===e.result?"bg-green-50 border border-green-200":"draw"===e.result?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200",a="won"===e.result?"text-green-700":"draw"===e.result?"text-yellow-700":"text-red-700",r="won"===e.result?"\u2713 Won":"draw"===e.result?"= Draw":"\u2717 Lost";return(0,bs.jsx)("div",{className:"p-3 rounded-lg text-sm ".concat(s),children:(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1",children:[(0,bs.jsxs)("span",{className:"text-gray-700",children:["With ",e.partner," vs ",e.opponent]}),(0,bs.jsxs)("span",{className:"font-semibold ".concat(a),children:[e.score," ",r]})]})},t)})})]}):(0,bs.jsx)("p",{className:"text-gray-500 text-sm italic",children:"No scores recorded for this match"})]})},e.id)})})]}),!m&&y&&0===v.length&&0===w.length&&(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:(0,bs.jsx)("p",{className:"text-gray-500",children:"No matches scheduled yet."})}),m&&(!(null!==n&&void 0!==n&&n.matches)||0===n.matches.length)&&(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center",children:(0,bs.jsx)("p",{className:"text-gray-500",children:"No matches scheduled for this season yet."})})]})},tr=fs("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),sr=fs("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ar=fs("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),rr="1.0.188";const nr=new class{constructor(){this.currentVersion=rr,this.swRegistration=null,this.updateAvailable=!1,this.listeners=new Set,this.preReloadCallbacks=new Set}addPreReloadCallback(e){return this.preReloadCallbacks.add(e),()=>this.preReloadCallbacks.delete(e)}async gracefulReload(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"update";const t=[];if(this.preReloadCallbacks.forEach(s=>{try{const a=s(e);a instanceof Promise&&t.push(a)}catch(a){console.error("[VM] Pre-reload callback error:",a)}}),t.length>0)try{await Promise.race([Promise.all(t),new Promise(e=>setTimeout(e,1e3))])}catch(s){console.error("[VM] Pre-reload promises failed:",s)}window.location.reload()}async init(){if(!("serviceWorker"in navigator))return console.warn("[VM] Service workers not supported"),!1;try{return this.swRegistration=await navigator.serviceWorker.register("/sw.js"),this.swRegistration.addEventListener("updatefound",()=>{const e=this.swRegistration.installing;e.addEventListener("statechange",()=>{"installed"===e.state&&navigator.serviceWorker.controller&&(this.updateAvailable=!0,this.notifyListeners("updateAvailable",{version:this.currentVersion}))})}),navigator.serviceWorker.addEventListener("message",e=>{"NEW_VERSION_ACTIVE"===e.data.type&&this.notifyListeners("newVersionActive",e.data)}),setInterval(()=>{this.checkForUpdates()},3e5),this.checkForUpdates(),!0}catch(e){return console.error("[VM] Service worker registration failed:",e),!1}}async checkForUpdates(){if(this.swRegistration)try{await this.swRegistration.update()}catch(e){console.error("[VM] Update check failed:",e)}}async applyUpdate(){if(this.swRegistration&&this.updateAvailable){const e=this.swRegistration.waiting;if(e)return e.postMessage({type:"SKIP_WAITING"}),setTimeout(async()=>{await this.gracefulReload("serviceWorkerUpdate")},500),!0}return!1}async clearCacheAndReload(){try{if("serviceWorker"in navigator&&navigator.serviceWorker.controller){const e=new MessageChannel;e.port1.onmessage=async e=>{"CACHE_CLEARED"===e.data.type&&await this.gracefulReload("cacheCleared")},navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"},[e.port2])}else{if("caches"in window){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}await this.gracefulReload("cacheClearedFallback")}}catch(e){console.error("[VM] Failed to clear cache:",e),await this.gracefulReload("cacheClearError")}}bustCache(e){const t=e.includes("?")?"&":"?";return"".concat(e).concat(t,"v=").concat(this.currentVersion,"&t=").concat(Date.now())}addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(e,t){this.listeners.forEach(s=>{try{s(e,t)}catch(a){console.error("[VM] Listener error:",a)}})}getVersionInfo(){return{version:this.currentVersion,updateAvailable:this.updateAvailable,swRegistered:!!this.swRegistration}}};"undefined"!==typeof window&&setTimeout(()=>{nr.init()},1e3);const ir=fs("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),lr=fs("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),or=fs("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),cr=e=>{var t,s,a,r,n,i,l;let{challenge:o,selectedSeason:d,resolveChallenge:u,editingScore:h,setEditingScore:m,editForm:p,setEditForm:g,saveScoreEdit:x}=e;return(0,bs.jsx)("div",{className:"border border-orange-200 bg-orange-50 rounded-lg p-4",children:(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded bg-orange-100 text-orange-800",children:"PENDING"}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:[o.match_date?new Date(o.match_date).toLocaleDateString():"Unknown date"," \u2022 Court ",o.court_number||"?"]})]}),(0,bs.jsx)(ir,{className:"w-5 h-5 text-orange-500"})]}),(0,bs.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,bs.jsxs)("div",{className:"space-y-2",children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900",children:"Match Details"}),(0,bs.jsxs)("div",{className:"text-sm text-gray-700",children:[o.fixture?(0,bs.jsxs)("div",{className:"space-y-1",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("strong",{children:"Players:"})," ",null===(t=o.fixture.player1)||void 0===t?void 0:t.name," & ",null===(s=o.fixture.player2)||void 0===s?void 0:s.name," vs ",null===(a=o.fixture.player3)||void 0===a?void 0:a.name," & ",null===(r=o.fixture.player4)||void 0===r?void 0:r.name]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("strong",{children:"Original Score:"})," ",(null===(n=o.original_result)||void 0===n?void 0:n.pair1_score)||"?"," - ",(null===(i=o.original_result)||void 0===i?void 0:i.pair2_score)||"?"]})]}):(0,bs.jsxs)("div",{children:[(0,bs.jsx)("strong",{children:"Players:"})," Unknown",(0,bs.jsx)("br",{}),(0,bs.jsx)("strong",{children:"Original Score:"})," Unknown"]}),(0,bs.jsxs)("div",{className:"mt-1",children:[(0,bs.jsx)("strong",{children:"Challenged By:"})," ",(null===(l=o.challenger)||void 0===l?void 0:l.name)||"Unknown"]})]})]})}),(0,bs.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,bs.jsx)("div",{className:"flex justify-between items-start",children:(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"font-medium text-yellow-800",children:"Disputed Score"}),(0,bs.jsxs)("div",{className:"text-lg font-bold text-yellow-900 mt-1",children:[o.challenged_pair1_score," - ",o.challenged_pair2_score]})]})}),o.challenge_reason&&(0,bs.jsxs)("div",{className:"mt-3",children:[(0,bs.jsx)("div",{className:"font-medium text-yellow-800 text-sm",children:"Reason:"}),(0,bs.jsx)("div",{className:"text-sm text-yellow-700",children:o.challenge_reason})]})]}),h===o.id&&(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("h6",{className:"font-medium text-blue-800 mb-2",children:"Edit Score"}),(0,bs.jsxs)("div",{className:"flex items-center gap-4",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("label",{className:"text-sm text-blue-700",children:"Pair 1:"}),(0,bs.jsx)("input",{type:"number",min:"0",value:p.pair1_score,onChange:e=>g(c(c({},p),{},{pair1_score:e.target.value})),className:"w-16 px-2 py-1 border border-blue-300 rounded text-center focus:outline-none focus:border-blue-500"})]}),(0,bs.jsx)("span",{className:"text-blue-700",children:"-"}),(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("label",{className:"text-sm text-blue-700",children:"Pair 2:"}),(0,bs.jsx)("input",{type:"number",min:"0",value:p.pair2_score,onChange:e=>g(c(c({},p),{},{pair2_score:e.target.value})),className:"w-16 px-2 py-1 border border-blue-300 rounded text-center focus:outline-none focus:border-blue-500"})]}),(0,bs.jsx)("button",{onClick:()=>x(o.id),className:"bg-blue-600 text-white px-4 py-1 rounded text-sm hover:bg-blue-700",children:"Save"}),(0,bs.jsx)("button",{onClick:()=>m(null),className:"bg-gray-500 text-white px-4 py-1 rounded text-sm hover:bg-gray-600",children:"Cancel"})]})]}),o.admin_decision&&(0,bs.jsxs)("div",{className:"mt-2 bg-yellow-50 p-2 rounded",children:[(0,bs.jsx)("p",{className:"text-xs text-yellow-600 font-medium",children:"Admin Decision:"}),(0,bs.jsx)("p",{className:"text-sm",children:o.admin_decision})]}),(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[(0,bs.jsxs)("button",{onClick:()=>u(o.id,"approved",{pair1_score:o.challenged_pair1_score,pair2_score:o.challenged_pair2_score}),disabled:"completed"===(null===d||void 0===d?void 0:d.status),className:"flex items-center justify-center gap-2 bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 disabled:opacity-50 transition-colors",title:"completed"===(null===d||void 0===d?void 0:d.status)?"Cannot process challenges for completed seasons":"Approve challenge and update score",children:[(0,bs.jsx)(na,{className:"w-4 h-4"}),"Approve"]}),(0,bs.jsxs)("button",{onClick:()=>u(o.id,"rejected"),disabled:"completed"===(null===d||void 0===d?void 0:d.status),className:"flex items-center justify-center gap-2 bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700 disabled:opacity-50 transition-colors",title:"completed"===(null===d||void 0===d?void 0:d.status)?"Cannot process challenges for completed seasons":"Reject challenge and keep original score",children:[(0,bs.jsx)(Es,{className:"w-4 h-4"}),"Reject"]})]}),(0,bs.jsxs)("div",{className:"text-xs text-gray-400",children:["Submitted: ",new Date(o.created_at).toLocaleString()]})]})})},dr=e=>{let{challenges:t}=e;const[s,r]=a.useState(!1);return(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("button",{onClick:()=>r(!s),className:"flex items-center justify-between w-full p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)(na,{className:"w-4 h-4 text-gray-600"}),(0,bs.jsxs)("span",{className:"font-medium text-gray-700",children:["Processed Challenges (",t.length,")"]})]}),(0,bs.jsx)("span",{className:"text-gray-500 text-sm",children:s?"Hide":"Show"})]}),s&&(0,bs.jsx)("div",{className:"mt-4 space-y-2",children:t.map(e=>{var t;return(0,bs.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2",children:[(0,bs.jsxs)("div",{className:"flex flex-col gap-1 flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,bs.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded whitespace-nowrap ".concat("approved"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.status.toUpperCase()}),(0,bs.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.resolved_at).toLocaleDateString()})]}),(0,bs.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,bs.jsx)("strong",{children:(null===(t=e.challenger)||void 0===t?void 0:t.name)||"Unknown"})," challenged score: ",e.challenged_pair1_score,"-",e.challenged_pair2_score]})]}),(0,bs.jsx)("div",{className:"text-right",children:(0,bs.jsxs)("div",{className:"text-xs text-gray-400",children:[e.match_date?new Date(e.match_date).toLocaleDateString():"Unknown date"," \u2022 Court ",e.court_number||"?"]})})]})},e.id)})})]})},ur=e=>{let{currentUser:t,currentSeason:s,activeSeason:r,selectedSeason:n,onDataRefresh:i}=e;const[l,o]=(0,a.useState)([]),[d,u]=(0,a.useState)([]),[h,m]=(0,a.useState)([]),[p,g]=(0,a.useState)(!1),[x,f]=(0,a.useState)(null),[y,b]=(0,a.useState)({pair1_score:"",pair2_score:""}),[v,w]=(0,a.useState)("challenges"),j=(0,a.useCallback)(async e=>{const t=e||(null===s||void 0===s?void 0:s.id);if(!t)return[];const a=e?n:s;if("completed"===(null===a||void 0===a?void 0:a.status))return[];const{data:r,error:i}=await is.from("match_results").select("\n        *,\n        fixture:fixture_id(\n          *,\n          match:match_id(week_number, match_date, season_id),\n          player1:player1_id(name),\n          player2:player2_id(name),\n          player3:player3_id(name),\n          player4:player4_id(name)\n        )\n      ").eq("fixture.match.season_id",t).order("created_at",{ascending:!1});if(i)throw console.error("\u274c Error fetching match results:",i),i;return(null===r||void 0===r?void 0:r.filter(e=>{var s,a;return(null===(s=e.fixture)||void 0===s||null===(a=s.match)||void 0===a?void 0:a.season_id)===t}))||[]},[s,n]),_=(0,a.useCallback)(async()=>{try{g(!0);const[e,t,s]=await Promise.all([ms(null===n||void 0===n?void 0:n.id),ps(null===n||void 0===n?void 0:n.id),j(null===n||void 0===n?void 0:n.id)]);o(e||[]),u(t||[]),m(s||[])}catch(e){console.error("\u274c Error fetching data:",e),alert("Error loading challenges: "+e.message)}finally{g(!1)}},[null===n||void 0===n?void 0:n.id,null===s||void 0===s?void 0:s.id,j]);(0,a.useEffect)(()=>{_()},[null===n||void 0===n?void 0:n.id,null===s||void 0===s?void 0:s.id,_]);const N=async function(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("completed"!==(null===n||void 0===n?void 0:n.status)){g(!0);try{if("approved"===s&&a){const t=l.find(t=>t.id===e);if(null!==t&&void 0!==t&&t.original_result_id&&null!==t&&void 0!==t&&t.fixture_id){const{error:e}=await is.from("match_results").insert({fixture_id:t.fixture_id,pair1_score:a.pair1_score,pair2_score:a.pair2_score,submitted_by:t.challenger_id,verified:!0}).select().single();if(e)return console.error("\u274c Error creating corrected result:",e),void alert("Error creating corrected result: "+e.message);const{error:s}=await is.from("match_results").update({verified:!1}).eq("id",t.original_result_id);if(s)return console.error("\u274c Error marking original as superseded:",s),void alert("Error updating original result: "+s.message)}}const n={status:s,resolved_by:t.id,resolved_at:(new Date).toISOString()};n.admin_decision="approved"===s?"Challenge upheld - score corrected":"Challenge rejected - original score stands";const{error:o}=await is.from("score_challenges").update(n).eq("id",e).select();if(o)return console.error("\u274c Challenge update error:",o),console.error("Error details:",{code:o.code,message:o.message,details:o.details,hint:o.hint}),void alert("Error resolving challenge: ".concat(o.message,"\n\nDetails: ").concat(o.details||"None"));if(alert("Challenge ".concat(s," successfully!")),"approved"===s&&a){const t=l.find(t=>t.id===e);if(null!==t&&void 0!==t&&t.fixture_id)try{const e=await us(t.fixture_id,a);e.success||console.warn("\u26a0\ufe0f ELO update failed (non-critical):",e.error)}catch(r){console.warn("\u26a0\ufe0f ELO update failed (non-critical):",r)}}await _(),i&&i()}catch(o){console.error("\ud83d\udca5 Unexpected error resolving challenge:",o),alert("Unexpected error resolving challenge: "+o.message)}finally{g(!1)}}else alert("Cannot process challenges for completed seasons. Challenges can only be processed for the current active season.")},k=async e=>{g(!0);try{if(!y.pair1_score||!y.pair2_score)return void alert("Please enter both scores");const s=h.find(t=>t.id===e),a=null===s||void 0===s?void 0:s.fixture_id,{error:r}=await is.from("match_results").update({pair1_score:parseInt(y.pair1_score),pair2_score:parseInt(y.pair2_score)}).eq("id",e);if(r)console.error("\u274c Error updating score:",r),alert("Error updating score: "+r.message);else{if(alert("Score updated successfully!"),a)try{const e={pair1_score:parseInt(y.pair1_score),pair2_score:parseInt(y.pair2_score)},t=await us(a,e);t.success||console.warn("\u26a0\ufe0f ELO update failed (non-critical):",t.error)}catch(t){console.warn("\u26a0\ufe0f ELO update failed (non-critical):",t)}f(null),b({pair1_score:"",pair2_score:""}),await _(),i&&i()}}catch(s){console.error("Error in handleSaveEdit:",s),alert("Error updating score: "+s.message)}finally{g(!1)}},S=()=>{f(null),b({pair1_score:"",pair2_score:""})};return p?(0,bs.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,bs.jsx)("div",{className:"text-gray-500",children:"Loading challenges..."})}):(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsx)("div",{className:"mb-6",children:(0,bs.jsx)("h3",{className:"text-lg font-semibold",children:"Score Management & Challenges"})}),(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row rounded-lg bg-gray-100 p-1 gap-1 sm:gap-0",children:[(0,bs.jsxs)("button",{className:"flex-1 py-2 px-3 rounded-md text-xs sm:text-sm font-medium transition-colors ".concat("challenges"===v?"bg-white text-gray-900 shadow":"text-gray-600"),onClick:()=>w("challenges"),children:[(0,bs.jsx)(ir,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Challenges"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"Challenges"}),(0,bs.jsxs)("span",{className:"ml-1",children:["(",l.filter(e=>"pending"===e.status).length,")"]})]}),(0,bs.jsxs)("button",{className:"flex-1 py-2 px-3 rounded-md text-xs sm:text-sm font-medium transition-colors ".concat("conflicts"===v?"bg-white text-gray-900 shadow":"text-gray-600"),onClick:()=>w("conflicts"),children:[(0,bs.jsx)(lr,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Conflicts"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"Conflicts"}),(0,bs.jsxs)("span",{className:"ml-1",children:["(",d.filter(e=>!e.resolved).length,")"]})]}),(0,bs.jsxs)("button",{className:"flex-1 py-2 px-3 rounded-md text-xs sm:text-sm font-medium transition-colors ".concat("results"===v?"bg-white text-gray-900 shadow":"text-gray-600"),onClick:()=>w("results"),children:[(0,bs.jsx)(Ga,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Edit Results"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"Edit"}),(0,bs.jsxs)("span",{className:"ml-1",children:["(",h.length,")"]})]})]}),"challenges"===v&&(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[(0,bs.jsxs)("h4",{className:"font-semibold flex items-center",children:[(0,bs.jsx)(ir,{className:"w-5 h-5 mr-2 text-orange-500"}),"Score Challenges (",l.length,")"]}),n&&(0,bs.jsxs)("div",{className:"text-sm text-gray-600 mt-1 sm:mt-0",children:["Season: ",(0,bs.jsx)("span",{className:"font-medium",children:n.name}),"completed"===n.status&&(0,bs.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Completed"})]})]}),"completed"===(null===n||void 0===n?void 0:n.status)&&(0,bs.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:(0,bs.jsxs)("div",{className:"flex items-center",children:[(0,bs.jsx)(or,{className:"w-5 h-5 text-yellow-600 mr-2"}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h5",{className:"font-medium text-yellow-800",children:"Season Completed"}),(0,bs.jsx)("p",{className:"text-sm text-yellow-700",children:"This season has been completed and closed. Score challenges cannot be processed for completed seasons."})]})]})}),0===l.length?(0,bs.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No score challenges yet"}):(0,bs.jsx)("div",{className:"space-y-6",children:(()=>{const e=l.filter(e=>"pending"===e.status),t=l.filter(e=>"pending"!==e.status);return(0,bs.jsxs)(bs.Fragment,{children:[e.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h5",{className:"font-medium text-orange-800 mb-3 flex items-center",children:[(0,bs.jsx)(lr,{className:"w-4 h-4 mr-2"}),"Pending Challenges (",e.length,")"]}),(0,bs.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,bs.jsx)(cr,{challenge:e,selectedSeason:n,resolveChallenge:N,editingScore:x,setEditingScore:f,editForm:y,setEditForm:b,saveScoreEdit:k},e.id))})]}),t.length>0&&(0,bs.jsx)(dr,{challenges:t})]})})()})]}),"conflicts"===v&&(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[(0,bs.jsxs)("h4",{className:"font-semibold flex items-center",children:[(0,bs.jsx)(lr,{className:"w-5 h-5 mr-2 text-red-500"}),"Score Conflicts (",d.length,")"]}),n&&(0,bs.jsxs)("div",{className:"text-sm text-gray-600 mt-1 sm:mt-0",children:["Season: ",(0,bs.jsx)("span",{className:"font-medium",children:n.name}),"completed"===n.status&&(0,bs.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Completed"})]})]}),0===d.length?(0,bs.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No score conflicts detected"}):(0,bs.jsx)("div",{className:"space-y-4",children:d.map(e=>{var t,s,a,r;return(0,bs.jsx)("div",{className:"border border-red-200 bg-red-50 rounded-lg p-4",children:(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded bg-red-100 text-red-800",children:"CONFLICT"}),(0,bs.jsx)("span",{className:"text-sm text-gray-600",children:"Detected on submission"})]}),(0,bs.jsx)(lr,{className:"w-5 h-5 text-red-500"})]}),(0,bs.jsx)("div",{className:"bg-white rounded-lg p-4 border",children:(0,bs.jsxs)("div",{className:"space-y-2",children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900",children:"Conflicting Submissions"}),(0,bs.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("strong",{children:"Original:"})," ",(null===(t=e.first_submission)||void 0===t?void 0:t.pair1_score)||"Unknown"," - ",(null===(s=e.first_submission)||void 0===s?void 0:s.pair2_score)||"Unknown"]}),(0,bs.jsxs)("div",{className:"mt-1",children:[(0,bs.jsx)("strong",{children:"New Submission:"})," ",(null===(a=e.conflicting_submission)||void 0===a?void 0:a.pair1_score)||"Unknown"," - ",(null===(r=e.conflicting_submission)||void 0===r?void 0:r.pair2_score)||"Unknown"]})]})]})}),(0,bs.jsxs)("div",{className:"text-xs text-gray-400",children:["Detected: ",new Date(e.created_at).toLocaleString(),e.resolved_at&&(0,bs.jsxs)("span",{children:[" \u2022 Resolved: ",new Date(e.resolved_at).toLocaleString()]})]})]})},e.id)})})]}),"results"===v&&(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[(0,bs.jsxs)("h4",{className:"font-semibold",children:["Match Results (",h.length,")"]}),n&&(0,bs.jsxs)("div",{className:"text-sm text-gray-600 mt-1 sm:mt-0",children:["Season: ",(0,bs.jsx)("span",{className:"font-medium",children:n.name}),"completed"===n.status&&(0,bs.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Completed"})]})]}),0===h.length?(0,bs.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No match results found"}):(0,bs.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:h.map(e=>{var t,s,a,r,i,l,o,d,u,h,m;return(0,bs.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"text-sm font-medium text-gray-900 mb-1",children:[(null===(t=e.fixture)||void 0===t||null===(s=t.player1)||void 0===s?void 0:s.name)||"Unknown"," & ",(null===(a=e.fixture)||void 0===a||null===(r=a.player2)||void 0===r?void 0:r.name)||"Unknown",(0,bs.jsx)("span",{className:"mx-2 text-gray-400",children:"vs"}),(null===(i=e.fixture)||void 0===i||null===(l=i.player3)||void 0===l?void 0:l.name)||"Unknown"," & ",(null===(o=e.fixture)||void 0===o||null===(d=o.player4)||void 0===d?void 0:d.name)||"Unknown"]}),(0,bs.jsxs)("div",{className:"text-xs text-gray-500",children:["Court ",(null===(u=e.fixture)||void 0===u?void 0:u.court_number)||"?"," \u2022 ",null!==(h=e.fixture)&&void 0!==h&&null!==(m=h.match)&&void 0!==m&&m.match_date?new Date(e.fixture.match.match_date).toLocaleDateString():"Unknown date"]})]}),(0,bs.jsx)("div",{className:"flex items-center space-x-4",children:(0,bs.jsx)("div",{className:"text-right",children:x===e.id?(0,bs.jsxs)("div",{className:"space-y-3",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("input",{type:"number",min:"0",className:"w-16 px-2 py-1 border border-gray-300 rounded text-center focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",value:y.pair1_score,onChange:e=>b(c(c({},y),{},{pair1_score:e.target.value})),disabled:p,placeholder:"0"}),(0,bs.jsx)("span",{className:"text-gray-500",children:"-"}),(0,bs.jsx)("input",{type:"number",min:"0",className:"w-16 px-2 py-1 border border-gray-300 rounded text-center focus:outline-none focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",value:y.pair2_score,onChange:e=>b(c(c({},y),{},{pair2_score:e.target.value})),disabled:p,placeholder:"0"})]}),(0,bs.jsxs)("div",{className:"flex gap-2",children:[(0,bs.jsxs)("button",{onClick:()=>k(e.id),disabled:p||!y.pair1_score||!y.pair2_score,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 disabled:opacity-50 flex items-center justify-center gap-2 transition-colors",children:[(0,bs.jsx)(na,{className:"w-4 h-4"}),"Save"]}),(0,bs.jsxs)("button",{onClick:S,disabled:p,className:"flex-1 bg-gray-500 text-white px-4 py-2 rounded text-sm hover:bg-gray-600 flex items-center justify-center gap-2 transition-colors",children:[(0,bs.jsx)(Es,{className:"w-4 h-4"}),"Cancel"]})]})]}):(0,bs.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,bs.jsx)("div",{className:"bg-gray-100 px-4 py-2 rounded-lg border border-gray-200",children:(0,bs.jsxs)("span",{className:"font-bold text-xl text-gray-800",children:[e.pair1_score," - ",e.pair2_score]})}),(0,bs.jsxs)("button",{onClick:()=>(e=>{"completed"!==(null===n||void 0===n?void 0:n.status)?(f(e.id),b({pair1_score:e.pair1_score.toString(),pair2_score:e.pair2_score.toString()})):alert("Cannot edit scores for completed seasons. Scores can only be edited for the current active season.")})(e),disabled:p||"completed"===(null===n||void 0===n?void 0:n.status),className:"px-3 py-2 rounded text-sm transition-colors flex items-center gap-2 ".concat("completed"===(null===n||void 0===n?void 0:n.status)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#5D1F1F] text-white hover:bg-[#4A1818]"),title:"completed"===(null===n||void 0===n?void 0:n.status)?"Cannot edit scores in completed seasons":"Edit score",children:[(0,bs.jsx)(Ga,{className:"w-4 h-4"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Edit"})]})]})})})]}),(0,bs.jsxs)("div",{className:"text-xs text-gray-400 mt-1 pt-1 border-t border-gray-100",children:["Submitted: ",e.created_at?new Date(e.created_at).toLocaleString():"Unknown"]})]},e.id)})})]})]})},hr=fs("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),mr=fs("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),pr=fs("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),gr=fs("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),xr=e=>{var t,s;let{isOpen:r,onClose:n,allUsers:i,currentUser:l,activeSeason:o,onDataRefresh:d}=e;const u=As(),[h,m]=(0,a.useState)(""),[p,g]=(0,a.useState)(null),[x,f]=(0,a.useState)(!1),[y,b]=(0,a.useState)("profile"),[v,w]=(0,a.useState)(""),[j,_]=(0,a.useState)(""),[N,k]=(0,a.useState)("player"),[S,C]=(0,a.useState)("approved"),[E,P]=(0,a.useState)(null),[T,D]=(0,a.useState)(null),[A,O]=(0,a.useState)(""),[F,R]=(0,a.useState)(""),[M,I]=(0,a.useState)(""),[L,U]=(0,a.useState)(null);(0,a.useEffect)(()=>{p?(w(p.name||""),_(p.email||""),k(p.role||"player"),C(p.status||"approved"),q(p.id),null!==o&&void 0!==o&&o.elo_enabled&&W(p.id)):z()},[p,o]);const z=()=>{w(""),_(""),k("player"),C("approved"),P(null),D(null),U(null),O(""),R(""),I(""),b("profile")},q=async e=>{try{const{data:t}=await is.from("season_players").select("\n          games_played,\n          games_won,\n          matches_played,\n          matches_won,\n          elo_rating,\n          season_id,\n          seasons!inner(name, season_type)\n        ").eq("player_id",e).order("created_at",{ascending:!1}),{count:s}=await is.from("coaching_attendance").select("id",{count:"exact"}).eq("player_id",e),{data:a}=await is.from("coaching_attendance").select("id, session_id, payment_status").eq("player_id",e).eq("payment_status","unpaid");U({seasonStats:t||[],coachingCount:s||0,unpaidCount:(null===a||void 0===a?void 0:a.length)||0})}catch(t){console.error("Error fetching player stats:",t)}},W=async e=>{if(null!==o&&void 0!==o&&o.id)try{const{data:t,error:s}=await is.from("season_players").select("id, elo_rating, matches_played, matches_won").eq("season_id",o.id).eq("player_id",e).maybeSingle();if(s)throw s;t&&(D(t),P(t.elo_rating||o.elo_initial_rating||1200))}catch(t){console.error("Error fetching player ELO:",t)}},B=(null===i||void 0===i?void 0:i.filter(e=>{var t,s;const a=h.toLowerCase();return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(a))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(a))}).sort((e,t)=>{var s;return null===(s=e.name)||void 0===s?void 0:s.localeCompare(t.name)}))||[],G=(null===i||void 0===i?void 0:i.filter(e=>{var t,s;if(!p||e.id===p.id)return!1;const a=F.toLowerCase();return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(a))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(a))}).sort((e,t)=>{var s;return null===(s=e.name)||void 0===s?void 0:s.localeCompare(t.name)}))||[],H=()=>{g(null),m(""),z(),n()},V=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);if(!r)return null;const J=p&&(v!==p.name||j!==p.email||N!==p.role||S!==p.status),K=T&&E&&E!==T.elo_rating;return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden flex flex-col",children:[(0,bs.jsx)("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsx)("div",{className:"bg-white/20 p-3 rounded-xl backdrop-blur-sm",children:(0,bs.jsx)(qs,{className:"w-6 h-6"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h2",{className:"text-2xl font-bold",children:"Player Management"}),(0,bs.jsx)("p",{className:"text-indigo-100 text-sm",children:"Complete player administration"})]})]}),(0,bs.jsx)("button",{onClick:H,disabled:x,className:"text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg",children:(0,bs.jsx)(Es,{className:"w-6 h-6"})})]})}),(0,bs.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,bs.jsxs)("div",{className:"p-6 space-y-6",children:[!p&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)(Ja,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,bs.jsx)("input",{type:"text",value:h,onChange:e=>m(e.target.value),placeholder:"Search players by name or email...",className:"w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-lg",autoFocus:!0})]}),h&&(0,bs.jsx)("div",{className:"mt-4 border-2 border-gray-200 rounded-xl max-h-96 overflow-y-auto",children:B.length>0?(0,bs.jsx)("div",{className:"divide-y divide-gray-100",children:B.map(e=>(0,bs.jsxs)("button",{onClick:()=>g(e),className:"w-full p-4 hover:bg-indigo-50 transition-colors text-left flex items-center justify-between group",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"font-semibold text-gray-900 group-hover:text-indigo-600",children:e.name}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),(0,bs.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,bs.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full ".concat("admin"===e.role?"bg-purple-100 text-purple-700":"coach"===e.role?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"),children:e.role||"player"}),(0,bs.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full ".concat("approved"===e.status?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:e.status})]})]}),(0,bs.jsx)(hr,{className:"w-5 h-5 text-gray-400 group-hover:text-indigo-600"})]},e.id))}):(0,bs.jsxs)("div",{className:"p-8 text-center text-gray-500",children:['No players found matching "',h,'"']})})]}),p&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 border-2 border-indigo-100 rounded-xl p-6 mb-6",children:[(0,bs.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:p.name}),(0,bs.jsx)("p",{className:"text-indigo-600",children:p.email})]}),(0,bs.jsx)("button",{onClick:()=>g(null),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:"Change Player"})]}),L&&(0,bs.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[(0,bs.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg p-3",children:[(0,bs.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"Seasons"}),(0,bs.jsx)("p",{className:"text-2xl font-bold text-indigo-600",children:L.seasonStats.length})]}),(0,bs.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg p-3",children:[(0,bs.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"Coaching"}),(0,bs.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:L.coachingCount})]}),(0,bs.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg p-3",children:[(0,bs.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"Unpaid"}),(0,bs.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:L.unpaidCount})]}),T&&(0,bs.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg p-3",children:[(0,bs.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"Current ELO"}),(0,bs.jsx)("p",{className:"text-2xl font-bold ".concat(hs(T.elo_rating)),children:T.elo_rating||"\u2014"})]})]})]}),(0,bs.jsxs)("div",{className:"flex border-b-2 border-gray-200 mb-6",children:[(0,bs.jsxs)("button",{onClick:()=>b("profile"),className:"px-6 py-3 font-semibold transition-colors relative ".concat("profile"===y?"text-indigo-600":"text-gray-500 hover:text-gray-700"),children:["Profile & Role","profile"===y&&(0,bs.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600"})]}),(0,bs.jsxs)("button",{onClick:()=>b("merge"),className:"px-6 py-3 font-semibold transition-colors relative ".concat("merge"===y?"text-indigo-600":"text-gray-500 hover:text-gray-700"),children:["Merge Player","merge"===y&&(0,bs.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600"})]}),(0,bs.jsxs)("button",{onClick:()=>b("delete"),className:"px-6 py-3 font-semibold transition-colors relative ".concat("delete"===y?"text-red-600":"text-gray-500 hover:text-gray-700"),children:["Delete","delete"===y&&(0,bs.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-600"})]})]}),"profile"===y&&(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,bs.jsx)(Us,{className:"w-4 h-4 inline mr-1"}),"Display Name"]}),(0,bs.jsx)("input",{type:"text",value:v,onChange:e=>w(e.target.value),disabled:x,className:"w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,bs.jsx)(mr,{className:"w-4 h-4 inline mr-1"}),"Email Address"]}),(0,bs.jsx)("input",{type:"email",value:j,onChange:e=>_(e.target.value),disabled:x,className:"w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,bs.jsx)(tr,{className:"w-4 h-4 inline mr-1"}),"Role"]}),(0,bs.jsxs)("select",{value:N,onChange:e=>k(e.target.value),disabled:x||p.id===(null===l||void 0===l?void 0:l.id),className:"w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent disabled:bg-gray-100",children:[(0,bs.jsx)("option",{value:"player",children:"Player"}),(0,bs.jsx)("option",{value:"coach",children:"Coach"}),(0,bs.jsx)("option",{value:"admin",children:"Admin"})]}),p.id===(null===l||void 0===l?void 0:l.id)&&(0,bs.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Cannot change your own role"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Status"}),(0,bs.jsxs)("select",{value:S,onChange:e=>C(e.target.value),disabled:x,className:"w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,bs.jsx)("option",{value:"approved",children:"Approved"}),(0,bs.jsx)("option",{value:"pending",children:"Pending"})]})]})]}),J&&(0,bs.jsxs)("button",{onClick:async()=>{if(p)if(v.trim())if(j.trim()&&V(j))if(p.id!==(null===l||void 0===l?void 0:l.id)||"admin"===N){f(!0);try{if(j!==p.email){const{data:e}=await is.from("profiles").select("id, name").eq("email",j.trim()).neq("id",p.id);if(e&&e.length>0)return u.error("Email already in use by ".concat(e[0].name)),void f(!1)}const{error:e}=await is.from("profiles").update({name:v.trim(),email:j.trim(),role:N,status:S}).eq("id",p.id);if(e)throw e;u.success("Profile updated for ".concat(v)),d&&d(),g(c(c({},p),{},{name:v,email:j,role:N,status:S}))}catch(e){console.error("Error updating profile:",e),u.error("Failed to update profile")}finally{f(!1)}}else u.error("You cannot remove your own admin privileges");else u.error("Valid email is required");else u.error("Name is required")},disabled:x,className:"w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 px-6 rounded-xl font-semibold hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition-all shadow-lg flex items-center justify-center gap-2",children:[(0,bs.jsx)(pr,{className:"w-5 h-5"}),x?"Saving...":"Save Profile Changes"]})]}),(null===o||void 0===o?void 0:o.elo_enabled)&&T&&(0,bs.jsxs)("div",{className:"border-t-2 border-gray-200 pt-6",children:[(0,bs.jsxs)("h4",{className:"font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,bs.jsx)(Is,{className:"w-5 h-5 text-yellow-600"}),"ELO Rating - ",o.name]}),(0,bs.jsxs)("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-4",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Current Rating"}),(0,bs.jsx)("input",{type:"number",min:"500",max:"3000",value:E||"",onChange:e=>P(parseInt(e.target.value)||null),disabled:x,className:"w-full p-3 border-2 border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"})]}),(0,bs.jsxs)("div",{className:"text-center",children:[(0,bs.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"Rank"}),(0,bs.jsx)("p",{className:"text-lg font-bold ".concat(hs(E||1200)),children:($=E||1200,$>=1400?"\ud83d\udd25 Elite":$>=1300?"\ud83c\udf1f Strong":$>=1200?"\u2b50 Good":$>=1100?"\ud83d\udcc8 Developing":"\ud83c\udd95 Beginner")})]})]}),K&&(0,bs.jsx)("button",{onClick:async()=>{if(!p||!T||!E)return;const e=Math.max(500,Math.min(3e3,parseInt(E)||1200));f(!0);try{const{error:t}=await is.from("season_players").update({elo_rating:e}).eq("id",T.id);if(t)throw t;await is.from("profiles").update({elo_rating:e}).eq("id",p.id),u.success("ELO rating updated to ".concat(e)),D(c(c({},T),{},{elo_rating:e})),d&&d()}catch(t){console.error("Error updating ELO:",t),u.error("Failed to update ELO rating")}finally{f(!1)}},disabled:x,className:"mt-4 w-full bg-yellow-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-yellow-700 disabled:opacity-50 transition-all",children:x?"Updating...":"Update ELO Rating"})]})]})]}),"merge"===y&&(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsx)("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-xl p-4",children:(0,bs.jsxs)("div",{className:"flex items-start gap-3",children:[(0,bs.jsx)(lr,{className:"w-5 h-5 text-amber-600 mt-0.5"}),(0,bs.jsxs)("div",{className:"text-sm text-amber-800",children:[(0,bs.jsx)("p",{className:"font-semibold mb-1",children:"Advanced Player Merge"}),(0,bs.jsxs)("p",{children:["This will merge ALL data from ",(0,bs.jsx)("strong",{children:p.name})," into another player account. This includes match history, season stats, coaching records, and more. The source account will be deleted. This cannot be undone."]})]})]})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Search Target Player (merge INTO)"}),(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)(Ja,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,bs.jsx)("input",{type:"text",value:F,onChange:e=>R(e.target.value),placeholder:"Search for target player...",className:"w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),F&&(0,bs.jsx)("div",{className:"border-2 border-gray-200 rounded-xl max-h-64 overflow-y-auto",children:G.length>0?(0,bs.jsx)("div",{className:"divide-y divide-gray-100",children:G.map(e=>(0,bs.jsxs)("button",{onClick:()=>O(e.id),className:"w-full p-4 transition-colors text-left ".concat(A===e.id?"bg-green-50 border-l-4 border-green-600":"hover:bg-gray-50"),children:[(0,bs.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:e.email})]},e.id))}):(0,bs.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No players found"})}),A&&(0,bs.jsxs)("div",{className:"bg-gradient-to-r from-red-50 to-green-50 border-2 border-gray-300 rounded-xl p-4",children:[(0,bs.jsxs)("h4",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[(0,bs.jsx)(gr,{className:"w-5 h-5"}),"Merge Preview"]}),(0,bs.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"font-semibold text-red-700 mb-1",children:"FROM (will be deleted):"}),(0,bs.jsx)("p",{className:"text-gray-800",children:p.name}),(0,bs.jsx)("p",{className:"text-gray-600",children:p.email})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"font-semibold text-green-700 mb-1",children:"TO (will receive all data):"}),(0,bs.jsx)("p",{className:"text-gray-800",children:null===(t=i.find(e=>e.id===A))||void 0===t?void 0:t.name}),(0,bs.jsx)("p",{className:"text-gray-600",children:null===(s=i.find(e=>e.id===A))||void 0===s?void 0:s.email})]})]})]}),(0,bs.jsx)("button",{onClick:async()=>{if(!p||!A)return void u.error("Please select a target player to merge into");const e=i.find(e=>e.id===A);if(e&&window.confirm("\u26a0\ufe0f MERGE PLAYERS\n\nThis will merge ALL data from:\n"+"  ".concat(p.name," (").concat(p.email,")\n\n")+"INTO:\n"+"  ".concat(e.name," (").concat(e.email,")\n\n")+"This includes:\n\u2022 All match history and results\n\u2022 Season statistics\n\u2022 Coaching attendance and payments\n\u2022 Availability records\n\nThe source account will be deleted.\nThis CANNOT be undone!\n\nContinue?")){f(!0);try{const{data:t}=await is.from("season_players").select("*").eq("player_id",p.id),{data:s}=await is.from("season_players").select("*").eq("player_id",A);for(const e of t||[]){const t=null===s||void 0===s?void 0:s.find(t=>t.season_id===e.season_id);t?(await is.from("season_players").update({games_played:(t.games_played||0)+(e.games_played||0),games_won:(t.games_won||0)+(e.games_won||0),matches_played:(t.matches_played||0)+(e.matches_played||0),matches_won:(t.matches_won||0)+(e.matches_won||0)}).eq("id",t.id),await is.from("season_players").delete().eq("id",e.id)):await is.from("season_players").update({player_id:A}).eq("id",e.id)}const a=["player1_id","player2_id","player3_id","player4_id","pair1_player1_id","pair1_player2_id","pair2_player1_id","pair2_player2_id","sitting_player_id"];for(const e of a)await is.from("match_fixtures").update({[e]:A}).eq(e,p.id);await is.from("match_results").update({submitted_by:A}).eq("submitted_by",p.id),await is.from("availability").update({player_id:A}).eq("player_id",p.id),await is.from("coaching_attendance").update({player_id:A}).eq("player_id",p.id),await is.from("coaching_payments").update({player_id:A}).eq("player_id",p.id),await is.from("score_challenges").update({challenger_id:A}).eq("challenger_id",p.id),await is.from("score_challenges").update({resolved_by:A}).eq("resolved_by",p.id),await is.from("score_conflicts").update({conflicting_user_id:A}).eq("conflicting_user_id",p.id),await is.from("score_conflicts").update({resolved_by:A}).eq("resolved_by",p.id);const{data:r}=await is.from("profiles").select("elo_rating").eq("id",p.id).single(),n=null===r||void 0===r?void 0:r.elo_rating;n&&1050!==n&&await is.from("profiles").update({elo_rating:n}).eq("id",A);const{error:i}=await is.from("profiles").delete().eq("id",p.id);i?(console.warn("Could not delete source profile:",i),u.success("Merged ".concat(p.name," into ").concat(e.name,"! (Source profile preserved due to constraints)"))):u.success("Successfully merged ".concat(p.name," into ").concat(e.name,"!")),d&&d(),H()}catch(t){console.error("Merge failed:",t),u.error("Merge failed: ".concat(t.message))}finally{f(!1)}}},disabled:x||!A,className:"w-full bg-amber-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg",children:x?"Merging Players...":"Merge Players"})]}),"delete"===y&&(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsx)("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-4",children:(0,bs.jsxs)("div",{className:"flex items-start gap-3",children:[(0,bs.jsx)(Ha,{className:"w-5 h-5 text-red-600 mt-0.5"}),(0,bs.jsxs)("div",{className:"text-sm text-red-800",children:[(0,bs.jsx)("p",{className:"font-semibold mb-1",children:"\u26a0\ufe0f Delete/Suspend User"}),(0,bs.jsx)("p",{className:"mb-2",children:"This will:"}),(0,bs.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,bs.jsx)("li",{children:'Set account status to "suspended"'}),(0,bs.jsx)("li",{children:"Anonymize name and email"}),(0,bs.jsx)("li",{children:"Remove from all current seasons"}),(0,bs.jsx)("li",{children:"Clear future availability"}),(0,bs.jsx)("li",{children:(0,bs.jsx)("strong",{children:"Preserve all match history and coaching records"})})]})]})]})}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Type exactly: ",(0,bs.jsxs)("span",{className:"font-mono text-red-600",children:["DELETE ",p.name]})]}),(0,bs.jsx)("input",{type:"text",value:M,onChange:e=>I(e.target.value),placeholder:"DELETE ".concat(p.name),className:"w-full p-3 border-2 border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent font-mono"}),M&&M==="DELETE ".concat(p.name)&&(0,bs.jsxs)("p",{className:"text-green-600 text-sm mt-1 flex items-center gap-1",children:[(0,bs.jsx)(Ns,{className:"w-4 h-4"}),"Confirmation text matches"]})]}),(0,bs.jsxs)("button",{onClick:async()=>{if(!p)return;const e="DELETE ".concat(p.name);if(M===e){if(window.confirm("\u26a0\ufe0f FINAL CONFIRMATION\n\nThis will SUSPEND the account for:\n"+"".concat(p.name," (").concat(p.email,")\n\n")+"Their account will be deactivated and anonymized,\nbut match history will be preserved.\n\nContinue?")){f(!0);try{const e="[Deleted User ".concat(p.id.substring(0,8),"]"),t="deleted_".concat(p.id,"@deleted.local"),{error:s}=await is.from("profiles").update({name:e,email:t,status:"suspended"}).eq("id",p.id);if(s)throw s;await is.from("season_players").delete().eq("player_id",p.id),await is.from("availability").delete().eq("player_id",p.id),u.success("User ".concat(p.name," has been suspended")),d&&d(),H()}catch(t){console.error("Delete failed:",t),u.error("Failed to suspend user")}finally{f(!1)}}}else u.error("Please type exactly: ".concat(e))},disabled:x||M!=="DELETE ".concat(p.name),className:"w-full bg-red-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg flex items-center justify-center gap-2",children:[(0,bs.jsx)(Ha,{className:"w-5 h-5"}),x?"Suspending User...":"SUSPEND USER"]})]})]})]})}),(0,bs.jsx)("div",{className:"border-t-2 border-gray-200 p-4 bg-gray-50",children:(0,bs.jsx)("button",{onClick:H,disabled:x,className:"w-full py-3 px-6 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 disabled:opacity-50 transition-all",children:"Close"})})]})});var $},fr=e=>{let{showModal:t,setShowModal:s,allUsers:r,ladderPlayers:n,addToLadder:i}=e;const[l,o]=(0,a.useState)(""),[c,d]=(0,a.useState)(null);if(!t)return null;const u=r.filter(e=>{var t,s;return"approved"===e.status&&!n.some(t=>t.id===e.id)&&((null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(l.toLowerCase()))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(l.toLowerCase())))}),h=n.length+1;return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden",children:[(0,bs.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Add Players to Ladder"}),(0,bs.jsx)("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"\xd7"})]}),(0,bs.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Add approved users to the current season's ladder with their starting rank"})]}),(0,bs.jsxs)("div",{className:"p-6",children:[(0,bs.jsx)("div",{className:"mb-6",children:(0,bs.jsx)("input",{type:"text",placeholder:"Search players by name or email...",value:l,onChange:e=>o(e.target.value),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent"})}),(0,bs.jsx)("div",{className:"overflow-y-auto max-h-96",children:0===u.length?(0,bs.jsx)("div",{className:"text-center py-8 text-gray-500",children:l?"No players found matching your search.":"No approved players waiting to join ladder."}):(0,bs.jsx)("div",{className:"space-y-3",children:u.map(e=>(0,bs.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsx)("div",{className:"flex-shrink-0",children:(0,bs.jsx)(qs,{className:"h-6 w-6 text-gray-400"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,bs.jsx)("div",{className:"text-sm text-gray-500",children:e.email}),(0,bs.jsxs)("div",{className:"text-xs text-gray-400",children:["Status: ",(0,bs.jsx)("span",{className:"text-green-600 font-semibold",children:"Approved"})]})]})]}),(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)(Is,{className:"h-4 w-4 text-yellow-500"}),(0,bs.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Rank:"}),(0,bs.jsx)("select",{id:"rank-".concat(e.id),defaultValue:h,className:"border border-gray-300 rounded px-2 py-1 text-sm focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",children:Array.from({length:h},(e,t)=>(0,bs.jsx)("option",{value:t+1,children:t+1},t+1))})]}),(0,bs.jsx)("button",{onClick:()=>(async e=>{const t=document.getElementById("rank-".concat(e)).value;if(t){d(e);try{const s=await i(e,t);null!==s&&void 0!==s&&s.success||alert("Failed to add player to ladder. Please try again.")}catch(s){console.error("Error adding to ladder:",s),alert("Error adding player to ladder: "+s.message)}finally{d(null)}}else alert("Please select a rank for the player.")})(e.id,e.name),disabled:c===e.id,className:"px-4 py-2 bg-[#5D1F1F] text-white text-sm rounded-md hover:bg-[#4A1818] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c===e.id?"Adding...":"Add to Ladder"})]})]},e.id))})}),n.length>0&&(0,bs.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,bs.jsx)("h4",{className:"text-sm font-semibold text-blue-800 mb-2",children:"Current Ladder Status:"}),(0,bs.jsxs)("p",{className:"text-sm text-blue-700",children:[n.length," players currently on the ladder. New players will be added at rank ",h," by default, but you can choose any rank."]})]})]}),(0,bs.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:(0,bs.jsx)("button",{onClick:()=>s(!1),className:"w-full bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 transition-colors",children:"Close"})})]})})},yr=e=>{let{showModal:t,setShowModal:s,seasons:r,selectedSeason:n,deleteSeason:i}=e;const[l,o]=(0,a.useState)(""),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)("");if(!t)return null;const m=r.find(e=>e.id===u),p=m?"DELETE ".concat(m.name):"";return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[(0,bs.jsxs)("div",{className:"p-6 border-b border-red-200 bg-red-50",children:[(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsx)("div",{className:"bg-red-100 p-2 rounded-full",children:(0,bs.jsx)(lr,{className:"w-6 h-6 text-red-600"})}),(0,bs.jsx)("h3",{className:"text-xl font-semibold text-red-900",children:"\u26a0\ufe0f Delete Season"})]}),(0,bs.jsx)("button",{onClick:()=>s(!1),className:"text-red-400 hover:text-red-600 text-2xl font-bold",children:"\xd7"})]}),(0,bs.jsx)("p",{className:"text-sm text-red-700 mt-2 font-medium",children:"\ud83d\udea8 DANGER: This action will permanently delete all season data and cannot be undone!"})]}),(0,bs.jsxs)("div",{className:"p-6 overflow-y-auto max-h-96",children:[(0,bs.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,bs.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,bs.jsx)(lr,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-semibold text-red-900 mb-2",children:"This will permanently delete:"}),(0,bs.jsxs)("ul",{className:"text-sm text-red-800 space-y-1",children:[(0,bs.jsx)("li",{children:"\u2022 All matches and match fixtures for the season"}),(0,bs.jsx)("li",{children:"\u2022 All match results and scores"}),(0,bs.jsx)("li",{children:"\u2022 All player rankings and ladder positions"}),(0,bs.jsx)("li",{children:"\u2022 All player availability records"}),(0,bs.jsx)("li",{children:"\u2022 The entire season record and history"})]}),(0,bs.jsx)("p",{className:"text-sm text-red-900 font-semibold mt-3",children:"\u26a0\ufe0f Users will NOT be deleted, only their season-specific data"})]})]})}),(0,bs.jsxs)("div",{className:"mb-6",children:[(0,bs.jsx)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Select Season to Delete:"}),(0,bs.jsxs)("select",{value:u,onChange:e=>{h(e.target.value),o("")},className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[(0,bs.jsx)("option",{value:"",children:"Choose a season..."}),r.map(e=>(0,bs.jsxs)("option",{value:e.id,children:[e.name," (",e.status,") - Started: ",new Date(e.start_date).toLocaleDateString("en-GB"),e.id===(null===n||void 0===n?void 0:n.id)?" [CURRENTLY SELECTED]":""]},e.id))]})]}),u&&(0,bs.jsxs)("div",{className:"mb-6",children:[(0,bs.jsxs)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Type exactly: ",(0,bs.jsx)("span",{className:"text-red-600 font-mono",children:p})]}),(0,bs.jsx)("input",{type:"text",value:l,onChange:e=>o(e.target.value),placeholder:p,className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent font-mono"}),l&&l!==p&&(0,bs.jsxs)("p",{className:"text-red-600 text-sm mt-1",children:["\u274c Text doesn't match. Please type exactly: ",p]}),l===p&&(0,bs.jsx)("p",{className:"text-green-600 text-sm mt-1",children:"\u2705 Confirmation text matches"})]}),m&&(0,bs.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,bs.jsx)(Ls,{className:"w-4 h-4 text-gray-600"}),(0,bs.jsx)("h4",{className:"font-medium text-gray-900",children:"Season to be deleted:"})]}),(0,bs.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Name:"})," ",m.name]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Status:"})," ",m.status]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Started:"})," ",new Date(m.start_date).toLocaleDateString("en-GB")]}),m.end_date&&(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Ended:"})," ",new Date(m.end_date).toLocaleDateString("en-GB")]})]})]})]}),(0,bs.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:(0,bs.jsxs)("div",{className:"flex space-x-3",children:[(0,bs.jsxs)("button",{onClick:async()=>{if(!u)return void alert("Please select a season to delete.");const e=r.find(e=>e.id===u);if(!e)return void alert("Selected season not found.");const t="DELETE ".concat(e.name);if(l!==t)return void alert("Please type exactly: ".concat(t));if(!window.confirm('\u26a0\ufe0f FINAL WARNING: This will permanently delete "'.concat(e.name,'" and ALL associated data:\n\n')+"\u2022 All matches and results for this season\n\u2022 All player rankings for this season\n\u2022 All availability records for this season\n\u2022 The entire season record\n\nThis action CANNOT be undone!\n\nClick OK to proceed with deletion."))return;if(window.confirm('\ud83d\udea8 LAST CHANCE: You are about to permanently delete season "'.concat(e.name,'".\n\n')+"This will remove ALL DATA for this season from the database forever.\n\nAre you absolutely certain you want to continue?")){d(!0);try{const t=await i(e.id,e.name);if(null!==t&&void 0!==t&&t.success)alert('\u2705 Season "'.concat(e.name,'" has been permanently deleted.')),s(!1),o(""),h("");else{var a,n;console.error("Season deletion failed:",null===t||void 0===t?void 0:t.error);const e=(null===t||void 0===t||null===(a=t.error)||void 0===a?void 0:a.message)||(null===t||void 0===t||null===(n=t.error)||void 0===n?void 0:n.details)||(null===t||void 0===t?void 0:t.error)||"Unknown error";alert("\u274c Failed to delete season: ".concat(e,"\n\nPlease try again or contact support."))}}catch(c){console.error("Error deleting season:",c),alert("\u274c Error deleting season: "+c.message)}finally{d(!1)}}},disabled:c||!u||l!==p,className:"flex-1 bg-red-600 text-white py-3 px-4 rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-semibold flex items-center justify-center space-x-2",children:[(0,bs.jsx)(Ha,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:c?"Deleting Season...":"DELETE SEASON PERMANENTLY"})]}),(0,bs.jsx)("button",{onClick:()=>{s(!1),o(""),h("")},disabled:c,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-md hover:bg-gray-400 disabled:opacity-50 transition-colors",children:"Cancel"})]})})]})})},br=fs("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),vr=e=>{try{const t=e.trim().split("\n").map(e=>e.trim()).filter(e=>e);if(t.length<5)throw new Error("Not enough lines in the text - please paste the complete match data");const s=t[0],{homeTeam:a,awayTeam:r}=wr(s),{matchDate:n,matchTime:i}=jr(t[1]),{homeTeamPairs:l,awayTeamPairs:o,scoringMatrix:c}=_r(t.slice(2),a,r);return{success:!0,data:{matchDate:n,matchTime:i,homeTeam:a,awayTeam:r,homeTeamPairs:l,awayTeamPairs:o,scoringMatrix:c,source:"text"}}}catch(t){return console.error("Error parsing league match text:",t),{success:!1,error:t.message,data:null}}},wr=e=>{const t=e.replace(/^Fixtures\s*-\s*/,"").match(/^(.+?)\s+v[s]?\s+(.+)$/i);if(t)return{homeTeam:t[1].trim(),awayTeam:t[2].trim()};throw new Error("Could not parse team names from header")},jr=e=>{const t=e.match(/(\d{1,2}\s+\w+\s+\d{4})\s*-\s*(\d{1,2}:\d{2})/);if(!t)throw new Error("Could not parse date and time");const[,s,a]=t,r=new Date(s);if(isNaN(r.getTime()))throw new Error("Invalid date format");return{matchDate:r.toISOString().split("T")[0],matchTime:a}},_r=(e,t,s)=>{let a=-1;for(let l=0;l<e.length;l++)if(e[l].trim()===s){a=l;break}if(-1===a)throw new Error("Could not find away team header (".concat(s,")"));const{awayTeamPairs:r,homeTeamPairs:n,scoringMatrix:i}=Nr(e,a,t,s);return{homeTeamPairs:n,awayTeamPairs:r,scoringMatrix:i}},Nr=(e,t,s,a)=>{const r=[],n=[],i=[],l=[];for(let o=t+1;o<e.length;o++){const t=e[o].trim();if(t.match(/\d+\s*-\s*\d+/))break;let a=t;a.startsWith(s)&&(a=a.substring(s.length).trim()),a=a.replace(/GF\s*GA.*$/,"").trim();const r=a.split(/\s{4,}|\t+/).filter(e=>e.trim().length>0);if(r.forEach(e=>{const t=e.trim();t&&t.length>1&&l.push(t)}),0!==r.length||!a||a.includes("GF")||a.includes("GA")||l.push(a),t.includes("GF")&&t.includes("GA"))break}for(let o=0;o<l.length;o+=2)o+1<l.length&&r.push({player1:l[o],player2:l[o+1]});for(let o=0;o<e.length;o++){const t=e[o].trim(),s=/(\d+)\s*-\s*(\d+)/g,a=[...t.matchAll(s)];if(a.length>=3){const s=o>0?e[o-1].trim():"",r=t.split(/\d+\s*-\s*\d+/)[0].trim();if(s&&r){n.push({player1:s,player2:r});const e=a.slice(0,3).map(e=>({homeScore:parseInt(e[1]),awayScore:parseInt(e[2])}));i.push(e)}}}return{awayTeamPairs:r,homeTeamPairs:n,scoringMatrix:i}},kr=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e||!t||0===t.length)return[];const a=s.find(t=>t.parsed_name.toLowerCase()===e.toLowerCase()),r=e.charAt(0).toLowerCase();return t.filter(e=>e.name.charAt(0).toLowerCase()===r).map(t=>({player:t,score:85,isExact:t.name.toLowerCase()===e.toLowerCase(),isCached:a&&a.matched_player_id===t.id})).sort((e,t)=>e.isCached&&!t.isCached?-1:!e.isCached&&t.isCached?1:e.isExact&&!t.isExact?-1:!e.isExact&&t.isExact?1:e.player.name.localeCompare(t.player.name))},Sr=async e=>{if(!e)return[];try{const{data:t,error:s}=await e.from("player_match_cache").select("\n        parsed_name,\n        matched_player_id,\n        profiles:matched_player_id(id, name, email)\n      ");if(s)throw s;return t||[]}catch(t){return console.error("Failed to fetch cached player matches:",t),[]}},Cr=async(e,t,s,a)=>{if(!e||!t||!s)return!1;try{const{error:r}=await e.from("player_match_cache").upsert({parsed_name:t,matched_player_id:s,confirmed_by:a,updated_at:(new Date).toISOString()},{onConflict:"parsed_name,matched_player_id"});if(r)throw r;return!0}catch(r){return console.error("Failed to save cached player match:",r),!1}},Er=e=>{if(!e)return{cawoodPlayers:[],opponentPlayers:[],opponentClub:null};const{homeTeam:t,awayTeam:s,homeTeamPairs:a,awayTeamPairs:r}=e;let n=[],i=[],l=null;const o=t&&t.toLowerCase().includes("cawood");s&&s.toLowerCase().includes("cawood");return o?(l=s,n=(null===a||void 0===a?void 0:a.flatMap(e=>[e.player1,e.player2]))||[],i=(null===r||void 0===r?void 0:r.flatMap(e=>[e.player1,e.player2]))||[]):(l=t,n=(null===r||void 0===r?void 0:r.flatMap(e=>[e.player1,e.player2]))||[],i=(null===a||void 0===a?void 0:a.flatMap(e=>[e.player1,e.player2]))||[]),n=[...new Set(n.filter(e=>e&&e.trim()))],i=[...new Set(i.filter(e=>e&&e.trim()))],{cawoodPlayers:n,opponentPlayers:i,opponentClub:l,cawoodIsHome:o}},Pr=e=>{if(!e)return"unknown@cawood.dummy";const t=e.toLowerCase().replace(/[^a-z\s]/g,"").trim().split(" ").filter(e=>e.length>0).join(".");return"".concat(t,"@cawood.dummy")},Tr=e=>{var t,s;let{isOpen:r,onClose:n,supabase:i,selectedSeason:l}=e;const[o,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null),[p,g]=(0,a.useState)(""),[x,f]=(0,a.useState)("parse"),[y,b]=(0,a.useState)([]),[v,w]=(0,a.useState)([]),[j,_]=(0,a.useState)([]),[N,k]=(0,a.useState)(null);(0,a.useEffect)(()=>{r&&(async()=>{if(i)try{const{data:e,error:t}=await i.from("profiles").select("id, name, email").in("role",["player","admin"]).eq("status","approved").order("name");if(t)throw t;b(e||[]);const s=await Sr(i);w(s)}catch(e){console.error("Failed to fetch data:",e)}})()},[r,i]);const S=()=>{c(""),m(null),g(""),f("parse"),_([]),k(null)},C=()=>{S(),n()};return r?(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gray-50",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsx)(br,{className:"w-6 h-6 text-blue-600"}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"League Match Import"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"Import match results by pasting match text data"})]})]}),(0,bs.jsx)("button",{onClick:C,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,bs.jsx)(Es,{className:"w-6 h-6"})})]}),(0,bs.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:["parse"===x&&(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Match Data Text"}),(0,bs.jsxs)("div",{className:"space-y-2",children:[(0,bs.jsx)("textarea",{value:o,onChange:e=>c(e.target.value),placeholder:"Paste the match data here, for example:\n\nFixtures - Market Weighton v Cawood 2\n27 April 2025 - 10:00\n     Cawood 2          \nMarket Weighton    Steven Walter\nNas Shefta    John Best\nMike Brennan    Mark Bottomley\nSteve Caslake    GF    GA\nIan Robson\nAled Edwards    6 - 6    7 - 5    10 - 2    23    13\n...",rows:12,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm font-mono",disabled:d}),(0,bs.jsxs)("div",{className:"flex space-x-2",children:[(0,bs.jsx)("button",{onClick:async()=>{u(!0),g(""),m(null);try{if(!o.trim())return void g("Please paste the match text data");const e=vr(o);if(e.success){m(e.data),g("");const t=Er(e.data);k(t);const s=t.cawoodPlayers.map(e=>{const t=kr(e,y,v),s=v.find(t=>t.parsed_name.toLowerCase()===e.toLowerCase()),a=s?y.find(e=>e.id===s.matched_player_id):null;return{parsedName:e,suggestions:t,selectedMatch:a,createNew:!1,isCachedMatch:!!a,newPlayerData:{name:e,email:Pr(e)}}});_(s),f("match")}else g(e.error||"Failed to parse match text"),m(null)}catch(e){g("Error: ".concat(e.message)),m(null)}finally{u(!1)}},disabled:d||!o.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:d?(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,bs.jsx)("span",{children:"Parsing..."})]}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(br,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Parse Text"})]})}),(0,bs.jsx)("button",{onClick:()=>{c("Fixtures - Market Weighton v Cawood 2\n27 April 2025 - 10:00\n     Cawood 2          \nMarket Weighton    Steven Walter\nNas Shefta    John Best\nMike Brennan    Mark Bottomley\nSteve Caslake    GF    GA\nIan Robson\nAled Edwards    6 - 6    7 - 5    10 - 2    23    13\nNick Collins\nStewart Berry    6 - 6    5 - 7    11 - 1    22    14\nKen Bottomer\nKeigan Freeman Hacker    6 - 6    5 - 7    11 - 1    22    14\nMarket Weighton    8.5    3.5    Cawood 2\n67    41")},className:"px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 text-sm",disabled:d,children:"Use Example"})]})]}),(0,bs.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Copy and paste the complete match results text from the league website"})]}),p&&(0,bs.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,bs.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,bs.jsx)(Ss,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h3",{className:"font-medium text-red-800",children:"Parse Error"}),(0,bs.jsx)("p",{className:"text-sm text-red-700 mt-1",children:p})]})]})}),(()=>{var e,t,s,a;return h?(0,bs.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,bs.jsx)(Ns,{className:"w-5 h-5 text-green-600"}),(0,bs.jsx)("h3",{className:"font-semibold text-green-800",children:"Match Data Parsed Successfully!"})]}),(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Match Information"}),(0,bs.jsxs)("div",{className:"text-sm space-y-1",children:[(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Date:"})," ",h.matchDate||"Not found"]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Time:"})," ",h.matchTime||"Not found"]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Home Team:"})," ",h.homeTeam||"Not found"]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Away Team:"})," ",h.awayTeam||"Not found"]})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Data Summary"}),(0,bs.jsxs)("div",{className:"text-sm space-y-1",children:[(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Home Team Pairs:"})," ",(null===(e=h.homeTeamPairs)||void 0===e?void 0:e.length)||0]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Away Team Pairs:"})," ",(null===(t=h.awayTeamPairs)||void 0===t?void 0:t.length)||0]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Scoring Matrix:"})," ",(null===(s=h.scoringMatrix)||void 0===s?void 0:s.length)||0," rows"]})]})]})]}),h.homeTeamPairs&&h.homeTeamPairs.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h4",{className:"font-medium text-gray-700 mb-2",children:["Home Team Pairs (",h.homeTeam,")"]}),(0,bs.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:h.homeTeamPairs.map((e,t)=>(0,bs.jsxs)("div",{className:"bg-white p-2 rounded border",children:[(0,bs.jsxs)("p",{className:"font-medium",children:["Pair ",t+1]}),(0,bs.jsx)("p",{children:e.player1}),(0,bs.jsx)("p",{children:e.player2})]},t))})]}),h.awayTeamPairs&&h.awayTeamPairs.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h4",{className:"font-medium text-gray-700 mb-2",children:["Away Team Pairs (",h.awayTeam,")"]}),(0,bs.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:h.awayTeamPairs.map((e,t)=>(0,bs.jsxs)("div",{className:"bg-white p-2 rounded border",children:[(0,bs.jsxs)("p",{className:"font-medium",children:["Pair ",t+1]}),(0,bs.jsx)("p",{children:e.player1}),(0,bs.jsx)("p",{children:e.player2})]},t))})]}),h.scoringMatrix&&h.scoringMatrix.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"Scoring Matrix"}),(0,bs.jsx)("div",{className:"overflow-x-auto",children:(0,bs.jsxs)("table",{className:"min-w-full border border-gray-300 text-sm",children:[(0,bs.jsx)("thead",{className:"bg-gray-50",children:(0,bs.jsxs)("tr",{children:[(0,bs.jsxs)("th",{className:"border border-gray-300 px-2 py-1",children:["Home Pair (",h.homeTeam,")"]}),null===(a=h.awayTeamPairs)||void 0===a?void 0:a.map((e,t)=>(0,bs.jsxs)("th",{className:"border border-gray-300 px-2 py-1",children:["vs ",e.player1," & ",e.player2]},t))]})}),(0,bs.jsx)("tbody",{children:h.scoringMatrix.map((e,t)=>{var s;return(0,bs.jsxs)("tr",{children:[(0,bs.jsx)("td",{className:"border border-gray-300 px-2 py-1 font-medium",children:null!==(s=h.homeTeamPairs)&&void 0!==s&&s[t]?"".concat(h.homeTeamPairs[t].player1," & ").concat(h.homeTeamPairs[t].player2):"Home Pair ".concat(t+1)}),e.map((e,t)=>(0,bs.jsx)("td",{className:"border border-gray-300 px-2 py-1 text-center",children:e?"".concat(e.homeScore,"-").concat(e.awayScore):"No score"},t))]},t)})})]})})]}),(0,bs.jsxs)("details",{className:"mt-4",children:[(0,bs.jsx)("summary",{className:"cursor-pointer text-sm text-gray-600 hover:text-gray-800",children:"Show Raw Parsed Data (for debugging)"}),(0,bs.jsx)("pre",{className:"mt-2 p-3 bg-gray-100 text-xs overflow-auto max-h-40 rounded",children:JSON.stringify(h,null,2)})]})]})]}):null})()]}),"match"===x&&(()=>{if(!N||!j.length)return null;const e=(e,t,s)=>{const a=[...j];a[e].newPlayerData[t]=s,_(a)},t=j.every(e=>e.selectedMatch||e.createNew&&e.newPlayerData.name.trim()&&e.newPlayerData.email.trim());return(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,bs.jsx)(qs,{className:"w-5 h-5 text-blue-600"}),(0,bs.jsx)("h3",{className:"font-semibold text-blue-800",children:"Player Matching Required"})]}),(0,bs.jsxs)("p",{className:"text-sm text-blue-700",children:["Match the ",N.cawoodPlayers.length," Cawood players from the parsed data with existing users, or create new accounts."]}),(0,bs.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:[(0,bs.jsx)("strong",{children:"Opponent club:"})," ",N.opponentClub," (",N.opponentPlayers.length," players)"]})]}),(0,bs.jsx)("div",{className:"space-y-4",children:j.map((t,s)=>(0,bs.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,bs.jsxs)("h4",{className:"font-medium text-gray-900",children:["Parsed Name: ",(0,bs.jsx)("span",{className:"text-blue-600",children:t.parsedName}),t.isCachedMatch&&(0,bs.jsx)("span",{className:"ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:"\u2713 Previously Confirmed"})]}),(0,bs.jsxs)("div",{className:"text-sm text-gray-500",children:[t.suggestions.length," player",1!==t.suggestions.length?"s":"",' starting with "',t.parsedName.charAt(0).toUpperCase(),'"']})]}),t.suggestions.length>0&&(0,bs.jsxs)("div",{className:"mb-4",children:[(0,bs.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:['Players starting with "',t.parsedName.charAt(0).toUpperCase(),'":']}),(0,bs.jsx)("div",{className:"space-y-2",children:t.suggestions.map((e,a)=>{var r;return(0,bs.jsxs)("label",{className:"flex items-center space-x-3 p-2 border rounded hover:bg-gray-50 ".concat(e.isCached?"border-green-300 bg-green-50":""),children:[(0,bs.jsx)("input",{type:"radio",name:"player-".concat(s),checked:(null===(r=t.selectedMatch)||void 0===r?void 0:r.id)===e.player.id,onChange:()=>((e,t)=>{const s=[...j];s[e].selectedMatch=t,s[e].createNew=!1,_(s)})(s,e.player),disabled:t.createNew,className:"text-blue-600"}),(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsx)("div",{className:"font-medium",children:e.player.name}),(0,bs.jsx)("div",{className:"text-sm text-gray-500",children:e.player.email})]}),(0,bs.jsxs)("div",{className:"text-right",children:[e.isCached&&(0,bs.jsx)("div",{className:"text-sm font-medium text-green-600",children:"\u2713 Cached"}),e.isExact&&!e.isCached&&(0,bs.jsx)("div",{className:"text-sm font-medium text-blue-600",children:"Exact match"})]})]},a)})})]}),(0,bs.jsxs)("div",{className:"border-t pt-4",children:[(0,bs.jsxs)("label",{className:"flex items-center space-x-3 mb-3",children:[(0,bs.jsx)("input",{type:"checkbox",checked:t.createNew,onChange:e=>((e,t)=>{const s=[...j];s[e].createNew=t,t&&(s[e].selectedMatch=null),_(s)})(s,e.target.checked),className:"text-blue-600"}),(0,bs.jsx)("span",{className:"font-medium text-gray-700",children:"Create new user"}),(0,bs.jsx)(sr,{className:"w-4 h-4 text-gray-400"})]}),t.createNew&&(0,bs.jsxs)("div",{className:"ml-6 space-y-3 bg-gray-50 p-3 rounded",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),(0,bs.jsx)("input",{type:"text",value:t.newPlayerData.name,onChange:t=>e(s,"name",t.target.value),className:"mt-1 w-full px-3 py-1 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,bs.jsx)("input",{type:"email",value:t.newPlayerData.email,onChange:t=>e(s,"email",t.target.value),className:"mt-1 w-full px-3 py-1 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),(0,bs.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Dummy email format recommended"})]})]})]})]},s))}),(0,bs.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t",children:[(0,bs.jsx)("button",{onClick:()=>f("parse"),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded hover:bg-gray-200",children:"\u2190 Back to Parsing"}),(0,bs.jsx)("button",{onClick:()=>f("import"),disabled:!t,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Proceed to Import \u2192"})]})]})})(),"import"===x&&(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,bs.jsx)(Ss,{className:"w-5 h-5 text-yellow-600"}),(0,bs.jsx)("h3",{className:"font-semibold text-yellow-800",children:"Ready to Import"})]}),(0,bs.jsxs)("div",{className:"text-sm text-yellow-700 space-y-2",children:[(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Season:"})," ",null===l||void 0===l?void 0:l.name," (",null===l||void 0===l?void 0:l.season_type,")"]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Match:"})," ",null===h||void 0===h?void 0:h.homeTeam," vs ",null===h||void 0===h?void 0:h.awayTeam]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Date:"})," ",null===h||void 0===h?void 0:h.matchDate]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Cawood Team:"})," ",null!==N&&void 0!==N&&N.cawoodIsHome?"Home":"Away"," (",(null===N||void 0===N||null===(t=N.cawoodPlayers)||void 0===t?void 0:t.length)||0," players)"]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Opponent:"})," ",null===N||void 0===N?void 0:N.opponentClub," (",(null===N||void 0===N||null===(s=N.opponentPlayers)||void 0===s?void 0:s.length)||0," players)"]})]})]}),(0,bs.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bs.jsx)("button",{onClick:()=>f("match"),disabled:d,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50",children:"\u2190 Back to Matching"}),(0,bs.jsx)("button",{onClick:async()=>{if(l&&N&&j&&h&&i)if("league"===l.season_type){u(!0),g("");try{var e,t;const{matchDate:r,homeTeam:n,awayTeam:o,scoringMatrix:c}=h,{opponentPlayers:d,opponentClub:u,cawoodIsHome:m}=N,p=(m?n:o).toLowerCase().includes("2")?"2nds":"1sts",{data:g}=await i.from("matches").select("week_number").eq("season_id",l.id).order("week_number",{ascending:!1}).limit(1),x=(null===g||void 0===g?void 0:g.length)>0?(g[0].week_number||0)+1:1,{data:y,error:b}=await i.from("matches").insert({season_id:l.id,week_number:x,match_date:r}).select().single();if(b)throw b;const v={};for(const e of d){const{data:t}=await i.from("external_players").select("id").eq("name",e).eq("club_name",u).maybeSingle();if(t)v[e]=t.id;else{const{data:t,error:s}=await i.from("external_players").insert({name:e,club_name:u}).select("id").single();if(s)throw s;v[e]=t.id}}const w={};for(const e of j)if(e.createNew&&e.newPlayerData.name.trim()){const{data:t,error:s}=await i.from("profiles").insert({name:e.newPlayerData.name,email:e.newPlayerData.email,status:"approved",role:"player"}).select("id").single();if(s)throw s;w[e.parsedName]=t.id}else e.selectedMatch&&(w[e.parsedName]=e.selectedMatch.id);const _=Object.values(w);if(0===_.length)throw new Error("No Cawood players found or created");const{data:k,error:S}=await i.from("match_fixtures").insert({match_id:y.id,court_number:1,game_number:1,player1_id:_[0],player2_id:_[1]||_[0],player3_id:_[2]||_[0],player4_id:_[3]||_[0],match_type:"league",team:p,opponent_club:u}).select().single();if(S)throw S;const C=m?h.homeTeamPairs:h.awayTeamPairs,E=m?h.awayTeamPairs:h.homeTeamPairs;let P=1;for(let e=0;e<Math.min(C.length,3);e++){const t=C[e];for(let r=0;r<Math.min(E.length,3);r++){var s,a;const n=E[r],l=m?null===(s=c[e])||void 0===s?void 0:s[r]:null===(a=c[r])||void 0===a?void 0:a[e];if(l){const e=m?l.homeScore:l.awayScore,s=m?l.awayScore:l.homeScore,{error:a}=await i.from("league_match_rubbers").insert({match_fixture_id:k.id,rubber_number:P,cawood_player1_id:w[t.player1],cawood_player2_id:w[t.player2],opponent_player1_id:v[n.player1],opponent_player2_id:v[n.player2],cawood_games_won:e,opponent_games_won:s});if(a)throw a;P++}}}const T=null===i||void 0===i||null===(e=i.auth)||void 0===e||null===(t=e.user)||void 0===t?void 0:t.id;for(const e of j)!e.selectedMatch||e.createNew||e.isCachedMatch||await Cr(i,e.parsedName,e.selectedMatch.id,T);f("success")}catch(r){console.error("Import error:",r),g("Import failed: ".concat(r.message))}finally{u(!1)}}else g("League matches can only be imported to league seasons. Please select a league season.");else g("Missing required data for import")},disabled:d||"league"!==(null===l||void 0===l?void 0:l.season_type),className:"px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:d?(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,bs.jsx)("span",{children:"Importing..."})]}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(Ns,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:"Import to Database"})]})})]})]}),"success"===x&&(0,bs.jsxs)("div",{className:"text-center py-8",children:[(0,bs.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[(0,bs.jsx)(Ns,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),(0,bs.jsx)("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Import Successful!"}),(0,bs.jsx)("p",{className:"text-green-700 mb-4",children:"League match has been imported to the database. All players, rubbers, and results have been saved."}),(0,bs.jsxs)("div",{className:"space-y-2 text-sm text-green-600",children:[(0,bs.jsx)("p",{children:"\u2713 Match record created"}),(0,bs.jsx)("p",{children:"\u2713 External players added"}),(0,bs.jsx)("p",{children:"\u2713 League rubbers recorded"}),(0,bs.jsx)("p",{children:"\u2713 Stats will be updated in profiles"})]})]}),(0,bs.jsxs)("div",{className:"mt-6 space-x-3",children:[(0,bs.jsx)("button",{onClick:S,className:"px-4 py-2 text-blue-600 border border-blue-600 rounded hover:bg-blue-50",children:"Import Another Match"}),(0,bs.jsx)("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Close"})]})]})]}),(0,bs.jsx)("div",{className:"border-t border-gray-200 p-4 bg-gray-50",children:(0,bs.jsxs)("div",{className:"flex justify-end space-x-3",children:[h&&"parse"===x&&(0,bs.jsx)("button",{onClick:S,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Parse Another URL"}),(0,bs.jsx)("button",{onClick:C,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Close"})]})})]})}):null},Dr=fs("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Ar=e=>{var t;let{isOpen:s,onClose:r,supabase:n,onPlayerAdded:i}=e;const[l,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(""),[u,h]=(0,a.useState)(""),[m,p]=(0,a.useState)(!1),[g,x]=(0,a.useState)(""),[f,y]=(0,a.useState)(""),[b,v]=(0,a.useState)(""),[w,j]=(0,a.useState)(""),[_,N]=(0,a.useState)(!1),[k,S]=(0,a.useState)(null),C=()=>{d(""),h(""),p(!1),x(""),y(""),v(""),j(""),N(!1),S(null)},E=()=>{C(),r()},P=()=>c.trim()?c.trim().length<2?"Player name must be at least 2 characters":u.trim()&&!T(u.trim())?"Please enter a valid email address":null:"Player name is required",T=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);return s?(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,bs.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsx)("div",{className:"bg-purple-100 p-2 rounded-full",children:(0,bs.jsx)(sr,{className:"w-6 h-6 text-purple-600"})}),(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Add External Player"})]}),(0,bs.jsx)("button",{onClick:E,disabled:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,bs.jsx)(Es,{className:"w-6 h-6"})})]})}),(0,bs.jsx)("div",{className:"p-6",children:_?(0,bs.jsxs)("div",{className:"text-center py-8",children:[(0,bs.jsx)("div",{className:"bg-green-100 p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,bs.jsx)(Ns,{className:"w-8 h-8 text-green-600"})}),(0,bs.jsx)("h4",{className:"text-lg font-semibold text-green-800 mb-2",children:"Player Added Successfully!"}),(0,bs.jsx)("p",{className:"text-green-600 mb-2",children:(0,bs.jsx)("strong",{children:null===k||void 0===k?void 0:k.name})}),(0,bs.jsx)("p",{className:"text-xs text-gray-500 mb-6",children:null!==k&&void 0!==k&&null!==(t=k.email)&&void 0!==t&&t.includes("@skeleton.local")?"Auto-generated skeleton email address":"Email: ".concat(null===k||void 0===k?void 0:k.email)}),(0,bs.jsxs)("div",{className:"flex space-x-3 justify-center",children:[(0,bs.jsx)("button",{onClick:()=>{C()},className:"bg-purple-600 text-white py-2 px-6 rounded-md hover:bg-purple-700 transition-colors font-medium",children:"Add Another Player"}),(0,bs.jsx)("button",{onClick:E,className:"bg-gray-300 text-gray-700 py-2 px-6 rounded-md hover:bg-gray-400 transition-colors",children:"Done"})]})]}):(0,bs.jsxs)("div",{className:"space-y-6",children:[w&&(0,bs.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 flex items-start space-x-3",children:[(0,bs.jsx)(Ss,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),(0,bs.jsx)("p",{className:"text-red-700",children:w})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,bs.jsx)("h4",{className:"text-blue-800 font-medium mb-2",children:"What is an External Player?"}),(0,bs.jsxs)("ul",{className:"text-blue-700 text-sm space-y-1",children:[(0,bs.jsx)("li",{children:"\u2022 Players who haven't signed up to the app"}),(0,bs.jsx)("li",{children:"\u2022 External opponents from other clubs"}),(0,bs.jsx)("li",{children:"\u2022 Junior players for coaching attendance"}),(0,bs.jsx)("li",{children:"\u2022 They won't be able to log in or see the app"})]})]}),(0,bs.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-purple-50 border border-purple-200 rounded-md",children:[(0,bs.jsx)("input",{type:"checkbox",id:"isJunior",checked:m,onChange:e=>p(e.target.checked),disabled:l,className:"w-5 h-5 text-purple-600 rounded focus:ring-purple-500"}),(0,bs.jsxs)("label",{htmlFor:"isJunior",className:"flex items-center cursor-pointer",children:[(0,bs.jsx)(qs,{className:"w-4 h-4 mr-2 text-purple-600"}),(0,bs.jsx)("span",{className:"font-medium text-purple-800",children:"This is a Junior Player"})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,bs.jsx)(Us,{className:"w-4 h-4 inline mr-1"}),"Player Name *"]}),(0,bs.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),disabled:l,placeholder:"e.g., John Smith",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,bs.jsx)(mr,{className:"w-4 h-4 inline mr-1"}),"Email Address (Optional)"]}),(0,bs.jsx)("input",{type:"email",value:u,onChange:e=>h(e.target.value),disabled:l,placeholder:"e.g., john.smith@email.com",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,bs.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"If left blank, a unique skeleton email will be generated automatically"})]}),m&&(0,bs.jsxs)("div",{className:"space-y-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:[(0,bs.jsxs)("h4",{className:"font-medium text-yellow-800 flex items-center",children:[(0,bs.jsx)(qs,{className:"w-4 h-4 mr-2"}),"Parent/Guardian Details"]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,bs.jsx)(Us,{className:"w-4 h-4 inline mr-1"}),"Parent Name"]}),(0,bs.jsx)("input",{type:"text",value:g,onChange:e=>x(e.target.value),disabled:l,placeholder:"e.g., Sarah Smith",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-yellow-500 focus:border-transparent"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,bs.jsx)(mr,{className:"w-4 h-4 inline mr-1"}),"Parent Email"]}),(0,bs.jsx)("input",{type:"email",value:f,onChange:e=>y(e.target.value),disabled:l,placeholder:"e.g., sarah.smith@email.com",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-yellow-500 focus:border-transparent"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,bs.jsx)(Dr,{className:"w-4 h-4 inline mr-1"}),"Parent Phone"]}),(0,bs.jsx)("input",{type:"tel",value:b,onChange:e=>v(e.target.value),disabled:l,placeholder:"e.g., 07700 900123",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-yellow-500 focus:border-transparent"})]})]}),c.trim()&&(0,bs.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"Player Preview:"}),(0,bs.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Name:"})," ",c.trim()]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Email:"})," ",u.trim()||"Auto-generated skeleton email"]}),(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Type:"})," ",m?"Junior Player":"External Player"," (Auto-approved)"]}),m&&g.trim()&&(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Parent:"})," ",g.trim()]}),m&&f.trim()&&(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Parent Email:"})," ",f.trim()]}),m&&b.trim()&&(0,bs.jsxs)("p",{children:[(0,bs.jsx)("strong",{children:"Parent Phone:"})," ",b.trim()]})]})]})]})}),!_&&(0,bs.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:(0,bs.jsxs)("div",{className:"flex space-x-3",children:[(0,bs.jsx)("button",{onClick:async()=>{const e=P();if(e)j(e);else{o(!0),j("");try{const e=c.trim(),t=u.trim()||(e=>{const t=e.toLowerCase().replace(/[^a-z0-9]/g,""),s=Date.now();return"".concat(t,"-").concat(s,"@skeleton.local")})(e),{data:s,error:a}=await n.from("profiles").select("id, name, email").eq("email",t);if(a)throw a;if(s&&s.length>0)return void j('A user with email "'.concat(t,'" already exists: ').concat(s[0].name));const{data:r,error:l}=await n.from("profiles").select("id, name, email").ilike("name",e);if(l)throw l;if(r&&r.length>0&&!window.confirm('A user named "'.concat(r[0].name,'" already exists. Do you want to create another user with this name?')))return;const o={name:e,email:t,status:"approved",role:"player",is_junior:m};m&&(g.trim()&&(o.parent_name=g.trim()),f.trim()&&(o.parent_email=f.trim()),b.trim()&&(o.parent_phone=b.trim()));const{data:d,error:h}=await n.from("profiles").insert(o).select().single();if(h)throw h;S(d),N(!0),i&&i(d)}catch(t){console.error("Failed to create external player:",t),j(t.message||"Failed to create player")}finally{o(!1)}}},disabled:l||null!==P(),className:"flex-1 bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:l?"Creating Player...":"Add External Player"}),(0,bs.jsx)("button",{onClick:E,disabled:l,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 disabled:opacity-50 transition-colors",children:"Cancel"})]})})]})}):null},Or=e=>{let{users:t,ladderPlayers:s=[],currentUser:r,currentSeason:n,activeSeason:i,approveUser:l,updateUserRole:o,addToLadder:c,fetchUsers:d,deleteSeason:u,matchFixtures:h,matchResults:m,seasonActions:p,selectedSeason:g,seasons:x,supabase:f,setShowScheduleModal:y,addMatchToSeason:b,refetch:v}=e;const[w,j]=(0,a.useState)("players"),[_,N]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),[C,E]=(0,a.useState)(""),[P,T]=(0,a.useState)(""),[D,A]=(0,a.useState)("ladder"),[O,F]=(0,a.useState)(!1),[R,M]=(0,a.useState)(32),[I,L]=(0,a.useState)(1200),[U,z]=(0,a.useState)(2),[q,W]=(0,a.useState)(2),[B,G]=(0,a.useState)(2),[H,V]=(0,a.useState)(!1),[J,K]=(0,a.useState)(!1),[$,Y]=(0,a.useState)(!1),[Q,X]=(0,a.useState)(!1),[Z,ee]=(0,a.useState)(!1),te=t.filter(e=>"pending"===e.status);return(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsx)("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-xl p-6 text-white",children:(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h2",{className:"text-3xl font-bold mb-2",children:"Admin Dashboard"}),(0,bs.jsx)("p",{className:"text-indigo-100",children:"Complete system administration"})]}),(0,bs.jsx)("div",{className:"flex items-center gap-3",children:(0,bs.jsx)("div",{className:"bg-white/20 backdrop-blur-sm px-4 py-2 rounded-xl",children:(0,bs.jsxs)("span",{className:"text-sm font-mono font-semibold",children:["v",rr]})})})]})}),te.length>0&&(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-2xl shadow-lg p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,bs.jsx)("div",{className:"bg-yellow-400 p-2 rounded-xl",children:(0,bs.jsx)(tr,{className:"w-5 h-5 text-white"})}),(0,bs.jsxs)("h3",{className:"text-lg font-bold text-gray-900",children:["Pending Approvals (",te.length,")"]})]}),(0,bs.jsx)("div",{className:"space-y-3",children:te.map(e=>(0,bs.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white rounded-xl shadow-sm",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:e.email})]}),(0,bs.jsxs)("button",{onClick:()=>(async e=>{N(!0),await l(e),N(!1)})(e.id),disabled:_,className:"bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 disabled:opacity-50 transition-all shadow-md flex items-center gap-2",children:[(0,bs.jsx)(na,{className:"w-4 h-4"}),"Approve"]})]},e.id))})]}),(0,bs.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[(0,bs.jsx)("div",{className:"border-b-2 border-gray-200",children:(0,bs.jsxs)("div",{className:"flex overflow-x-auto",children:[(0,bs.jsxs)("button",{onClick:()=>j("players"),className:"flex-1 min-w-[120px] px-6 py-4 font-bold transition-all relative ".concat("players"===w?"text-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:[(0,bs.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,bs.jsx)(qs,{className:"w-5 h-5"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Players"})]}),"players"===w&&(0,bs.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-indigo-600"})]}),(0,bs.jsxs)("button",{onClick:()=>j("seasons"),className:"flex-1 min-w-[120px] px-6 py-4 font-bold transition-all relative ".concat("seasons"===w?"text-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:[(0,bs.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,bs.jsx)(Ls,{className:"w-5 h-5"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Seasons"})]}),"seasons"===w&&(0,bs.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-indigo-600"})]}),(0,bs.jsxs)("button",{onClick:()=>j("matches"),className:"flex-1 min-w-[120px] px-6 py-4 font-bold transition-all relative ".concat("matches"===w?"text-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:[(0,bs.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,bs.jsx)(Is,{className:"w-5 h-5"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Matches"})]}),"matches"===w&&(0,bs.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-indigo-600"})]}),(0,bs.jsxs)("button",{onClick:()=>j("scores"),className:"flex-1 min-w-[120px] px-6 py-4 font-bold transition-all relative ".concat("scores"===w?"text-indigo-600 bg-indigo-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:[(0,bs.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,bs.jsx)(na,{className:"w-5 h-5"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Scores"})]}),"scores"===w&&(0,bs.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-indigo-600"})]})]})}),(0,bs.jsxs)("div",{className:"p-6",children:["players"===w&&(0,bs.jsx)("div",{className:"space-y-4",children:(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-indigo-200 rounded-2xl p-6",children:[(0,bs.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Player Management"}),(0,bs.jsx)("p",{className:"text-gray-700 mb-4",children:"Comprehensive player administration - edit profiles, manage roles, set ELO ratings, merge accounts, and more."}),(0,bs.jsxs)("button",{onClick:()=>V(!0),className:"w-full sm:w-auto bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-4 rounded-xl font-bold hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg flex items-center justify-center gap-2",children:[(0,bs.jsx)(qs,{className:"w-5 h-5"}),"Manage Players"]})]})}),"seasons"===w&&(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-2xl p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,bs.jsx)("div",{className:"bg-green-500 p-3 rounded-xl",children:(0,bs.jsx)(Ls,{className:"w-6 h-6 text-white"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-bold text-gray-900 text-lg",children:"Create Season"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"Start new ladder or league"})]})]}),(0,bs.jsx)("button",{onClick:()=>S(!0),disabled:_,className:"w-full bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 disabled:opacity-50 transition-all shadow-md",children:"Create New Season"})]}),(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-red-50 to-orange-50 border-2 border-red-200 rounded-2xl p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,bs.jsx)("div",{className:"bg-red-500 p-3 rounded-xl",children:(0,bs.jsx)(Ha,{className:"w-6 h-6 text-white"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-bold text-gray-900 text-lg",children:"Delete Season"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"\u26a0\ufe0f Permanently remove"})]})]}),(0,bs.jsx)("button",{onClick:()=>Y(!0),disabled:_,className:"w-full bg-red-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-red-700 disabled:opacity-50 transition-all shadow-md",children:"Delete Season"})]})]}),"active"===(null===i||void 0===i?void 0:i.status)&&(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 border-2 border-orange-300 rounded-2xl p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,bs.jsx)("div",{className:"bg-orange-500 p-3 rounded-xl",children:(0,bs.jsx)(Ls,{className:"w-6 h-6 text-white"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-bold text-gray-900 text-lg",children:"Complete Season"}),(0,bs.jsxs)("p",{className:"text-sm text-gray-600",children:["End current season: ",i.name]})]})]}),(0,bs.jsxs)("button",{onClick:async()=>{if(!window.confirm('Are you sure you want to complete the current season "'.concat(null===n||void 0===n?void 0:n.name,'"? This action cannot be undone.')))return;N(!0);(await p.completeSeason(n.id)).success&&alert("Season completed successfully!"),N(!1)},disabled:_,className:"w-full bg-orange-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-orange-700 disabled:opacity-50 transition-all shadow-md",children:['Complete "',i.name,'"']})]})]}),"matches"===w&&(0,bs.jsx)("div",{className:"space-y-4",children:(0,bs.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-2xl p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,bs.jsx)("div",{className:"bg-green-500 p-3 rounded-xl",children:(0,bs.jsx)(qs,{className:"w-6 h-6 text-white"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-bold text-gray-900 text-lg",children:"Add to Season"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"Add players to ladder"})]})]}),(0,bs.jsx)("button",{onClick:()=>K(!0),className:"w-full bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 transition-all shadow-md",children:"Add Players"})]}),(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-200 rounded-2xl p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,bs.jsx)("div",{className:"bg-purple-500 p-3 rounded-xl",children:(0,bs.jsx)(sr,{className:"w-6 h-6 text-white"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-bold text-gray-900 text-lg",children:"External Player"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"Create guest account"})]})]}),(0,bs.jsx)("button",{onClick:()=>ee(!0),className:"w-full bg-purple-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-purple-700 transition-all shadow-md",children:"Add External Player"})]}),"ladder"===(null===i||void 0===i?void 0:i.season_type)&&"active"===(null===i||void 0===i?void 0:i.status)&&(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,bs.jsx)("div",{className:"bg-blue-500 p-3 rounded-xl",children:(0,bs.jsx)(wa,{className:"w-6 h-6 text-white"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-bold text-gray-900 text-lg",children:"Ladder Match"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"Schedule new week"})]})]}),(0,bs.jsx)("button",{onClick:()=>y&&y(!0),disabled:!y,className:"w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 disabled:opacity-50 transition-all shadow-md",children:"Add Match Week"})]}),(0,bs.jsxs)("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 border-2 border-cyan-200 rounded-2xl p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,bs.jsx)("div",{className:"bg-cyan-500 p-3 rounded-xl",children:(0,bs.jsx)(ar,{className:"w-6 h-6 text-white"})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-bold text-gray-900 text-lg",children:"League Import"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"Import from URL"})]})]}),(0,bs.jsx)("button",{onClick:()=>X(!0),className:"w-full bg-cyan-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-cyan-700 transition-all shadow-md",children:"Import Match"})]})]})}),"scores"===w&&(0,bs.jsx)(ur,{currentUser:r,currentSeason:n,onDataRefresh:()=>{d&&d(),window.dispatchEvent(new CustomEvent("refreshMatchData"))}})]})]}),(0,bs.jsx)(xr,{isOpen:H,onClose:()=>V(!1),allUsers:t,currentUser:r,activeSeason:i,onDataRefresh:async()=>{await d(),null!==v&&void 0!==v&&v.seasonPlayers&&await v.seasonPlayers()}}),(0,bs.jsx)(fr,{showModal:J,setShowModal:K,allUsers:t,ladderPlayers:s,addToLadder:c}),(0,bs.jsx)(yr,{showModal:$,setShowModal:Y,seasons:x||[],selectedSeason:g,deleteSeason:u}),(0,bs.jsx)(Tr,{isOpen:Q,onClose:()=>X(!1),supabase:f,selectedSeason:g}),(0,bs.jsx)(Ar,{isOpen:Z,onClose:()=>ee(!1),supabase:f,onPlayerAdded:()=>{d&&d()}}),k&&(0,bs.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,bs.jsx)("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 p-6 text-white rounded-t-2xl",children:(0,bs.jsx)("h3",{className:"text-2xl font-bold",children:"Create New Season"})}),(0,bs.jsxs)("div",{className:"p-6 space-y-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Season Type"}),(0,bs.jsxs)("select",{value:D,onChange:e=>A(e.target.value),className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,bs.jsx)("option",{value:"ladder",children:"Ladder (Internal Competition)"}),(0,bs.jsx)("option",{value:"league",children:"League (External Matches)"})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Season Name"}),(0,bs.jsx)("input",{type:"text",value:C,onChange:e=>E(e.target.value),placeholder:"ladder"===D?"e.g., Spring Ladder 2025":"e.g., Winter League 2025",className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Start Date"}),(0,bs.jsx)("input",{type:"date",value:P,onChange:e=>T(e.target.value),className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),"ladder"===D&&(0,bs.jsxs)("div",{className:"border-t-2 border-gray-200 pt-4 space-y-4",children:[(0,bs.jsxs)("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4",children:[(0,bs.jsx)("h4",{className:"text-sm font-bold text-yellow-800 mb-2",children:"ELO Rating System"}),(0,bs.jsx)("p",{className:"text-sm text-yellow-700",children:"Enable for skill-based rankings instead of simple win percentage"})]}),(0,bs.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,bs.jsx)("input",{type:"checkbox",id:"eloEnabled",checked:O,onChange:e=>F(e.target.checked),className:"w-5 h-5 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500"}),(0,bs.jsx)("label",{htmlFor:"eloEnabled",className:"text-sm font-semibold text-gray-700",children:"Enable ELO rating system"})]}),O&&(0,bs.jsxs)("div",{className:"grid grid-cols-2 gap-4 pl-2",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"K-Factor"}),(0,bs.jsxs)("select",{value:R,onChange:e=>M(parseInt(e.target.value)),className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-transparent",children:[(0,bs.jsx)("option",{value:16,children:"16 (Stable)"}),(0,bs.jsx)("option",{value:32,children:"32 (Standard)"}),(0,bs.jsx)("option",{value:48,children:"48 (Volatile)"})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Initial Rating"}),(0,bs.jsx)("input",{type:"number",min:"800",max:"1600",step:"50",value:I,onChange:e=>L(parseInt(e.target.value)||1200),className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-transparent"})]})]})]}),(0,bs.jsxs)("div",{className:"border-t-2 border-gray-200 pt-4 space-y-4",children:[(0,bs.jsxs)("div",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[(0,bs.jsx)("h4",{className:"text-sm font-bold text-green-800 mb-2",children:"Match Fees"}),(0,bs.jsx)("p",{className:"text-sm text-green-700",children:"Set the fee charged per match day (not per rubber). Players will be charged when scores are submitted."})]}),(0,bs.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Ladder (\xa3)"}),(0,bs.jsx)("input",{type:"number",min:"0",max:"20",step:"0.50",value:U,onChange:e=>z(parseFloat(e.target.value)||0),className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"League (\xa3)"}),(0,bs.jsx)("input",{type:"number",min:"0",max:"20",step:"0.50",value:q,onChange:e=>W(parseFloat(e.target.value)||0),className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Singles (\xa3)"}),(0,bs.jsx)("input",{type:"number",min:"0",max:"20",step:"0.50",value:B,onChange:e=>G(parseFloat(e.target.value)||0),className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]})]})]}),(0,bs.jsxs)("div",{className:"px-6 py-4 border-t-2 border-gray-200 bg-gray-50 rounded-b-2xl flex gap-3",children:[(0,bs.jsx)("button",{onClick:async()=>{if(!C.trim()||!P)return void alert("Please provide both season name and start date");N(!0);(await p.createNewSeason({name:C.trim(),start_date:P,season_type:D,carryOverPlayers:!1,elo_enabled:O&&"ladder"===D,elo_k_factor:R,elo_initial_rating:I,match_fee_ladder:U,match_fee_league:q,match_fee_singles:B})).success&&(S(!1),E(""),T(""),A("ladder"),F(!1),M(32),L(1200),z(2),W(2),G(2),alert("New ".concat(D,' season "').concat(C,'" created successfully!'))),N(!1)},disabled:_||!C.trim()||!P,className:"flex-1 bg-green-600 text-white py-3 px-4 rounded-xl hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all font-bold shadow-md",children:"Create Season"}),(0,bs.jsx)("button",{onClick:()=>{S(!1),E(""),T(""),A("ladder"),F(!1),M(32),L(1200),z(2),W(2),G(2)},disabled:_,className:"flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-xl hover:bg-gray-300 disabled:opacity-50 transition-all font-semibold",children:"Cancel"})]})]})})]})},Fr=fs("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),Rr=fs("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),Mr=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[s,r]=(0,a.useState)({schedules:[],sessions:[],attendance:[],payments:[],loading:{schedules:!1,sessions:!1,attendance:!1,payments:!1},error:null}),n=(0,a.useCallback)((e,t)=>{r(s=>c(c({},s),{},{loading:c(c({},s.loading),{},{[e]:t})}))},[]),i=(0,a.useCallback)((e,t)=>{r(s=>c(c({},s),{},{[e]:t}))},[]),l=(0,a.useCallback)(async e=>{try{const{data:t,error:s}=await is.from("coaching_schedule_enrollments").select("\n          *,\n          player:profiles!coaching_schedule_enrollments_player_id_fkey(id, name, email, is_junior, parent_name, parent_phone)\n        ").eq("schedule_id",e).eq("is_active",!0).order("enrolled_at",{ascending:!0});if(s)throw s;return{data:t||[],error:null}}catch(t){return console.error("Error fetching schedule enrollments:",t),{data:[],error:t}}},[]),o=(0,a.useCallback)(async(t,s)=>{try{const{data:a,error:r}=await is.from("coaching_schedule_enrollments").upsert({schedule_id:t,player_id:s,enrolled_by:e,is_active:!0},{onConflict:"schedule_id,player_id"}).select().single();if(r)throw r;return{data:a,error:null}}catch(a){return console.error("Error enrolling player:",a),{data:null,error:a}}},[e]),d=(0,a.useCallback)(async(e,t)=>{try{const{error:s}=await is.from("coaching_schedule_enrollments").update({is_active:!1}).eq("schedule_id",e).eq("player_id",t);if(s)throw s;return{error:null}}catch(s){return console.error("Error unenrolling player:",s),{error:s}}},[]),u=(0,a.useCallback)(async e=>{try{const{data:t,error:s}=await is.from("coaching_sessions").select("schedule_id").eq("id",e).single();if(s)throw s;if(!t.schedule_id)return{data:[],error:null};const{data:a,error:r}=await is.from("coaching_schedule_enrollments").select("\n          *,\n          player:profiles!coaching_schedule_enrollments_player_id_fkey(id, name, email, is_junior)\n        ").eq("schedule_id",t.schedule_id).eq("is_active",!0);if(r)throw r;const{data:n,error:i}=await is.from("coaching_attendance").select("player_id").eq("session_id",e);if(i)throw i;const l=new Set((n||[]).map(e=>e.player_id));return{data:(a||[]).map(e=>c(c({},e.player),{},{has_attended:l.has(e.player.id)})),error:null}}catch(t){return console.error("Error fetching session enrolled players:",t),{data:[],error:t}}},[]),h=(0,a.useCallback)(async()=>{n("schedules",!0);try{let e=is.from("coaching_schedules").select("*").order("day_of_week",{ascending:!0});t||(e=e.eq("is_active",!0));const{data:s,error:a}=await e;if(a)throw a;i("schedules",s||[])}catch(e){console.error("Error fetching schedules:",e),i("error",e.message)}finally{n("schedules",!1)}},[t,n,i]),m=(0,a.useCallback)(async t=>{try{const{data:s,error:a}=await is.from("coaching_schedules").insert([c(c({},t),{},{created_by:e})]).select().single();if(a)throw a;return await h(),{data:s,error:null}}catch(s){return console.error("Error creating schedule:",s),{data:null,error:s}}},[e,h]),p=(0,a.useCallback)(async(e,t)=>{try{const{data:s,error:a}=await is.from("coaching_schedules").update(t).eq("id",e).select().single();if(a)throw a;return await h(),{data:s,error:null}}catch(s){return console.error("Error updating schedule:",s),{data:null,error:s}}},[h]),g=(0,a.useCallback)(async e=>{try{const{error:t}=await is.from("coaching_schedules").update({is_active:!1,deactivated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;return await h(),{error:null}}catch(t){return console.error("Error deactivating schedule:",t),{error:t}}},[h]),x=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const a={weeks_ahead:e};t&&(a.start_from_date=t),s&&s.length>0&&(a.schedule_ids=s);const{data:r,error:n}=await is.rpc("generate_coaching_sessions",a);if(n)throw n;return{data:r,error:null}}catch(a){return console.error("Error generating sessions:",a),{data:null,error:a}}},[]),f=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("sessions",!0);try{let t=is.from("coaching_sessions").select("\n          *,\n          attendance:coaching_attendance(count),\n          schedule:coaching_schedules(session_type, day_of_week)\n        ").order("session_date",{ascending:!1});e.status&&(t=t.eq("status",e.status)),e.session_type&&(t=t.eq("session_type",e.session_type)),e.dateFrom&&(t=t.gte("session_date",e.dateFrom)),e.dateTo&&(t=t.lte("session_date",e.dateTo));const{data:s,error:a}=await t;if(a)throw a;i("sessions",s||[])}catch(t){console.error("Error fetching sessions:",t),i("error",t.message)}finally{n("sessions",!1)}},[n,i]),y=(0,a.useCallback)(async t=>{try{const{data:s,error:a}=await is.from("coaching_sessions").insert([c(c({},t),{},{created_by:e,schedule_id:null})]).select().single();if(a)throw a;return await f(),{data:s,error:null}}catch(s){return console.error("Error creating session:",s),{data:null,error:s}}},[e,f]),b=(0,a.useCallback)(async(e,t)=>{try{const{data:s,error:a}=await is.from("coaching_sessions").update(t).eq("id",e).select().single();if(a)throw a;return await f(),{data:s,error:null}}catch(s){return console.error("Error updating session:",s),{data:null,error:s}}},[f]),v=(0,a.useCallback)(async function(e){return b(e,{status:"cancelled",cancellation_reason:arguments.length>1&&void 0!==arguments[1]?arguments[1]:""})},[b]),w=(0,a.useCallback)(async e=>b(e,{status:"completed"}),[b]),j=(0,a.useCallback)(async e=>{try{const{error:t}=await is.from("coaching_sessions").delete().eq("id",e);if(t)throw t;return await f(),{error:null}}catch(t){return console.error("Error deleting session:",t),{error:t}}},[f]),_=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("attendance",!0);try{let t=is.from("coaching_attendance").select("\n          *,\n          player:profiles!coaching_attendance_player_id_fkey(id, name, email),\n          session:coaching_sessions(id, session_date, session_time, session_type, status),\n          marked_by_user:profiles!coaching_attendance_marked_by_fkey(id, name)\n        ").order("created_at",{ascending:!1});e.sessionId&&(t=t.eq("session_id",e.sessionId)),e.playerId&&(t=t.eq("player_id",e.playerId));const{data:s,error:a}=await t;if(a)throw a;i("attendance",s||[])}catch(t){console.error("Error fetching attendance:",t),i("error",t.message)}finally{n("attendance",!1)}},[n,i]),N=(0,a.useCallback)(async function(t,s){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{const{data:r,error:n}=await is.from("coaching_attendance").insert([{session_id:t,player_id:s,marked_by:e,self_registered:a}]).select().single();if(n)throw n;return await _(),{data:r,error:null}}catch(r){return console.error("Error marking attendance:",r),{data:null,error:r}}},[e,_]),k=(0,a.useCallback)(async e=>{try{const{error:t}=await is.from("coaching_attendance").delete().eq("id",e);if(t)throw t;return await _(),{error:null}}catch(t){return console.error("Error removing attendance:",t),{error:t}}},[_]),S=(0,a.useCallback)(async e=>{try{const{data:t,error:s}=await is.from("coaching_attendance").select("\n          *,\n          player:profiles!coaching_attendance_player_id_fkey(id, name, email)\n        ").eq("session_id",e).order("created_at",{ascending:!0});if(s)throw s;return{data:t||[],error:null}}catch(t){return console.error("Error fetching session attendance:",t),{data:[],error:t}}},[]),C=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const{data:t,error:s}=await is.rpc("get_player_attendance_stats_by_type",{p_session_type:e});if(s)throw s;return{data:t||[],error:null}}catch(t){return console.error("Error fetching player attendance stats:",t),{data:[],error:t}}},[]),E=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("payments",!0);try{let t=is.from("coaching_payments").select("\n          *,\n          player:profiles!coaching_payments_player_id_fkey(id, name, email),\n          sessions:coaching_payment_sessions(\n            session:coaching_sessions(id, session_date, session_type)\n          )\n        ").order("created_at",{ascending:!1});e.status&&(t=t.eq("status",e.status)),e.playerId&&(t=t.eq("player_id",e.playerId));const{data:s,error:a}=await t;if(a)throw a;i("payments",s||[])}catch(t){console.error("Error fetching payments:",t),i("error",t.message)}finally{n("payments",!1)}},[n,i]),P=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const{data:a,error:r}=await is.rpc("get_unpaid_coaching_sessions",{p_player_id:e,p_billing_period_start:t,p_billing_period_end:s});if(r)throw r;return{data:a||[],error:null}}catch(a){return console.error("Error fetching unpaid sessions:",a),{data:[],error:a}}},[]),T=(0,a.useCallback)(async function(t,s,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{const{data:n,error:i}=await is.rpc("create_coaching_payment_request",{p_player_id:t,p_billing_period_start:s,p_billing_period_end:a,p_created_by:e,p_payment_deadline:r});if(i)throw i;return await E(),{data:n,error:null}}catch(n){return console.error("Error creating payment request:",n),{data:null,error:n}}},[e,E]),D=(0,a.useCallback)(async function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const{data:a,error:r}=await is.from("coaching_payments").update({status:"paid",paid_at:(new Date).toISOString(),marked_paid_by:e,payment_reference:s}).eq("id",t).select().single();if(r)throw r;return await E(),{data:a,error:null}}catch(a){return console.error("Error marking payment received:",a),{data:null,error:a}}},[e,E]),A=(0,a.useCallback)(async e=>{try{const{data:t,error:s}=await is.from("coaching_payments").update({reminder_sent_at:(new Date).toISOString()}).eq("id",e).select().single();if(s)throw s;return await E(),{data:t,error:null}}catch(t){return console.error("Error updating reminder timestamp:",t),{data:null,error:t}}},[E]),O=(0,a.useCallback)(async function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const{data:a,error:r}=await is.rpc("user_mark_payment_paid",{p_payment_id:t,p_user_id:e,p_note:s});if(r)throw r;return await E(),{data:a,error:null}}catch(a){return console.error("Error marking payment as paid:",a),{data:null,error:a}}},[e,E]),F=(0,a.useCallback)(async()=>{try{const{data:e,error:t}=await is.rpc("get_payment_statistics");if(t)throw t;return{data:(null===e||void 0===e?void 0:e[0])||null,error:null}}catch(e){return console.error("Error fetching payment statistics:",e),{data:null,error:e}}},[]),R=(0,a.useCallback)(async function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const{data:a,error:r}=await is.rpc("player_mark_sessions_paid",{p_attendance_ids:t,p_player_id:e,p_note:s});if(r)throw r;return await _({playerId:e}),{data:a,error:null}}catch(a){return console.error("Error marking sessions as paid:",a),{data:null,error:a}}},[e,_]),M=(0,a.useCallback)(async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;try{const{data:n,error:i}=await is.rpc("admin_confirm_payment",{p_player_id:e,p_amount:t,p_reference:s,p_session_cost:a});if(i)throw i;const l=null===n||void 0===n?void 0:n[0];if(l&&l.sessions_confirmed>0)try{const{data:a}=await is.from("profiles").select("email, name").eq("id",e).single();if(a){const{data:{session:r}}=await is.auth.getSession();r&&await fetch("".concat(ns,"/functions/v1/notify-payment-confirmed"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.access_token)},body:JSON.stringify({player_id:e,email:a.email,name:a.name,amount:l.amount_allocated||t,sessions_count:l.sessions_confirmed||0,reference:s||void 0})})}}catch(r){console.warn("Failed to send payment confirmation email:",r)}return await _(),{data:l||null,error:null}}catch(n){return console.error("Error confirming payment:",n),{data:null,error:n}}},[_]),I=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const{data:s,error:a}=await is.rpc("admin_confirm_sessions",{p_attendance_ids:e,p_reference:t});if(a)throw a;return await _(),{data:s,error:null}}catch(s){return console.error("Error confirming sessions:",s),{data:null,error:s}}},[_]),L=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const{data:s,error:a}=await is.rpc("admin_reverse_payment_status",{p_attendance_ids:e,p_reason:t});if(a)throw a;return await _(),{data:s,error:null}}catch(s){return console.error("Error reversing payment status:",s),{data:null,error:s}}},[_]),U=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;try{const{data:t,error:s}=await is.rpc("get_all_players_payment_summary",{p_session_cost:e});if(s)throw s;return{data:t||[],error:null}}catch(t){return console.error("Error fetching all players payment summary:",t),{data:[],error:t}}},[]),z=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;try{const{data:s,error:a}=await is.rpc("get_player_payment_summary",{p_player_id:e,p_session_cost:t});if(a)throw a;return{data:(null===s||void 0===s?void 0:s[0])||null,error:null}}catch(s){return console.error("Error fetching player payment summary:",s),{data:null,error:s}}},[]),q=(0,a.useCallback)(async e=>{try{const{data:t,error:s}=await is.rpc("get_player_sessions_by_payment_status",{p_player_id:e});if(s)throw s;return{data:t||[],error:null}}catch(t){return console.error("Error fetching player sessions:",t),{data:[],error:t}}},[]),W=(0,a.useCallback)(async()=>{try{const{data:e,error:t}=await is.rpc("get_coach_payment_summary");if(t)throw t;return{data:(null===e||void 0===e?void 0:e[0])||null,error:null}}catch(e){return console.error("Error fetching coach payment summary:",e),{data:null,error:e}}},[]),B=(0,a.useCallback)(async()=>{try{const{data:e,error:t}=await is.rpc("get_coach_sessions_to_pay");if(t)throw t;return{data:e||[],error:null}}catch(e){return console.error("Error fetching coach sessions to pay:",e),{data:[],error:e}}},[]),G=(0,a.useCallback)(async t=>{try{const{data:s,error:a}=await is.rpc("record_coach_payment",{p_payment_date:t.payment_date,p_amount:t.amount,p_payment_type:t.payment_type||"regular",p_payment_method:t.payment_method||"bank_transfer",p_reference:t.reference||"",p_notes:t.notes||"",p_recorded_by:e});if(a)throw a;return{data:s,error:null}}catch(s){return console.error("Error recording coach payment:",s),{data:null,error:s}}},[e]),H=(0,a.useCallback)(async()=>{try{const{data:e,error:t}=await is.rpc("get_coach_payment_history");if(t)throw t;return{data:e||[],error:null}}catch(e){return console.error("Error fetching coach payment history:",e),{data:[],error:e}}},[]),V=(0,a.useCallback)(async function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";try{const{data:r,error:n}=await is.rpc("update_coach_rate",{p_session_type:e,p_new_rate:t,p_effective_from:s,p_notes:a});if(n)throw n;return{data:r,error:null}}catch(r){return console.error("Error updating coach rate:",r),{data:null,error:r}}},[]),J=(0,a.useCallback)(async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const{data:a,error:r}=await is.from("coaching_sessions").update({coach_payment_status:t,coach_payment_notes:s}).eq("id",e).select().single();if(r)throw r;return await f(),{data:a,error:null}}catch(a){return console.error("Error updating session coach payment status:",a),{data:null,error:a}}},[f]),K=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const{data:{session:a}}=await is.auth.getSession();if(!a)throw new Error("Not authenticated");const r=await fetch("".concat(ns,"/functions/v1/send-payment-reminders"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.access_token)},body:JSON.stringify({filterType:e,threshold:t,selectedPayments:s})});if(!r.ok){const e=await r.json();throw new Error(e.error||"Failed to send reminders")}return{data:await r.json(),error:null}}catch(a){return console.error("Error sending payment reminders:",a),{data:null,error:a}}},[]),$=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{const{data:t,error:s}=await is.rpc("get_reminder_history",{p_limit:e});if(s)throw s;return{data:t,error:null}}catch(t){return console.error("Error getting reminder history:",t),{data:null,error:t}}},[]),Y=(0,a.useCallback)(async e=>{try{const{data:t,error:s}=await is.rpc("validate_payment_token",{p_token:e});if(s)throw s;return{data:(null===t||void 0===t?void 0:t[0])||null,error:null}}catch(t){return console.error("Error validating payment token:",t),{data:null,error:t}}},[]);return(0,a.useEffect)(()=>{e&&(t?(h(),f(),_(),E()):(h(),f(),_({playerId:e}),E({playerId:e})))},[e,t]),{schedules:s.schedules,sessions:s.sessions,attendance:s.attendance,payments:s.payments,loading:s.loading,error:s.error,actions:{getScheduleEnrollments:l,enrollPlayer:o,unenrollPlayer:d,getSessionEnrolledPlayers:u,fetchSchedules:h,createSchedule:m,updateSchedule:p,deactivateSchedule:g,generateSessions:x,fetchSessions:f,createSession:y,updateSession:b,cancelSession:v,completeSession:w,deleteSession:j,fetchAttendance:_,markAttendance:N,removeAttendance:k,getSessionAttendance:S,getPlayerAttendanceStats:C,fetchPayments:E,getUnpaidSessions:P,createPaymentRequest:T,markPaymentReceived:D,sendPaymentReminder:A,userMarkPaymentPaid:O,getPaymentStatistics:F,playerMarkSessionsPaid:R,adminConfirmPayment:M,adminConfirmSessions:I,adminReversePaymentStatus:L,getAllPlayersPaymentSummary:U,getPlayerPaymentSummary:z,getPlayerSessionsByPaymentStatus:q,getCoachPaymentSummary:W,getCoachSessionsToPay:B,recordCoachPayment:G,getCoachPaymentHistory:H,updateCoachRate:V,updateSessionCoachPaymentStatus:J,sendPaymentReminders:K,getReminderHistory:$,validatePaymentToken:Y}}},Ir=fs("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Lr=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],Ur=["Adults","Beginners","Juniors"],zr=e=>{let{isOpen:t,onClose:s,schedule:r,onSuccess:n,actions:i}=e;const{success:l,error:o}=As(),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)({schedule_name:"",session_type:"Adults",day_of_week:3,session_time:"18:00",session_cost:"4.00",is_junior_session:!1,notes:""});(0,a.useEffect)(()=>{var e;r?m({schedule_name:r.schedule_name||"",session_type:r.session_type||"Adults",day_of_week:r.day_of_week||3,session_time:r.session_time||"18:00",session_cost:(null===(e=r.session_cost)||void 0===e?void 0:e.toString())||"4.00",is_junior_session:r.is_junior_session||!1,notes:r.notes||""}):m({schedule_name:"",session_type:"Adults",day_of_week:3,session_time:"18:00",session_cost:"4.00",is_junior_session:!1,notes:""})},[r]);return t?(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:r?"Edit Schedule":"Create New Schedule"}),(0,bs.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,bs.jsx)(Es,{className:"w-5 h-5"})})]}),(0,bs.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),u(!0);try{const e=c(c({},h),{},{session_cost:parseFloat(h.session_cost)||0,is_junior_session:"Juniors"===h.session_type});let t;if(t=r?await i.updateSchedule(r.id,e):await i.createSchedule(e),t.error)throw t.error;l("Schedule ".concat(r?"updated":"created"," successfully")),n()}catch(t){o(t.message||"Failed to ".concat(r?"update":"create"," schedule"))}finally{u(!1)}},className:"p-6 space-y-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Schedule Name"}),(0,bs.jsx)("input",{type:"text",value:h.schedule_name,onChange:e=>m(c(c({},h),{},{schedule_name:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",placeholder:"e.g., Under 10s, Adult Improvers"}),(0,bs.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Optional: Give this schedule a friendly name"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Type"}),(0,bs.jsx)("select",{value:h.session_type,onChange:e=>{const t=e.target.value;m(c(c({},h),{},{session_type:t,session_cost:"Juniors"===t?"0.00":h.session_cost}))},className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0,children:Ur.map(e=>(0,bs.jsx)("option",{value:e,children:e},e))})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Day of Week"}),(0,bs.jsx)("select",{value:h.day_of_week,onChange:e=>m(c(c({},h),{},{day_of_week:parseInt(e.target.value)})),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0,children:Lr.map(e=>(0,bs.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Time"}),(0,bs.jsx)("input",{type:"time",value:h.session_time,onChange:e=>m(c(c({},h),{},{session_time:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Cost (\xa3)"}),(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"\xa3"}),(0,bs.jsx)("input",{type:"number",step:"0.01",min:"0",value:h.session_cost,onChange:e=>m(c(c({},h),{},{session_cost:e.target.value})),className:"w-full p-3 pl-8 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",placeholder:"4.00"})]}),(0,bs.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Juniors"===h.session_type?"Junior sessions are typically free (\xa30.00)":"Standard cost per session (e.g., \xa34.00)"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,bs.jsx)("textarea",{value:h.notes,onChange:e=>m(c(c({},h),{},{notes:e.target.value})),rows:3,className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",placeholder:"e.g., Wednesday evening adult coaching"})]}),(0,bs.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,bs.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,bs.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d?"Saving...":r?"Update Schedule":"Create Schedule"})]})]})]})}):null},qr=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Wr=e=>{let{isOpen:t,onClose:s,onGenerate:r,activeSchedules:n}=e;const[i,l]=(0,a.useState)(()=>{const e=new Date,t=(8-e.getDay())%7||7,s=new Date(e);return s.setDate(e.getDate()+t),s.toISOString().split("T")[0]}),[o,c]=(0,a.useState)(4),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)([]);if((0,a.useEffect)(()=>{t&&n&&m(n.map(e=>e.id))},[t,n]),!t)return null;return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50",onClick:s,children:(0,bs.jsxs)("div",{className:"bg-white rounded-t-2xl sm:rounded-lg shadow-xl w-full sm:max-w-lg max-h-[90vh] sm:max-h-[85vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,bs.jsxs)("div",{className:"flex justify-between items-center p-4 sm:p-6 border-b border-gray-200 flex-shrink-0",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,bs.jsx)("div",{className:"p-1.5 sm:p-2 bg-green-100 rounded-lg",children:(0,bs.jsx)(Ls,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600"})}),(0,bs.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Generate Sessions"})]}),(0,bs.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors p-2 -mr-2","aria-label":"Close",children:(0,bs.jsx)(Es,{className:"w-5 h-5"})})]}),(0,bs.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),u(!0);try{await r(i,o,h),s()}catch(t){console.error("Error generating sessions:",t)}finally{u(!1)}},className:"flex-1 flex flex-col overflow-hidden",children:[(0,bs.jsx)("div",{className:"overflow-y-auto flex-1 p-4 sm:p-6",children:(0,bs.jsxs)("div",{className:"space-y-4 sm:space-y-5",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Select Schedules"}),(0,bs.jsxs)("div",{className:"flex gap-2 text-xs",children:[(0,bs.jsx)("button",{type:"button",onClick:()=>{m(n.map(e=>e.id))},className:"text-blue-600 hover:text-blue-800 font-medium",children:"Select All"}),(0,bs.jsx)("span",{className:"text-gray-400",children:"|"}),(0,bs.jsx)("button",{type:"button",onClick:()=>{m([])},className:"text-blue-600 hover:text-blue-800 font-medium",children:"Deselect All"})]})]}),(0,bs.jsx)("div",{className:"space-y-1.5 border border-gray-200 rounded-lg p-2 sm:p-3 max-h-40 overflow-y-auto bg-gray-50",children:n&&n.length>0?n.map(e=>(0,bs.jsxs)("label",{className:"flex items-start gap-2.5 p-2 hover:bg-white rounded cursor-pointer transition-colors",children:[(0,bs.jsx)("input",{type:"checkbox",checked:h.includes(e.id),onChange:()=>{return t=e.id,void m(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 flex-shrink-0"}),(0,bs.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,bs.jsx)("div",{className:"font-medium text-sm text-gray-900",children:e.session_type}),(0,bs.jsxs)("div",{className:"text-xs text-gray-600",children:[qr[e.day_of_week]," at ",e.session_time]})]})]},e.id)):(0,bs.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No active schedules available"})}),(0,bs.jsxs)("p",{className:"mt-1.5 text-xs text-gray-500",children:[h.length," of ",(null===n||void 0===n?void 0:n.length)||0," selected"]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start From"}),(0,bs.jsx)("input",{type:"date",value:i,onChange:e=>l(e.target.value),className:"w-full px-3 py-2.5 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0}),(0,bs.jsx)("p",{className:"mt-1.5 text-xs text-gray-500",children:"Sessions will be generated starting from this date"})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Weeks"}),(0,bs.jsx)("div",{className:"sm:hidden",children:(0,bs.jsx)("select",{value:o,onChange:e=>c(parseInt(e.target.value)),className:"w-full px-3 py-2.5 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[1,2,3,4,6,8,10,12].map(e=>(0,bs.jsxs)("option",{value:e,children:[e," week",1!==e?"s":""]},e))})}),(0,bs.jsx)("div",{className:"hidden sm:grid grid-cols-4 gap-2",children:[1,2,3,4,6,8,10,12].map(e=>(0,bs.jsx)("button",{type:"button",onClick:()=>c(e),className:"\n                        px-3 py-2 rounded-md text-sm font-medium transition-colors\n                        ".concat(o===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200","\n                      "),children:e},e))}),(0,bs.jsxs)("p",{className:"mt-1.5 text-xs text-gray-500",children:[o," week",1!==o?"s":""," of sessions will be generated"]})]}),(0,bs.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4",children:(0,bs.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,bs.jsxs)("div",{className:"flex justify-between",children:[(0,bs.jsx)("span",{className:"text-gray-600",children:"Start:"}),(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:new Date(i).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})})]}),(0,bs.jsxs)("div",{className:"flex justify-between",children:[(0,bs.jsx)("span",{className:"text-gray-600",children:"End:"}),(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:(()=>{const e=new Date(i),t=new Date(e);return t.setDate(e.getDate()+7*o-1),t.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})})()})]}),(0,bs.jsxs)("div",{className:"flex justify-between",children:[(0,bs.jsx)("span",{className:"text-gray-600",children:"Duration:"}),(0,bs.jsxs)("span",{className:"font-medium text-gray-900",children:[o," week",1!==o?"s":""]})]}),(0,bs.jsx)("p",{className:"text-xs text-gray-600 mt-2 pt-2 border-t border-blue-200",children:"Only new sessions will be created. Existing sessions will be skipped."})]})})]})}),(0,bs.jsxs)("div",{className:"flex gap-3 p-4 sm:p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:[(0,bs.jsx)("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-white transition-colors font-medium",disabled:d,children:"Cancel"}),(0,bs.jsx)("button",{type:"submit",disabled:d||!i||o<1||0===h.length,className:"flex-1 px-4 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:d?"Generating...":"Generate"})]})]})]})})},Br=fs("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Gr=e=>{let{size:t="md",color:s="green"}=e;return(0,bs.jsx)("div",{className:"".concat({sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[t]," ").concat({green:"border-green-600",white:"border-white",gray:"border-gray-600"}[s]," border-2 border-t-transparent rounded-full animate-spin")})},Hr=e=>{let{isOpen:t,onClose:s,schedule:r,actions:n}=e;const{success:i,error:l}=As(),[o,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)([]),[p,g]=(0,a.useState)([]),[x,f]=(0,a.useState)(""),[y,b]=(0,a.useState)((null===r||void 0===r?void 0:r.is_junior_session)||!1);(0,a.useEffect)(()=>{t&&r&&v()},[t,r]);const v=async()=>{c(!0);try{const{data:e,error:t}=await n.getScheduleEnrollments(r.id);if(t)throw t;m(e||[]);const{data:s,error:a}=await is.from("profiles").select("id, name, email, is_junior, parent_name, parent_phone").eq("status","approved").order("name");if(a)throw a;const i=new Set((e||[]).map(e=>{var t;return(null===(t=e.player)||void 0===t?void 0:t.id)||e.player_id})),l=(s||[]).filter(e=>!i.has(e.id));g(l)}catch(e){console.error("Error loading enrollment data:",e),l("Failed to load enrollment data")}finally{c(!1)}},w=p.filter(e=>{const t=!x||e.name.toLowerCase().includes(x.toLowerCase())||e.email&&e.email.toLowerCase().includes(x.toLowerCase()),s=!y||e.is_junior;return t&&s});if(!t)return null;const j=r.schedule_name||r.session_type;return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,bs.jsx)(qs,{className:"w-5 h-5"}),"Manage Enrollment"]}),(0,bs.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[j," - ",r.session_type]})]}),(0,bs.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,bs.jsx)(Es,{className:"w-6 h-6"})})]}),o?(0,bs.jsx)("div",{className:"p-12",children:(0,bs.jsx)(Gr,{})}):(0,bs.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:["Enrolled Players",(0,bs.jsx)("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-sm",children:h.length})]}),0===h.length?(0,bs.jsxs)("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[(0,bs.jsx)(qs,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"No players enrolled yet"}),(0,bs.jsx)("p",{className:"text-sm text-gray-500",children:"Add players from the list below"})]}):(0,bs.jsx)("div",{className:"space-y-2",children:h.map(e=>{const t=e.player;return(0,bs.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:null===t||void 0===t?void 0:t.name}),(null===t||void 0===t?void 0:t.is_junior)&&(0,bs.jsx)("span",{className:"bg-purple-100 text-purple-700 px-2 py-0.5 rounded text-xs",children:"Junior"})]}),(null===t||void 0===t?void 0:t.is_junior)&&(null===t||void 0===t?void 0:t.parent_name)&&(0,bs.jsxs)("div",{className:"text-xs text-gray-600 mt-1 flex items-center gap-3",children:[(0,bs.jsxs)("span",{children:["Parent: ",t.parent_name]}),(null===t||void 0===t?void 0:t.parent_phone)&&(0,bs.jsxs)("span",{className:"flex items-center gap-1",children:[(0,bs.jsx)(Dr,{className:"w-3 h-3"}),t.parent_phone]})]})]}),(0,bs.jsx)("button",{onClick:()=>(async e=>{const t=e.player;if(window.confirm("Remove ".concat(t.name," from this schedule?"))){u(!0);try{const{error:e}=await n.unenrollPlayer(r.id,t.id);if(e)throw e;m(e=>e.filter(e=>{var s;return(null===(s=e.player)||void 0===s?void 0:s.id)!==t.id})),g(e=>[...e,t].sort((e,t)=>e.name.localeCompare(t.name))),i("".concat(t.name," removed from schedule"))}catch(s){l("Failed to remove player")}finally{u(!1)}}})(e),disabled:d,className:"p-2 text-red-600 hover:bg-red-100 rounded-md transition-colors",title:"Remove from schedule",children:(0,bs.jsx)(Br,{className:"w-4 h-4"})})]},(null===t||void 0===t?void 0:t.id)||e.player_id)})})]}),(0,bs.jsx)("hr",{className:"border-gray-200"}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Add Players"}),(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[(0,bs.jsxs)("div",{className:"relative flex-1",children:[(0,bs.jsx)(Ja,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,bs.jsx)("input",{type:"text",value:x,onChange:e=>f(e.target.value),placeholder:"Search players...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,bs.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-700 cursor-pointer",children:[(0,bs.jsx)("input",{type:"checkbox",checked:y,onChange:e=>b(e.target.checked),className:"rounded text-purple-600 focus:ring-purple-500"}),"Juniors only"]})]}),0===w.length?(0,bs.jsx)("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:(0,bs.jsx)("p",{className:"text-gray-600",children:x||y?"No matching players found":"All players are already enrolled"})}):(0,bs.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-2",children:w.map(e=>{var t;return(0,bs.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),e.is_junior&&(0,bs.jsx)("span",{className:"bg-purple-100 text-purple-700 px-2 py-0.5 rounded text-xs",children:"Junior"})]}),!(null!==(t=e.email)&&void 0!==t&&t.includes("@skeleton.local"))&&(0,bs.jsx)("p",{className:"text-xs text-gray-500",children:e.email})]}),(0,bs.jsxs)("button",{onClick:()=>(async e=>{u(!0);try{const{error:t}=await n.enrollPlayer(r.id,e.id);if(t)throw t;m(t=>[...t,{player:e}]),g(t=>t.filter(t=>t.id!==e.id)),i("".concat(e.name," enrolled successfully"))}catch(t){l("Failed to enroll player")}finally{u(!1)}})(e),disabled:d,className:"flex items-center gap-1 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:[(0,bs.jsx)(sr,{className:"w-4 h-4"}),"Add"]})]},e.id)})})]})]}),(0,bs.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:(0,bs.jsx)("button",{onClick:s,className:"w-full sm:w-auto px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors",children:"Done"})})]})})},Vr=e=>{if(!e)return"";const[t,s]=e.split(":"),a=parseInt(t,10),r=parseInt(s,10);if(isNaN(a))return e;const n=a>=12?"pm":"am",i=a%12||12;return r&&0!==r?"".concat(i,":").concat(s).concat(n):"".concat(i).concat(n)},Jr=e=>{switch(e){case"Juniors":return{bg:"bg-orange-100",text:"text-orange-700",border:"border-orange-200"};case"Adults":return{bg:"bg-blue-100",text:"text-blue-700",border:"border-blue-200"};case"Beginners":return{bg:"bg-green-100",text:"text-green-700",border:"border-green-200"};default:return{bg:"bg-gray-100",text:"text-gray-700",border:"border-gray-200"}}},Kr=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],$r=e=>{let{schedules:t,loading:s,actions:r,currentUser:n}=e;const{success:i,error:l}=As(),[o,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),[p,g]=(0,a.useState)(null),[x,f]=(0,a.useState)(null),[y,b]=(0,a.useState)(!1),v=()=>{g(null),c(!0)};if(s)return(0,bs.jsx)(Gr,{});const w=t.filter(e=>e.is_active),j=t.filter(e=>!e.is_active);return(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:justify-between sm:items-center",children:[(0,bs.jsxs)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:["Schedules ",(0,bs.jsxs)("span",{className:"text-sm sm:text-base text-gray-600",children:["(",w.length," active)"]})]}),(0,bs.jsxs)("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:[(0,bs.jsxs)("button",{onClick:()=>{u(!0)},disabled:y||0===w.length,className:"flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 bg-green-600 text-white text-sm sm:text-base rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors whitespace-nowrap",children:[y?(0,bs.jsx)(Ir,{className:"w-4 h-4 animate-spin flex-shrink-0"}):(0,bs.jsx)(Ls,{className:"w-4 h-4 flex-shrink-0"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Generate Sessions"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"Generate"})]}),(0,bs.jsxs)("button",{onClick:v,className:"flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 bg-blue-600 text-white text-sm sm:text-base rounded-md hover:bg-blue-700 transition-colors whitespace-nowrap",children:[(0,bs.jsx)(wa,{className:"w-4 h-4 flex-shrink-0"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"New Schedule"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"New"})]})]})]}),0===w.length?(0,bs.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,bs.jsx)(Ls,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-600 mb-4",children:"No active schedules"}),(0,bs.jsx)("button",{onClick:v,className:"text-blue-600 hover:text-blue-700 font-medium",children:"Create your first schedule"})]}):(0,bs.jsx)("div",{className:"grid gap-4",children:w.map(e=>{const t=Jr(e.session_type),s=(e.schedule_name||e.session_type,parseFloat(e.session_cost)||0);return(0,bs.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[(0,bs.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium whitespace-nowrap ".concat(t.bg," ").concat(t.text),children:e.session_type}),e.schedule_name&&(0,bs.jsx)("span",{className:"text-gray-900 font-semibold whitespace-nowrap",children:e.schedule_name}),(0,bs.jsxs)("span",{className:"text-gray-900 font-medium whitespace-nowrap",children:["Every ",Kr[e.day_of_week]]}),(0,bs.jsxs)("span",{className:"text-gray-600 whitespace-nowrap",children:["at ",Vr(e.session_time)]}),(0,bs.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-medium whitespace-nowrap ".concat(0===s?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"),children:0===s?"Free":"\xa3".concat(s.toFixed(2))})]}),e.notes&&(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:e.notes}),(0,bs.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Created ",new Date(e.created_at).toLocaleDateString("en-GB")]})]}),(0,bs.jsxs)("div",{className:"flex gap-2 self-end sm:self-start",children:[(0,bs.jsx)("button",{onClick:()=>(e=>{f(e),m(!0)})(e),className:"p-2 text-purple-600 hover:bg-purple-50 rounded-md transition-colors flex-shrink-0",title:"Manage enrolled players",children:(0,bs.jsx)(qs,{className:"w-4 h-4"})}),(0,bs.jsx)("button",{onClick:()=>(e=>{g(e),c(!0)})(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-md transition-colors flex-shrink-0",title:"Edit schedule",children:(0,bs.jsx)(Ga,{className:"w-4 h-4"})}),(0,bs.jsx)("button",{onClick:()=>(async e=>{if(!window.confirm("Are you sure you want to deactivate this schedule? Future sessions will no longer be generated."))return;(await r.deactivateSchedule(e)).error?l("Failed to deactivate schedule"):i("Schedule deactivated successfully")})(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-md transition-colors flex-shrink-0",title:"Deactivate schedule",children:(0,bs.jsx)(Ha,{className:"w-4 h-4"})})]})]})},e.id)})}),j.length>0&&(0,bs.jsxs)("div",{className:"mt-8",children:[(0,bs.jsxs)("h4",{className:"text-md font-semibold text-gray-700 mb-3",children:["Inactive Schedules (",j.length,")"]}),(0,bs.jsx)("div",{className:"space-y-2",children:j.map(e=>(0,bs.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 opacity-60",children:(0,bs.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bs.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium bg-gray-200 text-gray-700",children:e.session_type}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:["Every ",Kr[e.day_of_week]," at ",e.session_time]}),(0,bs.jsxs)("span",{className:"text-xs text-gray-500",children:["(Deactivated ",new Date(e.deactivated_at).toLocaleDateString("en-GB"),")"]})]})},e.id))})]}),o&&(0,bs.jsx)(zr,{isOpen:o,onClose:()=>c(!1),schedule:p,onSuccess:()=>{c(!1),r.fetchSchedules()},actions:r}),d&&(0,bs.jsx)(Wr,{isOpen:d,onClose:()=>u(!1),onGenerate:async(e,t,s)=>{b(!0);const a=await r.generateSessions(t,e,s);if(a.error)b(!1),l("Failed to generate sessions: "+a.error.message);else{var n;await r.fetchSessions(),b(!1);const e=(null===(n=a.data)||void 0===n?void 0:n.length)||0;i("Generated ".concat(e," new session").concat(1!==e?"s":""))}},activeSchedules:w}),h&&x&&(0,bs.jsx)(Hr,{isOpen:h,onClose:()=>{m(!1),f(null)},schedule:x,actions:r})]})},Yr=e=>{let{isOpen:t,onClose:s,onSuccess:r,actions:n}=e;const{success:i,error:l}=As(),[o,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)({session_type:"Adults",session_date:(new Date).toISOString().split("T")[0],session_time:"18:00",notes:""});return t?(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold",children:"Create Manual Session"}),(0,bs.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,bs.jsx)(Es,{className:"w-5 h-5"})})]}),(0,bs.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),d(!0);try{const e=await n.createSession(u);if(e.error)throw e.error;i("Session created successfully"),r()}catch(t){l(t.message||"Failed to create session")}finally{d(!1)}},className:"p-6 space-y-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Type"}),(0,bs.jsxs)("select",{value:u.session_type,onChange:e=>h(c(c({},u),{},{session_type:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0,children:[(0,bs.jsx)("option",{value:"Adults",children:"Adults"}),(0,bs.jsx)("option",{value:"Beginners",children:"Beginners"}),(0,bs.jsx)("option",{value:"Juniors",children:"Juniors"})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),(0,bs.jsx)("input",{type:"date",value:u.session_date,onChange:e=>h(c(c({},u),{},{session_date:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time"}),(0,bs.jsx)("input",{type:"time",value:u.session_time,onChange:e=>h(c(c({},u),{},{session_time:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",required:!0})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,bs.jsx)("textarea",{value:u.notes,onChange:e=>h(c(c({},u),{},{notes:e.target.value})),rows:3,className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent"})]}),(0,bs.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,bs.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,bs.jsx)("button",{type:"submit",disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:o?"Creating...":"Create Session"})]})]})]})}):null},Qr=e=>{let{isOpen:t,onClose:s,session:r,actions:n,onSuccess:i}=e;const{success:l,error:o}=As(),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)({cancellation_reason:"",coach_payment_status:"to_pay"});return t?(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold",children:"Cancel Session"}),(0,bs.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,bs.jsx)(Es,{className:"w-5 h-5"})})]}),(0,bs.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),u(!0);try{const e=await n.cancelSession(r.id,h.cancellation_reason);if(e.error)throw e.error;const t=await n.updateSessionCoachPaymentStatus(r.id,h.coach_payment_status,"Cancelled session - payment status: ".concat("to_pay"===h.coach_payment_status?"To Pay":"No Payment"));if(t.error)throw t.error;l("Session cancelled successfully"),i(),s()}catch(t){o(t.message||"Failed to cancel session")}finally{u(!1)}},className:"p-6 space-y-4",children:[(0,bs.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:(0,bs.jsxs)("p",{className:"text-sm text-blue-900",children:[(0,bs.jsx)("strong",{children:"Session:"})," ",r.session_type," on"," ",new Date(r.session_date).toLocaleDateString("en-GB")," at ",r.session_time]})}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cancellation Reason"}),(0,bs.jsx)("textarea",{value:h.cancellation_reason,onChange:e=>m(c(c({},h),{},{cancellation_reason:e.target.value})),rows:3,className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",placeholder:"Why is this session being cancelled?"})]}),(0,bs.jsxs)("div",{className:"border-t pt-4",children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Coach Payment"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Should we still pay the coach for this cancelled session?"}),(0,bs.jsxs)("div",{className:"space-y-3",children:[(0,bs.jsxs)("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",style:{borderColor:"to_pay"===h.coach_payment_status?"#2196f3":"#ddd"},children:[(0,bs.jsx)("input",{type:"radio",name:"coach_payment_status",value:"to_pay",checked:"to_pay"===h.coach_payment_status,onChange:e=>m(c(c({},h),{},{coach_payment_status:e.target.value})),className:"mt-1"}),(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900",children:"To Pay"}),(0,bs.jsx)("div",{className:"text-sm text-gray-600",children:"Coach will be paid for this session (e.g., cancelled with short notice, coach's decision to run it)"})]})]}),(0,bs.jsxs)("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",style:{borderColor:"no_payment"===h.coach_payment_status?"#2196f3":"#ddd"},children:[(0,bs.jsx)("input",{type:"radio",name:"coach_payment_status",value:"no_payment",checked:"no_payment"===h.coach_payment_status,onChange:e=>m(c(c({},h),{},{coach_payment_status:e.target.value})),className:"mt-1"}),(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900",children:"No Payment"}),(0,bs.jsx)("div",{className:"text-sm text-gray-600",children:"Coach will NOT be paid (e.g., weather, coach unavailable, cancelled well in advance)"})]})]})]})]}),(0,bs.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[(0,bs.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",disabled:d,children:"Cancel"}),(0,bs.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 transition-colors",children:d?"Cancelling...":"Cancel Session"})]})]})]})}):null},Xr=fs("CheckSquare",[["polyline",{points:"9 11 12 14 22 4",key:"19ybtz"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]),Zr=fs("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),en=e=>{let{isOpen:t,onClose:s,session:r,allUsers:n,actions:i,onSuccess:l}=e;const{success:o,error:d}=As(),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(""),[g,x]=(0,a.useState)([]),[f,y]=(0,a.useState)([]),[b,v]=(0,a.useState)([]);(0,a.useEffect)(()=>{r&&(i.getSessionAttendance(r.id).then(e=>{e.error||y(e.data||[])}),i.getPlayerAttendanceStats(r.session_type).then(e=>{e.error||v(e.data||[])}),x([]),p(""))},[r,i]);if(!t)return null;const w=new Set(f.map(e=>e.player_id)),j=new Map(b.map(e=>[e.player_id,e])),_=n.filter(e=>!w.has(e.id)).filter(e=>e.name.toLowerCase().includes(m.toLowerCase())).map(e=>c(c({},e),{},{stats:j.get(e.id)||{attendance_count:0,last_attended_date:null}})).sort((e,t)=>{const s=(t.stats.attendance_count||0)-(e.stats.attendance_count||0);return 0!==s?s:e.name.localeCompare(t.name)});return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold",children:"Mark Attendance"}),(0,bs.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,bs.jsx)(Es,{className:"w-5 h-5"})})]}),(0,bs.jsxs)("div",{className:"p-6",children:[(0,bs.jsxs)("div",{className:"mb-4",children:[(0,bs.jsxs)("p",{className:"text-sm text-gray-600",children:["Session: ",new Date(r.session_date).toLocaleDateString("en-GB")," at ",r.session_time]}),(0,bs.jsxs)("p",{className:"text-sm text-gray-600",children:["Current attendance: ",f.length]})]}),(0,bs.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),0!==g.length){h(!0);try{let e=0,t=0;for(const s of g){(await i.markAttendance(r.id,s,!1)).error?t++:e++}e>0&&o("Marked attendance for ".concat(e," player").concat(1!==e?"s":"")),t>0&&d("Failed to mark attendance for ".concat(t," player").concat(1!==t?"s":"")),l()}catch(t){d(t.message||"Failed to mark attendance")}finally{h(!1)}}},className:"space-y-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Players"}),(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)(Ja,{className:"w-5 h-5 absolute left-3 top-3 text-gray-400"}),(0,bs.jsx)("input",{type:"text",value:m,onChange:e=>p(e.target.value),placeholder:"Search by name...",className:"w-full pl-10 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent"})]})]}),_.length>0&&(0,bs.jsxs)("div",{className:"flex items-center justify-between px-1",children:[(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:[g.length," of ",_.length," selected"]}),(0,bs.jsx)("button",{type:"button",onClick:()=>{g.length===_.length?x([]):x(_.map(e=>e.id))},className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:g.length===_.length?"Clear All":"Select All"})]}),(0,bs.jsx)("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-md",children:0===_.length?(0,bs.jsx)("p",{className:"text-center py-8 text-gray-500",children:"No players found"}):_.map(e=>{const t=g.includes(e.id),s=e.stats.attendance_count||0,a=s>0;return(0,bs.jsxs)("div",{onClick:()=>{return t=e.id,void x(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"flex items-center justify-between p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors",children:[(0,bs.jsxs)("div",{className:"flex items-center flex-1 min-w-0",children:[t?(0,bs.jsx)(Xr,{className:"w-5 h-5 text-blue-600 mr-3 flex-shrink-0"}):(0,bs.jsx)(Zr,{className:"w-5 h-5 text-gray-400 mr-3 flex-shrink-0"}),(0,bs.jsx)("span",{className:"font-medium truncate ".concat(t?"text-blue-900":"text-gray-900"),children:e.name})]}),a&&(0,bs.jsxs)("div",{className:"flex items-center gap-1 ml-2 flex-shrink-0",children:[(0,bs.jsx)(da,{className:"w-3 h-3 text-green-600"}),(0,bs.jsxs)("span",{className:"text-xs font-medium text-green-700 bg-green-50 px-2 py-0.5 rounded",children:[s,"x"]})]})]},e.id)})}),(0,bs.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,bs.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,bs.jsx)("button",{type:"submit",disabled:u||0===g.length,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:u?"Marking...":"Mark ".concat(g.length," Player").concat(1!==g.length?"s":"")})]})]})]})]})})},tn=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";const s=new Date(e);return isNaN(s.getTime())?"":t?s.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):s.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"})},sn=e=>{if(!e)return"";const t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})},an=e=>{let{sessions:t,schedules:s,loading:r,attendance:n,actions:i,allUsers:l,currentUser:o}=e;const{success:c,error:d}=As(),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(null),[g,x]=(0,a.useState)(new Set),[f,y]=(0,a.useState)(null),[b,v]=(0,a.useState)("upcoming"),w=e=>{if(!e)return"";const[t,s]=e.split(":"),a=parseInt(t,10),r=a>=12?"pm":"am";return"".concat(a%12||12).concat("00"!==s?":"+s:"").concat(r)};if(r)return(0,bs.jsx)(Gr,{});const j=(new Date).toISOString().split("T")[0],_=t.filter(e=>"upcoming"===b?e.session_date>=j&&"scheduled"===e.status:"past"===b?e.session_date<j||"completed"===e.status:"cancelled"!==b||"cancelled"===e.status).sort((e,t)=>"upcoming"===b?new Date(e.session_date)-new Date(t.session_date):new Date(t.session_date)-new Date(e.session_date));return(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:justify-between sm:items-center",children:[(0,bs.jsx)("div",{className:"flex flex-wrap gap-2",children:["upcoming","past","cancelled","all"].map(e=>(0,bs.jsx)("button",{onClick:()=>v(e),className:"\n                px-3 sm:px-4 py-2 rounded-md text-sm sm:text-base font-medium transition-colors\n                ".concat(b===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200","\n              "),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,bs.jsxs)("button",{onClick:()=>h(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors whitespace-nowrap",children:[(0,bs.jsx)(wa,{className:"w-4 h-4 flex-shrink-0"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Create Session"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"Create"})]})]}),0===_.length?(0,bs.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,bs.jsx)(Ls,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,bs.jsxs)("p",{className:"text-gray-600",children:["No ","all"!==b&&b," sessions found"]})]}):(0,bs.jsx)("div",{className:"space-y-3",children:_.map(e=>{const t=n.filter(t=>t.session_id===e.id),s=g.has(e.id),a=Jr(e.session_type);return(0,bs.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow",children:[(0,bs.jsx)("div",{className:"p-4",children:(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[(0,bs.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium whitespace-nowrap ".concat(a.bg," ").concat(a.text),children:e.session_type}),(r=e.status,(0,bs.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat({scheduled:"bg-blue-100 text-blue-700",completed:"bg-green-100 text-green-700",cancelled:"bg-red-100 text-red-700"}[r]||"bg-gray-100 text-gray-700"),children:r.charAt(0).toUpperCase()+r.slice(1)})),(0,bs.jsx)("span",{className:"text-gray-900 font-medium whitespace-nowrap",children:sn(e.session_date)}),(0,bs.jsxs)("span",{className:"text-gray-600 whitespace-nowrap",children:["at ",w(e.session_time)]})]}),(0,bs.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,bs.jsxs)("button",{onClick:()=>{return t=e.id,void x(e=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s});var t},className:"flex items-center gap-2 hover:text-blue-600 transition-colors",children:[(0,bs.jsx)(qs,{className:"w-4 h-4"}),(0,bs.jsxs)("span",{children:[t.length," attendee",1!==t.length?"s":""]}),s?(0,bs.jsx)(sa,{className:"w-4 h-4"}):(0,bs.jsx)(aa,{className:"w-4 h-4"})]}),e.notes&&(0,bs.jsxs)("span",{className:"text-gray-500",children:["\u2022 ",e.notes]})]}),"cancelled"===e.status&&e.cancellation_reason&&(0,bs.jsxs)("p",{className:"text-sm text-red-600 mt-2",children:["Cancelled: ",e.cancellation_reason]})]}),(0,bs.jsxs)("div",{className:"flex flex-wrap gap-2 sm:flex-nowrap",children:[(0,bs.jsxs)("button",{onClick:()=>y(e),className:"flex items-center gap-1.5 px-2.5 sm:px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors whitespace-nowrap",title:"Add attendee",children:[(0,bs.jsx)(sr,{className:"w-4 h-4 flex-shrink-0"}),(0,bs.jsx)("span",{children:"Add"})]}),"scheduled"===e.status&&(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("button",{onClick:()=>(async e=>{if(!window.confirm("Mark this session as completed?"))return;(await i.completeSession(e)).error?d("Failed to complete session"):c("Session marked as completed")})(e.id),className:"p-2 text-green-600 hover:bg-green-50 rounded-md transition-colors flex-shrink-0",title:"Mark as completed",children:(0,bs.jsx)(na,{className:"w-4 h-4"})}),(0,bs.jsx)("button",{onClick:()=>(e=>{p(e)})(e),className:"p-2 text-orange-600 hover:bg-orange-50 rounded-md transition-colors flex-shrink-0",title:"Cancel session",children:(0,bs.jsx)(Es,{className:"w-4 h-4"})})]}),(0,bs.jsx)("button",{onClick:()=>(async e=>{const t=n.filter(t=>t.session_id===e.id),s=t.length>0?"This session has ".concat(t.length," attendee(s). Are you sure you want to permanently delete it?"):"Are you sure you want to permanently delete this session?";if(!window.confirm(s))return;(await i.deleteSession(e.id)).error?d("Failed to delete session"):c("Session deleted successfully")})(e),className:"p-2 text-red-600 hover:bg-red-50 rounded-md transition-colors flex-shrink-0",title:"Delete session permanently",children:(0,bs.jsx)(Ha,{className:"w-4 h-4"})})]})]})}),s&&(0,bs.jsxs)("div",{className:"border-t border-gray-200 bg-gray-50 p-4",children:[(0,bs.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Attendance"}),0===t.length?(0,bs.jsx)("div",{className:"text-center py-6 text-gray-500 text-sm",children:"No attendance recorded yet"}):(0,bs.jsx)("div",{className:"space-y-2",children:t.map(t=>{var s,a,r;return(0,bs.jsxs)("div",{className:"flex items-center justify-between py-2 px-3 bg-white rounded border border-gray-200",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:null===(s=t.player)||void 0===s?void 0:s.name}),t.self_registered&&(0,bs.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded",children:"Self-registered"}),(r=t.payment_status,r&&"unpaid"!==r?"pending_confirmation"===r?(0,bs.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:"Pending"}):"paid"===r?(0,bs.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded",children:"Paid"}):null:(0,bs.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded",children:"Unpaid"}))]}),(0,bs.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:null===(a=t.player)||void 0===a?void 0:a.email})]}),(0,bs.jsx)("button",{onClick:()=>(async e=>{var t;if(!window.confirm("Remove ".concat(null===(t=e.player)||void 0===t?void 0:t.name,"'s attendance?")))return;(await i.removeAttendance(e.id)).error?d("Failed to remove attendance"):(c("Attendance removed"),i.fetchAttendance())})(t,e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-md transition-colors",title:"Remove attendance",children:(0,bs.jsx)(Ha,{className:"w-4 h-4"})})]},t.id)})})]})]},e.id);var r})}),u&&(0,bs.jsx)(Yr,{isOpen:u,onClose:()=>h(!1),onSuccess:()=>{h(!1),i.fetchSessions()},actions:i}),f&&(0,bs.jsx)(en,{isOpen:!!f,onClose:()=>y(null),session:f,allUsers:l,actions:i,onSuccess:()=>{y(null),i.fetchAttendance()}}),m&&(0,bs.jsx)(Qr,{isOpen:!!m,onClose:()=>p(null),session:m,actions:i,onSuccess:()=>{p(null),i.fetchSessions()}})]})},rn=e=>{let{isOpen:t,onClose:s,player:r,actions:n,onSuccess:i}=e;const{success:l,error:o}=As(),[c,d]=(0,a.useState)([]),[u,h]=(0,a.useState)(!0),[m,p]=(0,a.useState)(!1),[g,x]=(0,a.useState)([]),[f,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&r&&b()},[t,r]);const b=async()=>{h(!0);const e=await n.getPlayerSessionsByPaymentStatus(r.player_id);e.data&&d(e.data),h(!1),x([])},v=e=>{x(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},w=e=>{const t=e.map(e=>e.attendance_id),s=t.every(e=>g.includes(e));x(s?e=>e.filter(e=>!t.includes(e)):e=>[...new Set([...e,...t])])};if(!t)return null;const j=c.filter(e=>"unpaid"===e.payment_status),_=c.filter(e=>"pending_confirmation"===e.payment_status),N=c.filter(e=>"paid"===e.payment_status);return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,bs.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:r.player_name}),(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:r.player_email})]}),(0,bs.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,bs.jsx)(Es,{className:"w-6 h-6"})})]}),(0,bs.jsxs)("div",{className:"p-6 bg-gray-50 border-b border-gray-200",children:[(0,bs.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"Total Owed"}),(0,bs.jsxs)("p",{className:"text-2xl font-bold text-yellow-700",children:["\xa3",parseFloat(r.amount_owed||0).toFixed(2)]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"To Confirm"}),(0,bs.jsxs)("p",{className:"text-2xl font-bold text-blue-700",children:["\xa3",parseFloat(r.amount_pending_confirmation||0).toFixed(2)]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"Paid"}),(0,bs.jsxs)("p",{className:"text-2xl font-bold text-green-700",children:["\xa3",parseFloat(r.amount_paid||0).toFixed(2)]})]})]}),parseFloat(r.amount_owed||0)>0&&(0,bs.jsxs)("div",{className:"border-t border-gray-200 pt-3 text-sm",children:[(0,bs.jsx)("p",{className:"text-gray-600 font-medium mb-2",children:"Amount owed breakdown:"}),(0,bs.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[r.unpaid_sessions>0&&(0,bs.jsxs)("div",{className:"bg-white rounded px-2 py-1 border border-gray-200",children:[(0,bs.jsx)("span",{className:"font-medium",children:r.unpaid_sessions}),(0,bs.jsx)("span",{className:"text-gray-500 ml-1",children:"coaching"}),(0,bs.jsxs)("span",{className:"text-gray-400 ml-1",children:["\xa3",parseFloat(r.coaching_amount_owed||4*r.unpaid_sessions).toFixed(2)]})]}),(r.ladder_matches_unpaid||0)>0&&(0,bs.jsxs)("div",{className:"bg-white rounded px-2 py-1 border border-gray-200",children:[(0,bs.jsx)("span",{className:"font-medium",children:r.ladder_matches_unpaid}),(0,bs.jsx)("span",{className:"text-gray-500 ml-1",children:"ladder"}),(0,bs.jsxs)("span",{className:"text-gray-400 ml-1",children:["\xa3",parseFloat(r.ladder_amount_owed||0).toFixed(2)]})]}),(r.league_matches_unpaid||0)>0&&(0,bs.jsxs)("div",{className:"bg-white rounded px-2 py-1 border border-gray-200",children:[(0,bs.jsx)("span",{className:"font-medium",children:r.league_matches_unpaid}),(0,bs.jsx)("span",{className:"text-gray-500 ml-1",children:"league"}),(0,bs.jsxs)("span",{className:"text-gray-400 ml-1",children:["\xa3",parseFloat(r.league_amount_owed||0).toFixed(2)]})]}),(r.singles_matches_unpaid||0)>0&&(0,bs.jsxs)("div",{className:"bg-white rounded px-2 py-1 border border-gray-200",children:[(0,bs.jsx)("span",{className:"font-medium",children:r.singles_matches_unpaid}),(0,bs.jsx)("span",{className:"text-gray-500 ml-1",children:"singles"}),(0,bs.jsxs)("span",{className:"text-gray-400 ml-1",children:["\xa3",parseFloat(r.singles_amount_owed||0).toFixed(2)]})]})]})]})]}),(0,bs.jsxs)("div",{className:"flex gap-2 p-4 bg-white border-b border-gray-200",children:[(0,bs.jsxs)("button",{onClick:async()=>{const e=window.prompt("Enter amount received from ".concat(r.player_name,":\n\n")+"(Sessions cost \xa34 each. Payment will be auto-allocated to oldest unpaid sessions.)");if(null===e)return;const t=parseFloat(e);if(isNaN(t)||t<=0)return void o("Please enter a valid amount");const s=window.prompt("Enter payment reference (optional):")||"";p(!0);const a=await n.adminConfirmPayment(r.player_id,t,s);if(a.error)o("Failed to confirm payment");else{var c,d,u;const e=(null===(c=a.data)||void 0===c?void 0:c.sessions_confirmed)||0,t=(null===(d=a.data)||void 0===d?void 0:d.amount_allocated)||0,s=(null===(u=a.data)||void 0===u?void 0:u.remaining_amount)||0;l("Confirmed \xa3".concat(t.toFixed(2)," for ").concat(e," session(s)")+(s>0?". \xa3".concat(s.toFixed(2)," remaining (not enough for another session)"):"")),await b(),i&&i()}p(!1)},disabled:m||u,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:[(0,bs.jsx)(Fr,{className:"w-4 h-4"}),"Confirm Payment"]}),g.length>0&&(0,bs.jsxs)("button",{onClick:async()=>{if(0===g.length)return void o("Please select sessions to mark as unpaid");const e="Are you sure you want to mark ".concat(g.length," session(s) as UNPAID?\n\n")+"This will reverse the payment status because the money hasn't been received.";if(!window.confirm(e))return;const t=window.prompt("Enter reason for reversal (optional):")||"Payment not received";y(!0);const s=await n.adminReversePaymentStatus(g,t);if(s.error)o("Failed to reverse payment status");else{var a;const e=(null===(a=s.data)||void 0===a?void 0:a.length)||0;l("Reversed ".concat(e," session(s) back to unpaid")),await b(),i&&i()}y(!1)},disabled:f||u,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",children:[(0,bs.jsx)(Ss,{className:"w-4 h-4"}),"Mark as Unpaid (",g.length,")"]})]}),(0,bs.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:u?(0,bs.jsx)(Gr,{}):0===c.length?(0,bs.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,bs.jsx)(Ls,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),(0,bs.jsx)("p",{children:"No coaching sessions found for this player"})]}):(0,bs.jsxs)("div",{className:"space-y-6",children:[j.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:["Unpaid Sessions (",j.length,")"]}),(0,bs.jsx)("div",{className:"space-y-2",children:j.map(e=>{const t=Jr(e.session_type);return(0,bs.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:[(0,bs.jsx)("div",{className:"flex-1",children:(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:new Date(e.session_date).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:["at ",Vr(e.session_time)]}),(0,bs.jsx)("span",{className:"text-xs ".concat(t.bg," ").concat(t.text," px-2 py-1 rounded"),children:e.session_type})]})}),(0,bs.jsx)("span",{className:"text-sm font-semibold text-yellow-700",children:"\xa34.00"})]},e.attendance_id)})})]}),_.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Awaiting Confirmation (",_.length,")"]}),(0,bs.jsx)("button",{onClick:()=>w(_),className:"text-xs text-blue-600 hover:text-blue-800",children:_.every(e=>g.includes(e.attendance_id))?"Deselect All":"Select All"})]}),(0,bs.jsx)("div",{className:"space-y-2",children:_.map(e=>{const t=Jr(e.session_type);return(0,bs.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-blue-50 border border-blue-200 rounded-md cursor-pointer hover:bg-blue-100 transition-colors",onClick:()=>v(e.attendance_id),children:[(0,bs.jsx)("input",{type:"checkbox",checked:g.includes(e.attendance_id),onChange:()=>v(e.attendance_id),className:"mt-1 w-4 h-4 text-blue-600 rounded",onClick:e=>e.stopPropagation()}),(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:new Date(e.session_date).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:["at ",Vr(e.session_time)]}),(0,bs.jsx)("span",{className:"text-xs ".concat(t.bg," ").concat(t.text," px-2 py-1 rounded"),children:e.session_type})]}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700",children:["Player marked paid: ",new Date(e.user_marked_paid_at).toLocaleDateString("en-GB")]}),e.user_payment_note&&(0,bs.jsxs)("div",{className:"text-xs text-blue-600 mt-1",children:["Note: ",e.user_payment_note]})]}),(0,bs.jsx)("span",{className:"text-sm font-semibold text-blue-700",children:"\xa34.00"})]},e.attendance_id)})})]}),N.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Paid Sessions (",N.length,")"]}),(0,bs.jsx)("button",{onClick:()=>w(N.slice(0,5)),className:"text-xs text-green-600 hover:text-green-800",children:N.slice(0,5).every(e=>g.includes(e.attendance_id))?"Deselect All":"Select All"})]}),(0,bs.jsxs)("div",{className:"space-y-2",children:[N.slice(0,5).map(e=>{const t=Jr(e.session_type);return(0,bs.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-green-50 border border-green-200 rounded-md cursor-pointer hover:bg-green-100 transition-colors",onClick:()=>v(e.attendance_id),children:[(0,bs.jsx)("input",{type:"checkbox",checked:g.includes(e.attendance_id),onChange:()=>v(e.attendance_id),className:"w-4 h-4 text-green-600 rounded",onClick:e=>e.stopPropagation()}),(0,bs.jsx)(na,{className:"w-5 h-5 text-green-600 flex-shrink-0"}),(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"text-sm text-gray-900",children:new Date(e.session_date).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}),(0,bs.jsxs)("span",{className:"text-xs text-gray-600",children:["at ",Vr(e.session_time)]}),(0,bs.jsx)("span",{className:"text-xs ".concat(t.bg," ").concat(t.text," px-2 py-1 rounded"),children:e.session_type})]}),e.admin_payment_reference&&(0,bs.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:["Ref: ",e.admin_payment_reference]})]}),(0,bs.jsx)("span",{className:"text-sm font-semibold text-green-700",children:"\xa34.00"})]},e.attendance_id)}),N.length>5&&(0,bs.jsxs)("p",{className:"text-sm text-gray-500 text-center py-2",children:["+ ",N.length-5," more paid session",N.length-5!==1?"s":""]})]})]})]})})]})})},nn=e=>{let{loading:t,actions:s}=e;const{success:r,error:n}=As(),[i,l]=(0,a.useState)([]),[o,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null),[h,m]=(0,a.useState)("all"),[p,g]=(0,a.useState)(""),[x,f]=(0,a.useState)(new Set),[y,b]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{c(!0);const e=await s.getAllPlayersPaymentSummary();e.data&&l(e.data),c(!1)})()},[s]);const v=e=>{const t=new Set(x);t.has(e)?t.delete(e):t.add(e),f(t)},w=()=>{const e=N.filter(e=>parseFloat(e.amount_owed)>0).map(e=>e.player_id);f(new Set(e))},j=()=>{f(new Set)},_=async()=>{c(!0);const e=await s.getAllPlayersPaymentSummary();e.data&&l(e.data),c(!1)};if(o&&0===i.length)return(0,bs.jsx)(Gr,{});const N=i.filter(e=>{if("owe_money"===h){if(0===parseFloat(e.amount_owed))return!1}else if("awaiting_confirmation"===h){if(0===parseFloat(e.amount_pending_confirmation))return!1}else if("paid_up"===h&&(0!==parseFloat(e.amount_owed)||0!==parseFloat(e.amount_pending_confirmation)))return!1;if(p.trim()){var t,s;const a=p.toLowerCase(),r=null===(t=e.player_name)||void 0===t?void 0:t.toLowerCase().includes(a),n=null===(s=e.player_email)||void 0===s?void 0:s.toLowerCase().includes(a);if(!r&&!n)return!1}return!0}),k=i.reduce((e,t)=>({owed:e.owed+parseFloat(t.amount_owed||0),pending:e.pending+parseFloat(t.amount_pending_confirmation||0),paid:e.paid+parseFloat(t.amount_paid||0),playersOwing:e.playersOwing+(parseFloat(t.amount_owed)>0?1:0),playersPending:e.playersPending+(parseFloat(t.amount_pending_confirmation)>0?1:0)}),{owed:0,pending:0,paid:0,playersOwing:0,playersPending:0});return(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,bs.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,bs.jsx)("p",{className:"text-sm text-yellow-700 font-medium",children:"Total Owed"}),(0,bs.jsx)(Fr,{className:"w-5 h-5 text-yellow-600"})]}),(0,bs.jsxs)("p",{className:"text-2xl font-bold text-yellow-900",children:["\xa3",k.owed.toFixed(2)]}),(0,bs.jsxs)("p",{className:"text-xs text-yellow-600 mt-1",children:[k.playersOwing," player",1!==k.playersOwing?"s":""," owing money"]})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,bs.jsx)("p",{className:"text-sm text-blue-700 font-medium",children:"Awaiting Confirmation"}),(0,bs.jsx)(na,{className:"w-5 h-5 text-blue-600"})]}),(0,bs.jsxs)("p",{className:"text-2xl font-bold text-blue-900",children:["\xa3",k.pending.toFixed(2)]}),(0,bs.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:[k.playersPending," player",1!==k.playersPending?"s":""," marked as paid"]})]}),(0,bs.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,bs.jsx)("p",{className:"text-sm text-green-700 font-medium",children:"Total Received"}),(0,bs.jsx)(na,{className:"w-5 h-5 text-green-600"})]}),(0,bs.jsxs)("p",{className:"text-2xl font-bold text-green-900",children:["\xa3",k.paid.toFixed(2)]}),(0,bs.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"All-time confirmed payments"})]})]}),(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsx)(Ja,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,bs.jsx)("input",{type:"text",placeholder:"Search by player name or email...",value:p,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,bs.jsx)("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"All Players"},{value:"owe_money",label:"Owe Money"},{value:"awaiting_confirmation",label:"To Confirm"},{value:"paid_up",label:"Paid Up"}].map(e=>(0,bs.jsx)("button",{onClick:()=>m(e.value),className:"\n                px-4 py-2 rounded-md font-medium transition-colors\n                ".concat(h===e.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200","\n              "),children:e.label},e.value))}),(0,bs.jsxs)("div",{className:"flex gap-2",children:[(0,bs.jsx)("button",{onClick:_,disabled:o,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50",children:o?"Refreshing...":"Refresh"}),(0,bs.jsxs)("button",{onClick:async()=>{if(0===x.size)return void n("Please select at least one player to send reminders to");const e="Send payment reminders to ".concat(x.size," selected player(s)?");if(window.confirm(e)){b(!0);try{const e=i.filter(e=>x.has(e.player_id)).map(e=>({player_id:e.player_id,player_name:e.player_name,player_email:e.player_email,amount_due:e.amount_owed,total_sessions:e.unpaid_sessions})),t=await s.sendPaymentReminders(null,null,e);if(t.error)throw new Error(t.error);if(r("Successfully sent ".concat(t.data.sent," reminder(s)")),t.data.failed>0){const e=t.data.errors&&t.data.errors.length>0?t.data.errors.map(e=>"".concat(e.player,": ").concat(e.error)).join("\n"):"Unknown error";n("".concat(t.data.failed," email(s) failed to send:\n\n").concat(e))}f(new Set),await _()}catch(t){console.error("Error sending reminders:",t),n("Failed to send reminders: "+t.message)}finally{b(!1)}}},disabled:y||0===x.size,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:[(0,bs.jsx)(mr,{className:"w-4 h-4"}),y?(0,bs.jsx)("span",{children:"Sending..."}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsxs)("span",{className:"hidden sm:inline",children:["Send Reminders ",x.size>0?"(".concat(x.size,")"):""]}),(0,bs.jsxs)("span",{className:"sm:hidden",children:["Send ",x.size>0?"(".concat(x.size,")"):""]})]})]})]})]}),N.length>0&&(0,bs.jsxs)("div",{className:"flex items-center gap-3 px-4 py-2 bg-gray-50 rounded-md border border-gray-200",children:[(0,bs.jsx)("span",{className:"text-sm text-gray-600 font-medium",children:"Select:"}),(0,bs.jsxs)("button",{onClick:w,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:["All Owing (",N.filter(e=>parseFloat(e.amount_owed)>0).length,")"]}),(0,bs.jsx)("span",{className:"text-gray-300",children:"|"}),(0,bs.jsx)("button",{onClick:j,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"None"}),x.size>0&&(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("span",{className:"text-gray-300",children:"|"}),(0,bs.jsxs)("span",{className:"text-sm text-gray-700",children:[(0,bs.jsx)("strong",{children:x.size})," selected"]})]})]}),0===N.length?(0,bs.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,bs.jsx)(Us,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"all"===h?"No players with outstanding items found":"owe_money"===h?"No players owe money":"awaiting_confirmation"===h?"No payments awaiting confirmation":"No players are fully paid up"})]}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("div",{className:"md:hidden space-y-3",children:N.map(e=>{const t=parseFloat(e.amount_owed||0),s=parseFloat(e.amount_pending_confirmation||0),a=parseFloat(e.amount_paid||0),r=t>0;return(0,bs.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[(0,bs.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,bs.jsxs)("div",{className:"flex gap-3 flex-1",children:[r?(0,bs.jsx)("input",{type:"checkbox",checked:x.has(e.player_id),onChange:t=>{t.stopPropagation(),v(e.player_id)},className:"w-5 h-5 cursor-pointer mt-1 flex-shrink-0"}):(0,bs.jsx)("div",{className:"w-5"}),(0,bs.jsxs)("div",{className:"flex-1",onClick:()=>u(e),children:[(0,bs.jsx)("h3",{className:"font-medium text-gray-900",children:e.player_name}),(0,bs.jsx)("p",{className:"text-sm text-gray-500",children:e.player_email}),(0,bs.jsxs)("div",{className:"text-xs text-gray-500 mt-1 space-y-0.5",children:[e.unpaid_sessions>0&&(0,bs.jsxs)("p",{children:[e.unpaid_sessions," coaching session",1!==e.unpaid_sessions?"s":""]}),(e.ladder_matches_unpaid||0)>0&&(0,bs.jsxs)("p",{children:[e.ladder_matches_unpaid," ladder match",1!==e.ladder_matches_unpaid?"es":""]}),(e.league_matches_unpaid||0)>0&&(0,bs.jsxs)("p",{children:[e.league_matches_unpaid," league match",1!==e.league_matches_unpaid?"es":""]}),(e.singles_matches_unpaid||0)>0&&(0,bs.jsxs)("p",{children:[e.singles_matches_unpaid," singles match",1!==e.singles_matches_unpaid?"es":""]})]})]})]}),(0,bs.jsx)("button",{onClick:t=>{t.stopPropagation(),u(e)},className:"text-blue-600 hover:text-blue-800 flex-shrink-0",children:(0,bs.jsx)(Sa,{className:"w-5 h-5"})})]}),(0,bs.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-center pt-3 border-t border-gray-200",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Owed"}),(0,bs.jsxs)("p",{className:"text-sm font-semibold ".concat(t>0?"text-yellow-700":"text-gray-400"),children:["\xa3",t.toFixed(2)]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Pending"}),(0,bs.jsxs)("p",{className:"text-sm font-semibold ".concat(s>0?"text-blue-700":"text-gray-400"),children:["\xa3",s.toFixed(2)]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Paid"}),(0,bs.jsxs)("p",{className:"text-sm font-semibold text-green-700",children:["\xa3",a.toFixed(2)]})]})]})]},e.player_id)})}),(0,bs.jsx)("div",{className:"hidden md:block bg-white rounded-lg shadow-md overflow-hidden",children:(0,bs.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,bs.jsx)("thead",{className:"bg-gray-50",children:(0,bs.jsxs)("tr",{children:[(0,bs.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-12",children:(0,bs.jsx)("input",{type:"checkbox",checked:N.filter(e=>parseFloat(e.amount_owed)>0).length>0&&N.filter(e=>parseFloat(e.amount_owed)>0).every(e=>x.has(e.player_id)),onChange:e=>e.target.checked?w():j(),className:"w-4 h-4 cursor-pointer",title:"Select/Deselect all players who owe money"})}),(0,bs.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Player"}),(0,bs.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),(0,bs.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Owed"}),(0,bs.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"To Confirm"}),(0,bs.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paid"}),(0,bs.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,bs.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(e=>{const t=parseFloat(e.amount_owed||0),s=parseFloat(e.amount_pending_confirmation||0),a=parseFloat(e.amount_paid||0),r=t>0;return(0,bs.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,bs.jsx)("td",{className:"px-4 py-4 text-center",children:r?(0,bs.jsx)("input",{type:"checkbox",checked:x.has(e.player_id),onChange:t=>{t.stopPropagation(),v(e.player_id)},className:"w-4 h-4 cursor-pointer"}):(0,bs.jsx)("span",{className:"text-gray-300",children:"\u2014"})}),(0,bs.jsx)("td",{className:"px-6 py-4 whitespace-nowrap cursor-pointer",onClick:()=>u(e),children:(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.player_name}),(0,bs.jsx)("div",{className:"text-sm text-gray-500",children:e.player_email})]})}),(0,bs.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600 cursor-pointer",onClick:()=>u(e),children:(0,bs.jsxs)("div",{className:"space-y-0.5",children:[e.unpaid_sessions>0&&(0,bs.jsxs)("div",{className:"text-xs",children:[(0,bs.jsx)("span",{className:"font-medium",children:e.unpaid_sessions})," coaching",e.coaching_amount_owed>0&&(0,bs.jsxs)("span",{className:"text-gray-400 ml-1",children:["\xa3",parseFloat(e.coaching_amount_owed).toFixed(2)]})]}),(e.ladder_matches_unpaid||0)>0&&(0,bs.jsxs)("div",{className:"text-xs",children:[(0,bs.jsx)("span",{className:"font-medium",children:e.ladder_matches_unpaid})," ladder",e.ladder_amount_owed>0&&(0,bs.jsxs)("span",{className:"text-gray-400 ml-1",children:["\xa3",parseFloat(e.ladder_amount_owed).toFixed(2)]})]}),(e.league_matches_unpaid||0)>0&&(0,bs.jsxs)("div",{className:"text-xs",children:[(0,bs.jsx)("span",{className:"font-medium",children:e.league_matches_unpaid})," league",e.league_amount_owed>0&&(0,bs.jsxs)("span",{className:"text-gray-400 ml-1",children:["\xa3",parseFloat(e.league_amount_owed).toFixed(2)]})]}),(e.singles_matches_unpaid||0)>0&&(0,bs.jsxs)("div",{className:"text-xs",children:[(0,bs.jsx)("span",{className:"font-medium",children:e.singles_matches_unpaid})," singles",e.singles_amount_owed>0&&(0,bs.jsxs)("span",{className:"text-gray-400 ml-1",children:["\xa3",parseFloat(e.singles_amount_owed).toFixed(2)]})]}),0===e.unpaid_sessions&&0===(e.ladder_matches_unpaid||0)&&0===(e.league_matches_unpaid||0)&&0===(e.singles_matches_unpaid||0)&&(0,bs.jsx)("div",{className:"text-xs text-gray-400",children:"No unpaid items"})]})}),(0,bs.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right cursor-pointer",onClick:()=>u(e),children:(0,bs.jsxs)("span",{className:"text-sm font-semibold ".concat(t>0?"text-yellow-700":"text-gray-400"),children:["\xa3",t.toFixed(2)]})}),(0,bs.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right cursor-pointer",onClick:()=>u(e),children:(0,bs.jsxs)("span",{className:"text-sm font-semibold ".concat(s>0?"text-blue-700":"text-gray-400"),children:["\xa3",s.toFixed(2)]})}),(0,bs.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right cursor-pointer",onClick:()=>u(e),children:(0,bs.jsxs)("span",{className:"text-sm font-semibold text-green-700",children:["\xa3",a.toFixed(2)]})}),(0,bs.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:(0,bs.jsxs)("button",{onClick:t=>{t.stopPropagation(),u(e)},className:"inline-flex items-center gap-1 text-blue-600 hover:text-blue-800",children:["View Details",(0,bs.jsx)(Sa,{className:"w-4 h-4"})]})})]},e.player_id)})})]})})]}),d&&(0,bs.jsx)(rn,{isOpen:!!d,onClose:()=>u(null),player:d,actions:s,onSuccess:_})]})},ln=e=>{let{userId:t}=e;const{actions:s}=Mr(t,!0),{success:r,error:n}=As(),[i,l]=(0,a.useState)(null),[o,d]=(0,a.useState)([]),[u,h]=(0,a.useState)([]),[m,p]=(0,a.useState)(!0),[g,x]=(0,a.useState)(!1),[f,y]=(0,a.useState)(!1),[b,v]=(0,a.useState)(!1),[w,j]=(0,a.useState)({payment_date:(new Date).toISOString().split("T")[0],amount:"",payment_type:"regular",payment_method:"bank_transfer",reference:"",notes:""}),[_,N]=(0,a.useState)({session_type:"Adults",new_rate:"20.00",effective_from:(new Date).toISOString().split("T")[0],notes:""}),k=async()=>{p(!0);try{const[e,t,a]=await Promise.all([s.getCoachPaymentSummary(),s.getCoachSessionsToPay(),s.getCoachPaymentHistory()]);if(e.error)throw new Error(e.error);if(t.error)throw new Error(t.error);if(a.error)throw new Error(a.error);l(e.data),d(t.data),h(a.data)}catch(e){console.error("Error loading coach payment data:",e),n("Failed to load coach payment data")}finally{p(!1)}};(0,a.useEffect)(()=>{k()},[]);const S=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e||0),C=e=>new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return m?(0,bs.jsx)("div",{className:"loading-spinner",children:"Loading coach payment data..."}):(0,bs.jsxs)("div",{className:"coach-payment-tracking",children:[(0,bs.jsx)("h2",{children:"Coach Payment Tracking"}),(0,bs.jsx)("p",{className:"subtitle",children:"Track payments owed to coach for delivered sessions"}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 mb-8",children:[(0,bs.jsxs)("div",{className:"bg-green-50 p-5 rounded-lg border-2 border-green-500",children:[(0,bs.jsx)("h3",{className:"m-0 mb-2.5 text-green-800",children:"Total Paid"}),(0,bs.jsx)("div",{className:"text-3xl font-bold text-green-900",children:S(null===i||void 0===i?void 0:i.total_paid)}),(0,bs.jsx)("div",{className:"text-sm text-green-700 mt-1",children:"Credits available"})]}),(0,bs.jsxs)("div",{className:"bg-orange-50 p-5 rounded-lg border-2 border-orange-500",children:[(0,bs.jsx)("h3",{className:"m-0 mb-2.5 text-orange-800",children:"Total Owed"}),(0,bs.jsx)("div",{className:"text-3xl font-bold text-orange-900",children:S(null===i||void 0===i?void 0:i.total_owed)}),(0,bs.jsxs)("div",{className:"text-sm text-orange-600 mt-1",children:[(null===i||void 0===i?void 0:i.sessions_to_pay_count)||0," sessions to pay"]})]}),(0,bs.jsxs)("div",{className:"p-5 rounded-lg border-2 ".concat((null===i||void 0===i?void 0:i.balance)>=0?"bg-blue-50 border-blue-500":"bg-red-50 border-red-500"),children:[(0,bs.jsx)("h3",{className:"m-0 mb-2.5 ".concat((null===i||void 0===i?void 0:i.balance)>=0?"text-blue-900":"text-red-900"),children:"Balance"}),(0,bs.jsx)("div",{className:"text-3xl font-bold ".concat((null===i||void 0===i?void 0:i.balance)>=0?"text-blue-800":"text-red-800"),children:S(null===i||void 0===i?void 0:i.balance)}),(0,bs.jsx)("div",{className:"text-sm mt-1 ".concat((null===i||void 0===i?void 0:i.balance)>=0?"text-blue-700":"text-red-700"),children:(null===i||void 0===i?void 0:i.balance)>=0?"In credit":"Amount owed"})]})]}),i&&(0,bs.jsxs)("div",{className:"mb-8 p-4 bg-gray-100 rounded-lg",children:[(0,bs.jsx)("h3",{className:"mt-0",children:"Breakdown by Session Type"}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[i.adults_sessions_count>0&&(0,bs.jsxs)("div",{className:"p-2.5 bg-white rounded",children:[(0,bs.jsx)("strong",{children:"Adults:"})," ",S(i.adults_owed)," (",i.adults_sessions_count," sessions)"]}),i.beginners_sessions_count>0&&(0,bs.jsxs)("div",{className:"p-2.5 bg-white rounded",children:[(0,bs.jsx)("strong",{children:"Beginners:"})," ",S(i.beginners_owed)," (",i.beginners_sessions_count," sessions)"]}),i.juniors_sessions_count>0&&(0,bs.jsxs)("div",{className:"p-2.5 bg-white rounded",children:[(0,bs.jsx)("strong",{children:"Juniors:"})," ",S(i.juniors_owed)," (",i.juniors_sessions_count," sessions)"]})]})]}),(0,bs.jsxs)("div",{className:"mb-8 flex flex-wrap gap-2.5",children:[(0,bs.jsx)("button",{className:"btn btn-primary",onClick:()=>x(!g),children:g?"Cancel":"Record Payment"}),(0,bs.jsx)("button",{className:"btn btn-secondary",onClick:()=>y(!f),children:f?"Cancel":"Add Goodwill Payment"}),(0,bs.jsx)("button",{className:"btn btn-secondary",onClick:()=>v(!b),children:b?"Cancel":"Update Rates"})]}),g&&(0,bs.jsxs)("div",{className:"mb-8 p-5 bg-gray-50 rounded-lg",children:[(0,bs.jsx)("h3",{children:"Record Payment to Coach"}),(0,bs.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const{error:t}=await s.recordCoachPayment(w);t?n("Failed to record payment"):(r("Payment recorded successfully"),x(!1),j({payment_date:(new Date).toISOString().split("T")[0],amount:"",payment_type:"regular",payment_method:"bank_transfer",reference:"",notes:""}),k())},children:[(0,bs.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{children:"Payment Date *"}),(0,bs.jsx)("input",{type:"date",value:w.payment_date,onChange:e=>j(c(c({},w),{},{payment_date:e.target.value})),required:!0})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{children:"Amount (\xa3) *"}),(0,bs.jsx)("input",{type:"number",step:"0.01",min:"0.01",value:w.amount,onChange:e=>j(c(c({},w),{},{amount:e.target.value})),placeholder:"e.g. 200.00",required:!0})]})]}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{children:"Payment Method"}),(0,bs.jsxs)("select",{value:w.payment_method,onChange:e=>j(c(c({},w),{},{payment_method:e.target.value})),children:[(0,bs.jsx)("option",{value:"bank_transfer",children:"Bank Transfer"}),(0,bs.jsx)("option",{value:"cash",children:"Cash"}),(0,bs.jsx)("option",{value:"cheque",children:"Cheque"}),(0,bs.jsx)("option",{value:"other",children:"Other"})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{children:"Reference"}),(0,bs.jsx)("input",{type:"text",value:w.reference,onChange:e=>j(c(c({},w),{},{reference:e.target.value})),placeholder:"Transaction reference"})]})]}),(0,bs.jsxs)("div",{className:"mb-4",children:[(0,bs.jsx)("label",{children:"Notes"}),(0,bs.jsx)("textarea",{value:w.notes,onChange:e=>j(c(c({},w),{},{notes:e.target.value})),placeholder:"Optional notes about this payment",rows:"3"})]}),(0,bs.jsxs)("div",{className:"form-actions",children:[(0,bs.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Record Payment"}),(0,bs.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>x(!1),children:"Cancel"})]})]})]}),f&&(0,bs.jsxs)("div",{className:"mb-8 p-5 bg-blue-50 rounded-lg",children:[(0,bs.jsx)("h3",{children:"Add Goodwill Payment"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Record a one-off payment to the coach not tied to specific sessions"}),(0,bs.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const{error:t}=await s.recordCoachPayment(c(c({},w),{},{payment_type:"goodwill"}));t?n("Failed to record goodwill payment"):(r("Goodwill payment recorded successfully"),y(!1),j({payment_date:(new Date).toISOString().split("T")[0],amount:"",payment_type:"regular",payment_method:"bank_transfer",reference:"",notes:""}),k())},children:[(0,bs.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{children:"Payment Date *"}),(0,bs.jsx)("input",{type:"date",value:w.payment_date,onChange:e=>j(c(c({},w),{},{payment_date:e.target.value})),required:!0})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{children:"Amount (\xa3) *"}),(0,bs.jsx)("input",{type:"number",step:"0.01",min:"0.01",value:w.amount,onChange:e=>j(c(c({},w),{},{amount:e.target.value})),placeholder:"e.g. 50.00",required:!0})]})]}),(0,bs.jsxs)("div",{className:"mb-4",children:[(0,bs.jsx)("label",{children:"Reason / Notes *"}),(0,bs.jsx)("textarea",{value:w.notes,onChange:e=>j(c(c({},w),{},{notes:e.target.value})),placeholder:"Reason for goodwill payment",rows:"3",required:!0})]}),(0,bs.jsxs)("div",{className:"form-actions",children:[(0,bs.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Add Goodwill Payment"}),(0,bs.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>y(!1),children:"Cancel"})]})]})]}),b&&(0,bs.jsxs)("div",{className:"mb-8 p-5 bg-yellow-50 rounded-lg",children:[(0,bs.jsx)("h3",{children:"Update Coach Payment Rates"}),(0,bs.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Set new payment rates for coaching sessions by type"}),(0,bs.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const{error:t}=await s.updateCoachRate(_.session_type,parseFloat(_.new_rate),_.effective_from,_.notes);t?n("Failed to update rate"):(r("Rate updated successfully"),v(!1),N({session_type:"Adults",new_rate:"20.00",effective_from:(new Date).toISOString().split("T")[0],notes:""}),k())},children:[(0,bs.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{children:"Session Type *"}),(0,bs.jsxs)("select",{value:_.session_type,onChange:e=>N(c(c({},_),{},{session_type:e.target.value})),required:!0,children:[(0,bs.jsx)("option",{value:"Adults",children:"Adults"}),(0,bs.jsx)("option",{value:"Beginners",children:"Beginners"}),(0,bs.jsx)("option",{value:"Juniors",children:"Juniors"})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{children:"New Rate (\xa3) *"}),(0,bs.jsx)("input",{type:"number",step:"0.01",min:"0.01",value:_.new_rate,onChange:e=>N(c(c({},_),{},{new_rate:e.target.value})),placeholder:"e.g. 20.00",required:!0})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{children:"Effective From *"}),(0,bs.jsx)("input",{type:"date",value:_.effective_from,onChange:e=>N(c(c({},_),{},{effective_from:e.target.value})),required:!0})]})]}),(0,bs.jsxs)("div",{className:"mb-4",children:[(0,bs.jsx)("label",{children:"Notes"}),(0,bs.jsx)("input",{type:"text",value:_.notes,onChange:e=>N(c(c({},_),{},{notes:e.target.value})),placeholder:"Reason for rate change"})]}),(0,bs.jsxs)("div",{className:"form-actions",children:[(0,bs.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Update Rate"}),(0,bs.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>v(!1),children:"Cancel"})]})]})]}),(0,bs.jsxs)("div",{className:"mb-8",children:[(0,bs.jsxs)("h3",{children:["Sessions Awaiting Payment (",o.length,")"]}),0===o.length?(0,bs.jsx)("p",{className:"text-gray-600 italic",children:"No sessions awaiting payment"}):(0,bs.jsx)("div",{className:"overflow-x-auto",children:(0,bs.jsxs)("table",{className:"w-full border-collapse",children:[(0,bs.jsx)("thead",{className:"bg-gray-100",children:(0,bs.jsxs)("tr",{children:[(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Date"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Type"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Status"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Amount"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Notes"})]})}),(0,bs.jsx)("tbody",{className:"bg-white",children:o.map(e=>(0,bs.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,bs.jsx)("td",{className:"p-2.5 border-b border-gray-200",children:C(e.session_date)}),(0,bs.jsx)("td",{className:"p-2.5 border-b border-gray-200",children:e.session_type}),(0,bs.jsx)("td",{className:"p-2.5 border-b border-gray-200",children:(0,bs.jsx)("span",{className:"px-2 py-1 rounded text-xs font-semibold ".concat("scheduled"===e.status?"bg-blue-100 text-blue-800":"completed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.status})}),(0,bs.jsx)("td",{className:"p-2.5 border-b border-gray-200",children:S(e.amount_owed)}),(0,bs.jsx)("td",{className:"text-xs text-gray-600 p-2.5 border-b border-gray-200",children:e.cancellation_reason||e.notes||"-"})]},e.session_id))})]})})]}),(0,bs.jsxs)("div",{className:"mb-8",children:[(0,bs.jsxs)("h3",{children:["Payment History (",u.length,")"]}),0===u.length?(0,bs.jsx)("p",{className:"text-gray-600 italic",children:"No payments recorded yet"}):(0,bs.jsx)("div",{className:"overflow-x-auto",children:(0,bs.jsxs)("table",{className:"w-full border-collapse",children:[(0,bs.jsx)("thead",{className:"bg-gray-100",children:(0,bs.jsxs)("tr",{children:[(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Date"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Amount"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Type"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Method"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Reference"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Recorded By"}),(0,bs.jsx)("th",{className:"p-3 text-left border-b-2 border-gray-300 font-semibold",children:"Notes"})]})}),(0,bs.jsx)("tbody",{className:"bg-white",children:u.map(e=>(0,bs.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,bs.jsx)("td",{className:"p-2.5 border-b border-gray-200",children:C(e.payment_date)}),(0,bs.jsx)("td",{className:"font-bold p-2.5 border-b border-gray-200",children:S(e.amount)}),(0,bs.jsx)("td",{className:"p-2.5 border-b border-gray-200",children:(0,bs.jsx)("span",{className:"px-2 py-1 rounded text-xs font-semibold ".concat("regular"===e.payment_type?"bg-blue-100 text-blue-800":"advance"===e.payment_type?"bg-purple-100 text-purple-800":"goodwill"===e.payment_type?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"),children:e.payment_type})}),(0,bs.jsx)("td",{className:"p-2.5 border-b border-gray-200",children:e.payment_method}),(0,bs.jsx)("td",{className:"p-2.5 border-b border-gray-200",children:e.reference||"-"}),(0,bs.jsx)("td",{className:"p-2.5 border-b border-gray-200",children:e.recorded_by_name}),(0,bs.jsx)("td",{className:"text-xs text-gray-600 p-2.5 border-b border-gray-200",children:e.notes||"-"})]},e.payment_id))})]})})]})]})},on=e=>{let{currentUser:t,allUsers:s}=e;const[r,n]=(0,a.useState)("schedules"),i=Mr(null===t||void 0===t?void 0:t.id,!0),l=[{id:"schedules",name:"Schedules",icon:or,color:"blue"},{id:"sessions",name:"Sessions & Attendance",icon:Ls,color:"green"},{id:"payments",name:"Player Payments",icon:Fr,color:"orange"},{id:"coach-payments",name:"Coach Payments",icon:Rr,color:"purple"}];return(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,bs.jsx)(Ws,{className:"w-6 h-6 text-[#5D1F1F]"}),(0,bs.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Coaching Management"})]}),(0,bs.jsx)("p",{className:"text-gray-600",children:"Manage coaching schedules, sessions, attendance, and payments"})]}),(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,bs.jsx)("div",{className:"flex border-b border-gray-200 overflow-x-auto",children:l.map(e=>{const t=e.icon,s=r===e.id;return(0,bs.jsxs)("button",{onClick:()=>n(e.id),className:"\n                  flex items-center gap-2 px-4 sm:px-6 py-4 font-medium transition-colors whitespace-nowrap\n                  ".concat(s?"text-".concat(e.color,"-600 border-b-2 border-").concat(e.color,"-600 bg-").concat(e.color,"-50"):"text-gray-600 hover:text-gray-900 hover:bg-gray-50","\n                "),title:e.name,children:[(0,bs.jsx)(t,{className:"w-5 h-5 flex-shrink-0"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:e.name}),(0,bs.jsx)("span",{className:"sm:hidden text-xs",children:e.name.split(" ")[0]})]},e.id)})}),(0,bs.jsx)("div",{className:"p-6",children:(()=>{switch(r){case"schedules":return(0,bs.jsx)($r,{schedules:i.schedules,loading:i.loading.schedules,actions:i.actions,currentUser:t});case"sessions":return(0,bs.jsx)(an,{sessions:i.sessions,schedules:i.schedules,attendance:i.attendance,loading:i.loading.sessions||i.loading.attendance,actions:i.actions,allUsers:s,currentUser:t});case"payments":return(0,bs.jsx)(nn,{payments:i.payments,loading:i.loading.payments,actions:i.actions,allUsers:s,currentUser:t});case"coach-payments":return(0,bs.jsx)(ln,{userId:null===t||void 0===t?void 0:t.id});default:return null}})()})]})]})},cn=e=>{let{currentUser:t}=e;const s=Mr(null===t||void 0===t?void 0:t.id,!1),{success:r,error:n}=As(),[i,l]=(0,a.useState)("sessions"),[o,c]=(0,a.useState)("upcoming"),[d,u]=(0,a.useState)(null),[h,m]=(0,a.useState)([]),[p,g]=(0,a.useState)(!1),[x,f]=(0,a.useState)([]);(0,a.useEffect)(()=>{"payments"===i&&null!==t&&void 0!==t&&t.id&&y()},[i,t]);const y=async()=>{g(!0);const[e,a]=await Promise.all([s.actions.getPlayerPaymentSummary(t.id),s.actions.getPlayerSessionsByPaymentStatus(t.id)]);e.data&&u(e.data),a.data&&m(a.data),g(!1)},b=(new Date).toISOString().split("T")[0],v=s.attendance.filter(e=>e.player_id===t.id),w=new Map(v.map(e=>[e.session_id,e])),j=new Set(v.map(e=>e.session_id)),_=s.sessions.filter(e=>j.has(e.id)).filter(e=>"upcoming"===o?e.session_date>=b&&"scheduled"===e.status:"past"===o?e.session_date<b||"completed"===e.status:"cancelled"!==o||"cancelled"===e.status).sort((e,t)=>"upcoming"===o?new Date(e.session_date)-new Date(t.session_date):new Date(t.session_date)-new Date(e.session_date)),N=s.sessions.filter(e=>e.session_date>=b&&"scheduled"===e.status).sort((e,t)=>new Date(e.session_date)-new Date(t.session_date)),k=h.filter(e=>"unpaid"===e.payment_status),S=h.filter(e=>"pending_confirmation"===e.payment_status),C=h.filter(e=>"paid"===e.payment_status);return(0,bs.jsxs)("div",{className:"space-y-6",children:[(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,bs.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Coaching Sessions"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"View upcoming sessions and manage your attendance and payments"})]}),(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,bs.jsxs)("div",{className:"flex border-b border-gray-200",children:[(0,bs.jsxs)("button",{onClick:()=>l("sessions"),className:"\n              flex items-center gap-2 px-6 py-4 font-medium transition-colors\n              ".concat("sessions"===i?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50","\n            "),children:[(0,bs.jsx)(Ls,{className:"w-5 h-5"}),"Sessions"]}),(0,bs.jsxs)("button",{onClick:()=>l("payments"),className:"\n              flex items-center gap-2 px-6 py-4 font-medium transition-colors\n              ".concat("payments"===i?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50","\n            "),children:[(0,bs.jsx)(Fr,{className:"w-5 h-5"}),"Payments",d&&d.unpaid_sessions>0&&(0,bs.jsx)("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full",children:d.unpaid_sessions})]})]}),(0,bs.jsx)("div",{className:"p-6",children:"sessions"===i?(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("div",{className:"flex flex-wrap gap-2",children:["upcoming","past","cancelled","all"].map(e=>(0,bs.jsx)("button",{onClick:()=>c(e),className:"\n                      px-3 sm:px-4 py-2 rounded-md text-sm sm:text-base font-medium transition-colors\n                      ".concat(o===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200","\n                    "),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),s.loading.sessions?(0,bs.jsx)(Gr,{}):(0,bs.jsxs)(bs.Fragment,{children:["upcoming"===o&&0===N.length&&(0,bs.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,bs.jsx)(Ls,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"No upcoming sessions scheduled"})]}),"upcoming"===o&&N.length>0&&(0,bs.jsx)("div",{className:"space-y-3",children:N.map(e=>{const a=w.get(e.id),i=!!a,l=Jr(e.session_type);return(0,bs.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,bs.jsxs)("div",{className:"flex items-start justify-between",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[(0,bs.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(l.bg," ").concat(l.text),children:e.session_type}),i&&(0,bs.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700",children:"Registered"}),(0,bs.jsx)("span",{className:"hidden md:inline text-gray-900 font-medium",children:tn(e.session_date,!1)}),(0,bs.jsx)("span",{className:"md:hidden text-gray-900 font-medium",children:tn(e.session_date,!0)})]}),(0,bs.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,bs.jsx)(or,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:Vr(e.session_time)})]}),e.notes&&(0,bs.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:e.notes})]}),(0,bs.jsx)("div",{children:i?(0,bs.jsxs)("button",{onClick:()=>(async e=>{if(!window.confirm("Cancel your registration for this session?"))return;(await s.actions.removeAttendance(e)).error?n("Failed to cancel registration"):(r("Registration cancelled"),s.actions.fetchSessions({status:"scheduled"}),s.actions.fetchAttendance({playerId:t.id}))})(a.id),className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-red-50 text-red-600 rounded-md hover:bg-red-100 transition-colors whitespace-nowrap",children:[(0,bs.jsx)(ks,{className:"w-4 h-4 flex-shrink-0"}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Cancel Registration"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"Cancel"})]}):(0,bs.jsxs)("button",{onClick:()=>(async e=>{const a=await s.actions.markAttendance(e.id,t.id,!0);var i;a.error?null!==(i=a.error.message)&&void 0!==i&&i.includes("duplicate")?n("You are already registered for this session"):n("Failed to register for session"):(r("Successfully registered for session"),s.actions.fetchSessions({status:"scheduled"}),s.actions.fetchAttendance({playerId:t.id}))})(e),className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[(0,bs.jsx)(Ns,{className:"w-4 h-4"}),"Register"]})})]})},e.id)})}),"upcoming"!==o&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:["all"===o?"All":o.charAt(0).toUpperCase()+o.slice(1)," Sessions"]}),0===_.length?(0,bs.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,bs.jsx)(Ls,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,bs.jsxs)("p",{className:"text-gray-600",children:["No ","all"!==o&&o," sessions found"]})]}):(0,bs.jsx)("div",{className:"space-y-3",children:_.map(e=>{const t=w.get(e.id),s=Jr(e.session_type);return(0,bs.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,bs.jsx)("div",{className:"flex items-start justify-between",children:(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[(0,bs.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(s.bg," ").concat(s.text),children:e.session_type}),(a=e.status,(0,bs.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat({scheduled:"bg-blue-100 text-blue-700",completed:"bg-green-100 text-green-700",cancelled:"bg-red-100 text-red-700"}[a]||"bg-gray-100 text-gray-700"),children:a.charAt(0).toUpperCase()+a.slice(1)})),(0,bs.jsx)("span",{className:"text-gray-900 font-medium",children:sn(e.session_date)})]}),(0,bs.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,bs.jsx)(or,{className:"w-4 h-4"}),(0,bs.jsx)("span",{children:Vr(e.session_time)})]}),e.notes&&(0,bs.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:e.notes}),"cancelled"===e.status&&e.cancellation_reason&&(0,bs.jsxs)("p",{className:"text-sm text-red-600 mt-2",children:["Cancelled: ",e.cancellation_reason]}),(null===t||void 0===t?void 0:t.payment_status)&&(0,bs.jsxs)("div",{className:"mt-2",children:["unpaid"===t.payment_status&&(0,bs.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded",children:"Unpaid"}),"pending_confirmation"===t.payment_status&&(0,bs.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:"Payment Pending"}),"paid"===t.payment_status&&(0,bs.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded",children:"Paid"})]})]})})},e.id);var a})})]})]})]}):(0,bs.jsx)("div",{className:"space-y-6",children:p?(0,bs.jsx)(Gr,{}):d?(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,bs.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,bs.jsx)("p",{className:"text-sm text-yellow-700 font-medium mb-1",children:"Amount Owed"}),(0,bs.jsxs)("p",{className:"text-2xl font-bold text-yellow-900",children:["\xa3",parseFloat(d.amount_owed||0).toFixed(2)]}),(0,bs.jsxs)("p",{className:"text-xs text-yellow-600 mt-1",children:[d.unpaid_sessions," unpaid session",1!==d.unpaid_sessions?"s":""]})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("p",{className:"text-sm text-blue-700 font-medium mb-1",children:"Awaiting Confirmation"}),(0,bs.jsxs)("p",{className:"text-2xl font-bold text-blue-900",children:["\xa3",parseFloat(d.amount_pending_confirmation||0).toFixed(2)]}),(0,bs.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:[d.pending_confirmation_sessions," session",1!==d.pending_confirmation_sessions?"s":""]})]}),(0,bs.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,bs.jsx)("p",{className:"text-sm text-green-700 font-medium mb-1",children:"Total Paid"}),(0,bs.jsxs)("p",{className:"text-2xl font-bold text-green-900",children:["\xa3",parseFloat(d.amount_paid||0).toFixed(2)]}),(0,bs.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:[d.paid_sessions," confirmed session",1!==d.paid_sessions?"s":""]})]})]}),x.length>0&&(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center justify-between",children:[(0,bs.jsxs)("p",{className:"text-sm text-blue-700",children:[x.length," session",1!==x.length?"s":""," selected (\xa3",(4*x.length).toFixed(2),")"]}),(0,bs.jsxs)("button",{onClick:async()=>{if(0===x.length)return void n("Please select sessions to mark as paid");const e=window.prompt("Mark ".concat(x.length," session(s) as paid?\n\n")+"Total: \xa3".concat((4*x.length).toFixed(2),"\n\n")+"Enter payment reference or note (optional):\n"+'For example: "Bank transfer on '.concat((new Date).toLocaleDateString("en-GB"),'"'));if(null===e)return;(await s.actions.playerMarkSessionsPaid(x,e||"")).error?n("Failed to mark sessions as paid"):(r("Marked ".concat(x.length," session(s) as paid - awaiting admin confirmation")),f([]),await y())},className:"px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors whitespace-nowrap",children:[(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Mark as Paid"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"Mark Paid"})]})]}),k.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Unpaid Sessions (",k.length,")"]}),(0,bs.jsx)("button",{onClick:()=>{const e=h.filter(e=>"unpaid"===e.payment_status),t=e.every(e=>x.includes(e.attendance_id));f(t?t=>t.filter(t=>!e.find(e=>e.attendance_id===t)):t=>[...new Set([...t,...e.map(e=>e.attendance_id)])])},className:"text-sm text-blue-600 hover:text-blue-800",children:k.every(e=>x.includes(e.attendance_id))?"Deselect All":"Select All"})]}),(0,bs.jsx)("div",{className:"space-y-2",children:k.map(e=>(0,bs.jsxs)("div",{onClick:()=>{return t=e.attendance_id,void f(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"flex items-center gap-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md cursor-pointer hover:bg-yellow-100 transition-colors",children:[x.includes(e.attendance_id)?(0,bs.jsx)(Xr,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}):(0,bs.jsx)(Zr,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}),(0,bs.jsx)("div",{className:"flex-1",children:(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:sn(e.session_date)}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:["at ",e.session_time]}),(0,bs.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded",children:e.session_type})]})}),(0,bs.jsx)("span",{className:"text-sm font-semibold text-yellow-700",children:"\xa34.00"})]},e.attendance_id))})]}),S.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:["Awaiting Confirmation (",S.length,")"]}),(0,bs.jsx)("div",{className:"space-y-2",children:S.map(e=>(0,bs.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[(0,bs.jsx)(Ns,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:sn(e.session_date)}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600",children:["at ",e.session_time]}),(0,bs.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:e.session_type})]}),(0,bs.jsxs)("div",{className:"text-xs text-blue-700",children:["You marked as paid: ",sn(e.user_marked_paid_at)]}),e.user_payment_note&&(0,bs.jsxs)("div",{className:"text-xs text-blue-600 mt-1",children:["Note: ",e.user_payment_note]})]}),(0,bs.jsx)("span",{className:"text-sm font-semibold text-blue-700",children:"\xa34.00"})]},e.attendance_id))})]}),C.length>0&&(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:["Paid Sessions (",C.length,")"]}),(0,bs.jsxs)("div",{className:"space-y-2",children:[C.slice(0,5).map(e=>(0,bs.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-green-50 border border-green-200 rounded-md",children:[(0,bs.jsx)(Ns,{className:"w-5 h-5 text-green-600 flex-shrink-0"}),(0,bs.jsx)("div",{className:"flex-1",children:(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"text-sm text-gray-900",children:sn(e.session_date)}),(0,bs.jsxs)("span",{className:"text-xs text-gray-600",children:["at ",e.session_time]}),(0,bs.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded",children:e.session_type})]})}),(0,bs.jsx)("span",{className:"text-sm font-semibold text-green-700",children:"\xa34.00"})]},e.attendance_id)),C.length>5&&(0,bs.jsxs)("p",{className:"text-sm text-gray-500 text-center py-2",children:["+ ",C.length-5," more paid session",C.length-5!==1?"s":""]})]})]}),0===h.length&&(0,bs.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,bs.jsx)(Ls,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"You haven't attended any coaching sessions yet"})]})]}):(0,bs.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,bs.jsx)(Fr,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"No coaching sessions found"})]})})})]})]})},dn=e=>{let{isOpen:t,onClose:s,session:r,schedule:n,actions:i,currentUser:l}=e;const{success:o,error:d}=As(),[u,h]=(0,a.useState)(!0),[m,p]=(0,a.useState)(!1),[g,x]=(0,a.useState)([]),[f,y]=(0,a.useState)({}),[b,v]=(0,a.useState)({}),[w,j]=(0,a.useState)({});(0,a.useEffect)(()=>{t&&r&&_()},[t,r]);const _=async()=>{h(!0);try{let e=[];if(r.schedule_id){const{data:t,error:s}=await is.from("coaching_schedule_enrollments").select("\n            *,\n            player:profiles!coaching_schedule_enrollments_player_id_fkey(id, name, is_junior)\n          ").eq("schedule_id",r.schedule_id).eq("is_active",!0);if(s)throw s;e=(t||[]).map(e=>e.player)}const{data:t,error:s}=await is.from("coaching_attendance").select("player_id").eq("session_id",r.id);if(s)throw s;const a={};if((t||[]).forEach(e=>{a[e.player_id]=!0}),0===e.length&&(null===t||void 0===t?void 0:t.length)>0){const s=t.map(e=>e.player_id),{data:a,error:r}=await is.from("profiles").select("id, name, is_junior").in("id",s);r||(e=a||[])}const n={};if(e.length>0&&r.session_type){const{data:t,error:s}=await is.from("coaching_sessions").select("id, session_date").eq("session_type",r.session_type).neq("id",r.id).in("status",["scheduled","completed"]).order("session_date",{ascending:!1}).limit(4);if(!s&&(null===t||void 0===t?void 0:t.length)>0){const s=t.map(e=>e.id),a=s[0],{data:r,error:i}=await is.from("coaching_attendance").select("player_id, session_id").in("session_id",s);!i&&r&&e.forEach(e=>{const s=r.filter(t=>t.player_id===e.id);n[e.id]={count:s.length,attendedLast:s.some(e=>e.session_id===a),total:t.length}})}}x(e),y(a),v(a),j(n)}catch(e){console.error("Error loading register data:",e),d("Failed to load register data")}finally{h(!1)}},N=(0,a.useMemo)(()=>[...g].sort((e,t)=>{var s,a,r,n;const i=f[e.id]?1:0,l=f[t.id]?1:0;if(i!==l)return l-i;const o=null!==(s=w[e.id])&&void 0!==s&&s.attendedLast?1:0,c=null!==(a=w[t.id])&&void 0!==a&&a.attendedLast?1:0;if(o!==c)return c-o;const d=(null===(r=w[e.id])||void 0===r?void 0:r.count)||0,u=(null===(n=w[t.id])||void 0===n?void 0:n.count)||0;return d!==u?u-d:e.name.localeCompare(t.name)}),[g,f,w]),[k,S]=(0,a.useState)(null),[C,E]=(0,a.useState)(null),[P,T]=(0,a.useState)(null),[D,A]=(0,a.useState)(null),[O,F]=(0,a.useState)(0),R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;y(s=>c(c({},s),{},{[e]:null!==t?t:!s[e]})),S(e),setTimeout(()=>S(null),200)},M=()=>{E(null),T(null),A(null),F(0)};if(!t)return null;(null===n||void 0===n?void 0:n.schedule_name)||r.session_type;const I=new Date(r.session_date),L=Jr(r.session_type),U=Object.values(f).filter(Boolean).length,z=JSON.stringify(f)!==JSON.stringify(b);return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50",children:(0,bs.jsxs)("div",{className:"bg-white w-full sm:max-w-lg sm:mx-4 sm:rounded-lg shadow-xl h-full sm:h-auto sm:max-h-[90vh] flex flex-col",children:[(0,bs.jsx)("div",{className:"flex-shrink-0 px-4 py-3 border-b border-gray-200 bg-white",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,bs.jsx)("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold ".concat(L.bg," ").concat(L.text),children:r.session_type}),(null===n||void 0===n?void 0:n.schedule_name)&&(0,bs.jsx)("span",{className:"font-semibold text-gray-900 truncate",children:n.schedule_name}),(0,bs.jsx)("span",{className:"text-gray-400",children:"\u2022"}),(0,bs.jsxs)("span",{className:"text-sm text-gray-600 whitespace-nowrap",children:[(e=>{const t=new Date,s=new Date(t);return s.setDate(s.getDate()+1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===s.toDateString()?"Tomorrow":e.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})})(I)," ",Vr(r.session_time)]})]}),(0,bs.jsx)("button",{onClick:s,className:"ml-2 p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:(0,bs.jsx)(Es,{className:"w-5 h-5"})})]})}),u?(0,bs.jsx)("div",{className:"flex-1 flex items-center justify-center p-12",children:(0,bs.jsx)(Gr,{})}):(0,bs.jsx)("div",{className:"flex-1 overflow-y-auto overscroll-contain",children:0===N.length?(0,bs.jsxs)("div",{className:"text-center py-12 px-6",children:[(0,bs.jsx)(Ss,{className:"w-12 h-12 text-yellow-500 mx-auto mb-3"}),(0,bs.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"No Players Enrolled"}),(0,bs.jsxs)("p",{className:"text-sm text-gray-600",children:["No players are enrolled in this schedule.",(0,bs.jsx)("br",{}),"Ask an admin to enroll players first."]})]}):(0,bs.jsx)("div",{className:"divide-y divide-gray-100",children:N.map(e=>{const t=f[e.id]||!1,s=(e=>{const t=w[e];return t?0===t.count?{color:"bg-gray-300",label:"New"}:t.attendedLast&&t.count>=2?{color:"bg-green-500",label:"Regular"}:t.attendedLast?{color:"bg-blue-500",label:"Last week"}:t.count>=2?{color:"bg-yellow-500",label:"Sometimes"}:{color:"bg-gray-400",label:"Occasional"}:{color:"bg-gray-300",label:"New"}})(e.id),a=D===e.id,r=a?O:0;return(0,bs.jsxs)("div",{className:"relative overflow-hidden",children:[(0,bs.jsx)("div",{className:"absolute inset-y-0 left-0 w-20 bg-green-500 flex items-center justify-start pl-4",children:(0,bs.jsx)(na,{className:"w-6 h-6 text-white"})}),(0,bs.jsx)("div",{className:"absolute inset-y-0 right-0 w-20 bg-red-400 flex items-center justify-end pr-4",children:(0,bs.jsx)(Es,{className:"w-6 h-6 text-white"})}),(0,bs.jsxs)("button",{onClick:()=>!a&&R(e.id),onTouchStart:t=>((e,t)=>{T(null),E(e.targetTouches[0].clientX),A(t)})(t,e.id),onTouchMove:t=>((e,t)=>{if(!C||D!==t)return;const s=e.targetTouches[0].clientX,a=s-C;F(Math.max(-80,Math.min(80,a))),T(s)})(t,e.id),onTouchEnd:()=>(e=>{if(!C||!P)return void M();const t=P-C,s=t<-50;t>50?R(e,!0):s&&R(e,!1),M()})(e.id),style:{transform:"translateX(".concat(r,"px)")},className:"relative w-full flex items-center gap-4 px-4 py-4 sm:py-3 transition-colors ".concat(a?"":"transition-transform"," active:scale-[0.99] ").concat(k===e.id?"bg-green-100":t?"bg-green-50":"bg-white"),children:[(0,bs.jsx)("div",{className:"flex-shrink-0 w-7 h-7 rounded-full border-2 flex items-center justify-center transition-all ".concat(t?"border-green-500 bg-green-500 text-white scale-110":"border-gray-300 bg-white"),children:t&&(0,bs.jsx)(na,{className:"w-4 h-4",strokeWidth:3})}),(0,bs.jsx)("div",{className:"flex-1 text-left min-w-0",children:(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"font-medium truncate ".concat(t?"text-green-900":"text-gray-900"),children:e.name}),e.is_junior&&(0,bs.jsx)("span",{className:"flex-shrink-0 bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded text-xs font-medium",children:"Jr"})]})}),(0,bs.jsxs)("div",{className:"flex-shrink-0 flex items-center gap-1.5",title:s.label,children:[(0,bs.jsx)("span",{className:"w-2.5 h-2.5 rounded-full ".concat(s.color)}),(0,bs.jsx)("span",{className:"text-xs text-gray-400 hidden sm:inline",children:s.label})]})]})]},e.id)})})}),(0,bs.jsx)("div",{className:"flex-shrink-0 px-4 py-3 border-t border-gray-200 bg-white safe-area-inset-bottom",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full ".concat(U>0?"bg-green-100":"bg-gray-100"),children:(0,bs.jsx)("span",{className:"text-lg font-bold ".concat(U>0?"text-green-700":"text-gray-500"),children:U})}),(0,bs.jsxs)("span",{className:"text-sm text-gray-500",children:["/ ",N.length," present"]})]}),(0,bs.jsx)("button",{onClick:async()=>{p(!0);try{const e=[],t=[];g.forEach(s=>{const a=b[s.id]||!1,r=f[s.id]||!1;r&&!a?e.push(s.id):!r&&a&&t.push(s.id)});const a=0===(parseFloat(r.session_cost)||parseFloat(null===n||void 0===n?void 0:n.session_cost)||4)?"paid":"unpaid";if(e.length>0){const{error:t}=await is.from("coaching_attendance").insert(e.map(e=>({session_id:r.id,player_id:e,marked_by:l.id,self_registered:!1,payment_status:a})));if(t)throw t}if(t.length>0){const{error:e}=await is.from("coaching_attendance").delete().eq("session_id",r.id).in("player_id",t);if(e)throw e}const i=e.length+t.length;o(i>0?"Register saved - ".concat(Object.values(f).filter(Boolean).length," attended"):"No changes to save"),s()}catch(e){console.error("Error saving register:",e),d("Failed to save register")}finally{p(!1)}},disabled:m||0===N.length,className:"flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ".concat(z?"bg-green-600 text-white hover:bg-green-700 active:bg-green-800":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800"," disabled:opacity-50 disabled:cursor-not-allowed min-w-[120px]"),children:m?(0,bs.jsx)("span",{children:"Saving..."}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(pr,{className:"w-5 h-5"}),(0,bs.jsx)("span",{children:"Save"})]})})]})})]})})},un=e=>{let{currentUser:t}=e;const{sessions:s,schedules:r,loading:n,actions:i}=Mr(null===t||void 0===t?void 0:t.id,!1),[l,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!1),u=(0,a.useMemo)(()=>{const e=new Date;e.setHours(0,0,0,0);const t=new Date(e);t.setDate(t.getDate()+1);const a=new Date(e);a.setDate(a.getDate()+7);const r=[],n=[],i=[];s.forEach(t=>{const s=new Date(t.session_date);s.setHours(0,0,0,0),"cancelled"!==t.status&&(s.getTime()===e.getTime()?r.push(t):s>e&&s<=a?n.push(t):s<e&&i.push(t))});const l=(e,t)=>{const s=new Date(e.session_date)-new Date(t.session_date);return 0!==s?s:e.session_time.localeCompare(t.session_time)};r.sort(l),n.sort(l),i.sort((e,t)=>-l(e,t));const o=new Date(e);o.setDate(o.getDate()-7);const c=[],d=new Set;for(const s of i){const e=new Date(s.session_date);e.setHours(0,0,0,0);const t="".concat(s.session_type,"-").concat(s.session_time);e>=o?(c.push(s),d.add(t)):d.has(t)||(c.push(s),d.add(t))}return{todaySessions:r,upcomingSessions:n,recentSessions:c}},[s]),h=e=>{const t=new Date(e),s=new Date,a=new Date(s);return a.setDate(a.getDate()+1),t.toDateString()===s.toDateString()?"Today":t.toDateString()===a.toDateString()?"Tomorrow":t.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})};if(n.sessions||n.schedules)return(0,bs.jsx)("div",{className:"p-8",children:(0,bs.jsx)(Gr,{})});const m=e=>{var t,s;let{session:a,showDate:n=!1,isRecent:i=!1}=e;const l=Jr(a.session_type),c=r.find(e=>e.id===a.schedule_id),u=((null===c||void 0===c?void 0:c.schedule_name)||a.session_type,(null===(t=a.attendance)||void 0===t||null===(s=t[0])||void 0===s?void 0:s.count)||0);return(0,bs.jsx)("div",{className:"bg-white border rounded-lg p-4 hover:shadow-md transition-shadow ".concat(i?"border-gray-200 opacity-80":"border-gray-200"),children:(0,bs.jsxs)("div",{className:"flex items-start justify-between",children:[(0,bs.jsxs)("div",{className:"flex-1",children:[(0,bs.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[(0,bs.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(l.bg," ").concat(l.text),children:a.session_type}),(null===c||void 0===c?void 0:c.schedule_name)&&(0,bs.jsx)("span",{className:"text-gray-900 font-semibold",children:c.schedule_name})]}),(0,bs.jsxs)("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[n&&(0,bs.jsxs)("span",{className:"flex items-center gap-1",children:[(0,bs.jsx)(Ls,{className:"w-4 h-4"}),h(a.session_date)]}),(0,bs.jsxs)("span",{className:"flex items-center gap-1",children:[(0,bs.jsx)(or,{className:"w-4 h-4"}),Vr(a.session_time)]}),i&&u>0&&(0,bs.jsxs)("span",{className:"flex items-center gap-1 text-green-600",children:[(0,bs.jsx)(qs,{className:"w-4 h-4"}),u," attended"]})]})]}),(0,bs.jsx)("button",{onClick:()=>(e=>{o(e),d(!0)})(a),className:"flex items-center gap-2 px-4 py-2 rounded-md transition-colors ".concat(i?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-blue-600 text-white hover:bg-blue-700"),children:i?(0,bs.jsxs)(bs.Fragment,{children:["View",(0,bs.jsx)(Sa,{className:"w-4 h-4"})]}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(Ns,{className:"w-4 h-4"}),"Take Register"]})})]})})};return(0,bs.jsxs)("div",{className:"space-y-8",children:[(0,bs.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg p-6 text-white",children:[(0,bs.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Coach Dashboard"}),(0,bs.jsx)("p",{className:"text-blue-100",children:"Welcome back! Take attendance for your coaching sessions."})]}),(0,bs.jsxs)("section",{children:[(0,bs.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,bs.jsx)(Ls,{className:"w-5 h-5 text-blue-600"}),"Today",u.todaySessions.length>0&&(0,bs.jsx)("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-sm",children:u.todaySessions.length})]}),0===u.todaySessions.length?(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[(0,bs.jsx)(Ls,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"No sessions scheduled for today"})]}):(0,bs.jsx)("div",{className:"space-y-3",children:u.todaySessions.map(e=>(0,bs.jsx)(m,{session:e},e.id))})]}),(0,bs.jsxs)("section",{children:[(0,bs.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,bs.jsx)(or,{className:"w-5 h-5 text-green-600"}),"Upcoming This Week",u.upcomingSessions.length>0&&(0,bs.jsx)("span",{className:"bg-green-100 text-green-700 px-2 py-0.5 rounded text-sm",children:u.upcomingSessions.length})]}),0===u.upcomingSessions.length?(0,bs.jsx)("div",{className:"bg-gray-50 rounded-lg p-6 text-center",children:(0,bs.jsx)("p",{className:"text-gray-600",children:"No upcoming sessions this week"})}):(0,bs.jsx)("div",{className:"space-y-3",children:u.upcomingSessions.map(e=>(0,bs.jsx)(m,{session:e,showDate:!0},e.id))})]}),u.recentSessions.length>0&&(0,bs.jsxs)("section",{children:[(0,bs.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,bs.jsx)(Ns,{className:"w-5 h-5 text-gray-500"}),"Previous Sessions",(0,bs.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-sm font-normal",children:u.recentSessions.length})]}),(0,bs.jsx)("p",{className:"text-sm text-gray-500 mb-3",children:"Missed recording attendance? You can still update these sessions."}),(0,bs.jsx)("div",{className:"space-y-3",children:u.recentSessions.slice(0,8).map(e=>(0,bs.jsx)(m,{session:e,showDate:!0,isRecent:!0},e.id))})]}),c&&l&&(0,bs.jsx)(dn,{isOpen:c,onClose:()=>{d(!1),o(null),i.fetchSessions()},session:l,schedule:r.find(e=>e.id===l.schedule_id),actions:i,currentUser:t})]})},hn=fs("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),mn=fs("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),pn=e=>{let{currentUser:t}=e;const{actions:s}=Mr(null===t||void 0===t?void 0:t.id,!0),[r,n]=(0,a.useState)(null),[i,l]=(0,a.useState)([]),[o,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(!0),[h,m]=(0,a.useState)(null),p=async()=>{u(!0),m(null);try{const[e,t,a]=await Promise.all([s.getCoachPaymentSummary(),s.getCoachSessionsToPay(),s.getCoachPaymentHistory()]);if(e.error)throw new Error("Failed to load summary");if(t.error)throw new Error("Failed to load sessions");if(a.error)throw new Error("Failed to load payment history");n(e.data),l(t.data||[]),c(a.data||[])}catch(e){console.error("Error loading coach payment data:",e),m(e.message)}finally{u(!1)}};(0,a.useEffect)(()=>{p()},[]);const g=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e||0);if(d)return(0,bs.jsx)("div",{className:"p-8",children:(0,bs.jsx)(Gr,{})});if(h)return(0,bs.jsx)("div",{className:"p-4",children:(0,bs.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[(0,bs.jsx)(Ss,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),(0,bs.jsx)("p",{className:"text-red-700",children:h}),(0,bs.jsx)("button",{onClick:p,className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Retry"})]})});const x=(null===r||void 0===r?void 0:r.total_paid)||0,f=(null===r||void 0===r?void 0:r.sessions_to_pay_count)||0,y=(null===r||void 0===r?void 0:r.total_owed)||0,b=(null===r||void 0===r?void 0:r.balance)||0,v=Math.floor(b/20);return(0,bs.jsxs)("div",{className:"space-y-6 pb-20",children:[(0,bs.jsxs)("div",{className:"bg-gradient-to-r from-green-600 to-green-700 rounded-lg p-5 text-white",children:[(0,bs.jsx)("h1",{className:"text-xl font-bold mb-1",children:"My Payments"}),(0,bs.jsx)("p",{className:"text-green-100 text-sm",children:"Track your sessions and payment balance with the club"})]}),(0,bs.jsxs)("div",{className:"p-5 rounded-xl border-2 ".concat(b>=0?"bg-gradient-to-br from-green-50 to-emerald-50 border-green-400":"bg-gradient-to-br from-orange-50 to-red-50 border-orange-400"),children:[(0,bs.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"text-sm font-medium text-gray-600 mb-1",children:"Prepaid Credit"}),(0,bs.jsx)("div",{className:"text-3xl font-bold ".concat(b>=0?"text-green-700":"text-orange-700"),children:g(b)})]}),(0,bs.jsx)("div",{className:"p-3 rounded-full ".concat(b>=0?"bg-green-100":"bg-orange-100"),children:(0,bs.jsx)(hn,{className:"w-6 h-6 ".concat(b>=0?"text-green-600":"text-orange-600")})})]}),b>=0?(0,bs.jsxs)("div",{className:"bg-white/60 rounded-lg p-3",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 text-green-800",children:[(0,bs.jsx)(Ns,{className:"w-4 h-4"}),(0,bs.jsxs)("span",{className:"text-sm font-medium",children:[v," more session",1!==v?"s":""," covered"]})]}),(0,bs.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:["At \xa3",20,"/session, your credit covers approximately ",v," more sessions before you need to invoice."]})]}):(0,bs.jsxs)("div",{className:"bg-white/60 rounded-lg p-3",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 text-orange-800",children:[(0,bs.jsx)(Ss,{className:"w-4 h-4"}),(0,bs.jsx)("span",{className:"text-sm font-medium",children:"Time to invoice!"})]}),(0,bs.jsxs)("p",{className:"text-xs text-orange-600 mt-1",children:["The club owes you ",g(Math.abs(b)),". Please send an invoice."]})]})]}),(0,bs.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,bs.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,bs.jsx)(Ms,{className:"w-4 h-4 text-blue-500"}),(0,bs.jsx)("span",{className:"text-xs font-medium text-gray-500",children:"Total Received"})]}),(0,bs.jsx)("div",{className:"text-xl font-bold text-gray-900",children:g(x)}),(0,bs.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:"All payments from club"})]}),(0,bs.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,bs.jsx)(mn,{className:"w-4 h-4 text-purple-500"}),(0,bs.jsx)("span",{className:"text-xs font-medium text-gray-500",children:"Sessions Delivered"})]}),(0,bs.jsx)("div",{className:"text-xl font-bold text-gray-900",children:f}),(0,bs.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Worth ",g(y)]})]})]}),r&&(r.adults_sessions_count>0||r.beginners_sessions_count>0||r.juniors_sessions_count>0)&&(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,bs.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,bs.jsx)(da,{className:"w-4 h-4"}),"Sessions by Type"]}),(0,bs.jsxs)("div",{className:"space-y-2",children:[r.adults_sessions_count>0&&(0,bs.jsxs)("div",{className:"flex items-center justify-between bg-white rounded-lg p-3 border border-gray-100",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),(0,bs.jsx)("span",{className:"text-sm text-gray-700",children:"Adults"})]}),(0,bs.jsxs)("div",{className:"text-right",children:[(0,bs.jsx)("span",{className:"font-semibold text-gray-900",children:r.adults_sessions_count}),(0,bs.jsxs)("span",{className:"text-xs text-gray-400 ml-2",children:["(",g(r.adults_owed),")"]})]})]}),r.beginners_sessions_count>0&&(0,bs.jsxs)("div",{className:"flex items-center justify-between bg-white rounded-lg p-3 border border-gray-100",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500"}),(0,bs.jsx)("span",{className:"text-sm text-gray-700",children:"Beginners"})]}),(0,bs.jsxs)("div",{className:"text-right",children:[(0,bs.jsx)("span",{className:"font-semibold text-gray-900",children:r.beginners_sessions_count}),(0,bs.jsxs)("span",{className:"text-xs text-gray-400 ml-2",children:["(",g(r.beginners_owed),")"]})]})]}),r.juniors_sessions_count>0&&(0,bs.jsxs)("div",{className:"flex items-center justify-between bg-white rounded-lg p-3 border border-gray-100",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("span",{className:"w-2 h-2 rounded-full bg-purple-500"}),(0,bs.jsx)("span",{className:"text-sm text-gray-700",children:"Juniors"})]}),(0,bs.jsxs)("div",{className:"text-right",children:[(0,bs.jsx)("span",{className:"font-semibold text-gray-900",children:r.juniors_sessions_count}),(0,bs.jsxs)("span",{className:"text-xs text-gray-400 ml-2",children:["(",g(r.juniors_owed),")"]})]})]})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,bs.jsx)(Ls,{className:"w-4 h-4 text-gray-500"}),"Recent Sessions Delivered"]}),0===i.length?(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 text-center",children:[(0,bs.jsx)(Ls,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"No sessions delivered yet"})]}):(0,bs.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,bs.jsx)("div",{className:"divide-y divide-gray-100 max-h-48 overflow-y-auto",children:i.slice(0,20).map(e=>{return(0,bs.jsxs)("div",{className:"p-3 flex items-center justify-between",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900 text-sm",children:(t=e.session_date,new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short"}))}),(0,bs.jsx)("div",{className:"text-xs text-gray-500",children:e.session_type})]}),(0,bs.jsx)("div",{className:"font-medium text-gray-700",children:g(e.amount_owed)})]},e.session_id);var t})}),i.length>0&&(0,bs.jsxs)("div",{className:"p-2 bg-gray-50 border-t text-center text-xs text-gray-500",children:["Showing ",Math.min(20,i.length)," of ",i.length," sessions"]})]})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,bs.jsx)(Ms,{className:"w-4 h-4 text-green-500"}),"Payments Received from Club"]}),0===o.length?(0,bs.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 text-center",children:[(0,bs.jsx)(Ms,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),(0,bs.jsx)("p",{className:"text-gray-600",children:"No payments recorded yet"})]}):(0,bs.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,bs.jsx)("div",{className:"divide-y divide-gray-100 max-h-48 overflow-y-auto",children:o.map(e=>{return(0,bs.jsxs)("div",{className:"p-3 flex items-center justify-between",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900 text-sm",children:(t=e.payment_date,new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}))}),(0,bs.jsx)("div",{className:"text-xs text-gray-500",children:e.reference||e.payment_method})]}),(0,bs.jsxs)("div",{className:"font-semibold text-green-600",children:["+",g(e.amount)]})]},e.payment_id);var t})}),o.length>0&&(0,bs.jsxs)("div",{className:"p-2 bg-gray-50 border-t text-center text-xs text-gray-500",children:[o.length," payment",1!==o.length?"s":""," totalling ",g(x)]})]})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-100",children:[(0,bs.jsx)("h4",{className:"text-sm font-semibold text-blue-800 mb-2",children:"How it works"}),(0,bs.jsxs)("ul",{className:"text-xs text-blue-700 space-y-1",children:[(0,bs.jsx)("li",{children:"\u2022 The club pays you in advance for blocks of sessions"}),(0,bs.jsxs)("li",{children:["\u2022 Each session you deliver (\xa3",20,") is deducted from your credit"]}),(0,bs.jsx)("li",{children:"\u2022 When credit runs low, send your next invoice to the club"})]})]})]})},gn=e=>{let{showModal:t,setShowModal:s,newMatchDate:a,setNewMatchDate:r,addMatchToSeason:n}=e;if(!t)return null;const i=(()=>{const e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(a)})();return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:(0,bs.jsxs)("div",{className:"p-6",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Add New Match"}),(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Match Date"}),(0,bs.jsx)("input",{type:"date",value:a,onChange:e=>r(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#5D1F1F] focus:border-transparent",min:i}),(0,bs.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["You can schedule matches for today (",(new Date).toLocaleDateString("en-GB"),") or any future date"]})]}),(0,bs.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,bs.jsx)("button",{onClick:()=>n(a),disabled:!a,className:"flex-1 bg-[#5D1F1F] text-white py-2 px-4 rounded-md hover:bg-[#4A1818] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Add Match"}),(0,bs.jsx)("button",{onClick:()=>{s(!1),r("")},className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 transition-colors",children:"Cancel"})]})]})]})})})},xn=e=>{let{showModal:t,setShowModal:s,selectedMatch:r,setSelectedMatch:n,submitScore:i,currentUser:l,getMatchScore:o,onChallengeScore:c}=e;const d=As(),[u,h]=(0,a.useState)(""),[m,p]=(0,a.useState)(""),[g,x]=(0,a.useState)(!1),[f,y]=(0,a.useState)(null),[b,v]=(0,a.useState)(!1),[w,j]=(0,a.useState)(!1),[_,N]=(0,a.useState)("");(0,a.useEffect)(()=>{if(null!==r&&void 0!==r&&r.fixtureId){const e=o(r.fixtureId);y(e),setTimeout(()=>j(!0),100)}else j(!1),y(null)},[r,o]);const k=()=>{s(!1),n(null),h(""),p(""),N(""),v(!1),y(null),j(!1)};if(!t||!r)return null;const S="admin"===(null===l||void 0===l?void 0:l.role)||[r.pair1,r.pair2].flat().includes(null===l||void 0===l?void 0:l.name);return(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:(0,bs.jsxs)("div",{className:"p-6",children:[(0,bs.jsx)("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:f?(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(js,{className:"w-5 h-5 mr-2 text-blue-500"}),"View/Challenge Score"]}):"Enter Score"}),(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsx)("div",{children:(0,bs.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:[r.pair1.join(" & ")," vs ",r.pair2.join(" & ")]})}),f?(0,bs.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,bs.jsx)("h4",{className:"font-medium text-green-800 mb-2",children:"Current Score:"}),(0,bs.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{className:"text-center",children:[(0,bs.jsx)("p",{className:"text-sm font-medium",children:r.pair1.join(" & ")}),(0,bs.jsx)("p",{className:"text-2xl font-bold text-green-700",children:f.pair1_score})]}),(0,bs.jsxs)("div",{className:"text-center",children:[(0,bs.jsx)("p",{className:"text-sm font-medium",children:r.pair2.join(" & ")}),(0,bs.jsx)("p",{className:"text-2xl font-bold text-green-700",children:f.pair2_score})]})]}),(0,bs.jsxs)("p",{className:"text-xs text-gray-600 mt-2",children:["Submitted: ",f.created_at?new Date(f.created_at).toLocaleString():"Unknown"]})]}):null,(!f||b)&&S&&(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r.pair1.join(" & ")}),(0,bs.jsx)("input",{type:"number",min:"0",max:"20",value:u,onChange:e=>h(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"Games won",disabled:g})]}),(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r.pair2.join(" & ")}),(0,bs.jsx)("input",{type:"number",min:"0",max:"20",value:m,onChange:e=>p(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"Games won",disabled:g})]})]}),b&&(0,bs.jsxs)("div",{children:[(0,bs.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Challenge"}),(0,bs.jsx)("textarea",{value:_,onChange:e=>N(e.target.value),className:"w-full p-3 border border-gray-300 rounded-md",rows:"3",placeholder:"Explain why you believe the recorded score is incorrect...",disabled:g})]})]}),(0,bs.jsxs)("div",{className:"flex space-x-3 pt-4",children:[!f&&S?(0,bs.jsx)("button",{onClick:async()=>{if(!u||!m)return Ys.warning(),void d.warning("Please enter scores for both pairs");Ys.impact(),x(!0);try{const e=o(r.fixtureId);if(e&&!f)return d.warning("Someone already submitted a different score: ".concat(e.pair1_score,"-").concat(e.pair2_score,". Closing modal to show current score."),6e3),void setTimeout(()=>k(),2e3);const t=await i(u,m);null!==t&&void 0!==t&&t.conflict?(d.warning("Score conflict! Winning score: ".concat(t.winningScore.pair1_score,"-").concat(t.winningScore.pair2_score,". You can challenge this score if needed."),6e3),setTimeout(()=>k(),2e3)):null!==t&&void 0!==t&&t.success&&(Ys.success(),d.success("Score submitted successfully!"),k())}catch(e){Ys.error(),d.error("Error submitting score: ".concat(e.message))}finally{x(!1)}},disabled:g||!u||!m,className:"flex-1 bg-[#5D1F1F] text-white py-2 px-4 rounded-md hover:bg-[#4A1818] disabled:opacity-50",children:g?"Submitting...":"Submit Score"}):w&&f&&S&&!b?(0,bs.jsxs)("button",{onClick:()=>v(!0),className:"flex-1 bg-orange-600 text-white py-2 px-4 rounded-md hover:bg-orange-700 flex items-center justify-center",children:[(0,bs.jsx)(ir,{className:"w-4 h-4 mr-2"}),"Challenge Score"]}):w&&b?(0,bs.jsx)("button",{onClick:async()=>{if(_.trim()){x(!0);try{await c({fixtureId:r.fixtureId,originalResultId:f.id,challengedPair1Score:parseInt(u),challengedPair2Score:parseInt(m),reason:_}),Ys.success(),d.success("Challenge submitted! An admin will review your dispute."),k()}catch(e){Ys.error(),d.error("Error submitting challenge: ".concat(e.message))}finally{x(!1)}}else d.warning("Please provide a reason for challenging this score")},disabled:g||!u||!m||!_.trim(),className:"flex-1 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 disabled:opacity-50",children:g?"Submitting Challenge...":"Submit Challenge"}):null,(0,bs.jsx)("button",{onClick:k,disabled:g,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 disabled:opacity-50",children:b?"Cancel Challenge":"Close"})]}),!S&&(0,bs.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:(0,bs.jsxs)("div",{className:"flex items-center",children:[(0,bs.jsx)(lr,{className:"w-5 h-5 text-yellow-600 mr-2"}),(0,bs.jsx)("p",{className:"text-yellow-800 text-sm",children:"Only players in this match can enter scores or challenge results."})]})}),!1]})]})})})},fn=e=>{let{showModal:t,setShowModal:s}=e;return t?(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,bs.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[(0,bs.jsx)("h2",{className:"text-2xl font-bold text-[#5D1F1F]",children:"Tennis Ladder Players Guide"}),(0,bs.jsx)("button",{onClick:()=>s(!1),className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),(0,bs.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,bs.jsxs)("div",{className:"prose prose-sm max-w-none",children:[(0,bs.jsx)("div",{className:"mb-8",children:(0,bs.jsx)("p",{className:"text-gray-700 mb-4 text-lg",children:"Welcome to the Tennis Ladder! This guide covers everything you need to know about our ranking system, match scheduling, and how to compete for prizes."})}),(0,bs.jsxs)("div",{className:"mb-8",children:[(0,bs.jsx)("h3",{className:"text-xl font-semibold text-[#5D1F1F] mb-4",children:"How Rankings Work"}),(0,bs.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-3",children:"Your Position on the Ladder"}),(0,bs.jsxs)("p",{className:"text-gray-700 mb-4",children:["Your ladder position is based on your ",(0,bs.jsx)("strong",{children:"win percentage"})," - simply the number of games you've won divided by your total games played."]}),(0,bs.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-3",children:"ELO Rating"}),(0,bs.jsx)("p",{className:"text-gray-700 mb-2",children:"We also use an ELO rating system to:"}),(0,bs.jsxs)("ul",{className:"list-disc list-inside text-gray-700 mb-4 space-y-1",children:[(0,bs.jsx)("li",{children:"Schedule fair matches between players of similar skill levels"}),(0,bs.jsx)("li",{children:"Track your improvement over time"}),(0,bs.jsx)("li",{children:"Ensure competitive, enjoyable games"})]}),(0,bs.jsx)("p",{className:"text-gray-700 mb-4 italic",children:"How ELO works: Beat a higher-rated player and your rating jumps up significantly. Beat a lower-rated player and it rises slightly. The reverse happens when you lose."}),(0,bs.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-3",children:"Minimum Games Requirement"}),(0,bs.jsxs)("p",{className:"text-gray-700 mb-4",children:["You must play at least ",(0,bs.jsx)("strong",{children:"3 matches"})," during the season to be eligible for prizes."]})]}),(0,bs.jsxs)("div",{className:"mb-8",children:[(0,bs.jsx)("h3",{className:"text-xl font-semibold text-[#5D1F1F] mb-4",children:"Prizes"}),(0,bs.jsx)("p",{className:"text-gray-700 mb-2",children:"At the end of each season, we award:"}),(0,bs.jsxs)("ul",{className:"list-disc list-inside text-gray-700 mb-4 space-y-1",children:[(0,bs.jsxs)("li",{children:[(0,bs.jsx)("strong",{children:"Men's Champion"})," - highest win percentage"]}),(0,bs.jsxs)("li",{children:[(0,bs.jsx)("strong",{children:"Ladies Champion"})," - highest win percentage"]}),(0,bs.jsxs)("li",{children:[(0,bs.jsx)("strong",{children:"Most Improved Player"})," - biggest ELO rating increase during the season"]})]})]}),(0,bs.jsxs)("div",{className:"mb-8",children:[(0,bs.jsx)("h3",{className:"text-xl font-semibold text-[#5D1F1F] mb-4",children:"Match Schedule"}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[(0,bs.jsxs)("p",{className:"text-blue-800 font-semibold",children:[(0,bs.jsx)("strong",{children:"When:"})," Sunday mornings at 10:00 AM sharp"]}),(0,bs.jsxs)("p",{className:"text-blue-700 text-sm mt-1",children:[(0,bs.jsx)("strong",{children:"Important:"})," Arrive early to warm up - matches begin promptly at 10:00 AM!"]})]})]}),(0,bs.jsxs)("div",{className:"mb-8",children:[(0,bs.jsx)("h3",{className:"text-xl font-semibold text-[#5D1F1F] mb-4",children:"Match Format"}),(0,bs.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,bs.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,bs.jsx)("h4",{className:"font-semibold text-green-800 mb-2",children:"5 Players on Court"}),(0,bs.jsxs)("ul",{className:"list-disc list-inside text-green-700 space-y-1 text-sm",children:[(0,bs.jsx)("li",{children:(0,bs.jsx)("strong",{children:"8 games total"})}),(0,bs.jsx)("li",{children:"Rotating doubles with one player sitting out each game"}),(0,bs.jsx)("li",{children:"Each player sits out exactly once to ensure equal playing time"})]})]}),(0,bs.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,bs.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"4 Players on Court"}),(0,bs.jsxs)("ul",{className:"list-disc list-inside text-blue-700 space-y-1 text-sm",children:[(0,bs.jsx)("li",{children:(0,bs.jsx)("strong",{children:"10 games total"})}),(0,bs.jsx)("li",{children:"Straight doubles throughout the entire match"})]})]})]})]}),(0,bs.jsxs)("div",{className:"mb-8",children:[(0,bs.jsx)("h3",{className:"text-xl font-semibold text-[#5D1F1F] mb-4",children:"Season Details"}),(0,bs.jsxs)("ul",{className:"list-disc list-inside text-gray-700 space-y-1",children:[(0,bs.jsx)("li",{children:"Each season runs 10-12 weeks"}),(0,bs.jsx)("li",{children:"Rankings update weekly and are viewable online anytime"}),(0,bs.jsx)("li",{children:"New seasons begin shortly after the previous season ends"})]})]}),(0,bs.jsxs)("div",{className:"mb-8",children:[(0,bs.jsx)("h3",{className:"text-xl font-semibold text-[#5D1F1F] mb-4",children:"Tips for Success"}),(0,bs.jsxs)("ul",{className:"list-disc list-inside text-gray-700 space-y-1",children:[(0,bs.jsxs)("li",{children:[(0,bs.jsx)("strong",{children:"Play regularly"})," - More matches mean more opportunities to improve your win percentage"]}),(0,bs.jsxs)("li",{children:[(0,bs.jsx)("strong",{children:"Focus on individual games"})," - Each game counts toward your ranking, not just overall match wins"]}),(0,bs.jsxs)("li",{children:[(0,bs.jsx)("strong",{children:"Practice good sportsmanship"})," - Agree on scores before leaving the court"]})]})]}),(0,bs.jsxs)("div",{className:"mb-8",children:[(0,bs.jsx)("h3",{className:"text-xl font-semibold text-[#5D1F1F] mb-4",children:"Common Questions"}),(0,bs.jsxs)("div",{className:"space-y-4",children:[(0,bs.jsxs)("div",{className:"border-l-4 border-[#5D1F1F] pl-4",children:[(0,bs.jsx)("h4",{className:"font-semibold text-gray-800 mb-1",children:"What happens if we disagree on a game result?"}),(0,bs.jsx)("p",{className:"text-gray-700 text-sm",children:"All players should agree on the score before leaving the court. Contact the ladder administrator if you can't resolve a dispute."})]}),(0,bs.jsxs)("div",{className:"border-l-4 border-[#5D1F1F] pl-4",children:[(0,bs.jsx)("h4",{className:"font-semibold text-gray-800 mb-1",children:"When do rankings update?"}),(0,bs.jsx)("p",{className:"text-gray-700 text-sm",children:"Rankings are updated weekly and can be viewed online at any time."})]})]})]}),(0,bs.jsx)("div",{className:"text-center bg-[#5D1F1F] text-white rounded-lg p-6",children:(0,bs.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Good luck and have fun! \ud83c\udfbe"})})]})}),(0,bs.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,bs.jsx)("button",{onClick:()=>s(!1),className:"w-full bg-[#5D1F1F] text-white py-2 px-4 rounded-md hover:bg-[#4A1818] transition-colors",children:"Close Guide"})})]})}):null},yn=e=>{let{message:t="Loading...",onRetry:s}=e;const[r,n]=(0,a.useState)(!1),[i,l]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=setTimeout(()=>{n(!0)},15e3);return()=>clearTimeout(e)},[]);return(0,bs.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-[#5D1F1F] to-[#8B3A3A] flex items-center justify-center",children:(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-xl p-8 max-w-sm w-full mx-4",children:(0,bs.jsxs)("div",{className:"flex flex-col items-center",children:[(0,bs.jsxs)("div",{className:"relative w-24 h-28 mb-4 flex items-end justify-center",children:[(0,bs.jsx)("div",{className:"absolute bottom-0 w-16 h-4 bg-black bg-opacity-20 rounded-full",style:{animation:"shadow-bounce 1.2s infinite ease-in-out"}}),(0,bs.jsxs)("div",{className:"relative animate-bounce",style:{animation:"bounce 1.2s infinite ease-in-out",filter:"drop-shadow(0 10px 20px rgba(93, 31, 31, 0.3))"},children:[(0,bs.jsx)("img",{src:"/club-logo.png",alt:"Cawood Tennis Club",className:"w-20 h-20 object-contain",style:{animation:"subtle-rotate 3s infinite linear",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))",background:"transparent"},onLoad:e=>{const t=document.createElement("canvas"),s=t.getContext("2d");t.width=e.target.naturalWidth,t.height=e.target.naturalHeight,s.drawImage(e.target,0,0);const a=s.getImageData(0,0,t.width,t.height),r=a.data;for(let n=0;n<r.length;n+=4){const e=r[n],t=r[n+1],s=r[n+2];e>240&&t>240&&s>240&&(r[n+3]=0)}s.putImageData(a,0,0),e.target.src=t.toDataURL()},onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),(0,bs.jsx)("div",{className:"logo-fallback w-20 h-20 bg-gradient-to-br from-[#9ACD32] to-[#7CB342] rounded-full flex items-center justify-center",style:{display:"none"},children:(0,bs.jsx)("span",{className:"text-white font-bold text-3xl drop-shadow-lg",children:"C"})}),(0,bs.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-white/20 to-transparent blur-sm opacity-50"})]})]}),(0,bs.jsx)("style",{jsx:!0,children:"\n            @keyframes subtle-rotate {\n              0% { transform: rotate(0deg) scale(1); }\n              25% { transform: rotate(2deg) scale(1.05); }\n              50% { transform: rotate(0deg) scale(1); }\n              75% { transform: rotate(-2deg) scale(1.05); }\n              100% { transform: rotate(0deg) scale(1); }\n            }\n            @keyframes shadow-bounce {\n              0%, 100% { \n                transform: scaleX(0.5) scaleY(0.8); \n                opacity: 0.3; \n              }\n              50% { \n                transform: scaleX(1) scaleY(1); \n                opacity: 0.2; \n              }\n            }\n          "}),(0,bs.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Cawood Tennis Club"}),(0,bs.jsx)("p",{className:"text-gray-600 text-center",children:t}),(0,bs.jsxs)("div",{className:"flex space-x-1 mt-4",children:[(0,bs.jsx)("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,bs.jsx)("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,bs.jsx)("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),r&&!i&&(0,bs.jsxs)("div",{className:"mt-6 text-center",children:[(0,bs.jsx)("p",{className:"text-sm text-gray-500 mb-3",children:"Taking longer than expected?"}),(0,bs.jsx)("button",{onClick:async()=>{l(!0),n(!1);try{s?await s():window.location.reload()}catch(e){l(!1),n(!0)}},className:"bg-[#5D1F1F] text-white px-4 py-2 rounded text-sm hover:bg-[#4A1818] transition-colors",children:"Retry Connection"})]}),i&&(0,bs.jsx)("div",{className:"mt-6 text-center",children:(0,bs.jsx)("p",{className:"text-sm text-gray-600",children:"Retrying connection..."})})]})})})},bn=fs("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);class vn extends a.Component{constructor(e){super(e),this.handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.handleFullRefresh=async()=>{await nr.gracefulReload("errorRecovery")},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("\ud83d\udd25 Error boundary caught:",e,t),this.setState(e=>({errorInfo:t,errorCount:e.errorCount+1})),window.Sentry&&window.Sentry.captureException(e,{contexts:{react:t}})}render(){if(this.state.hasError){var e,t;const s=!1;return(0,bs.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,bs.jsxs)("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg overflow-hidden",children:[(0,bs.jsx)("div",{className:"bg-red-500 px-6 py-4",children:(0,bs.jsxs)("div",{className:"flex items-center",children:[(0,bs.jsx)(lr,{className:"w-6 h-6 text-white mr-2"}),(0,bs.jsx)("h2",{className:"text-xl font-bold text-white",children:"Oops! Something went wrong"})]})}),(0,bs.jsxs)("div",{className:"p-6",children:[(0,bs.jsxs)("p",{className:"text-gray-600 mb-4",children:["We've encountered an unexpected error. Don't worry, your data is safe.",this.state.errorCount>2&&(0,bs.jsx)("span",{className:"block mt-2 text-sm text-orange-600",children:"Multiple errors detected. A full page refresh might help."})]}),s&&(0,bs.jsxs)("details",{className:"mb-4 bg-gray-100 p-3 rounded",children:[(0,bs.jsx)("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Error Details (Development Mode)"}),(0,bs.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,bs.jsxs)("div",{className:"text-xs bg-white p-2 rounded border border-gray-200",children:[(0,bs.jsx)("strong",{children:"Error:"}),(0,bs.jsx)("pre",{className:"mt-1 whitespace-pre-wrap text-red-600",children:null===(e=this.state.error)||void 0===e?void 0:e.toString()})]}),(null===(t=this.state.error)||void 0===t?void 0:t.stack)&&(0,bs.jsxs)("div",{className:"text-xs bg-white p-2 rounded border border-gray-200",children:[(0,bs.jsx)("strong",{children:"Stack Trace:"}),(0,bs.jsx)("pre",{className:"mt-1 whitespace-pre-wrap text-gray-600 max-h-40 overflow-auto",children:this.state.error.stack})]}),this.state.errorInfo&&(0,bs.jsxs)("div",{className:"text-xs bg-white p-2 rounded border border-gray-200",children:[(0,bs.jsx)("strong",{children:"Component Stack:"}),(0,bs.jsx)("pre",{className:"mt-1 whitespace-pre-wrap text-gray-600 max-h-40 overflow-auto",children:this.state.errorInfo.componentStack})]})]})]}),(0,bs.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,bs.jsxs)("button",{onClick:this.handleReset,className:"flex-1 flex items-center justify-center bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:[(0,bs.jsx)(Ir,{className:"w-4 h-4 mr-2"}),"Try Again"]}),(0,bs.jsxs)("button",{onClick:this.handleFullRefresh,className:"flex-1 flex items-center justify-center bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors",children:[(0,bs.jsx)(Ir,{className:"w-4 h-4 mr-2"}),"Refresh Page"]}),(0,bs.jsxs)("button",{onClick:this.handleGoHome,className:"flex-1 flex items-center justify-center bg-[#5D1F1F] text-white px-4 py-2 rounded hover:bg-[#4A1818] transition-colors",children:[(0,bs.jsx)(bn,{className:"w-4 h-4 mr-2"}),"Go Home"]})]})]}),(0,bs.jsx)("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:(0,bs.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"If this problem persists, please contact support"})})]})})}return this.props.children}}const wn=vn,jn=fs("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),_n=()=>{const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(!1),[n,i]=(0,a.useState)(null);(0,a.useEffect)(()=>{const e=nr.addListener((e,s)=>{"updateAvailable"===e&&(i(s),t(!0),Ys.tap())}),s=nr.getVersionInfo();return s.updateAvailable&&(i(s),t(!0)),e},[]);const l=()=>{t(!1),Ys.tap()};return e?(0,bs.jsx)(bs.Fragment,{children:(0,bs.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center p-4",children:(0,bs.jsx)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md transform transition-all",children:(0,bs.jsxs)("div",{className:"p-6",children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,bs.jsxs)("div",{className:"flex items-center",children:[(0,bs.jsx)("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,bs.jsx)(jn,{className:"w-5 h-5 text-blue-600"})}),(0,bs.jsxs)("div",{className:"ml-3",children:[(0,bs.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Update Available"}),(0,bs.jsxs)("p",{className:"text-sm text-gray-500",children:["Version ",(null===n||void 0===n?void 0:n.version)||"1.0.1"]})]})]}),(0,bs.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:s,children:(0,bs.jsx)(Es,{className:"w-5 h-5"})})]}),(0,bs.jsx)("div",{className:"mb-6",children:(0,bs.jsx)("p",{className:"text-gray-600",children:"A new version of the Cawood Tennis app is available. Update now to get the latest features and improvements."})}),(0,bs.jsxs)("div",{className:"flex space-x-3",children:[(0,bs.jsx)("button",{onClick:async()=>{r(!0),Ys.impact();try{await nr.applyUpdate()||await nr.clearCacheAndReload()}catch(e){console.error("[UpdateNotification] Update failed:",e),await nr.gracefulReload("updateError")}},disabled:s,className:"flex-1 flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-md transition-colors ".concat(s?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),style:{touchAction:"manipulation"},children:s?(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(Ir,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating..."]}):(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)(jn,{className:"w-4 h-4 mr-2"}),"Update Now"]})}),!s&&(0,bs.jsx)("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",style:{touchAction:"manipulation"},children:"Later"})]}),(0,bs.jsx)("div",{className:"mt-3 text-xs text-gray-500 text-center",children:"Updates are automatic - no app store required"})]})})})}):null},Nn=e=>{let{className:t="",position:s="bottom-right"}=e;const[r,n]=(0,a.useState)({version:rr,updateAvailable:!1,buildTime:null}),[i,l]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{const e=await fetch("/build-info.json");if(e.ok){const t=await e.json();n(e=>c(c({},e),{},{buildTime:t.buildTime,buildDate:t.buildDate}))}}catch(e){}})();const e=nr.addListener((e,t)=>{"updateAvailable"===e&&n(e=>c(c({},e),{},{updateAvailable:!0}))}),t=nr.getVersionInfo();return n(e=>c(c({},e),t)),e},[]);return(0,bs.jsx)("div",{className:"".concat({"bottom-right":"fixed bottom-4 right-4 z-40 sm:bottom-4 bottom-20","bottom-left":"fixed bottom-4 left-4 z-40 sm:bottom-4 bottom-20","top-right":"fixed top-4 right-4 z-40","top-left":"fixed top-4 left-4 z-40",footer:"inline-flex"}[s]," ").concat(t),children:(0,bs.jsxs)("div",{className:"bg-white bg-opacity-90 backdrop-blur-sm border border-gray-200 rounded-lg shadow-lg transition-all duration-200 cursor-pointer hover:bg-opacity-100 ".concat(i?"p-3":"px-3 py-1"),onClick:()=>{l(!i)},children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-600",children:[(0,bs.jsxs)("span",{className:"inline-flex items-center ".concat(r.updateAvailable?"text-orange-600":"text-gray-600"),children:[(0,bs.jsxs)("span",{className:"font-mono font-medium",children:["v",r.version]}),r.updateAvailable&&(0,bs.jsx)("span",{className:"ml-1 w-2 h-2 bg-orange-500 rounded-full animate-pulse"})]}),i&&(0,bs.jsx)("div",{className:"border-l border-gray-300 pl-2 ml-2",children:(0,bs.jsxs)("div",{className:"flex flex-col space-y-1",children:[r.buildTime&&(0,bs.jsxs)("div",{className:"text-xs text-gray-500",children:["Build: ",r.buildTime]}),(0,bs.jsxs)("div",{className:"text-xs text-gray-500",children:["Cache: ",r.swRegistered?"\u2705":"\u274c"]}),r.updateAvailable&&(0,bs.jsx)("div",{className:"text-xs text-orange-600 font-medium",children:"\ud83d\udd04 Update available"}),(0,bs.jsx)("button",{onClick:()=>nr.clearCacheAndReload(),className:"text-xs bg-red-100 text-red-600 px-2 py-1 rounded text-left hover:bg-red-200",children:"\ud83d\uddd1\ufe0f Force Refresh"})]})})]}),!i&&(0,bs.jsx)("div",{className:"text-xs text-gray-400 mt-0.5",children:"Click for details"})]})})},kn=e=>{let{seasons:t,selectedSeason:s,onSeasonSelect:r,loading:n}=e;const[i,l]=(0,a.useState)(!1),o=e=>{switch(e){case"active":return"\ud83c\udfbe";case"completed":return"\ud83c\udfc6";case"archived":return"\ud83d\udcc1";default:return"\ud83d\udcc5"}},c=e=>{switch(e){case"active":return"text-green-600 bg-green-50";case"completed":return"text-blue-600 bg-blue-50";default:return"text-gray-600 bg-gray-50"}};return n||!s?(0,bs.jsx)("div",{className:"bg-gray-100 rounded-lg px-4 py-2 animate-pulse",children:(0,bs.jsx)("div",{className:"h-6 bg-gray-200 rounded w-32"})}):(0,bs.jsxs)("div",{className:"relative",children:[(0,bs.jsxs)("button",{onClick:()=>l(!i),className:"flex items-center space-x-3 bg-white border border-gray-200 rounded-lg px-4 py-3 hover:border-gray-300 transition-colors shadow-sm",children:[(0,bs.jsx)("img",{src:"/club-logo.png",alt:"Cawood Tennis Club",className:"w-8 h-8 object-contain flex-shrink-0",onError:e=>{e.target.src="/c-ball.png",e.target.className="w-6 h-6 object-contain flex-shrink-0"}}),(0,bs.jsxs)("div",{className:"text-left flex-1 min-w-0",children:[(0,bs.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bs.jsx)("div",{className:"font-medium text-gray-900 truncate",children:s.name}),(0,bs.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium ".concat(ta(s).badgeColor),children:ta(s).badge})]}),(0,bs.jsx)("div",{className:"text-xs text-gray-500 truncate",children:ta(s).subtitle})]}),(0,bs.jsx)(aa,{className:"w-4 h-4 text-gray-400 transition-transform flex-shrink-0 ".concat(i?"rotate-180":"")})]}),i&&(0,bs.jsxs)(bs.Fragment,{children:[(0,bs.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>l(!1)}),(0,bs.jsxs)("div",{className:"absolute top-full left-0 mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg z-20",children:[(0,bs.jsx)("div",{className:"p-2 border-b border-gray-100",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between px-2 py-1",children:[(0,bs.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Select Season"}),(0,bs.jsxs)("div",{className:"text-xs text-gray-500",children:[(null===t||void 0===t?void 0:t.filter(e=>"active"===e.status).length)||0," active"]})]})}),(0,bs.jsx)("div",{className:"max-h-64 overflow-y-auto",children:null===t||void 0===t?void 0:t.sort((e,t)=>"active"===e.status&&"active"!==t.status?-1:"active"===t.status&&"active"!==e.status?1:new Date(t.start_date)-new Date(e.start_date)).map(e=>{const t=ta(e);return(0,bs.jsxs)("button",{onClick:()=>{r(e),l(!1)},className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-l-4 ".concat(e.id===s.id?"border-[#5D1F1F] bg-[#5D1F1F]/5":"border-transparent"),children:[(0,bs.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("span",{children:o(e.status)}),(0,bs.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),(0,bs.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium ".concat(t.badgeColor),children:t.badge})]}),(0,bs.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(c(e.status)),children:e.status})]}),(0,bs.jsxs)("div",{className:"text-xs text-gray-600",children:[(0,bs.jsx)("div",{className:"mb-1",children:t.subtitle}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,bs.jsx)("span",{children:new Date(e.start_date).toLocaleDateString()}),(0,bs.jsx)("span",{children:"\u2022"}),(0,bs.jsxs)("span",{children:[e.player_count," players"]})]})]})]},e.id)})}),0===(null===t||void 0===t?void 0:t.length)&&(0,bs.jsx)("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No seasons available"})]})]})]})},Sn=fs("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),Cn=()=>{const e=new URLSearchParams(window.location.search).get("token"),[t,s]=(0,a.useState)("loading"),[r,n]=(0,a.useState)(""),[i,l]=(0,a.useState)(null);(0,a.useEffect)(()=>{e?o():(s("error"),n("Invalid confirmation link - no token provided"))},[e]);const o=async()=>{try{s("loading");const{data:t,error:a}=await is.rpc("validate_payment_token",{p_token:e});if(a)throw a;const r=null===t||void 0===t?void 0:t[0];if(!r||!r.valid)return s("error"),void n((null===r||void 0===r?void 0:r.error_message)||"Invalid or expired token");s("success"),l({amount:r.amount_due,playerId:r.player_id}),n("Thank you! Your payment confirmation has been received.")}catch(t){console.error("Error validating token:",t),s("error"),n("An error occurred while confirming your payment. Please try again or contact the club.")}};return(0,bs.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:[(0,bs.jsxs)("div",{style:{maxWidth:"600px",width:"100%",background:"white",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",padding:"40px",textAlign:"center"},children:[(0,bs.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,bs.jsx)("h1",{style:{fontSize:"28px",fontWeight:"bold",color:"#1a202c",margin:"0 0 8px 0"},children:"Cawood Tennis Club"}),(0,bs.jsx)("p",{style:{fontSize:"16px",color:"#718096",margin:0},children:"Payment Confirmation"})]}),"loading"===t&&(0,bs.jsxs)("div",{style:{padding:"40px 20px"},children:[(0,bs.jsx)(Sn,{className:"w-16 h-16 mx-auto mb-4 animate-spin",style:{color:"#667eea",animation:"spin 1s linear infinite"}}),(0,bs.jsx)("p",{style:{fontSize:"18px",color:"#4a5568"},children:"Confirming your payment..."})]}),"success"===t&&(0,bs.jsxs)("div",{style:{padding:"20px"},children:[(0,bs.jsx)("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#48bb78",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:(0,bs.jsx)(Ns,{className:"w-12 h-12 text-white"})}),(0,bs.jsx)("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"#2d3748",marginBottom:"16px"},children:"Payment Confirmed!"}),(0,bs.jsx)("p",{style:{fontSize:"16px",color:"#4a5568",marginBottom:"24px",lineHeight:"1.6"},children:r}),i&&(0,bs.jsxs)("div",{style:{background:"#f7fafc",borderRadius:"8px",padding:"20px",marginBottom:"24px"},children:[(0,bs.jsx)("p",{style:{fontSize:"14px",color:"#718096",marginBottom:"8px"},children:"Amount Confirmed"}),(0,bs.jsx)("p",{style:{fontSize:"32px",fontWeight:"bold",color:"#48bb78",margin:0},children:(c=i.amount,new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(c||0))})]}),(0,bs.jsx)("div",{style:{background:"#ebf8ff",border:"2px solid #4299e1",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:(0,bs.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[(0,bs.jsx)(Ss,{className:"w-5 h-5 text-blue-600 flex-shrink-0",style:{marginTop:"2px"}}),(0,bs.jsxs)("div",{style:{textAlign:"left"},children:[(0,bs.jsx)("p",{style:{fontSize:"14px",color:"#2c5282",margin:"0 0 8px 0",fontWeight:"600"},children:"What happens next?"}),(0,bs.jsx)("p",{style:{fontSize:"14px",color:"#2d3748",margin:0,lineHeight:"1.5"},children:"An admin will review and confirm your payment within 48 hours. You'll receive an email once your payment has been verified."})]})]})}),(0,bs.jsx)("button",{onClick:()=>window.location.href="/",style:{background:"#667eea",color:"white",padding:"12px 32px",borderRadius:"8px",border:"none",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s",width:"100%"},onMouseOver:e=>e.target.style.background="#5a67d8",onMouseOut:e=>e.target.style.background="#667eea",children:"Go to Coaching Portal"})]}),"error"===t&&(0,bs.jsxs)("div",{style:{padding:"20px"},children:[(0,bs.jsx)("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#fc8181",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:(0,bs.jsx)(ks,{className:"w-12 h-12 text-white"})}),(0,bs.jsx)("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"#2d3748",marginBottom:"16px"},children:"Unable to Confirm Payment"}),(0,bs.jsx)("p",{style:{fontSize:"16px",color:"#4a5568",marginBottom:"24px",lineHeight:"1.6"},children:r}),(0,bs.jsx)("div",{style:{background:"#fff5f5",border:"2px solid #fc8181",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:(0,bs.jsxs)("p",{style:{fontSize:"14px",color:"#742a2a",margin:0,lineHeight:"1.5"},children:[(0,bs.jsx)("strong",{children:"Common reasons:"}),(0,bs.jsx)("br",{}),"\u2022 This link has already been used",(0,bs.jsx)("br",{}),"\u2022 The link has expired (valid for 30 days)",(0,bs.jsx)("br",{}),"\u2022 The payment was already confirmed by an admin"]})}),(0,bs.jsxs)("div",{style:{display:"flex",gap:"12px",flexDirection:"column"},children:[(0,bs.jsx)("button",{onClick:()=>window.location.href="/",style:{background:"#667eea",color:"white",padding:"12px 32px",borderRadius:"8px",border:"none",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s"},onMouseOver:e=>e.target.style.background="#5a67d8",onMouseOut:e=>e.target.style.background="#667eea",children:"Log in to Check Status"}),(0,bs.jsxs)("p",{style:{fontSize:"14px",color:"#718096",margin:"12px 0 0 0"},children:["Need help? Email"," ",(0,bs.jsx)("a",{href:"mailto:cawoodtennis@gmail.com",style:{color:"#667eea",textDecoration:"none"},children:"cawoodtennis@gmail.com"})]})]})]})]}),(0,bs.jsx)("style",{children:"\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n        .animate-spin {\n          animation: spin 1s linear infinite;\n        }\n      "})]});var c},En=()=>{const e=(()=>{const[e,t]=(0,a.useState)(null),[s,r]=(0,a.useState)(!0),[n,i]=(0,a.useState)("normal"),[l,o]=(0,a.useState)(null),c=(0,a.useCallback)(()=>{const e=new URLSearchParams(window.location.hash.substring(1));return"recovery"===e.get("type")&&e.get("access_token")},[]),d=(0,a.useCallback)(async e=>{const s=new Promise((e,t)=>{setTimeout(()=>t(new Error("Profile query timeout")),2e3)}),a=is.from("profiles").select("*").eq("id",e).single();try{const e=await Promise.race([a,s]),{data:r,error:n}=e;return n?(console.error("\u274c [useAuth] Profile query error:",n),n.code,null):(t(r),r)}catch(l){return"Profile query timeout"===l.message?(console.warn("\u26a0\ufe0f [useAuth] Profile query timeout - returning null to trigger retry"),null):(console.error("\u274c [useAuth] Unexpected profile error:",l),null)}},[]),u=(0,a.useCallback)(async(e,t)=>{r(!0),o(null);try{const{data:s,error:a}=await is.auth.signInWithPassword({email:e,password:t});return a?(o(a),{success:!1,error:a}):{success:!0,user:await d(s.user.id)}}catch(l){return o(l),{success:!1,error:l}}finally{r(!1)}},[d]),h=(0,a.useCallback)(async(e,t,s)=>{r(!0),o(null);try{const{data:r,error:n}=await is.auth.signUp({email:e,password:t,options:{data:{name:s}}});if(n)return o(n),{success:!1,error:n};if(r.user){const{error:t}=await is.from("profiles").upsert({id:r.user.id,name:s,email:e,role:"player",status:"approved"},{onConflict:"id"});t&&console.error("Failed to create profile:",t);try{const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3cGpya21wbHlkcWF4aWlrdXB2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MTUwNjgsImV4cCI6MjA3MTA5MTA2OH0.6xnC3k_CRChyavAfdJT0I4NLN_Wv1ZgIlRO0Jnqckkk";await fetch("".concat(ns,"/functions/v1/notify-new-user-signup"),{method:"POST",headers:{"Content-Type":"application/json",apikey:t,Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:r.user.id,email:e,name:s})})}catch(a){console.warn("Failed to send admin notification:",a)}}return{success:!0,needsApproval:!1}}catch(l){return o(l),{success:!1,error:l}}finally{r(!1)}},[]),m=(0,a.useCallback)(async()=>{r(!0);try{const{error:e}=await is.auth.signOut();if(e)throw e;return t(null),i("normal"),o(null),{success:!0}}catch(l){return o(l),{success:!1,error:l}}finally{r(!1)}},[]),p=(0,a.useCallback)(async e=>{r(!0),o(null);try{const{data:t,error:s}=await is.auth.updateUser({password:e});return s?(o(s),{success:!1,error:s}):(await is.auth.signOut(),i("normal"),window.location.hash&&window.history.replaceState({},document.title,window.location.pathname),{success:!0})}catch(l){return console.error("\ud83d\udca5 Unexpected error:",l),o(l),{success:!1,error:l}}finally{r(!1)}},[]);return(0,a.useEffect)(()=>{let e=!0;const s=setTimeout(()=>{e&&r(!1)},5e3);return(async()=>{try{if(c())return void(e&&(i("reset"),r(!1)));const{data:{session:n},error:l}=await is.auth.getSession();if(!e)return;if(l)return console.error("\u274c [useAuth] Session error:",l),o(l),void r(!1);if(null!==n&&void 0!==n&&n.user){let r=await d(n.user.id);if(!e)return;if(!r){if(await new Promise(e=>setTimeout(e,500)),r=await d(n.user.id),!e)return;var s,a;r||(r={id:n.user.id,name:(null===(s=n.user.user_metadata)||void 0===s?void 0:s.name)||(null===(a=n.user.email)||void 0===a?void 0:a.split("@")[0])||"User",email:n.user.email,status:"pending",role:null},t(r))}}}catch(l){e&&o(l)}finally{e&&r(!1)}})().finally(()=>{clearTimeout(s)}),()=>{e=!1,clearTimeout(s)}},[c,d]),(0,a.useEffect)(()=>{const{data:{subscription:s}}=is.auth.onAuthStateChange(async(s,a)=>{switch(s){case"SIGNED_IN":!a||c()||e||await d(a.user.id);break;case"SIGNED_OUT":t(null),i("normal");break;case"PASSWORD_RECOVERY":i("reset"),t(null)}});return()=>s.unsubscribe()},[c,d,e]),{user:e,loading:s,authMode:n,error:l,actions:{signIn:u,signUp:h,signOut:m,updatePassword:p,setAuthMode:i}}})(),{user:t=null,loading:s=!0,authMode:r="normal",actions:n={}}=e||{},i=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const[t,s]=(0,a.useState)([]),[r,n]=(0,a.useState)(null),[i,l]=(0,a.useState)(null),[o,d]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),m=(0,a.useCallback)(async()=>{try{d(!0);const{data:e,error:t}=await is.from("seasons").select("\n          *,\n          season_players(count)\n        ").order("created_at",{ascending:!1});if(t)throw console.error("\u274c [useSeasonManager] Database error:",t),t;const a=(null===e||void 0===e?void 0:e.map(e=>{var t,s;return c(c({},e),{},{player_count:(null===(t=e.season_players)||void 0===t||null===(s=t[0])||void 0===s?void 0:s.count)||0,season_type:e.season_type||"ladder",league_info:e.league_info||{},display_name:e.name+("league"===e.season_type?" (".concat(e.season_type,")"):""),is_league:"league"===e.season_type})}))||[];s(a);const r=a.filter(e=>"active"===e.status),o=r.length>0?r[0]:null;return n(o),!i&&o&&l(o),a}catch(u){return console.error("Error fetching seasons:",u),h(u),[]}finally{d(!1)}},[i]),p=(0,a.useCallback)(async e=>{try{var t,s,a;d(!0),e.completeExistingSeason&&r&&"ladder"===e.season_type&&await is.from("seasons").update({status:"completed",end_date:(new Date).toISOString().split("T")[0]}).eq("id",r.id);const{data:n,error:i}=await is.from("seasons").insert({name:e.name,start_date:e.start_date,status:"active",season_type:e.season_type||"ladder",league_info:e.league_info||{},elo_enabled:e.elo_enabled||!1,elo_k_factor:e.elo_k_factor||32,elo_initial_rating:e.elo_initial_rating||1200,match_fee_ladder:null!==(t=e.match_fee_ladder)&&void 0!==t?t:2,match_fee_league:null!==(s=e.match_fee_league)&&void 0!==s?s:2,match_fee_singles:null!==(a=e.match_fee_singles)&&void 0!==a?a:2}).select().single();if(i)throw i;if(e.carryOverPlayers&&"ladder"===e.season_type&&r){const{data:e,error:t}=await is.from("season_players").select("\n            *,\n            profile:player_id (\n              id,\n              elo_rating\n            )\n          ").eq("season_id",r.id).order("rank",{ascending:!0});if(t)throw t;if(e.length>0){const t=e.map(e=>{var t;return{season_id:n.id,player_id:e.player_id,rank:e.rank,matches_played:0,matches_won:0,games_played:0,games_won:0,previous_rank:null,elo_rating:(null===(t=e.profile)||void 0===t?void 0:t.elo_rating)||1050}}),{error:s}=await is.from("season_players").insert(t);if(s)throw s}}return await m(),l(n),{success:!0,season:n}}catch(u){return console.error("Error creating season:",u),h(u),{success:!1,error:u}}finally{d(!1)}},[r,m]),g=(0,a.useCallback)(async e=>{try{d(!0);const{error:t}=await is.from("seasons").update({status:"completed",end_date:(new Date).toISOString().split("T")[0]}).eq("id",e);if(t)throw t;return await m(),{success:!0}}catch(u){return console.error("Error completing season:",u),h(u),{success:!1,error:u}}finally{d(!1)}},[m]);(0,a.useEffect)(()=>{e?(async()=>{const e=setTimeout(()=>{console.error("\u274c [useSeasonManager] TIMEOUT: Season initialization timeout (8s) - forcing loading to false"),d(!1),h(new Error("Season loading timeout - please refresh the page"))},8e3);try{await m(),clearTimeout(e)}catch(u){console.error("\u274c [useSeasonManager] Season initialization failed:",u),h(u),clearTimeout(e),d(!1)}})():d(!1)},[e,m]),(0,a.useEffect)(()=>{const e=()=>{m()};return window.addEventListener("refreshSeasonData",e),()=>window.removeEventListener("refreshSeasonData",e)},[m]);const x=(0,a.useCallback)(()=>t.filter(e=>"active"===e.status),[t]),f=(0,a.useCallback)(e=>t.filter(t=>t.season_type===e),[t]),y=(0,a.useCallback)(e=>"league"===(null===e||void 0===e?void 0:e.season_type),[]);return{seasons:t,activeSeason:r,selectedSeason:i,loading:o,error:u,activeSeasons:x(),ladderSeasons:f("ladder"),leagueSeasons:f("league"),actions:{createNewSeason:p,completeSeason:g,setSelectedSeason:l,fetchSeasons:m,getActiveSeasons:x,getSeasonsByType:f,isLeagueSeason:y}}}(!!t),{seasons:l=[],activeSeason:o=null,selectedSeason:d=null,loading:u=!0,actions:h={}}=i||{},m=((e,t)=>{const[s,r]=(0,a.useState)({users:[],currentSeason:null,selectedSeason:null,seasonPlayers:[],availability:[],matchFixtures:[],matchResults:[],loading:{initial:!0,users:!1,seasons:!1,availability:!1,fixtures:!1,results:!1},error:null}),n=(0,a.useCallback)((e,t)=>{r(s=>c(c({},s),{},{loading:c(c({},s.loading),{},{[e]:t})}))},[]),i=(0,a.useCallback)((e,t)=>{r(s=>c(c({},s),{},{[e]:t}))},[]),l=(0,a.useCallback)(async()=>{try{await is.from("seasons").update({status:"completed"}).eq("status","active");const{data:e,error:t}=await is.from("seasons").insert({name:"Season ".concat((new Date).getFullYear()),start_date:(new Date).toISOString().split("T")[0],status:"active"}).select().single();if(t)throw t;return e}catch(w){return console.error("Error creating season:",w),null}},[]),o=(0,a.useCallback)(async()=>{n("users",!0);try{const{data:e,error:t}=await is.from("profiles").select("*").order("name",{ascending:!0});if(t)throw t;return i("users",e||[]),e}catch(w){console.error("Error fetching users:",w),i("error",w)}finally{n("users",!1)}},[n,i]),d=(0,a.useCallback)(async e=>{if(!e)return[];n("users",!0);try{const{data:t,error:s}=await is.from("season_players").select("\n          *,\n          profile:player_id (\n            id,\n            name,\n            email,\n            status,\n            role\n          )\n        ").eq("season_id",e).order("rank",{ascending:!0,nullsLast:!0});if(s)throw s;const a=(null===t||void 0===t?void 0:t.map(e=>c(c({},e.profile),{},{rank:e.rank,matches_played:e.matches_played,matches_won:e.matches_won,games_played:e.games_played,games_won:e.games_won,previous_rank:e.previous_rank,elo_rating:e.elo_rating,in_ladder:!0,season_player_id:e.id})))||[];return i("seasonPlayers",a),a}catch(w){return console.error("Error fetching season players:",w),i("error",w),[]}finally{n("users",!1)}},[n,i]),u=(0,a.useCallback)(async e=>{if(!e)return null;n("seasons",!0);try{const{data:t,error:s}=await is.from("seasons").select("*").eq("id",e).single();if(s)throw s;const{data:a}=await is.from("matches").select("*").eq("season_id",e).order("week_number",{ascending:!0}),r=c(c({},t),{},{matches:a||[]});return i("selectedSeason",r),r}catch(w){return console.error("Error fetching selected season data:",w),i("error",w),null}finally{n("seasons",!1)}},[n,i]),h=(0,a.useCallback)(async()=>{n("seasons",!0);try{const{data:e,error:t}=await is.from("seasons").select("*").eq("status","active").limit(1);if(t)throw t;let s=null===e||void 0===e?void 0:e[0];if(!s&&(s=await l(),!s))return;return i("currentSeason",s),s}catch(w){console.error("Error fetching seasons:",w),i("error",w)}finally{n("seasons",!1)}},[n,i,l]),m=(0,a.useCallback)(async()=>{n("availability",!0);try{const{data:e,error:t}=await is.from("availability").select("*");if(t)throw t;return i("availability",e||[]),e}catch(w){console.error("Error fetching availability:",w)}finally{n("availability",!1)}},[n,i]),p=(0,a.useCallback)(async()=>{n("fixtures",!0);try{const{data:e,error:t}=await is.from("match_fixtures").select("\n          *,\n          player1:player1_id(name),\n          player2:player2_id(name),\n          player3:player3_id(name),\n          player4:player4_id(name),\n          sitting_player:sitting_player_id(name),\n          league_match_rubbers(*)\n        ");if(t)throw t;return i("matchFixtures",e||[]),e}catch(w){console.error("Error fetching fixtures:",w)}finally{n("fixtures",!1)}},[n,i]),g=(0,a.useCallback)(async()=>{n("results",!0);try{const{data:e,error:t}=await is.from("match_results").select("*");if(t)throw t;return i("matchResults",e||[]),e}catch(w){console.error("Error fetching results:",w)}finally{n("results",!1)}},[n,i]),x=(0,a.useCallback)(async e=>{try{const{data:s,error:a}=await is.from("profiles").select("email, name").eq("id",e).single();if(a)throw a;const{error:r}=await is.from("profiles").update({status:"approved"}).eq("id",e);if(r)throw r;try{const{data:{session:t}}=await is.auth.getSession();t&&await fetch("".concat(ns,"/functions/v1/notify-user-approved"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token)},body:JSON.stringify({user_id:e,email:s.email,name:s.name})})}catch(t){console.warn("Failed to send approval email:",t)}return await o(),{success:!0}}catch(w){return console.error("Error approving user:",w),{success:!1,error:w}}},[o]),f=(0,a.useCallback)(async(e,t)=>{try{const{error:s}=await is.from("profiles").update({role:t}).eq("id",e);if(s)throw s;return await o(),{success:!0}}catch(w){return console.error("Error updating user role:",w),{success:!1,error:w}}},[o]),y=(0,a.useCallback)(async(e,s)=>{if(!t)return console.error("No selectedSeasonId provided"),alert("No season selected to add player to"),{success:!1};try{const{data:a}=await is.from("season_players").select("id").eq("season_id",t).eq("player_id",e).maybeSingle();if(a)return alert("Player already in this season"),{success:!1};const{data:r}=await is.from("profiles").select("elo_rating").eq("id",e).single(),{error:n}=await is.from("season_players").insert({season_id:t,player_id:e,rank:parseInt(s)||null,elo_rating:(null===r||void 0===r?void 0:r.elo_rating)||1050});if(n)throw n;return await d(t),await o(),{success:!0}}catch(w){return console.error("Error adding to season:",w),alert("Error: "+w.message),{success:!1,error:w}}},[t,d,o]),b=(0,a.useCallback)(async(e,t,a)=>{try{var r,n,i,l;const o=(null===(r=s.selectedSeason)||void 0===r||null===(n=r.matches)||void 0===n?void 0:n.find(t=>t.id===e))||(null===(i=s.currentSeason)||void 0===i||null===(l=i.matches)||void 0===l?void 0:l.find(t=>t.id===e));if(!o)throw new Error("Match not found");const c=o.match_date;if(void 0===t)await is.from("availability").delete().eq("player_id",a).eq("match_date",c);else{const{data:e}=await is.from("availability").select("*").eq("player_id",a).eq("match_date",c).maybeSingle();e?await is.from("availability").update({is_available:t}).eq("player_id",a).eq("match_date",c):await is.from("availability").insert({player_id:a,match_date:c,is_available:t})}return await m(),{success:!0}}catch(w){return console.error("Error setting availability:",w),alert("Error: "+w.message),{success:!1,error:w}}},[s.selectedSeason,s.currentSeason,m]),v=(0,a.useCallback)(async e=>{if(!e)return console.error("No match date provided"),alert("Please select a date for the match"),{success:!1};if(!t)return console.error("No selectedSeasonId provided"),alert("No season selected"),{success:!1};let s;try{const{data:e,error:a}=await is.from("seasons").select("*").eq("id",t).single();if(a)throw a;s=e}catch(w){return console.error("Error fetching season:",w),alert("Error finding selected season"),{success:!1}}if(!s)return alert("Selected season not found"),{success:!1};try{var a;const{data:r}=await is.from("matches").select("week_number").eq("season_id",s.id).order("week_number",{ascending:!1}).limit(1),n=((null===r||void 0===r||null===(a=r[0])||void 0===a?void 0:a.week_number)||0)+1,{error:i}=await is.from("matches").insert({season_id:s.id,week_number:n,match_date:e});if(i)throw i;return await h(),await u(t),window.dispatchEvent(new CustomEvent("refreshSeasonData")),alert("Match created for Week ".concat(n)),{success:!0}}catch(w){return console.error("Error adding match:",w),alert("Error: "+w.message),{success:!1,error:w}}},[t,h,u]),j=(0,a.useCallback)(async function(e){var a,r,n,i;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"winPercent",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=(null===(a=s.selectedSeason)||void 0===a||null===(r=a.matches)||void 0===r?void 0:r.find(t=>t.id===e))||(null===(n=s.currentSeason)||void 0===n||null===(i=n.matches)||void 0===i?void 0:i.find(t=>t.id===e));if(!c)return alert("Match not found"),{success:!1};const d=(s.seasonPlayers.length>0?s.seasonPlayers:s.users.filter(e=>e.in_ladder&&"approved"===e.status)).filter(e=>{const t=s.availability.find(t=>t.player_id===e.id&&t.match_date===c.match_date);return!0===(null===t||void 0===t?void 0:t.is_available)});let m;if("elo"===l){const e=s.selectedSeason||s.currentSeason,t=(null===e||void 0===e?void 0:e.elo_initial_rating)||1200;m=d.sort((e,s)=>{const a=e.elo_rating||t;return(s.elo_rating||t)-a})}else m=d.sort((e,t)=>(e.rank||999)-(t.rank||999));const g=m.length;if(g<4)return alert("Need at least 4 players. Found ".concat(g,".")),{success:!1};if(g%4!==0&&0!==g%5&&9!==g&&5!==g){const e=4*Math.ceil(g/4),t=5*Math.ceil(g/5),s=5*Math.floor(g/5),a=[];return g>1&&a.push("\u2022 ".concat(g-1," players")),g>2&&a.push("\u2022 ".concat(g-2," players")),s>=5&&s!==g&&a.push("\u2022 ".concat(s," players")),a.push("\u2022 Wait for ".concat(Math.min(e,t)," players")),alert("Cannot schedule matches for ".concat(g," players.\n\n")+"This would leave ".concat(g%4," player(s) without a proper court rotation.\n")+"Please adjust your player selection.\n\n"+"Options:\n".concat(a.join("\n"),"\n\n")+"Supported formats:\n\u2022 4, 8, 12, 16... players: Full courts (4 each)\n\u2022 5, 10, 15, 20... players: Rotation courts (5 each)\n\u2022 9 players: Special case (4 + 5 courts)"),{success:!1}}const x=[];if(o&&Array.isArray(o)){const e=o.reduce((e,t)=>e+t,0);if(e!==g)return alert("Court layout error: Layout sums to ".concat(e," but have ").concat(g," players.")),{success:!1};x.push(...os(m,o))}else if(g%4===0)for(let t=0;t<g;t+=4)x.push(m.slice(t,t+4));else if(5===g)x.push(m);else if(9===g)x.push(m.slice(0,4)),x.push(m.slice(4,9));else if(10===g)x.push(m.slice(0,5)),x.push(m.slice(5,10));else{const e=Math.floor(g/4);for(let t=0;t<e;t++)x.push(m.slice(4*t,4*(t+1)));g%4>0&&x.push(m.slice(4*e))}try{const s=[];x.forEach((t,a)=>{const r=a+1;let n=1;5===t.length?[{pair1:[0,1],pair2:[2,3],sitting:4},{pair1:[0,2],pair2:[1,4],sitting:3},{pair1:[0,3],pair2:[2,4],sitting:1},{pair1:[0,4],pair2:[1,3],sitting:2},{pair1:[1,2],pair2:[3,4],sitting:0}].forEach(a=>{s.push({match_id:e,court_number:r,game_number:n++,player1_id:t[a.pair1[0]].id,player2_id:t[a.pair1[1]].id,player3_id:t[a.pair2[0]].id,player4_id:t[a.pair2[1]].id,pair1_player1_id:t[a.pair1[0]].id,pair1_player2_id:t[a.pair1[1]].id,pair2_player1_id:t[a.pair2[0]].id,pair2_player2_id:t[a.pair2[1]].id,sitting_player_id:t[a.sitting].id})}):4===t.length&&[{pair1:[0,3],pair2:[1,2]},{pair1:[0,2],pair2:[1,3]},{pair1:[0,1],pair2:[2,3]}].forEach(a=>{s.push({match_id:e,court_number:r,game_number:n++,player1_id:t[a.pair1[0]].id,player2_id:t[a.pair1[1]].id,player3_id:t[a.pair2[0]].id,player4_id:t[a.pair2[1]].id,pair1_player1_id:t[a.pair1[0]].id,pair1_player2_id:t[a.pair1[1]].id,pair2_player1_id:t[a.pair2[0]].id,pair2_player2_id:t[a.pair2[1]].id,sitting_player_id:null})})});const{error:a}=await is.from("match_fixtures").insert(s);if(a)throw a;return await Promise.all([p(),h(),u(t)]),alert("Matches generated! Created ".concat(x.length," court(s) with ").concat(g," players.")),{success:!0}}catch(w){return console.error("Error generating matches:",w),alert("Error: "+w.message),{success:!1,error:w}}},[s.selectedSeason,s.currentSeason,s.seasonPlayers,s.users,s.availability,t,p,h,u]),_=(0,a.useCallback)(async()=>{try{const{data:e,error:s}=await is.from("league_match_rubbers").select("\n          *,\n          cawood_player1:cawood_player1_id(id, name),\n          cawood_player2:cawood_player2_id(id, name),\n          match_fixture:match_fixture_id!inner (\n            match:match_id!inner (\n              season_id\n            )\n          )\n        ").eq("match_fixture.match.season_id",t);if(s)throw s;if(!e||0===e.length)return await is.from("season_players").update({matches_played:0,matches_won:0,games_played:0,games_won:0}).eq("season_id",t),await d(t),alert("Rankings updated successfully (no league matches yet)!"),{success:!0};const a=new Set;e.forEach(e=>{e.cawood_player1_id&&a.add(e.cawood_player1_id),e.cawood_player2_id&&a.add(e.cawood_player2_id)});const{data:r,error:n}=await is.from("season_players").select("*").eq("season_id",t);if(n)throw n;const i=new Set(r.map(e=>e.player_id)),l=[];for(const c of a)if(!i.has(c)){const{data:e}=await is.from("profiles").select("elo_rating").eq("id",c).single();l.push({season_id:t,player_id:c,rank:null,matches_played:0,matches_won:0,games_played:0,games_won:0,elo_rating:(null===e||void 0===e?void 0:e.elo_rating)||1050})}if(l.length>0){const{error:e}=await is.from("season_players").insert(l);if(e)throw e}const{data:o,error:u}=await is.from("season_players").select("*").eq("season_id",t);if(u)throw u;const h={};o.forEach(e=>{h[e.player_id]=c(c({},e),{},{matches_played:0,matches_won:0,games_played:0,games_won:0,rubbers_played:0})}),e.forEach(e=>{const t=e.cawood_games_won||0,s=e.opponent_games_won||0,a=t+s;if(e.cawood_player1_id&&h[e.cawood_player1_id]){const r=h[e.cawood_player1_id];r.rubbers_played+=1,r.games_played+=a,r.games_won+=t,t>s&&(r.matches_won+=1),r.matches_played+=1}if(e.cawood_player2_id&&h[e.cawood_player2_id]){const r=h[e.cawood_player2_id];r.rubbers_played+=1,r.games_played+=a,r.games_won+=t,t>s&&(r.matches_won+=1),r.matches_played+=1}});const m=Object.values(h).sort((e,t)=>{const s=e.games_played>0?e.games_won/e.games_played:0,a=t.games_played>0?t.games_won/t.games_played:0;return a!==s?a-s:t.games_won!==e.games_won?t.games_won-e.games_won:t.games_played!==e.games_played?t.games_played-e.games_played:0});for(let t=0;t<m.length;t++){const e=m[t],s=t+1;await is.from("season_players").update({previous_rank:e.rank,rank:s,matches_played:e.matches_played,matches_won:e.matches_won,games_played:e.games_played,games_won:e.games_won}).eq("id",e.id)}return await d(t),alert("League rankings updated successfully!"),{success:!0}}catch(w){return console.error("Error updating league rankings:",w),alert("Error updating league rankings: "+w.message),{success:!1,error:w}}},[t,d]),N=(0,a.useCallback)(async()=>{try{const{data:e,error:s}=await is.from("match_fixtures").select("\n          id,\n          match:match_id!inner (\n            id,\n            season_id\n          )\n        ").eq("match.season_id",t);if(s)throw s;if(!e||0===e.length)return await is.from("season_players").update({matches_played:0,matches_won:0,games_played:0,games_won:0}).eq("season_id",t),await d(t),alert("Rankings updated successfully (no matches yet)!"),{success:!0};const a=e.map(e=>e.id),{data:r,error:n}=await is.from("match_results").select("\n          *,\n          fixture:fixture_id (\n            *,\n            player1:player1_id(id, name),\n            player2:player2_id(id, name),\n            player3:player3_id(id, name),\n            player4:player4_id(id, name)\n          )\n        ").in("fixture_id",a).neq("verified",!1);if(n)throw n;const{data:i,error:l}=await is.from("season_players").select("*").eq("season_id",t);if(l)throw l;const o={};i.forEach(e=>{o[e.player_id]=c(c({},e),{},{matches_played:0,matches_won:0,games_played:0,games_won:0})}),null===r||void 0===r||r.forEach(e=>{const t=e.fixture;[t.player1,t.player2,t.player3,t.player4].forEach(s=>{if(s&&o[s.id]){const a=o[s.id];a.matches_played+=1,a.games_played+=e.pair1_score+e.pair2_score;const r=t.pair1_player1_id===s.id||t.pair1_player2_id===s.id,n=r?e.pair1_score>e.pair2_score:e.pair2_score>e.pair1_score,i=r?e.pair1_score:e.pair2_score;n&&(a.matches_won+=1),a.games_won+=i}})});const u=Object.values(o).sort((e,t)=>{const s=e.games_played>0?e.games_won/e.games_played:0,a=t.games_played>0?t.games_won/t.games_played:0;return a!==s?a-s:t.matches_won!==e.matches_won?t.matches_won-e.matches_won:0});for(let t=0;t<u.length;t++){const e=u[t],s=t+1;await is.from("season_players").update({previous_rank:e.rank,rank:s,matches_played:e.matches_played,matches_won:e.matches_won,games_played:e.games_played,games_won:e.games_won}).eq("id",e.id)}return await d(t),alert("Rankings updated successfully!"),{success:!0}}catch(w){return console.error("Error updating ladder rankings:",w),alert("Error updating ladder rankings: "+w.message),{success:!1,error:w}}},[t,d]),k=(0,a.useCallback)(async()=>{try{const{data:e,error:s}=await is.from("match_fixtures").select("\n          id,\n          match_format,\n          match:match_id!inner (\n            id,\n            season_id\n          )\n        ").eq("match.season_id",t).eq("match_format","singles");if(s)throw s;if(!e||0===e.length)return await is.from("season_players").update({matches_played:0,matches_won:0,games_played:0,games_won:0}).eq("season_id",t),await d(t),alert("Rankings updated successfully (no singles matches yet)!"),{success:!0};const a=e.map(e=>e.id),{data:r,error:n}=await is.from("match_results").select("\n          *,\n          fixture:fixture_id (\n            *,\n            player1:player1_id(id, name),\n            player2:player2_id(id, name)\n          )\n        ").in("fixture_id",a).neq("verified",!1);if(n)throw n;const{data:i,error:l}=await is.from("season_players").select("*").eq("season_id",t);if(l)throw l;const o={};i.forEach(e=>{o[e.player_id]=c(c({},e),{},{matches_played:0,matches_won:0,games_played:0,games_won:0})}),null===r||void 0===r||r.forEach(e=>{const t=e.fixture;[t.player1,t.player2].forEach(s=>{if(s&&o[s.id]){const a=o[s.id];a.matches_played+=1,a.games_played+=e.pair1_score+e.pair2_score;const r=t.player1_id===s.id,n=r?e.pair1_score>e.pair2_score:e.pair2_score>e.pair1_score,i=r?e.pair1_score:e.pair2_score;n&&(a.matches_won+=1),a.games_won+=i}})});const u=Object.values(o).sort((e,t)=>{const s=e.games_played>0?e.games_won/e.games_played:0,a=t.games_played>0?t.games_won/t.games_played:0;return a!==s?a-s:t.matches_won!==e.matches_won?t.matches_won-e.matches_won:0});for(let t=0;t<u.length;t++){const e=u[t],s=t+1;await is.from("season_players").update({previous_rank:e.rank,rank:s,matches_played:e.matches_played,matches_won:e.matches_won,games_played:e.games_played,games_won:e.games_won}).eq("id",e.id)}return await d(t),alert("Singles championship rankings updated successfully!"),{success:!0}}catch(w){return console.error("Error updating singles rankings:",w),alert("Error updating singles rankings: "+w.message),{success:!1,error:w}}},[t,d]),S=(0,a.useCallback)(async()=>{if(t)try{const{data:e,error:s}=await is.from("seasons").select("season_type").eq("id",t).single();if(s)throw s;const a=null===e||void 0===e?void 0:e.season_type;return"league"===a?await _():"singles_championship"===a?await k():await N()}catch(w){return console.error("Error updating rankings:",w),alert("Error updating rankings: "+w.message),{success:!1,error:w}}else alert("No season selected for ranking update")},[t,_,k,N]),C=(0,a.useCallback)(async()=>{try{return await is.from("score_challenges").delete().neq("id","00000000-0000-0000-0000-000000000000"),await is.from("score_conflicts").delete().neq("id","00000000-0000-0000-0000-000000000000"),await is.from("match_results").delete().neq("id","00000000-0000-0000-0000-000000000000"),await is.from("match_fixtures").delete().neq("id","00000000-0000-0000-0000-000000000000"),await is.from("matches").delete().neq("id","00000000-0000-0000-0000-000000000000"),await is.from("availability").delete().neq("id","00000000-0000-0000-0000-000000000000"),await is.from("season_players").delete().neq("id","00000000-0000-0000-0000-000000000000"),await is.from("seasons").delete().neq("id","00000000-0000-0000-0000-000000000000"),await is.from("ladder_players").delete().neq("id",0),await is.from("ladders").delete().neq("id",0),i("currentSeason",null),i("selectedSeason",null),i("seasonPlayers",[]),i("availability",[]),i("matchFixtures",[]),i("matchResults",[]),await Promise.all([o(),h(),m(),p(),g()]),window.dispatchEvent(new CustomEvent("refreshSeasonData")),window.dispatchEvent(new CustomEvent("refreshMatchData")),alert("All season and match data cleared! Users have been preserved."),{success:!0}}catch(w){return console.error("Error clearing data:",w),alert("Error clearing data: "+w.message),{success:!1,error:w}}},[o,h,m,p,g]),E=(0,a.useCallback)(async(e,t)=>{try{const{data:t,error:s}=await is.from("season_players").select("id, player_id, elo_rating").eq("season_id",e);if(s)throw s;if(t&&t.length>0){const e=t.map(e=>e.id),{error:s}=await is.from("elo_history").delete().in("season_player_id",e);if(s)throw s}const{data:a}=await is.from("matches").select("id, match_date").eq("season_id",e);if(a&&a.length>0){const e=a.map(e=>e.id),{data:t}=await is.from("match_fixtures").select("id").in("match_id",e);if(t&&t.length>0){const e=t.map(e=>e.id),{error:s}=await is.from("score_challenges").delete().in("fixture_id",e);if(s)throw s;const{error:a}=await is.from("score_conflicts").delete().in("fixture_id",e);if(a)throw a;const{error:r}=await is.from("match_results").delete().in("fixture_id",e);if(r)throw r}const{error:s}=await is.from("match_fixtures").delete().in("match_id",e);if(s)throw s;const r=a.map(e=>e.match_date);if(r.length>0){const{error:e}=await is.from("availability").delete().in("match_date",r);if(e)throw e}const{error:n}=await is.from("matches").delete().in("id",e);if(n)throw n}if(t&&t.length>0)for(const l of t){const{player_id:t}=l,{data:s,error:a}=await is.rpc("restore_player_elo_after_deletion",{player_uuid:t,deleted_season_uuid:e});a&&console.warn("Error restoring ELO for player ".concat(t,":"),a)}const{error:r}=await is.from("season_players").delete().eq("season_id",e);if(r)throw r;const{error:n}=await is.from("trophy_cabinet").delete().eq("season_id",e);if(n)throw n;const{error:i}=await is.from("seasons").delete().eq("id",e);if(i)throw i;return await Promise.all([h(),o(),m(),p(),g()]),window.dispatchEvent(new CustomEvent("refreshSeasonData")),window.dispatchEvent(new CustomEvent("refreshMatchData")),{success:!0}}catch(w){console.error("Error deleting season with ELO restoration:",w);const t={message:w.message,details:w.details||w.hint||"No additional details",code:w.code,constraint:w.constraint||"Unknown constraint"};return console.error("Detailed error:",t),{success:!1,error:t}}},[is,h,o,m,p,g]),P=(0,a.useCallback)(async(e,t)=>{try{const e=t.map((e,t)=>({id:e.id,game_number:t+1})).map(e=>is.from("match_fixtures").update({game_number:e.game_number}).eq("id",e.id)),s=(await Promise.all(e)).filter(e=>e.error);if(s.length>0)throw new Error("Failed to update ".concat(s.length," fixtures"));return await p(),{success:!0}}catch(w){return console.error("Error reordering match fixtures:",w),{success:!1,error:w}}},[is,p]),T=(0,a.useCallback)(async e=>{try{var a,r,n,i;if(!(null===(a=s.selectedSeason)||void 0===a||null===(r=a.matches)||void 0===r?void 0:r.find(t=>t.id===e))&&!(null===(n=s.currentSeason)||void 0===n||null===(i=n.matches)||void 0===i?void 0:i.find(t=>t.id===e)))return alert("Match not found"),{success:!1};const{data:l,error:o}=await is.from("match_fixtures").select("id").eq("match_id",e);if(o)throw o;if(!l||0===l.length)return alert("No generated matches to undo"),{success:!1};const c=l.map(e=>e.id),{data:d,error:m}=await is.from("match_results").select("id").in("fixture_id",c).limit(1);if(m)throw m;if(d&&d.length>0){if(!window.confirm("Warning: Scores have been entered for some matches. Undoing will DELETE all scores for this match. Are you sure you want to continue?"))return{success:!1,cancelled:!0};const{error:e}=await is.from("match_results").delete().in("fixture_id",c);if(e)throw e;await is.from("score_challenges").delete().in("fixture_id",c),await is.from("score_conflicts").delete().in("fixture_id",c)}const{error:x}=await is.from("match_fixtures").delete().eq("match_id",e);if(x)throw x;return await Promise.all([p(),g(),h(),u(t)]),alert("Match generation undone successfully! Player availability has been restored."),{success:!0}}catch(w){return console.error("Error undoing match generation:",w),alert("Error: "+w.message),{success:!1,error:w}}},[s.selectedSeason,s.currentSeason,t,p,g,h,u]),D=(0,a.useCallback)(async(e,t,s)=>{try{const{error:s}=await is.from("season_players").delete().eq("player_id",e);if(s)throw s;const{error:a}=await is.from("profiles").update({status:"suspended",name:"[Deleted User - ".concat(t.substring(0,3),"***]"),email:"deleted_user_".concat(e.substring(0,8),"@deleted.local")}).eq("id",e);if(a)throw a;const{error:r}=await is.from("availability").delete().eq("player_id",e).gte("match_date",(new Date).toISOString());if(r)throw r;return await Promise.all([o(),h(),m()]),window.dispatchEvent(new CustomEvent("refreshUserData")),window.dispatchEvent(new CustomEvent("refreshSeasonData")),{success:!0}}catch(w){return console.error("Error deactivating user:",w),{success:!1,error:w}}},[o,h,m]),A=(0,a.useCallback)((e,t)=>{var a,r,n,i;const l=(null===(a=s.selectedSeason)||void 0===a||null===(r=a.matches)||void 0===r?void 0:r.find(e=>e.id===t))||(null===(n=s.currentSeason)||void 0===n||null===(i=n.matches)||void 0===i?void 0:i.find(e=>e.id===t));if(!l)return;const o=s.availability.find(t=>t.player_id===e&&t.match_date===l.match_date);return null===o||void 0===o?void 0:o.is_available},[s.selectedSeason,s.currentSeason,s.availability]),O=(0,a.useCallback)(e=>{var t,a,r,n;const i=(null===(t=s.selectedSeason)||void 0===t||null===(a=t.matches)||void 0===a?void 0:a.find(t=>t.id===e))||(null===(r=s.currentSeason)||void 0===r||null===(n=r.matches)||void 0===n?void 0:n.find(t=>t.id===e));if(!i)return{total:0,available:0,responded:0,pending:0};const l=s.seasonPlayers.length>0?s.seasonPlayers:s.users.filter(e=>e.in_ladder&&"approved"===e.status),o=s.availability.filter(e=>e.match_date===i.match_date&&!0===e.is_available).length,c=s.availability.filter(e=>e.match_date===i.match_date&&(!0===e.is_available||!1===e.is_available)).length;return{total:l.length,available:o,responded:c,pending:l.length-c}},[s.selectedSeason,s.currentSeason,s.seasonPlayers,s.users,s.availability]),F=(0,a.useCallback)(e=>{const t=s.matchResults.filter(t=>t.fixture_id===e);if(0===t.length)return null;if(1===t.length)return t[0];return t.find(e=>!0===e.verified)||t.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at))[0]},[s.matchResults]),R=(0,a.useCallback)(e=>s.matchResults.filter(t=>t.fixture_id===e).sort((e,t)=>new Date(t.created_at)-new Date(e.created_at)),[s.matchResults]);(0,a.useEffect)(()=>{t&&(d(t),u(t))},[t,d,u]),(0,a.useEffect)(()=>{e?(async()=>{n("initial",!0);const e=setTimeout(()=>{console.error("\u274c [useApp] TIMEOUT: App data initialization timeout (25s) - forcing loading to false"),n("initial",!1),i("error",new Error("App data loading timeout - please refresh the page"))},25e3);try{await Promise.all([o(),h()]),await Promise.all([m(),p(),g()]),clearTimeout(e)}catch(w){console.error("\u274c [useApp] Error loading initial data:",w),i("error",w),clearTimeout(e)}finally{n("initial",!1)}})():n("initial",!1)},[e]),(0,a.useEffect)(()=>{const e=()=>{Promise.all([g(),p(),h()])};return window.addEventListener("refreshMatchData",e),()=>window.removeEventListener("refreshMatchData",e)},[g,p,h]);const M=(0,a.useMemo)(()=>({users:o,seasons:h,selectedSeasonData:()=>u(t),availability:m,fixtures:p,results:g,seasonPlayers:()=>d(t),all:()=>Promise.all([o(),h(),m(),p(),g(),t?u(t):Promise.resolve()])}),[o,h,u,t,m,p,g,d]);return c(c({},s),{},{ladderPlayers:s.seasonPlayers,allUsers:s.users,supabase:is,actions:{approveUser:x,updateUserRole:f,addToLadder:y,setPlayerAvailability:b,addMatchToSeason:v,generateMatches:j,undoGenerateMatches:T,updateRankings:S,clearOldMatches:C,deleteSeason:E,deleteUser:D,reorderMatchFixtures:P},helpers:{getPlayerAvailability:A,getAvailabilityStats:O,getMatchScore:F,getMatchScoreHistory:R},refetch:M})})(null===t||void 0===t?void 0:t.id,null===d||void 0===d?void 0:d.id),{ladderPlayers:p=[],allUsers:g=[],selectedSeason:x=null,availability:f=[],matchFixtures:y=[],matchResults:b=[],loading:v={initial:!0},error:w=null,actions:j={},helpers:_={},refetch:N={},supabase:k=null}=m||{},[S,C]=(0,a.useState)("ladder"),[E,P]=(0,a.useState)(!1),[T,D]=(0,a.useState)(!1),[A,O]=(0,a.useState)(!1),[F,R]=(0,a.useState)(null),[M,I]=(0,a.useState)(""),[L,U]=(0,a.useState)(null);if((0,a.useEffect)(()=>{"coach"===(null===t||void 0===t?void 0:t.role)&&C("coaching")},[null===t||void 0===t?void 0:t.role]),!e||!i||!m)return(0,bs.jsx)("div",{className:"p-4 bg-red-100",children:"Error: Service unavailable"});if(!s&&!u&&(null===v||void 0===v||!v.initial)&&(w||null!==i&&void 0!==i&&i.error||null!==e&&void 0!==e&&e.error)){const e=async()=>{if(null!==N&&void 0!==N&&N.all)try{await N.all()}catch(w){}};return(0,bs.jsx)("div",{className:"min-h-screen bg-red-50 flex items-center justify-center p-4",children:(0,bs.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full",children:[(0,bs.jsx)("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"Connection Error"}),(0,bs.jsx)("p",{className:"text-gray-700 mb-4",children:"There was a problem connecting to the server. This may be temporary."}),(0,bs.jsx)("button",{onClick:e,className:"w-full bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"Retry Connection"})]})})}const z=new URLSearchParams(window.location.search).get("token"),q=window.location.pathname;if("/reset-password"===q&&z)return(0,bs.jsx)(_s,{});if(z&&"/"===q)return(0,bs.jsx)(Cn,{});const W=async()=>{if(null!==j&&void 0!==j&&j.addMatchToSeason){const e=await j.addMatchToSeason(M);null!==e&&void 0!==e&&e.success&&(P(!1),I(""))}};if(s||u||null!==v&&void 0!==v&&v.initial){const e=s?"Authenticating...":u?"Loading seasons...":"Loading app data...";return(0,bs.jsx)(yn,{message:e,onRetry:null===N||void 0===N?void 0:N.all})}return(0,bs.jsxs)(Os,{children:["reset"===r&&(0,bs.jsx)(Fs,{onAuthChange:()=>{},isPasswordReset:!0,onPasswordResetComplete:()=>{null!==n&&void 0!==n&&n.setAuthMode&&n.setAuthMode("normal")}}),!t&&"reset"!==r&&(0,bs.jsx)(Fs,{onAuthChange:()=>{}}),t&&(0,bs.jsx)(wn,{children:(0,bs.jsxs)("div",{className:"min-h-screen bg-gray-50",style:{minHeight:"100dvh"},children:[(0,bs.jsx)("header",{className:"bg-[#5D1F1F] text-white shadow-sm",style:{paddingTop:"env(safe-area-inset-top)"},children:(0,bs.jsx)("div",{className:"max-w-7xl mx-auto px-3 py-3 pb-4",children:(0,bs.jsxs)("div",{className:"flex items-center justify-between h-12",children:[(0,bs.jsx)("div",{className:"flex-1 max-w-[280px] sm:max-w-[320px]",children:(0,bs.jsx)(kn,{seasons:l,selectedSeason:d,onSeasonSelect:null===h||void 0===h?void 0:h.setSelectedSeason,loading:u})}),(0,bs.jsxs)("div",{className:"flex items-center space-x-2",children:["ladder"===(null===d||void 0===d?void 0:d.season_type)&&(0,bs.jsxs)("button",{onClick:()=>O(!0),className:"bg-[#4A1818] hover:bg-[#6B2424] text-white px-3 py-1.5 rounded transition-colors min-h-[44px] flex items-center text-sm",style:{touchAction:"manipulation"},title:"Players Guide",children:[(0,bs.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bs.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Guide"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"?"})]}),(0,bs.jsxs)("button",{onClick:async()=>{if(null!==n&&void 0!==n&&n.signOut)try{await n.signOut()}catch(w){alert("Error signing out. Please try again.")}},className:"bg-[#4A1818] hover:bg-[#6B2424] text-white px-3 py-1.5 rounded transition-colors min-h-[44px] flex items-center text-sm",style:{touchAction:"manipulation"},title:"Sign out ".concat((null===t||void 0===t?void 0:t.name)||""),children:[(0,bs.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bs.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,bs.jsx)("span",{className:"hidden sm:inline",children:"Sign Out"}),(0,bs.jsx)("span",{className:"sm:hidden",children:"Out"})]})]})]})})}),(0,bs.jsx)(Qs,{activeTab:S,setActiveTab:C,currentUser:t,ladderPlayers:p,selectedSeason:d}),(0,bs.jsxs)("main",{className:"max-w-7xl mx-auto px-2 sm:px-4 py-4 sm:py-6 pb-20 sm:pb-6",children:["ladder"===S&&(0,bs.jsx)(oa,{currentUser:t,users:p,updateRankings:(null===j||void 0===j?void 0:j.updateRankings)||(()=>alert("Update rankings not available")),selectedSeason:d,onPlayerSelect:e=>{U(e),C("profile")},supabase:k,matchFixtures:y}),"matches"===S&&(0,bs.jsx)(Na,{currentUser:t,currentSeason:x||d,selectedSeason:d,matchFixtures:y,matchResults:b,availability:f,users:p,generateMatches:(null===j||void 0===j?void 0:j.generateMatches)||(()=>alert("Generate matches not available")),undoGenerateMatches:(null===j||void 0===j?void 0:j.undoGenerateMatches)||(()=>alert("Undo matches not available")),openScoreModal:e=>{R(e),D(!0)},getAvailabilityStats:(null===_||void 0===_?void 0:_.getAvailabilityStats)||(()=>({total:0,available:0,responded:0,pending:0})),getMatchScore:(null===_||void 0===_?void 0:_.getMatchScore)||(()=>null),supabase:k,refetch:N,reorderMatchFixtures:(null===j||void 0===j?void 0:j.reorderMatchFixtures)||(()=>alert("Reorder matches not available"))}),"profile"===S&&(0,bs.jsx)(za,{currentUser:t,seasons:l,selectedSeason:d,allUsers:g,selectedPlayerId:L,onPlayerSelect:U,onPlayerClear:()=>U(null)}),"trophies"===S&&(0,bs.jsx)(Za,{currentUser:t,seasons:l,selectedSeason:d,allUsers:g}),"availability"===S&&(0,bs.jsx)(er,{currentUser:t,currentSeason:x||d,selectedSeason:d,ladderPlayers:p,getPlayerAvailability:(null===_||void 0===_?void 0:_.getPlayerAvailability)||(()=>{}),setPlayerAvailability:(e,s,a)=>{if(null!==j&&void 0!==j&&j.setPlayerAvailability){const r=a||t.id;j.setPlayerAvailability(e,s,r)}},matchFixtures:y,matchResults:b,getMatchScore:(null===_||void 0===_?void 0:_.getMatchScore)||(()=>null)}),"admin"===S&&"admin"===(null===t||void 0===t?void 0:t.role)&&(0,bs.jsx)(Or,{users:g,ladderPlayers:p,currentUser:t,currentSeason:x||d,activeSeason:o,approveUser:(null===j||void 0===j?void 0:j.approveUser)||(()=>alert("Approve user not available")),updateUserRole:(null===j||void 0===j?void 0:j.updateUserRole)||(()=>alert("Update user role not available")),addToLadder:(null===j||void 0===j?void 0:j.addToLadder)||(()=>alert("Add to ladder not available")),fetchUsers:(null===N||void 0===N?void 0:N.users)||(()=>{}),setPlayerAvailability:(null===j||void 0===j?void 0:j.setPlayerAvailability)||(()=>{}),getPlayerAvailability:(null===_||void 0===_?void 0:_.getPlayerAvailability)||(()=>{}),getAvailabilityStats:(null===_||void 0===_?void 0:_.getAvailabilityStats)||(()=>({total:0,available:0,responded:0,pending:0})),clearOldMatches:(null===j||void 0===j?void 0:j.clearOldMatches)||(()=>alert("Clear matches not available")),deleteSeason:(null===j||void 0===j?void 0:j.deleteSeason)||(()=>alert("Delete season not available")),deleteUser:(null===j||void 0===j?void 0:j.deleteUser)||(()=>alert("Delete user not available")),matchFixtures:y,matchResults:b,selectedSeason:d,seasonActions:h,seasons:l,supabase:k,setShowScheduleModal:P,addMatchToSeason:W,refetch:N}),"coaching"===S&&("admin"===(null===t||void 0===t?void 0:t.role)?(0,bs.jsx)(on,{currentUser:t,allUsers:g}):"coach"===(null===t||void 0===t?void 0:t.role)?(0,bs.jsx)(un,{currentUser:t}):(0,bs.jsx)(cn,{currentUser:t})),"coach-payments"===S&&"coach"===(null===t||void 0===t?void 0:t.role)&&(0,bs.jsx)(pn,{currentUser:t})]}),(0,bs.jsx)(gn,{showModal:E,setShowModal:P,newMatchDate:M,setNewMatchDate:I,addMatchToSeason:W}),(0,bs.jsx)(xn,{showModal:T,setShowModal:D,selectedMatch:F,setSelectedMatch:R,submitScore:async(e,s)=>{if(F)try{const a=await(async(e,t,s,a)=>{try{const{data:n,error:i}=await is.from("match_results").select("*").eq("fixture_id",e).maybeSingle();if(i)throw new Error("Error checking existing result: ".concat(i.message));if(n){const{error:r}=await is.from("score_conflicts").insert({fixture_id:e,first_submission_id:n.id,conflicting_submission:{pair1_score:parseInt(t),pair2_score:parseInt(s),submitted_at:(new Date).toISOString()},conflicting_user_id:a});if(r)throw new Error("Error creating conflict record: ".concat(r.message));return{conflict:!0,winningScore:n,conflictingScore:{pair1_score:parseInt(t),pair2_score:parseInt(s)}}}const{data:l,error:o}=await is.from("match_results").insert({fixture_id:e,pair1_score:parseInt(t),pair2_score:parseInt(s),submitted_by:a,verified:!0}).select().single();if(o){if(console.error("\u274c Error inserting result:",o),"23505"===o.code||o.message.includes("duplicate")){const{data:r}=await is.from("match_results").select("*").eq("fixture_id",e).single();if(r)return await is.from("score_conflicts").insert({fixture_id:e,first_submission_id:r.id,conflicting_submission:{pair1_score:parseInt(t),pair2_score:parseInt(s),submitted_at:(new Date).toISOString()},conflicting_user_id:a}),{conflict:!0,winningScore:r,conflictingScore:{pair1_score:parseInt(t),pair2_score:parseInt(s)}}}throw new Error("Error inserting result: ".concat(o.message))}try{await us(e,{pair1_score:parseInt(t),pair2_score:parseInt(s)})}catch(r){console.warn("\u26a0\ufe0f ELO update failed (non-critical):",r)}return{success:!0,result:l}}catch(w){throw console.error("\ud83d\udca5 Error in submitScoreWithConflictHandling:",w),w}})(F.fixtureId,e,s,t.id);return null!==N&&void 0!==N&&N.results&&await N.results(),null!==N&&void 0!==N&&N.seasons&&await N.seasons(),a}catch(w){throw w}},currentUser:t,getMatchScore:(null===_||void 0===_?void 0:_.getMatchScore)||(()=>null),onChallengeScore:async e=>{try{return await(async e=>{try{const{error:t}=await is.from("score_challenges").insert({fixture_id:e.fixtureId,original_result_id:e.originalResultId,challenger_id:e.challengerId,challenged_pair1_score:e.challengedPair1Score,challenged_pair2_score:e.challengedPair2Score,challenge_reason:e.reason});if(t)throw console.error("\u274c Error submitting challenge:",t),new Error("Error submitting challenge: ".concat(t.message));return{success:!0}}catch(w){throw console.error("\ud83d\udca5 Error in submitScoreChallenge:",w),w}})(c(c({},e),{},{challengerId:t.id})),null!==N&&void 0!==N&&N.results&&await N.results(),{success:!0}}catch(w){throw w}}}),(0,bs.jsx)(fn,{showModal:A,setShowModal:O})]})}),(0,bs.jsx)(_n,{}),(0,bs.jsx)(Nn,{position:"bottom-right"})]})};r.createRoot(document.getElementById("root")).render((0,bs.jsx)(a.StrictMode,{children:(0,bs.jsx)(En,{})})),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{}).catch(e=>{})})})();